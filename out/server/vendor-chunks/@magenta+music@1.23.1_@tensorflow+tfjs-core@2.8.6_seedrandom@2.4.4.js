"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4";
exports.ids = ["vendor-chunks/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4"];
exports.modules = {

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core.js":
/*!***************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core.js ***!
  \***************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BasePlayer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.BasePlayer),\n/* harmony export */   BasePlayerCallback: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.BasePlayerCallback),\n/* harmony export */   BaseRecorderCallback: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.BaseRecorderCallback),\n/* harmony export */   BaseSVGVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.BaseSVGVisualizer),\n/* harmony export */   BaseVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.BaseVisualizer),\n/* harmony export */   MIDIPlayer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.MIDIPlayer),\n/* harmony export */   Metronome: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.Metronome),\n/* harmony export */   MetronomeCallbackObject: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.MetronomeCallbackObject),\n/* harmony export */   MidiConversionError: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.MidiConversionError),\n/* harmony export */   PianoRollCanvasVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.PianoRollCanvasVisualizer),\n/* harmony export */   PianoRollSVGVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.PianoRollSVGVisualizer),\n/* harmony export */   Player: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.Player),\n/* harmony export */   PlayerWithClick: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.PlayerWithClick),\n/* harmony export */   Recorder: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.Recorder),\n/* harmony export */   ScrollType: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.ScrollType),\n/* harmony export */   SoundFontPlayer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.SoundFontPlayer),\n/* harmony export */   StaffSVGVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.StaffSVGVisualizer),\n/* harmony export */   Visualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.Visualizer),\n/* harmony export */   WaterfallSVGVisualizer: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.WaterfallSVGVisualizer),\n/* harmony export */   aux_inputs: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.aux_inputs),\n/* harmony export */   blobToNoteSequence: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.blobToNoteSequence),\n/* harmony export */   chords: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.chords),\n/* harmony export */   constants: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.constants),\n/* harmony export */   data: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.data),\n/* harmony export */   logging: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.logging),\n/* harmony export */   melodies: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.melodies),\n/* harmony export */   midiToSequenceProto: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.midiToSequenceProto),\n/* harmony export */   performance: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.performance),\n/* harmony export */   sequenceProtoToMidi: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.sequenceProtoToMidi),\n/* harmony export */   sequences: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.sequences),\n/* harmony export */   urlToBlob: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.urlToBlob),\n/* harmony export */   urlToNoteSequence: () => (/* reexport safe */ _core_index__WEBPACK_IMPORTED_MODULE_0__.urlToNoteSequence)\n/* harmony export */ });\n/* harmony import */ var _core_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./core/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/index.js\");\n\n//# sourceMappingURL=core.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNkI7QUFDN0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb21vbmdhaC5naXRodWIuaW8vLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS5qcz84OWJjIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCAqIGZyb20gJy4vY29yZS9pbmRleCc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb3JlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/aux_inputs.js":
/*!**************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/aux_inputs.js ***!
  \**************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuxiliaryInput: () => (/* binding */ AuxiliaryInput),\n/* harmony export */   BinaryCounter: () => (/* binding */ BinaryCounter),\n/* harmony export */   auxiliaryInputFromSpec: () => (/* binding */ auxiliaryInputFromSpec)\n/* harmony export */ });\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tensorflow/tfjs */ \"(ssr)/./node_modules/.pnpm/@tensorflow+tfjs@2.8.6_seedrandom@2.4.4/node_modules/@tensorflow/tfjs/dist/tf.node.js\");\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction auxiliaryInputFromSpec(spec) {\n    switch (spec.type) {\n        case 'BinaryCounter':\n            return new BinaryCounter(spec.args);\n        default:\n            throw new Error(`Unknown auxiliary input: ${spec}`);\n    }\n}\nclass AuxiliaryInput {\n    constructor(depth) {\n        this.depth = depth;\n    }\n}\nclass BinaryCounter extends AuxiliaryInput {\n    constructor(args) {\n        super(args.numBits);\n    }\n    getTensors(numSteps) {\n        const buffer = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, this.depth]);\n        for (let step = 0; step < numSteps; ++step) {\n            for (let i = 0; i < this.depth; ++i) {\n                buffer.set(Math.floor((step + 1) / Math.pow(2, i)) % 2 ? 1.0 : -1.0, step, i);\n            }\n        }\n        return buffer.toTensor().as2D(numSteps, this.depth);\n    }\n}\n//# sourceMappingURL=aux_inputs.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9hdXhfaW5wdXRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXVDO0FBQ2hDO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0QsS0FBSztBQUM3RDtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsb0RBQVM7QUFDaEMsMkJBQTJCLGlCQUFpQjtBQUM1Qyw0QkFBNEIsZ0JBQWdCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvYXV4X2lucHV0cy5qcz9hOTE4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHRmIGZyb20gJ0B0ZW5zb3JmbG93L3RmanMnO1xuZXhwb3J0IGZ1bmN0aW9uIGF1eGlsaWFyeUlucHV0RnJvbVNwZWMoc3BlYykge1xuICAgIHN3aXRjaCAoc3BlYy50eXBlKSB7XG4gICAgICAgIGNhc2UgJ0JpbmFyeUNvdW50ZXInOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBCaW5hcnlDb3VudGVyKHNwZWMuYXJncyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYXV4aWxpYXJ5IGlucHV0OiAke3NwZWN9YCk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEF1eGlsaWFyeUlucHV0IHtcbiAgICBjb25zdHJ1Y3RvcihkZXB0aCkge1xuICAgICAgICB0aGlzLmRlcHRoID0gZGVwdGg7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEJpbmFyeUNvdW50ZXIgZXh0ZW5kcyBBdXhpbGlhcnlJbnB1dCB7XG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzLm51bUJpdHMpO1xuICAgIH1cbiAgICBnZXRUZW5zb3JzKG51bVN0ZXBzKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRmLmJ1ZmZlcihbbnVtU3RlcHMsIHRoaXMuZGVwdGhdKTtcbiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBudW1TdGVwczsgKytzdGVwKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZGVwdGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5zZXQoTWF0aC5mbG9vcigoc3RlcCArIDEpIC8gTWF0aC5wb3coMiwgaSkpICUgMiA/IDEuMCA6IC0xLjAsIHN0ZXAsIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBidWZmZXIudG9UZW5zb3IoKS5hczJEKG51bVN0ZXBzLCB0aGlzLmRlcHRoKTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXhfaW5wdXRzLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/aux_inputs.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/chords.js":
/*!**********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/chords.js ***!
  \**********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChordEncoder: () => (/* binding */ ChordEncoder),\n/* harmony export */   ChordEncodingException: () => (/* binding */ ChordEncodingException),\n/* harmony export */   ChordQuality: () => (/* binding */ ChordQuality),\n/* harmony export */   ChordSymbolException: () => (/* binding */ ChordSymbolException),\n/* harmony export */   ChordSymbols: () => (/* binding */ ChordSymbols),\n/* harmony export */   MajorMinorChordEncoder: () => (/* binding */ MajorMinorChordEncoder),\n/* harmony export */   PitchChordEncoder: () => (/* binding */ PitchChordEncoder),\n/* harmony export */   TriadChordEncoder: () => (/* binding */ TriadChordEncoder),\n/* harmony export */   chordEncoderFromType: () => (/* binding */ chordEncoderFromType)\n/* harmony export */ });\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tensorflow/tfjs */ \"(ssr)/./node_modules/.pnpm/@tensorflow+tfjs@2.8.6_seedrandom@2.4.4/node_modules/@tensorflow/tfjs/dist/tf.node.js\");\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tonal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tonal */ \"(ssr)/./node_modules/.pnpm/tonal@2.2.2/node_modules/tonal/build/es5.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n\n\n\nconst CHORD_QUALITY_INTERVALS = [\n    ['1P', '3M', '5P'],\n    ['1P', '3m', '5P'],\n    ['1P', '3M', '5A'],\n    ['1P', '3m', '5d'],\n];\nvar ChordQuality;\n(function (ChordQuality) {\n    ChordQuality[ChordQuality[\"Major\"] = 0] = \"Major\";\n    ChordQuality[ChordQuality[\"Minor\"] = 1] = \"Minor\";\n    ChordQuality[ChordQuality[\"Augmented\"] = 2] = \"Augmented\";\n    ChordQuality[ChordQuality[\"Diminished\"] = 3] = \"Diminished\";\n    ChordQuality[ChordQuality[\"Other\"] = 4] = \"Other\";\n})(ChordQuality || (ChordQuality = {}));\nclass ChordSymbolException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass ChordEncodingException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass ChordSymbols {\n    static pitches(chord) {\n        const root = tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.tokenize(chord)[0];\n        if (!root || !tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.exists(chord)) {\n            throw new ChordSymbolException(`Unrecognized chord symbol: ${chord}`);\n        }\n        const notes = tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.notes(chord);\n        return notes.map(tonal__WEBPACK_IMPORTED_MODULE_1__.Note.chroma);\n    }\n    static root(chord) {\n        const root = tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.tokenize(chord)[0];\n        if (!root) {\n            throw new ChordSymbolException(`Chord symbol has unknown root: ${chord}`);\n        }\n        return tonal__WEBPACK_IMPORTED_MODULE_1__.Note.chroma(root);\n    }\n    static quality(chord) {\n        if (!tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.exists(chord)) {\n            throw new ChordSymbolException(`Unrecognized chord symbol: ${chord}`);\n        }\n        const intervals = tonal__WEBPACK_IMPORTED_MODULE_1__.Chord.intervals(chord);\n        const qualities = CHORD_QUALITY_INTERVALS.map(cqis => cqis.every(cqi => intervals.includes(cqi)));\n        const i = qualities.indexOf(true);\n        const j = qualities.lastIndexOf(true);\n        if (i >= 0 && i === j) {\n            return i;\n        }\n        else {\n            return ChordQuality.Other;\n        }\n    }\n}\nclass ChordEncoder {\n    encodeProgression(chords, numSteps) {\n        const encodedChords = chords.map(chord => this.encode(chord));\n        const indices = Array.from(Array(numSteps).keys())\n            .map(step => Math.floor(step * encodedChords.length / numSteps));\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.stack(indices.map(i => encodedChords[i]));\n    }\n}\nfunction chordEncoderFromType(type) {\n    switch (type) {\n        case 'MajorMinorChordEncoder':\n            return new MajorMinorChordEncoder();\n        case 'TriadChordEncoder':\n            return new TriadChordEncoder();\n        case 'PitchChordEncoder':\n            return new PitchChordEncoder();\n        default:\n            throw new Error(`Unknown chord encoder type: ${type}`);\n    }\n}\nclass MajorMinorChordEncoder extends ChordEncoder {\n    constructor() {\n        super(...arguments);\n        this.depth = 1 + 2 * _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES;\n    }\n    index(chord) {\n        if (chord === _constants__WEBPACK_IMPORTED_MODULE_2__.NO_CHORD) {\n            return 0;\n        }\n        const root = ChordSymbols.root(chord);\n        const quality = ChordSymbols.quality(chord);\n        const index = 1 + quality * _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES + root;\n        if (index >= this.depth) {\n            throw new ChordEncodingException(`Chord is neither major nor minor: ${chord}`);\n        }\n        return index;\n    }\n    encode(chord) {\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([this.index(chord)], 'int32'), this.depth)\n            .as1D());\n    }\n}\nclass TriadChordEncoder extends ChordEncoder {\n    constructor() {\n        super(...arguments);\n        this.depth = 1 + 4 * _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES;\n    }\n    index(chord) {\n        if (chord === _constants__WEBPACK_IMPORTED_MODULE_2__.NO_CHORD) {\n            return 0;\n        }\n        const root = ChordSymbols.root(chord);\n        const quality = ChordSymbols.quality(chord);\n        const index = 1 + quality * _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES + root;\n        if (index >= this.depth) {\n            throw new ChordEncodingException(`Chord is not a standard triad: ${chord}`);\n        }\n        return index;\n    }\n    encode(chord) {\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([this.index(chord)], 'int32'), this.depth)\n            .as1D());\n    }\n}\nclass PitchChordEncoder extends ChordEncoder {\n    constructor() {\n        super(...arguments);\n        this.depth = 1 + 3 * _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES;\n    }\n    encode(chord) {\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => {\n            if (chord === _constants__WEBPACK_IMPORTED_MODULE_2__.NO_CHORD) {\n                return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([0], 'int32'), this.depth).as1D();\n            }\n            const root = ChordSymbols.root(chord);\n            const rootEncoding = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([root], 'int32'), _constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES)\n                .as1D();\n            const pitchBuffer = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([_constants__WEBPACK_IMPORTED_MODULE_2__.NUM_PITCH_CLASSES]);\n            ChordSymbols.pitches(chord).forEach(pitch => pitchBuffer.set(1.0, pitch));\n            const pitchEncoding = pitchBuffer.toTensor().as1D();\n            const bassEncoding = rootEncoding;\n            return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.concat1d([_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([0.0]), rootEncoding, pitchEncoding, bassEncoding]);\n        });\n    }\n}\n//# sourceMappingURL=chords.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jaG9yZHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUF1QztBQUNIO0FBQ0s7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9DQUFvQztBQUM5QjtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0EscUJBQXFCLHdDQUFLO0FBQzFCLHNCQUFzQix3Q0FBSztBQUMzQix5RUFBeUUsTUFBTTtBQUMvRTtBQUNBLHNCQUFzQix3Q0FBSztBQUMzQix5QkFBeUIsdUNBQUk7QUFDN0I7QUFDQTtBQUNBLHFCQUFxQix3Q0FBSztBQUMxQjtBQUNBLDZFQUE2RSxNQUFNO0FBQ25GO0FBQ0EsZUFBZSx1Q0FBSTtBQUNuQjtBQUNBO0FBQ0EsYUFBYSx3Q0FBSztBQUNsQix5RUFBeUUsTUFBTTtBQUMvRTtBQUNBLDBCQUEwQix3Q0FBSztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsbURBQVE7QUFDdkI7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxLQUFLO0FBQ2hFO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSw2QkFBNkIseURBQTJCO0FBQ3hEO0FBQ0E7QUFDQSxzQkFBc0IsZ0RBQWtCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHlEQUEyQjtBQUMvRDtBQUNBLGtGQUFrRixNQUFNO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTyxPQUFPLG9EQUFTLENBQUMsc0RBQVc7QUFDbEQ7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EsNkJBQTZCLHlEQUEyQjtBQUN4RDtBQUNBO0FBQ0Esc0JBQXNCLGdEQUFrQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyx5REFBMkI7QUFDL0Q7QUFDQSwrRUFBK0UsTUFBTTtBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsa0RBQU8sT0FBTyxvREFBUyxDQUFDLHNEQUFXO0FBQ2xEO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBLDZCQUE2Qix5REFBMkI7QUFDeEQ7QUFDQTtBQUNBLGVBQWUsa0RBQU87QUFDdEIsMEJBQTBCLGdEQUFrQjtBQUM1Qyx1QkFBdUIsb0RBQVMsQ0FBQyxzREFBVztBQUM1QztBQUNBO0FBQ0EsaUNBQWlDLG9EQUFTLENBQUMsc0RBQVcsbUJBQW1CLHlEQUEyQjtBQUNwRztBQUNBLGdDQUFnQyxvREFBUyxFQUFFLHlEQUEyQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsc0RBQVcsRUFBRSxzREFBVztBQUMzQyxTQUFTO0FBQ1Q7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvY2hvcmRzLmpzPzU0YzEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdGYgZnJvbSAnQHRlbnNvcmZsb3cvdGZqcyc7XG5pbXBvcnQgeyBDaG9yZCwgTm90ZSB9IGZyb20gJ3RvbmFsJztcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5jb25zdCBDSE9SRF9RVUFMSVRZX0lOVEVSVkFMUyA9IFtcbiAgICBbJzFQJywgJzNNJywgJzVQJ10sXG4gICAgWycxUCcsICczbScsICc1UCddLFxuICAgIFsnMVAnLCAnM00nLCAnNUEnXSxcbiAgICBbJzFQJywgJzNtJywgJzVkJ10sXG5dO1xuZXhwb3J0IHZhciBDaG9yZFF1YWxpdHk7XG4oZnVuY3Rpb24gKENob3JkUXVhbGl0eSkge1xuICAgIENob3JkUXVhbGl0eVtDaG9yZFF1YWxpdHlbXCJNYWpvclwiXSA9IDBdID0gXCJNYWpvclwiO1xuICAgIENob3JkUXVhbGl0eVtDaG9yZFF1YWxpdHlbXCJNaW5vclwiXSA9IDFdID0gXCJNaW5vclwiO1xuICAgIENob3JkUXVhbGl0eVtDaG9yZFF1YWxpdHlbXCJBdWdtZW50ZWRcIl0gPSAyXSA9IFwiQXVnbWVudGVkXCI7XG4gICAgQ2hvcmRRdWFsaXR5W0Nob3JkUXVhbGl0eVtcIkRpbWluaXNoZWRcIl0gPSAzXSA9IFwiRGltaW5pc2hlZFwiO1xuICAgIENob3JkUXVhbGl0eVtDaG9yZFF1YWxpdHlbXCJPdGhlclwiXSA9IDRdID0gXCJPdGhlclwiO1xufSkoQ2hvcmRRdWFsaXR5IHx8IChDaG9yZFF1YWxpdHkgPSB7fSkpO1xuZXhwb3J0IGNsYXNzIENob3JkU3ltYm9sRXhjZXB0aW9uIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIENob3JkRW5jb2RpbmdFeGNlcHRpb24gZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ2hvcmRTeW1ib2xzIHtcbiAgICBzdGF0aWMgcGl0Y2hlcyhjaG9yZCkge1xuICAgICAgICBjb25zdCByb290ID0gQ2hvcmQudG9rZW5pemUoY2hvcmQpWzBdO1xuICAgICAgICBpZiAoIXJvb3QgfHwgIUNob3JkLmV4aXN0cyhjaG9yZCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDaG9yZFN5bWJvbEV4Y2VwdGlvbihgVW5yZWNvZ25pemVkIGNob3JkIHN5bWJvbDogJHtjaG9yZH1gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub3RlcyA9IENob3JkLm5vdGVzKGNob3JkKTtcbiAgICAgICAgcmV0dXJuIG5vdGVzLm1hcChOb3RlLmNocm9tYSk7XG4gICAgfVxuICAgIHN0YXRpYyByb290KGNob3JkKSB7XG4gICAgICAgIGNvbnN0IHJvb3QgPSBDaG9yZC50b2tlbml6ZShjaG9yZClbMF07XG4gICAgICAgIGlmICghcm9vdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENob3JkU3ltYm9sRXhjZXB0aW9uKGBDaG9yZCBzeW1ib2wgaGFzIHVua25vd24gcm9vdDogJHtjaG9yZH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTm90ZS5jaHJvbWEocm9vdCk7XG4gICAgfVxuICAgIHN0YXRpYyBxdWFsaXR5KGNob3JkKSB7XG4gICAgICAgIGlmICghQ2hvcmQuZXhpc3RzKGNob3JkKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENob3JkU3ltYm9sRXhjZXB0aW9uKGBVbnJlY29nbml6ZWQgY2hvcmQgc3ltYm9sOiAke2Nob3JkfWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGludGVydmFscyA9IENob3JkLmludGVydmFscyhjaG9yZCk7XG4gICAgICAgIGNvbnN0IHF1YWxpdGllcyA9IENIT1JEX1FVQUxJVFlfSU5URVJWQUxTLm1hcChjcWlzID0+IGNxaXMuZXZlcnkoY3FpID0+IGludGVydmFscy5pbmNsdWRlcyhjcWkpKSk7XG4gICAgICAgIGNvbnN0IGkgPSBxdWFsaXRpZXMuaW5kZXhPZih0cnVlKTtcbiAgICAgICAgY29uc3QgaiA9IHF1YWxpdGllcy5sYXN0SW5kZXhPZih0cnVlKTtcbiAgICAgICAgaWYgKGkgPj0gMCAmJiBpID09PSBqKSB7XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBDaG9yZFF1YWxpdHkuT3RoZXI7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ2hvcmRFbmNvZGVyIHtcbiAgICBlbmNvZGVQcm9ncmVzc2lvbihjaG9yZHMsIG51bVN0ZXBzKSB7XG4gICAgICAgIGNvbnN0IGVuY29kZWRDaG9yZHMgPSBjaG9yZHMubWFwKGNob3JkID0+IHRoaXMuZW5jb2RlKGNob3JkKSk7XG4gICAgICAgIGNvbnN0IGluZGljZXMgPSBBcnJheS5mcm9tKEFycmF5KG51bVN0ZXBzKS5rZXlzKCkpXG4gICAgICAgICAgICAubWFwKHN0ZXAgPT4gTWF0aC5mbG9vcihzdGVwICogZW5jb2RlZENob3Jkcy5sZW5ndGggLyBudW1TdGVwcykpO1xuICAgICAgICByZXR1cm4gdGYuc3RhY2soaW5kaWNlcy5tYXAoaSA9PiBlbmNvZGVkQ2hvcmRzW2ldKSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNob3JkRW5jb2RlckZyb21UeXBlKHR5cGUpIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnTWFqb3JNaW5vckNob3JkRW5jb2Rlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1ham9yTWlub3JDaG9yZEVuY29kZXIoKTtcbiAgICAgICAgY2FzZSAnVHJpYWRDaG9yZEVuY29kZXInOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUcmlhZENob3JkRW5jb2RlcigpO1xuICAgICAgICBjYXNlICdQaXRjaENob3JkRW5jb2Rlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBpdGNoQ2hvcmRFbmNvZGVyKCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gY2hvcmQgZW5jb2RlciB0eXBlOiAke3R5cGV9YCk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIE1ham9yTWlub3JDaG9yZEVuY29kZXIgZXh0ZW5kcyBDaG9yZEVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmRlcHRoID0gMSArIDIgKiBjb25zdGFudHMuTlVNX1BJVENIX0NMQVNTRVM7XG4gICAgfVxuICAgIGluZGV4KGNob3JkKSB7XG4gICAgICAgIGlmIChjaG9yZCA9PT0gY29uc3RhbnRzLk5PX0NIT1JEKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb290ID0gQ2hvcmRTeW1ib2xzLnJvb3QoY2hvcmQpO1xuICAgICAgICBjb25zdCBxdWFsaXR5ID0gQ2hvcmRTeW1ib2xzLnF1YWxpdHkoY2hvcmQpO1xuICAgICAgICBjb25zdCBpbmRleCA9IDEgKyBxdWFsaXR5ICogY29uc3RhbnRzLk5VTV9QSVRDSF9DTEFTU0VTICsgcm9vdDtcbiAgICAgICAgaWYgKGluZGV4ID49IHRoaXMuZGVwdGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDaG9yZEVuY29kaW5nRXhjZXB0aW9uKGBDaG9yZCBpcyBuZWl0aGVyIG1ham9yIG5vciBtaW5vcjogJHtjaG9yZH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICAgIGVuY29kZShjaG9yZCkge1xuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB0Zi5vbmVIb3QodGYudGVuc29yMWQoW3RoaXMuaW5kZXgoY2hvcmQpXSwgJ2ludDMyJyksIHRoaXMuZGVwdGgpXG4gICAgICAgICAgICAuYXMxRCgpKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgVHJpYWRDaG9yZEVuY29kZXIgZXh0ZW5kcyBDaG9yZEVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmRlcHRoID0gMSArIDQgKiBjb25zdGFudHMuTlVNX1BJVENIX0NMQVNTRVM7XG4gICAgfVxuICAgIGluZGV4KGNob3JkKSB7XG4gICAgICAgIGlmIChjaG9yZCA9PT0gY29uc3RhbnRzLk5PX0NIT1JEKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb290ID0gQ2hvcmRTeW1ib2xzLnJvb3QoY2hvcmQpO1xuICAgICAgICBjb25zdCBxdWFsaXR5ID0gQ2hvcmRTeW1ib2xzLnF1YWxpdHkoY2hvcmQpO1xuICAgICAgICBjb25zdCBpbmRleCA9IDEgKyBxdWFsaXR5ICogY29uc3RhbnRzLk5VTV9QSVRDSF9DTEFTU0VTICsgcm9vdDtcbiAgICAgICAgaWYgKGluZGV4ID49IHRoaXMuZGVwdGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDaG9yZEVuY29kaW5nRXhjZXB0aW9uKGBDaG9yZCBpcyBub3QgYSBzdGFuZGFyZCB0cmlhZDogJHtjaG9yZH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICAgIGVuY29kZShjaG9yZCkge1xuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB0Zi5vbmVIb3QodGYudGVuc29yMWQoW3RoaXMuaW5kZXgoY2hvcmQpXSwgJ2ludDMyJyksIHRoaXMuZGVwdGgpXG4gICAgICAgICAgICAuYXMxRCgpKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGl0Y2hDaG9yZEVuY29kZXIgZXh0ZW5kcyBDaG9yZEVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmRlcHRoID0gMSArIDMgKiBjb25zdGFudHMuTlVNX1BJVENIX0NMQVNTRVM7XG4gICAgfVxuICAgIGVuY29kZShjaG9yZCkge1xuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hvcmQgPT09IGNvbnN0YW50cy5OT19DSE9SRCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0Zi5vbmVIb3QodGYudGVuc29yMWQoWzBdLCAnaW50MzInKSwgdGhpcy5kZXB0aCkuYXMxRCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgcm9vdCA9IENob3JkU3ltYm9scy5yb290KGNob3JkKTtcbiAgICAgICAgICAgIGNvbnN0IHJvb3RFbmNvZGluZyA9IHRmLm9uZUhvdCh0Zi50ZW5zb3IxZChbcm9vdF0sICdpbnQzMicpLCBjb25zdGFudHMuTlVNX1BJVENIX0NMQVNTRVMpXG4gICAgICAgICAgICAgICAgLmFzMUQoKTtcbiAgICAgICAgICAgIGNvbnN0IHBpdGNoQnVmZmVyID0gdGYuYnVmZmVyKFtjb25zdGFudHMuTlVNX1BJVENIX0NMQVNTRVNdKTtcbiAgICAgICAgICAgIENob3JkU3ltYm9scy5waXRjaGVzKGNob3JkKS5mb3JFYWNoKHBpdGNoID0+IHBpdGNoQnVmZmVyLnNldCgxLjAsIHBpdGNoKSk7XG4gICAgICAgICAgICBjb25zdCBwaXRjaEVuY29kaW5nID0gcGl0Y2hCdWZmZXIudG9UZW5zb3IoKS5hczFEKCk7XG4gICAgICAgICAgICBjb25zdCBiYXNzRW5jb2RpbmcgPSByb290RW5jb2Rpbmc7XG4gICAgICAgICAgICByZXR1cm4gdGYuY29uY2F0MWQoW3RmLnRlbnNvcjFkKFswLjBdKSwgcm9vdEVuY29kaW5nLCBwaXRjaEVuY29kaW5nLCBiYXNzRW5jb2RpbmddKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2hvcmRzLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/chords.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js":
/*!*****************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js ***!
  \*****************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetch: () => (/* binding */ fetch),\n/* harmony export */   getOfflineAudioContext: () => (/* reexport safe */ _global_browser__WEBPACK_IMPORTED_MODULE_0__.getOfflineAudioContext),\n/* harmony export */   isSafari: () => (/* reexport safe */ _global_browser__WEBPACK_IMPORTED_MODULE_0__.isSafari),\n/* harmony export */   navigator: () => (/* binding */ navigator),\n/* harmony export */   performance: () => (/* binding */ performance)\n/* harmony export */ });\n/* harmony import */ var _global_browser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./global_browser */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global_browser.js\");\nconst isNode = typeof global !== 'undefined' && typeof global.process !== 'undefined';\nconst fetch = isNode ? __webpack_require__(/*! node-fetch */ \"(ssr)/./node_modules/.pnpm/node-fetch@2.6.1/node_modules/node-fetch/lib/index.js\") : window.fetch.bind(window);\nconst performance = isNode ? __webpack_require__(/*! ./performance_node */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/performance_node.js\") : window.performance;\nconst navigator = isNode ? __webpack_require__(/*! ./navigator_node */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/navigator_node.js\") : window.navigator;\n\n//# sourceMappingURL=global.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb21wYXQvZ2xvYmFsLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ08sdUJBQXVCLG1CQUFPLENBQUMsb0dBQVk7QUFDM0MsNkJBQTZCLG1CQUFPLENBQUMseUxBQW9CO0FBQ3pELDJCQUEyQixtQkFBTyxDQUFDLHFMQUFrQjtBQUNRO0FBQ3BFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvY29tcGF0L2dsb2JhbC5qcz80ZGI1Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGlzTm9kZSA9IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBnbG9iYWwucHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCc7XG5leHBvcnQgY29uc3QgZmV0Y2ggPSBpc05vZGUgPyByZXF1aXJlKCdub2RlLWZldGNoJykgOiB3aW5kb3cuZmV0Y2guYmluZCh3aW5kb3cpO1xuZXhwb3J0IGNvbnN0IHBlcmZvcm1hbmNlID0gaXNOb2RlID8gcmVxdWlyZSgnLi9wZXJmb3JtYW5jZV9ub2RlJykgOiB3aW5kb3cucGVyZm9ybWFuY2U7XG5leHBvcnQgY29uc3QgbmF2aWdhdG9yID0gaXNOb2RlID8gcmVxdWlyZSgnLi9uYXZpZ2F0b3Jfbm9kZScpIDogd2luZG93Lm5hdmlnYXRvcjtcbmV4cG9ydCB7IGlzU2FmYXJpLCBnZXRPZmZsaW5lQXVkaW9Db250ZXh0IH0gZnJvbSAnLi9nbG9iYWxfYnJvd3Nlcic7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1nbG9iYWwuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global_browser.js":
/*!*************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global_browser.js ***!
  \*************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetch: () => (/* binding */ fetch),\n/* harmony export */   getOfflineAudioContext: () => (/* binding */ getOfflineAudioContext),\n/* harmony export */   isSafari: () => (/* binding */ isSafari),\n/* harmony export */   navigator: () => (/* binding */ navigator),\n/* harmony export */   performance: () => (/* binding */ performance)\n/* harmony export */ });\nfunction getGlobalObject() {\n    if (typeof globalThis !== 'undefined') {\n        return globalThis;\n    }\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    throw new Error('cannot find the global object');\n}\nconst globalObject = getGlobalObject();\nconst fetch = globalObject.fetch.bind(globalObject);\nconst performance = globalObject.performance;\nconst navigator = globalObject.navigator;\nconst isSafari = !!globalObject.webkitOfflineAudioContext;\nconst isWorker = typeof globalObject.WorkerGlobalScope !== 'undefined';\nfunction getOfflineAudioContext(sampleRate) {\n    const WEBKIT_SAMPLE_RATE = 44100;\n    sampleRate = isSafari ? WEBKIT_SAMPLE_RATE : sampleRate;\n    if (isWorker) {\n        throw new Error('Cannot use offline audio context in a web worker.');\n    }\n    const SafariOfflineCtx = globalObject.webkitOfflineAudioContext;\n    return isSafari ? new SafariOfflineCtx(1, sampleRate, sampleRate) :\n        new globalObject.OfflineAudioContext(1, sampleRate, sampleRate);\n}\n//# sourceMappingURL=global_browser.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb21wYXQvZ2xvYmFsX2Jyb3dzZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvY29tcGF0L2dsb2JhbF9icm93c2VyLmpzPzEyMjQiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZ2V0R2xvYmFsT2JqZWN0KCkge1xuICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGdsb2JhbFRoaXM7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gd2luZG93O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGdsb2JhbDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjYW5ub3QgZmluZCB0aGUgZ2xvYmFsIG9iamVjdCcpO1xufVxuY29uc3QgZ2xvYmFsT2JqZWN0ID0gZ2V0R2xvYmFsT2JqZWN0KCk7XG5leHBvcnQgY29uc3QgZmV0Y2ggPSBnbG9iYWxPYmplY3QuZmV0Y2guYmluZChnbG9iYWxPYmplY3QpO1xuZXhwb3J0IGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsT2JqZWN0LnBlcmZvcm1hbmNlO1xuZXhwb3J0IGNvbnN0IG5hdmlnYXRvciA9IGdsb2JhbE9iamVjdC5uYXZpZ2F0b3I7XG5leHBvcnQgY29uc3QgaXNTYWZhcmkgPSAhIWdsb2JhbE9iamVjdC53ZWJraXRPZmZsaW5lQXVkaW9Db250ZXh0O1xuY29uc3QgaXNXb3JrZXIgPSB0eXBlb2YgZ2xvYmFsT2JqZWN0Lldvcmtlckdsb2JhbFNjb3BlICE9PSAndW5kZWZpbmVkJztcbmV4cG9ydCBmdW5jdGlvbiBnZXRPZmZsaW5lQXVkaW9Db250ZXh0KHNhbXBsZVJhdGUpIHtcbiAgICBjb25zdCBXRUJLSVRfU0FNUExFX1JBVEUgPSA0NDEwMDtcbiAgICBzYW1wbGVSYXRlID0gaXNTYWZhcmkgPyBXRUJLSVRfU0FNUExFX1JBVEUgOiBzYW1wbGVSYXRlO1xuICAgIGlmIChpc1dvcmtlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCB1c2Ugb2ZmbGluZSBhdWRpbyBjb250ZXh0IGluIGEgd2ViIHdvcmtlci4nKTtcbiAgICB9XG4gICAgY29uc3QgU2FmYXJpT2ZmbGluZUN0eCA9IGdsb2JhbE9iamVjdC53ZWJraXRPZmZsaW5lQXVkaW9Db250ZXh0O1xuICAgIHJldHVybiBpc1NhZmFyaSA/IG5ldyBTYWZhcmlPZmZsaW5lQ3R4KDEsIHNhbXBsZVJhdGUsIHNhbXBsZVJhdGUpIDpcbiAgICAgICAgbmV3IGdsb2JhbE9iamVjdC5PZmZsaW5lQXVkaW9Db250ZXh0KDEsIHNhbXBsZVJhdGUsIHNhbXBsZVJhdGUpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z2xvYmFsX2Jyb3dzZXIuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global_browser.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/navigator_node.js":
/*!*************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/navigator_node.js ***!
  \*************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   userAgent: () => (/* binding */ userAgent)\n/* harmony export */ });\nconst userAgent = '';\n//# sourceMappingURL=navigator_node.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb21wYXQvbmF2aWdhdG9yX25vZGUuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFPO0FBQ1AiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb21vbmdhaC5naXRodWIuaW8vLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb21wYXQvbmF2aWdhdG9yX25vZGUuanM/NWRlZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgdXNlckFnZW50ID0gJyc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1uYXZpZ2F0b3Jfbm9kZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/navigator_node.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/performance_node.js":
/*!***************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/performance_node.js ***!
  \***************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   now: () => (/* binding */ now),\n/* harmony export */   timing: () => (/* binding */ timing)\n/* harmony export */ });\nconst NS_PER_SEC = 1e9;\nconst time = global.process.hrtime();\nconst now = () => {\n    const diff = global.process.hrtime(time);\n    return diff[0] + diff[1] / NS_PER_SEC;\n};\nconst timing = {\n    navigationStart: Date.now(),\n};\n//# sourceMappingURL=performance_node.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb21wYXQvcGVyZm9ybWFuY2Vfbm9kZS5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvY29tcGF0L3BlcmZvcm1hbmNlX25vZGUuanM/ZjNkZiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBOU19QRVJfU0VDID0gMWU5O1xuY29uc3QgdGltZSA9IGdsb2JhbC5wcm9jZXNzLmhydGltZSgpO1xuZXhwb3J0IGNvbnN0IG5vdyA9ICgpID0+IHtcbiAgICBjb25zdCBkaWZmID0gZ2xvYmFsLnByb2Nlc3MuaHJ0aW1lKHRpbWUpO1xuICAgIHJldHVybiBkaWZmWzBdICsgZGlmZlsxXSAvIE5TX1BFUl9TRUM7XG59O1xuZXhwb3J0IGNvbnN0IHRpbWluZyA9IHtcbiAgICBuYXZpZ2F0aW9uU3RhcnQ6IERhdGUubm93KCksXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGVyZm9ybWFuY2Vfbm9kZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/performance_node.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js ***!
  \*************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_CHANNEL: () => (/* binding */ DEFAULT_CHANNEL),\n/* harmony export */   DEFAULT_DRUM_PITCH_CLASSES: () => (/* binding */ DEFAULT_DRUM_PITCH_CLASSES),\n/* harmony export */   DEFAULT_PROGRAM: () => (/* binding */ DEFAULT_PROGRAM),\n/* harmony export */   DEFAULT_QUARTERS_PER_MINUTE: () => (/* binding */ DEFAULT_QUARTERS_PER_MINUTE),\n/* harmony export */   DEFAULT_STEPS_PER_BAR: () => (/* binding */ DEFAULT_STEPS_PER_BAR),\n/* harmony export */   DEFAULT_STEPS_PER_QUARTER: () => (/* binding */ DEFAULT_STEPS_PER_QUARTER),\n/* harmony export */   DEFAULT_STEPS_PER_SECOND: () => (/* binding */ DEFAULT_STEPS_PER_SECOND),\n/* harmony export */   DEFAULT_TICKS_PER_QUARTER: () => (/* binding */ DEFAULT_TICKS_PER_QUARTER),\n/* harmony export */   DEFAULT_VELOCITY: () => (/* binding */ DEFAULT_VELOCITY),\n/* harmony export */   DRUM_CHANNEL: () => (/* binding */ DRUM_CHANNEL),\n/* harmony export */   HI_CLICK_CLASS: () => (/* binding */ HI_CLICK_CLASS),\n/* harmony export */   HI_CLICK_PITCH: () => (/* binding */ HI_CLICK_PITCH),\n/* harmony export */   LO_CLICK_CLASS: () => (/* binding */ LO_CLICK_CLASS),\n/* harmony export */   LO_CLICK_PITCH: () => (/* binding */ LO_CLICK_PITCH),\n/* harmony export */   MAX_DRUM_PITCH: () => (/* binding */ MAX_DRUM_PITCH),\n/* harmony export */   MAX_MIDI_PITCH: () => (/* binding */ MAX_MIDI_PITCH),\n/* harmony export */   MAX_MIDI_PROGRAM: () => (/* binding */ MAX_MIDI_PROGRAM),\n/* harmony export */   MAX_MIDI_VELOCITY: () => (/* binding */ MAX_MIDI_VELOCITY),\n/* harmony export */   MAX_PIANO_PITCH: () => (/* binding */ MAX_PIANO_PITCH),\n/* harmony export */   MIDI_PITCHES: () => (/* binding */ MIDI_PITCHES),\n/* harmony export */   MIDI_VELOCITIES: () => (/* binding */ MIDI_VELOCITIES),\n/* harmony export */   MIN_DRUM_PITCH: () => (/* binding */ MIN_DRUM_PITCH),\n/* harmony export */   MIN_MIDI_PITCH: () => (/* binding */ MIN_MIDI_PITCH),\n/* harmony export */   MIN_MIDI_PROGRAM: () => (/* binding */ MIN_MIDI_PROGRAM),\n/* harmony export */   MIN_MIDI_VELOCITY: () => (/* binding */ MIN_MIDI_VELOCITY),\n/* harmony export */   MIN_PIANO_PITCH: () => (/* binding */ MIN_PIANO_PITCH),\n/* harmony export */   NON_DRUM_CHANNELS: () => (/* binding */ NON_DRUM_CHANNELS),\n/* harmony export */   NO_CHORD: () => (/* binding */ NO_CHORD),\n/* harmony export */   NUM_PITCH_CLASSES: () => (/* binding */ NUM_PITCH_CLASSES)\n/* harmony export */ });\nnull;\nconst DEFAULT_QUARTERS_PER_MINUTE = 120.0;\nconst DEFAULT_STEPS_PER_BAR = 16;\nconst DEFAULT_STEPS_PER_QUARTER = 4;\nconst DEFAULT_STEPS_PER_SECOND = 100;\nconst DEFAULT_VELOCITY = 80;\nconst DEFAULT_PROGRAM = 0;\nconst DEFAULT_TICKS_PER_QUARTER = 220;\nconst DEFAULT_CHANNEL = 0;\nconst DRUM_CHANNEL = 9;\nconst NON_DRUM_CHANNELS = [0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15];\nconst DEFAULT_DRUM_PITCH_CLASSES = [\n    [36, 35],\n    [38, 27, 28, 31, 32, 33, 34, 37, 39, 40, 56, 65, 66, 75, 85],\n    [42, 44, 54, 68, 69, 70, 71, 73, 78, 80],\n    [46, 67, 72, 74, 79, 81],\n    [45, 29, 41, 61, 64, 84],\n    [48, 47, 60, 63, 77, 86, 87],\n    [50, 30, 43, 62, 76, 83],\n    [49, 55, 57, 58],\n    [51, 52, 53, 59, 82]\n];\nconst MIN_MIDI_VELOCITY = 0;\nconst MAX_MIDI_VELOCITY = 127;\nconst MIDI_VELOCITIES = MAX_MIDI_VELOCITY - MIN_MIDI_VELOCITY + 1;\nconst NO_CHORD = 'N.C.';\nconst NUM_PITCH_CLASSES = 12;\nconst MIN_MIDI_PITCH = 0;\nconst MAX_MIDI_PITCH = 127;\nconst MIDI_PITCHES = MAX_MIDI_PITCH - MIN_MIDI_PITCH + 1;\nconst MIN_PIANO_PITCH = 21;\nconst MAX_PIANO_PITCH = 108;\nconst MIN_DRUM_PITCH = 35;\nconst MAX_DRUM_PITCH = 81;\nconst MIN_MIDI_PROGRAM = 0;\nconst MAX_MIDI_PROGRAM = 127;\nconst LO_CLICK_PITCH = 89;\nconst HI_CLICK_PITCH = 90;\nconst LO_CLICK_CLASS = 9;\nconst HI_CLICK_CLASS = 10;\n//# sourceMappingURL=constants.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9jb25zdGFudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNQIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvY29uc3RhbnRzLmpzP2NmMmEiXSwic291cmNlc0NvbnRlbnQiOlsibnVsbDtcbmV4cG9ydCBjb25zdCBERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEUgPSAxMjAuMDtcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NURVBTX1BFUl9CQVIgPSAxNjtcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NURVBTX1BFUl9RVUFSVEVSID0gNDtcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NURVBTX1BFUl9TRUNPTkQgPSAxMDA7XG5leHBvcnQgY29uc3QgREVGQVVMVF9WRUxPQ0lUWSA9IDgwO1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfUFJPR1JBTSA9IDA7XG5leHBvcnQgY29uc3QgREVGQVVMVF9USUNLU19QRVJfUVVBUlRFUiA9IDIyMDtcbmV4cG9ydCBjb25zdCBERUZBVUxUX0NIQU5ORUwgPSAwO1xuZXhwb3J0IGNvbnN0IERSVU1fQ0hBTk5FTCA9IDk7XG5leHBvcnQgY29uc3QgTk9OX0RSVU1fQ0hBTk5FTFMgPSBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgMTAsIDExLCAxMiwgMTMsIDE0LCAxNV07XG5leHBvcnQgY29uc3QgREVGQVVMVF9EUlVNX1BJVENIX0NMQVNTRVMgPSBbXG4gICAgWzM2LCAzNV0sXG4gICAgWzM4LCAyNywgMjgsIDMxLCAzMiwgMzMsIDM0LCAzNywgMzksIDQwLCA1NiwgNjUsIDY2LCA3NSwgODVdLFxuICAgIFs0MiwgNDQsIDU0LCA2OCwgNjksIDcwLCA3MSwgNzMsIDc4LCA4MF0sXG4gICAgWzQ2LCA2NywgNzIsIDc0LCA3OSwgODFdLFxuICAgIFs0NSwgMjksIDQxLCA2MSwgNjQsIDg0XSxcbiAgICBbNDgsIDQ3LCA2MCwgNjMsIDc3LCA4NiwgODddLFxuICAgIFs1MCwgMzAsIDQzLCA2MiwgNzYsIDgzXSxcbiAgICBbNDksIDU1LCA1NywgNThdLFxuICAgIFs1MSwgNTIsIDUzLCA1OSwgODJdXG5dO1xuZXhwb3J0IGNvbnN0IE1JTl9NSURJX1ZFTE9DSVRZID0gMDtcbmV4cG9ydCBjb25zdCBNQVhfTUlESV9WRUxPQ0lUWSA9IDEyNztcbmV4cG9ydCBjb25zdCBNSURJX1ZFTE9DSVRJRVMgPSBNQVhfTUlESV9WRUxPQ0lUWSAtIE1JTl9NSURJX1ZFTE9DSVRZICsgMTtcbmV4cG9ydCBjb25zdCBOT19DSE9SRCA9ICdOLkMuJztcbmV4cG9ydCBjb25zdCBOVU1fUElUQ0hfQ0xBU1NFUyA9IDEyO1xuZXhwb3J0IGNvbnN0IE1JTl9NSURJX1BJVENIID0gMDtcbmV4cG9ydCBjb25zdCBNQVhfTUlESV9QSVRDSCA9IDEyNztcbmV4cG9ydCBjb25zdCBNSURJX1BJVENIRVMgPSBNQVhfTUlESV9QSVRDSCAtIE1JTl9NSURJX1BJVENIICsgMTtcbmV4cG9ydCBjb25zdCBNSU5fUElBTk9fUElUQ0ggPSAyMTtcbmV4cG9ydCBjb25zdCBNQVhfUElBTk9fUElUQ0ggPSAxMDg7XG5leHBvcnQgY29uc3QgTUlOX0RSVU1fUElUQ0ggPSAzNTtcbmV4cG9ydCBjb25zdCBNQVhfRFJVTV9QSVRDSCA9IDgxO1xuZXhwb3J0IGNvbnN0IE1JTl9NSURJX1BST0dSQU0gPSAwO1xuZXhwb3J0IGNvbnN0IE1BWF9NSURJX1BST0dSQU0gPSAxMjc7XG5leHBvcnQgY29uc3QgTE9fQ0xJQ0tfUElUQ0ggPSA4OTtcbmV4cG9ydCBjb25zdCBISV9DTElDS19QSVRDSCA9IDkwO1xuZXhwb3J0IGNvbnN0IExPX0NMSUNLX0NMQVNTID0gOTtcbmV4cG9ydCBjb25zdCBISV9DTElDS19DTEFTUyA9IDEwO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29uc3RhbnRzLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/data.js":
/*!********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/data.js ***!
  \********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_DRUM_PITCH_CLASSES: () => (/* reexport safe */ _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_DRUM_PITCH_CLASSES),\n/* harmony export */   DataConverter: () => (/* binding */ DataConverter),\n/* harmony export */   DrumRollConverter: () => (/* binding */ DrumRollConverter),\n/* harmony export */   DrumsConverter: () => (/* binding */ DrumsConverter),\n/* harmony export */   DrumsOneHotConverter: () => (/* binding */ DrumsOneHotConverter),\n/* harmony export */   GrooveConverter: () => (/* binding */ GrooveConverter),\n/* harmony export */   MelodyConverter: () => (/* binding */ MelodyConverter),\n/* harmony export */   MelodyRhythmConverter: () => (/* binding */ MelodyRhythmConverter),\n/* harmony export */   MelodyShapeConverter: () => (/* binding */ MelodyShapeConverter),\n/* harmony export */   MultitrackConverter: () => (/* binding */ MultitrackConverter),\n/* harmony export */   TrioConverter: () => (/* binding */ TrioConverter),\n/* harmony export */   TrioRhythmConverter: () => (/* binding */ TrioRhythmConverter),\n/* harmony export */   converterFromSpec: () => (/* binding */ converterFromSpec)\n/* harmony export */ });\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tensorflow/tfjs */ \"(ssr)/./node_modules/.pnpm/@tensorflow+tfjs@2.8.6_seedrandom@2.4.4/node_modules/@tensorflow/tfjs/dist/tf.node.js\");\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n/* harmony import */ var _melodies__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./melodies */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/melodies.js\");\n/* harmony import */ var _performance__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./performance */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/performance.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n\n\n\n\n\n\n\n\n\nfunction converterFromSpec(spec) {\n    switch (spec.type) {\n        case 'MelodyConverter':\n            return new MelodyConverter(spec.args);\n        case 'MelodyRhythmConverter':\n            return new MelodyRhythmConverter(spec.args);\n        case 'MelodyShapeConverter':\n            return new MelodyShapeConverter(spec.args);\n        case 'DrumsConverter':\n            return new DrumsConverter(spec.args);\n        case 'DrumRollConverter':\n            return new DrumRollConverter(spec.args);\n        case 'TrioConverter':\n            return new TrioConverter(spec.args);\n        case 'TrioRhythmConverter':\n            return new TrioRhythmConverter(spec.args);\n        case 'DrumsOneHotConverter':\n            return new DrumsOneHotConverter(spec.args);\n        case 'MultitrackConverter':\n            return new MultitrackConverter(spec.args);\n        case 'GrooveConverter':\n            return new GrooveConverter(spec.args);\n        default:\n            throw new Error(`Unknown DataConverter type: ${spec}`);\n    }\n}\nclass DataConverter {\n    constructor(args) {\n        this.NUM_SPLITS = 0;\n        this.SEGMENTED_BY_TRACK = false;\n        this.numSteps = args.numSteps;\n        this.numSegments = args.numSegments;\n    }\n    tensorSteps(tensor) {\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.scalar(tensor.shape[0], 'int32');\n    }\n}\nclass DrumsConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.pitchClasses = args.pitchClasses || _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_DRUM_PITCH_CLASSES;\n        this.pitchToClass = new Map();\n        for (let c = 0; c < this.pitchClasses.length; ++c) {\n            this.pitchClasses[c].forEach((p) => {\n                this.pitchToClass.set(p, c);\n            });\n        }\n        this.depth = this.pitchClasses.length + 1;\n    }\n    toTensor(noteSequence) {\n        _sequences__WEBPACK_IMPORTED_MODULE_6__.assertIsQuantizedSequence(noteSequence);\n        const numSteps = this.numSteps || noteSequence.totalQuantizedSteps;\n        const drumRoll = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, this.pitchClasses.length + 1], 'int32');\n        for (let i = 0; i < numSteps; ++i) {\n            drumRoll.set(1, i, -1);\n        }\n        noteSequence.notes.forEach((note) => {\n            drumRoll.set(1, note.quantizedStartStep, this.pitchToClass.get(note.pitch));\n            drumRoll.set(0, note.quantizedStartStep, -1);\n        });\n        return drumRoll.toTensor();\n    }\n    async toNoteSequence(oh, stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        const labelsTensor = oh.argMax(1);\n        const labels = await labelsTensor.data();\n        labelsTensor.dispose();\n        for (let s = 0; s < labels.length; ++s) {\n            for (let p = 0; p < this.pitchClasses.length; p++) {\n                if (labels[s] >> p & 1) {\n                    noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                        pitch: this.pitchClasses[p][0],\n                        quantizedStartStep: s,\n                        quantizedEndStep: s + 1,\n                        isDrum: true\n                    }));\n                }\n            }\n        }\n        noteSequence.totalQuantizedSteps = labels.length;\n        return noteSequence;\n    }\n}\nclass DrumRollConverter extends DrumsConverter {\n    async toNoteSequence(roll, stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        const flatRoll = await roll.data();\n        for (let s = 0; s < roll.shape[0]; ++s) {\n            const pitches = flatRoll.slice(s * this.pitchClasses.length, (s + 1) * this.pitchClasses.length);\n            for (let p = 0; p < pitches.length; ++p) {\n                if (pitches[p]) {\n                    noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                        pitch: this.pitchClasses[p][0],\n                        quantizedStartStep: s,\n                        quantizedEndStep: s + 1,\n                        isDrum: true\n                    }));\n                }\n            }\n        }\n        noteSequence.totalQuantizedSteps = roll.shape[0];\n        return noteSequence;\n    }\n}\nclass DrumsOneHotConverter extends DrumsConverter {\n    constructor(args) {\n        super(args);\n        this.depth = Math.pow(2, this.pitchClasses.length);\n    }\n    toTensor(noteSequence) {\n        _sequences__WEBPACK_IMPORTED_MODULE_6__.assertIsRelativeQuantizedSequence(noteSequence);\n        const numSteps = this.numSteps || noteSequence.totalQuantizedSteps;\n        const labels = Array(numSteps).fill(0);\n        for (const { pitch, quantizedStartStep } of noteSequence.notes) {\n            labels[quantizedStartStep] += Math.pow(2, this.pitchToClass.get(pitch));\n        }\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d(labels, 'int32'), this.depth));\n    }\n}\nclass MelodyConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.NOTE_OFF = 1;\n        this.FIRST_PITCH = 2;\n        this.minPitch = args.minPitch;\n        this.maxPitch = args.maxPitch;\n        this.ignorePolyphony = args.ignorePolyphony;\n        this.depth = args.maxPitch - args.minPitch + 1 + this.FIRST_PITCH;\n    }\n    toTensor(noteSequence) {\n        const melody = _melodies__WEBPACK_IMPORTED_MODULE_4__.Melody.fromNoteSequence(noteSequence, this.minPitch, this.maxPitch, this.ignorePolyphony, this.numSteps);\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor(melody.events, [melody.events.length], 'int32'), this.depth));\n    }\n    async toNoteSequence(oh, stepsPerQuarter, qpm) {\n        const labelsTensor = oh.argMax(1);\n        const labels = await labelsTensor.data();\n        labelsTensor.dispose();\n        const melody = new _melodies__WEBPACK_IMPORTED_MODULE_4__.Melody(labels, this.minPitch, this.maxPitch);\n        return melody.toNoteSequence(stepsPerQuarter, qpm);\n    }\n}\nclass MelodyControlConverter extends DataConverter {\n    constructor(args, melodyControl) {\n        super(args);\n        this.minPitch = args.minPitch;\n        this.maxPitch = args.maxPitch;\n        this.ignorePolyphony = args.ignorePolyphony;\n        this.melodyControl = melodyControl;\n        this.depth = melodyControl.depth;\n    }\n    toTensor(noteSequence) {\n        const melody = _melodies__WEBPACK_IMPORTED_MODULE_4__.Melody.fromNoteSequence(noteSequence, this.minPitch, this.maxPitch, this.ignorePolyphony, this.numSteps);\n        return this.melodyControl.extract(melody);\n    }\n}\nclass MelodyRhythmConverter extends MelodyControlConverter {\n    constructor(args) {\n        super(args, new _melodies__WEBPACK_IMPORTED_MODULE_4__.MelodyRhythm());\n    }\n    async toNoteSequence(tensor, stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        const rhythm = await tensor.data();\n        for (let s = 0; s < rhythm.length; ++s) {\n            if (rhythm[s]) {\n                noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                    pitch: _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_DRUM_PITCH_CLASSES[1][0],\n                    quantizedStartStep: s,\n                    quantizedEndStep: s + 1,\n                    isDrum: true\n                }));\n            }\n        }\n        noteSequence.totalQuantizedSteps = rhythm.length;\n        return noteSequence;\n    }\n}\nclass MelodyShapeConverter extends MelodyControlConverter {\n    constructor(args) {\n        super(args, new _melodies__WEBPACK_IMPORTED_MODULE_4__.MelodyShape());\n    }\n    async toNoteSequence(oh, stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        const shapeTensor = oh.argMax(1);\n        const shape = await shapeTensor.data();\n        shapeTensor.dispose();\n        let pitch = Math.round((this.maxPitch + this.minPitch) / 2);\n        for (let s = 0; s < shape.length; ++s) {\n            switch (shape[s]) {\n                case 0:\n                    pitch -= 1;\n                    if (pitch < this.minPitch) {\n                        pitch = this.minPitch;\n                        _logging__WEBPACK_IMPORTED_MODULE_3__.log('Pitch range exceeded when creating NoteSequence from shape.', 'MelodyShapeConverter');\n                    }\n                    break;\n                case 2:\n                    pitch += 1;\n                    if (pitch > this.maxPitch) {\n                        pitch = this.maxPitch;\n                        _logging__WEBPACK_IMPORTED_MODULE_3__.log('Pitch range exceeded when creating NoteSequence from shape.', 'MelodyShapeConverter');\n                    }\n                    break;\n                default:\n                    break;\n            }\n            noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({ pitch, quantizedStartStep: s, quantizedEndStep: s + 1 }));\n        }\n        noteSequence.totalQuantizedSteps = shape.length;\n        return noteSequence;\n    }\n}\nclass TrioConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.NUM_SPLITS = 3;\n        this.MEL_PROG_RANGE = [0, 31];\n        this.BASS_PROG_RANGE = [32, 39];\n        args.melArgs.numSteps = args.numSteps;\n        args.bassArgs.numSteps = args.numSteps;\n        args.drumsArgs.numSteps = args.numSteps;\n        this.melConverter = new MelodyConverter(args.melArgs);\n        this.bassConverter = new MelodyConverter(args.bassArgs);\n        this.drumsConverter = new DrumsOneHotConverter(args.drumsArgs);\n        this.depth =\n            (this.melConverter.depth + this.bassConverter.depth +\n                this.drumsConverter.depth);\n    }\n    toTensor(noteSequence) {\n        _sequences__WEBPACK_IMPORTED_MODULE_6__.assertIsQuantizedSequence(noteSequence);\n        const melSeq = _sequences__WEBPACK_IMPORTED_MODULE_6__.clone(noteSequence);\n        const bassSeq = _sequences__WEBPACK_IMPORTED_MODULE_6__.clone(noteSequence);\n        const drumsSeq = _sequences__WEBPACK_IMPORTED_MODULE_6__.clone(noteSequence);\n        melSeq.notes = noteSequence.notes.filter(n => (!n.isDrum && n.program >= this.MEL_PROG_RANGE[0] &&\n            n.program <= this.MEL_PROG_RANGE[1]));\n        bassSeq.notes = noteSequence.notes.filter(n => (!n.isDrum && n.program >= this.BASS_PROG_RANGE[0] &&\n            n.program <= this.BASS_PROG_RANGE[1]));\n        drumsSeq.notes = noteSequence.notes.filter(n => n.isDrum);\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.concat([\n            this.melConverter.toTensor(melSeq),\n            this.bassConverter.toTensor(bassSeq),\n            this.drumsConverter.toTensor(drumsSeq)\n        ], -1));\n    }\n    async toNoteSequence(th, stepsPerQuarter, qpm) {\n        const ohs = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.split(th, [\n            this.melConverter.depth, this.bassConverter.depth,\n            this.drumsConverter.depth\n        ], -1);\n        const ns = await this.melConverter.toNoteSequence(ohs[0], stepsPerQuarter, qpm);\n        ns.notes.forEach(n => {\n            n.instrument = 0;\n            n.program = 0;\n        });\n        const bassNs = await this.bassConverter.toNoteSequence(ohs[1], stepsPerQuarter, qpm);\n        ns.notes.push(...bassNs.notes.map(n => {\n            n.instrument = 1;\n            n.program = this.BASS_PROG_RANGE[0];\n            return n;\n        }));\n        const drumsNs = await this.drumsConverter.toNoteSequence(ohs[2], stepsPerQuarter, qpm);\n        ns.notes.push(...drumsNs.notes.map(n => {\n            n.instrument = 2;\n            return n;\n        }));\n        ohs.forEach(oh => oh.dispose());\n        return ns;\n    }\n}\nclass TrioRhythmConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.NUM_SPLITS = 3;\n        this.trioConverter = new TrioConverter(args);\n        this.depth = 3;\n    }\n    toTensor(noteSequence) {\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => {\n            const trioTensor = this.trioConverter.toTensor(noteSequence);\n            const instrumentTensors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.split(trioTensor, [\n                this.trioConverter.melConverter.depth,\n                this.trioConverter.bassConverter.depth,\n                this.trioConverter.drumsConverter.depth\n            ], 1);\n            const melodyEvents = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.argMax(instrumentTensors[0], 1);\n            const bassEvents = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.argMax(instrumentTensors[1], 1);\n            const drumsEvents = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.argMax(instrumentTensors[2], 1);\n            const melodyRhythm = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.greater(melodyEvents, 1);\n            const bassRhythm = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.greater(bassEvents, 1);\n            const drumsRhythm = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.greater(drumsEvents, 0);\n            return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.stack([melodyRhythm, bassRhythm, drumsRhythm], 1);\n        });\n    }\n    async toNoteSequence(tensor, stepsPerQuarter, qpm) {\n        const rhythmTensors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.split(tensor, 3, 1);\n        const rhythms = await Promise.all(rhythmTensors.map(t => t.data()));\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        for (let s = 0; s < this.numSteps; ++s) {\n            if (rhythms[0][s]) {\n                noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                    pitch: 72,\n                    quantizedStartStep: s,\n                    quantizedEndStep: s + 1,\n                    instrument: 0,\n                    program: 0,\n                }));\n            }\n            if (rhythms[1][s]) {\n                noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                    pitch: 36,\n                    quantizedStartStep: s,\n                    quantizedEndStep: s + 1,\n                    instrument: 1,\n                    program: 32,\n                }));\n            }\n            if (rhythms[2][s]) {\n                noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                    pitch: _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_DRUM_PITCH_CLASSES[1][0],\n                    quantizedStartStep: s,\n                    quantizedEndStep: s + 1,\n                    instrument: 2,\n                    isDrum: true\n                }));\n            }\n        }\n        noteSequence.totalQuantizedSteps = this.numSteps;\n        return noteSequence;\n    }\n}\nclass MultitrackConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.SEGMENTED_BY_TRACK = true;\n        this.stepsPerQuarter = args.stepsPerQuarter;\n        this.totalSteps = args.totalSteps;\n        this.numVelocityBins = args.numVelocityBins;\n        this.minPitch = args.minPitch ? args.minPitch : _constants__WEBPACK_IMPORTED_MODULE_2__.MIN_MIDI_PITCH;\n        this.maxPitch = args.maxPitch ? args.maxPitch : _constants__WEBPACK_IMPORTED_MODULE_2__.MAX_MIDI_PITCH;\n        this.numPitches = this.maxPitch - this.minPitch + 1;\n        this.performanceEventDepth =\n            2 * this.numPitches + this.totalSteps + this.numVelocityBins;\n        this.numPrograms =\n            _constants__WEBPACK_IMPORTED_MODULE_2__.MAX_MIDI_PROGRAM - _constants__WEBPACK_IMPORTED_MODULE_2__.MIN_MIDI_PROGRAM + 2;\n        this.endToken = this.performanceEventDepth + this.numPrograms;\n        this.depth = this.endToken + 1;\n        this.endTensor = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tensor1d([this.endToken], 'int32'), this.depth)\n            .as1D());\n    }\n    trackToTensor(track) {\n        const maxEventsPerTrack = this.numSteps / this.numSegments;\n        let tokens = undefined;\n        if (track) {\n            while (track.events.length > maxEventsPerTrack - 2) {\n                track.events.pop();\n            }\n            tokens = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([track.events.length + 2], 'int32');\n            tokens.set(this.performanceEventDepth +\n                (track.isDrum ? this.numPrograms - 1 : track.program), 0);\n            track.events.forEach((event, index) => {\n                switch (event.type) {\n                    case 'note-on':\n                        tokens.set(event.pitch - this.minPitch, index + 1);\n                        break;\n                    case 'note-off':\n                        tokens.set(this.numPitches + event.pitch - this.minPitch, index + 1);\n                        break;\n                    case 'time-shift':\n                        tokens.set(2 * this.numPitches + event.steps - 1, index + 1);\n                        break;\n                    case 'velocity-change':\n                        tokens.set(2 * this.numPitches + this.totalSteps + event.velocityBin - 1, index + 1);\n                        break;\n                    default:\n                        throw new Error(`Unrecognized performance event: ${event}`);\n                }\n            });\n            tokens.set(this.endToken, track.events.length + 1);\n        }\n        else {\n            tokens = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([1], 'int32', new Int32Array([this.endToken]));\n        }\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => {\n            const oh = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.oneHot(tokens.toTensor(), this.depth);\n            return oh.pad([[0, maxEventsPerTrack - oh.shape[0]], [0, 0]]);\n        });\n    }\n    toTensor(noteSequence) {\n        _sequences__WEBPACK_IMPORTED_MODULE_6__.assertIsRelativeQuantizedSequence(noteSequence);\n        if (noteSequence.quantizationInfo.stepsPerQuarter !==\n            this.stepsPerQuarter) {\n            throw new Error(`Steps per quarter note mismatch: ${noteSequence.quantizationInfo.stepsPerQuarter} != ${this.stepsPerQuarter}`);\n        }\n        const seq = _sequences__WEBPACK_IMPORTED_MODULE_6__.clone(noteSequence);\n        seq.notes = noteSequence.notes.filter(note => note.pitch >= this.minPitch && note.pitch <= this.maxPitch);\n        const instruments = new Set(seq.notes.map(note => note.instrument));\n        const tracks = Array.from(instruments)\n            .map(instrument => _performance__WEBPACK_IMPORTED_MODULE_5__.Performance.fromNoteSequence(seq, this.totalSteps, this.numVelocityBins, instrument));\n        const sortedTracks = tracks.sort((a, b) => b.isDrum ? -1 : (a.isDrum ? 1 : a.program - b.program));\n        while (sortedTracks.length > this.numSegments) {\n            sortedTracks.pop();\n        }\n        sortedTracks.forEach((track) => track.setNumSteps(this.totalSteps));\n        while (sortedTracks.length < this.numSegments) {\n            sortedTracks.push(undefined);\n        }\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.concat(sortedTracks.map((track) => this.trackToTensor(track)), 0));\n    }\n    tokensToTrack(tokens) {\n        const idx = tokens.indexOf(this.endToken);\n        const endIndex = idx >= 0 ? idx : tokens.length;\n        const trackTokens = tokens.slice(0, endIndex);\n        const eventTokens = trackTokens.filter((token) => token < this.performanceEventDepth);\n        const programTokens = trackTokens.filter((token) => token >= this.performanceEventDepth);\n        const [program, isDrum] = programTokens.length ?\n            (programTokens[0] - this.performanceEventDepth < this.numPrograms - 1 ?\n                [programTokens[0] - this.performanceEventDepth, false] :\n                [0, true]) :\n            [0, false];\n        const events = Array.from(eventTokens).map((token) => {\n            if (token < this.numPitches) {\n                return { type: 'note-on', pitch: this.minPitch + token };\n            }\n            else if (token < 2 * this.numPitches) {\n                return {\n                    type: 'note-off',\n                    pitch: this.minPitch + token - this.numPitches\n                };\n            }\n            else if (token < 2 * this.numPitches + this.totalSteps) {\n                return {\n                    type: 'time-shift',\n                    steps: token - 2 * this.numPitches + 1\n                };\n            }\n            else if (token <\n                2 * this.numPitches + this.totalSteps + this.numVelocityBins) {\n                return {\n                    type: 'velocity-change',\n                    velocityBin: token - 2 * this.numPitches - this.totalSteps + 1\n                };\n            }\n            else {\n                throw new Error(`Invalid performance event token: ${token}`);\n            }\n        });\n        return new _performance__WEBPACK_IMPORTED_MODULE_5__.Performance(events, this.totalSteps, this.numVelocityBins, program, isDrum);\n    }\n    async toNoteSequence(oh, stepsPerQuarter = this.stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_6__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        noteSequence.totalQuantizedSteps = this.totalSteps;\n        const tensors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.split(oh.argMax(1), this.numSegments));\n        const tracks = await Promise.all(tensors.map(async (tensor) => {\n            const tokens = await tensor.data();\n            const track = this.tokensToTrack(tokens);\n            tensor.dispose();\n            return track;\n        }));\n        tracks.forEach((track, instrument) => {\n            track.setNumSteps(this.totalSteps);\n            noteSequence.notes.push(...track.toNoteSequence(instrument).notes);\n        });\n        return noteSequence;\n    }\n}\nclass GrooveConverter extends DataConverter {\n    constructor(args) {\n        super(args);\n        this.TAPIFY_CHANNEL = 3;\n        this.stepsPerQuarter =\n            args.stepsPerQuarter || _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_STEPS_PER_QUARTER;\n        this.pitchClasses = args.pitchClasses || _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_DRUM_PITCH_CLASSES;\n        this.pitchToClass = new Map();\n        for (let c = 0; c < this.pitchClasses.length; ++c) {\n            this.pitchClasses[c].forEach((p) => {\n                this.pitchToClass.set(p, c);\n            });\n        }\n        this.humanize = args.humanize || false;\n        this.tapify = args.tapify || false;\n        this.splitInstruments = args.splitInstruments || false;\n        this.depth = 3;\n    }\n    toTensor(ns) {\n        const qns = _sequences__WEBPACK_IMPORTED_MODULE_6__.isRelativeQuantizedSequence(ns) ?\n            ns :\n            _sequences__WEBPACK_IMPORTED_MODULE_6__.quantizeNoteSequence(ns, this.stepsPerQuarter);\n        const numSteps = this.numSteps;\n        const qpm = (qns.tempos && qns.tempos.length) ?\n            qns.tempos[0].qpm :\n            _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_QUARTERS_PER_MINUTE;\n        const stepLength = (60. / qpm) / this.stepsPerQuarter;\n        const stepNotes = [];\n        for (let i = 0; i < numSteps; ++i) {\n            stepNotes.push(new Map());\n        }\n        qns.notes.forEach(n => {\n            if (!(this.tapify || this.pitchToClass.has(n.pitch))) {\n                return;\n            }\n            const s = n.quantizedStartStep;\n            if (s >= stepNotes.length) {\n                throw Error(`Model does not support sequences with more than ${numSteps} steps (${numSteps * stepLength} seconds at qpm ${qpm}).`);\n            }\n            const d = this.tapify ? this.TAPIFY_CHANNEL : this.pitchToClass.get(n.pitch);\n            if (!stepNotes[s].has(d) || stepNotes[s].get(d).velocity < n.velocity) {\n                stepNotes[s].set(d, n);\n            }\n        });\n        const numDrums = this.pitchClasses.length;\n        const hitVectors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, numDrums]);\n        const velocityVectors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, numDrums]);\n        const offsetVectors = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, numDrums]);\n        function getOffset(n) {\n            if (n.startTime === undefined) {\n                return 0;\n            }\n            const tOnset = n.startTime;\n            const qOnset = n.quantizedStartStep * stepLength;\n            return 2 * (qOnset - tOnset) / stepLength;\n        }\n        for (let s = 0; s < numSteps; ++s) {\n            for (let d = 0; d < numDrums; ++d) {\n                const note = stepNotes[s].get(d);\n                hitVectors.set(note ? 1 : 0, s, d);\n                if (!this.humanize && !this.tapify) {\n                    velocityVectors.set(note ? note.velocity / _constants__WEBPACK_IMPORTED_MODULE_2__.MAX_MIDI_VELOCITY : 0, s, d);\n                }\n                if (!this.humanize) {\n                    offsetVectors.set(note ? getOffset(note) : 0, s, d);\n                }\n            }\n        }\n        return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.tidy(() => {\n            const hits = hitVectors.toTensor();\n            const velocities = velocityVectors.toTensor();\n            const offsets = offsetVectors.toTensor();\n            const outLength = this.splitInstruments ? numSteps * numDrums : numSteps;\n            return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.concat([\n                hits.as2D(outLength, -1), velocities.as2D(outLength, -1),\n                offsets.as2D(outLength, -1)\n            ], 1);\n        });\n    }\n    async toNoteSequence(t, stepsPerQuarter, qpm = _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_QUARTERS_PER_MINUTE) {\n        if (stepsPerQuarter && stepsPerQuarter !== this.stepsPerQuarter) {\n            throw Error('`stepsPerQuarter` is set by the model.');\n        }\n        stepsPerQuarter = this.stepsPerQuarter;\n        const numSteps = this.splitInstruments ?\n            t.shape[0] / this.pitchClasses.length :\n            t.shape[0];\n        const stepLength = (60. / qpm) / this.stepsPerQuarter;\n        const ns = _protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.create({ totalTime: numSteps * stepLength, tempos: [{ qpm }] });\n        const results = await t.data();\n        function clip(v, min, max) {\n            return Math.min(Math.max(v, min), max);\n        }\n        const numDrums = this.pitchClasses.length;\n        for (let s = 0; s < numSteps; ++s) {\n            const stepResults = results.slice(s * numDrums * this.depth, (s + 1) * numDrums * this.depth);\n            for (let d = 0; d < numDrums; ++d) {\n                const hitOutput = stepResults[this.splitInstruments ? d * this.depth : d];\n                const velI = this.splitInstruments ? (d * this.depth + 1) : (numDrums + d);\n                const velOutput = stepResults[velI];\n                const offsetI = this.splitInstruments ? (d * this.depth + 2) : (2 * numDrums + d);\n                const offsetOutput = stepResults[offsetI];\n                if (hitOutput > 0.5) {\n                    const velocity = clip(Math.round(velOutput * _constants__WEBPACK_IMPORTED_MODULE_2__.MAX_MIDI_VELOCITY), _constants__WEBPACK_IMPORTED_MODULE_2__.MIN_MIDI_VELOCITY, _constants__WEBPACK_IMPORTED_MODULE_2__.MAX_MIDI_VELOCITY);\n                    const offset = clip(offsetOutput / 2, -0.5, 0.5);\n                    ns.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                        pitch: this.pitchClasses[d][0],\n                        startTime: (s - offset) * stepLength,\n                        endTime: (s - offset + 1) * stepLength,\n                        velocity,\n                        isDrum: true\n                    }));\n                }\n            }\n        }\n        return ns;\n    }\n}\n//# sourceMappingURL=data.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9kYXRhLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF1QztBQUNVO0FBQ1I7QUFDZ0I7QUFDcEI7QUFDMEI7QUFDbEI7QUFDSjtBQUNIO0FBQy9CO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsS0FBSztBQUNoRTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsb0RBQVM7QUFDeEI7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBLGlEQUFpRCxrRUFBMEI7QUFDM0U7QUFDQSx3QkFBd0IsOEJBQThCO0FBQ3REO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFtQztBQUMzQztBQUNBLHlCQUF5QixvREFBUztBQUNsQyx3QkFBd0IsY0FBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixtRUFBcUM7QUFDbEU7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG1CQUFtQjtBQUMzQyw0QkFBNEIsOEJBQThCO0FBQzFEO0FBQ0EsNENBQTRDLHlEQUFZO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBLDZCQUE2QixtRUFBcUM7QUFDbEU7QUFDQSx3QkFBd0IsbUJBQW1CO0FBQzNDO0FBQ0EsNEJBQTRCLG9CQUFvQjtBQUNoRDtBQUNBLDRDQUE0Qyx5REFBWTtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEseUVBQTJDO0FBQ25EO0FBQ0E7QUFDQSxxQkFBcUIsNEJBQTRCO0FBQ2pEO0FBQ0E7QUFDQSxlQUFlLGtEQUFPLE9BQU8sb0RBQVMsQ0FBQyxzREFBVztBQUNsRDtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw2Q0FBTTtBQUM3QixlQUFlLGtEQUFPLE9BQU8sb0RBQVMsQ0FBQyxvREFBUztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDZDQUFNO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLDZDQUFNO0FBQzdCO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQSx3QkFBd0IsbURBQVk7QUFDcEM7QUFDQTtBQUNBLDZCQUE2QixtRUFBcUM7QUFDbEU7QUFDQSx3QkFBd0IsbUJBQW1CO0FBQzNDO0FBQ0Esd0NBQXdDLHlEQUFZO0FBQ3BELDJCQUEyQixrRUFBMEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQSx3QkFBd0Isa0RBQVc7QUFDbkM7QUFDQTtBQUNBLDZCQUE2QixtRUFBcUM7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isa0JBQWtCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUNBQVc7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlDQUFXO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MseURBQVksZUFBZSx1REFBdUQ7QUFDdEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFtQztBQUMzQyx1QkFBdUIsNkNBQWU7QUFDdEMsd0JBQXdCLDZDQUFlO0FBQ3ZDLHlCQUF5Qiw2Q0FBZTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTyxPQUFPLG9EQUFTO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtREFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsa0RBQU87QUFDdEI7QUFDQSxzQ0FBc0MsbURBQVE7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsb0RBQVM7QUFDMUMsK0JBQStCLG9EQUFTO0FBQ3hDLGdDQUFnQyxvREFBUztBQUN6QyxpQ0FBaUMscURBQVU7QUFDM0MsK0JBQStCLHFEQUFVO0FBQ3pDLGdDQUFnQyxxREFBVTtBQUMxQyxtQkFBbUIsbURBQVE7QUFDM0IsU0FBUztBQUNUO0FBQ0E7QUFDQSw4QkFBOEIsbURBQVE7QUFDdEM7QUFDQSw2QkFBNkIsbUVBQXFDO0FBQ2xFLHdCQUF3QixtQkFBbUI7QUFDM0M7QUFDQSx3Q0FBd0MseURBQVk7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esd0NBQXdDLHlEQUFZO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLHdDQUF3Qyx5REFBWTtBQUNwRCwyQkFBMkIsa0VBQTBCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELHNEQUF3QjtBQUNoRix3REFBd0Qsc0RBQXdCO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBMEIsR0FBRyx3REFBMEI7QUFDbkU7QUFDQTtBQUNBLHlCQUF5QixrREFBTyxPQUFPLG9EQUFTLENBQUMsc0RBQVc7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG9EQUFTO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRUFBMkUsTUFBTTtBQUNqRjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsb0RBQVM7QUFDOUI7QUFDQSxlQUFlLGtEQUFPO0FBQ3RCLHVCQUF1QixvREFBUztBQUNoQztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsUUFBUSx5RUFBMkM7QUFDbkQ7QUFDQTtBQUNBLGdFQUFnRSwrQ0FBK0MsS0FBSyxxQkFBcUI7QUFDekk7QUFDQSxvQkFBb0IsNkNBQWU7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHFEQUF1QjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTyxPQUFPLG9EQUFTO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VBQW9FLE1BQU07QUFDMUU7QUFDQSxTQUFTO0FBQ1QsbUJBQW1CLHFEQUF1QjtBQUMxQztBQUNBO0FBQ0EsNkJBQTZCLG1FQUFxQztBQUNsRTtBQUNBLHdCQUF3QixrREFBTyxPQUFPLG1EQUFRO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsaUVBQW1DO0FBQ3ZFLGlEQUFpRCxrRUFBMEI7QUFDM0U7QUFDQSx3QkFBd0IsOEJBQThCO0FBQ3REO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsbUVBQXFDO0FBQ3pEO0FBQ0EsWUFBWSw0REFBOEI7QUFDMUM7QUFDQTtBQUNBO0FBQ0EsWUFBWSxtRUFBcUM7QUFDakQ7QUFDQTtBQUNBLHdCQUF3QixjQUFjO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRUFBK0UsVUFBVSxTQUFTLHVCQUF1QixpQkFBaUIsSUFBSTtBQUM5STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsMkJBQTJCLG9EQUFTO0FBQ3BDLGdDQUFnQyxvREFBUztBQUN6Qyw4QkFBOEIsb0RBQVM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixjQUFjO0FBQ3RDLDRCQUE0QixjQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCx5REFBMkI7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixvREFBUztBQUM1QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxtREFBbUQsbUVBQXFDO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIseURBQVksVUFBVSw2Q0FBNkMsS0FBSyxHQUFHO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsY0FBYztBQUN0QztBQUNBLDRCQUE0QixjQUFjO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSx5REFBMkIsR0FBRyx5REFBMkIsRUFBRSx5REFBMkI7QUFDdko7QUFDQSxrQ0FBa0MseURBQVk7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9jb3JlL2RhdGEuanM/ZDkzMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB0ZiBmcm9tICdAdGVuc29yZmxvdy90ZmpzJztcbmltcG9ydCB7IE5vdGVTZXF1ZW5jZSB9IGZyb20gJy4uL3Byb3RvYnVmL2luZGV4JztcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBERUZBVUxUX0RSVU1fUElUQ0hfQ0xBU1NFUyB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCAqIGFzIGxvZ2dpbmcgZnJvbSAnLi9sb2dnaW5nJztcbmltcG9ydCB7IE1lbG9keSwgTWVsb2R5Umh5dGhtLCBNZWxvZHlTaGFwZSB9IGZyb20gJy4vbWVsb2RpZXMnO1xuaW1wb3J0ICogYXMgcGVyZm9ybWFuY2UgZnJvbSAnLi9wZXJmb3JtYW5jZSc7XG5pbXBvcnQgKiBhcyBzZXF1ZW5jZXMgZnJvbSAnLi9zZXF1ZW5jZXMnO1xuZXhwb3J0IHsgREVGQVVMVF9EUlVNX1BJVENIX0NMQVNTRVMgfTtcbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0ZXJGcm9tU3BlYyhzcGVjKSB7XG4gICAgc3dpdGNoIChzcGVjLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnTWVsb2R5Q29udmVydGVyJzpcbiAgICAgICAgICAgIHJldHVybiBuZXcgTWVsb2R5Q29udmVydGVyKHNwZWMuYXJncyk7XG4gICAgICAgIGNhc2UgJ01lbG9keVJoeXRobUNvbnZlcnRlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1lbG9keVJoeXRobUNvbnZlcnRlcihzcGVjLmFyZ3MpO1xuICAgICAgICBjYXNlICdNZWxvZHlTaGFwZUNvbnZlcnRlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1lbG9keVNoYXBlQ29udmVydGVyKHNwZWMuYXJncyk7XG4gICAgICAgIGNhc2UgJ0RydW1zQ29udmVydGVyJzpcbiAgICAgICAgICAgIHJldHVybiBuZXcgRHJ1bXNDb252ZXJ0ZXIoc3BlYy5hcmdzKTtcbiAgICAgICAgY2FzZSAnRHJ1bVJvbGxDb252ZXJ0ZXInOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEcnVtUm9sbENvbnZlcnRlcihzcGVjLmFyZ3MpO1xuICAgICAgICBjYXNlICdUcmlvQ29udmVydGVyJzpcbiAgICAgICAgICAgIHJldHVybiBuZXcgVHJpb0NvbnZlcnRlcihzcGVjLmFyZ3MpO1xuICAgICAgICBjYXNlICdUcmlvUmh5dGhtQ29udmVydGVyJzpcbiAgICAgICAgICAgIHJldHVybiBuZXcgVHJpb1JoeXRobUNvbnZlcnRlcihzcGVjLmFyZ3MpO1xuICAgICAgICBjYXNlICdEcnVtc09uZUhvdENvbnZlcnRlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IERydW1zT25lSG90Q29udmVydGVyKHNwZWMuYXJncyk7XG4gICAgICAgIGNhc2UgJ011bHRpdHJhY2tDb252ZXJ0ZXInOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBNdWx0aXRyYWNrQ29udmVydGVyKHNwZWMuYXJncyk7XG4gICAgICAgIGNhc2UgJ0dyb292ZUNvbnZlcnRlcic6XG4gICAgICAgICAgICByZXR1cm4gbmV3IEdyb292ZUNvbnZlcnRlcihzcGVjLmFyZ3MpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIERhdGFDb252ZXJ0ZXIgdHlwZTogJHtzcGVjfWApO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBEYXRhQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHRoaXMuTlVNX1NQTElUUyA9IDA7XG4gICAgICAgIHRoaXMuU0VHTUVOVEVEX0JZX1RSQUNLID0gZmFsc2U7XG4gICAgICAgIHRoaXMubnVtU3RlcHMgPSBhcmdzLm51bVN0ZXBzO1xuICAgICAgICB0aGlzLm51bVNlZ21lbnRzID0gYXJncy5udW1TZWdtZW50cztcbiAgICB9XG4gICAgdGVuc29yU3RlcHModGVuc29yKSB7XG4gICAgICAgIHJldHVybiB0Zi5zY2FsYXIodGVuc29yLnNoYXBlWzBdLCAnaW50MzInKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgRHJ1bXNDb252ZXJ0ZXIgZXh0ZW5kcyBEYXRhQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLnBpdGNoQ2xhc3NlcyA9IGFyZ3MucGl0Y2hDbGFzc2VzIHx8IERFRkFVTFRfRFJVTV9QSVRDSF9DTEFTU0VTO1xuICAgICAgICB0aGlzLnBpdGNoVG9DbGFzcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCB0aGlzLnBpdGNoQ2xhc3Nlcy5sZW5ndGg7ICsrYykge1xuICAgICAgICAgICAgdGhpcy5waXRjaENsYXNzZXNbY10uZm9yRWFjaCgocCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGl0Y2hUb0NsYXNzLnNldChwLCBjKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVwdGggPSB0aGlzLnBpdGNoQ2xhc3Nlcy5sZW5ndGggKyAxO1xuICAgIH1cbiAgICB0b1RlbnNvcihub3RlU2VxdWVuY2UpIHtcbiAgICAgICAgc2VxdWVuY2VzLmFzc2VydElzUXVhbnRpemVkU2VxdWVuY2Uobm90ZVNlcXVlbmNlKTtcbiAgICAgICAgY29uc3QgbnVtU3RlcHMgPSB0aGlzLm51bVN0ZXBzIHx8IG5vdGVTZXF1ZW5jZS50b3RhbFF1YW50aXplZFN0ZXBzO1xuICAgICAgICBjb25zdCBkcnVtUm9sbCA9IHRmLmJ1ZmZlcihbbnVtU3RlcHMsIHRoaXMucGl0Y2hDbGFzc2VzLmxlbmd0aCArIDFdLCAnaW50MzInKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TdGVwczsgKytpKSB7XG4gICAgICAgICAgICBkcnVtUm9sbC5zZXQoMSwgaSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIG5vdGVTZXF1ZW5jZS5ub3Rlcy5mb3JFYWNoKChub3RlKSA9PiB7XG4gICAgICAgICAgICBkcnVtUm9sbC5zZXQoMSwgbm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAsIHRoaXMucGl0Y2hUb0NsYXNzLmdldChub3RlLnBpdGNoKSk7XG4gICAgICAgICAgICBkcnVtUm9sbC5zZXQoMCwgbm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAsIC0xKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkcnVtUm9sbC50b1RlbnNvcigpO1xuICAgIH1cbiAgICBhc3luYyB0b05vdGVTZXF1ZW5jZShvaCwgc3RlcHNQZXJRdWFydGVyLCBxcG0pIHtcbiAgICAgICAgY29uc3Qgbm90ZVNlcXVlbmNlID0gc2VxdWVuY2VzLmNyZWF0ZVF1YW50aXplZE5vdGVTZXF1ZW5jZShzdGVwc1BlclF1YXJ0ZXIsIHFwbSk7XG4gICAgICAgIGNvbnN0IGxhYmVsc1RlbnNvciA9IG9oLmFyZ01heCgxKTtcbiAgICAgICAgY29uc3QgbGFiZWxzID0gYXdhaXQgbGFiZWxzVGVuc29yLmRhdGEoKTtcbiAgICAgICAgbGFiZWxzVGVuc29yLmRpc3Bvc2UoKTtcbiAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCBsYWJlbHMubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHAgPSAwOyBwIDwgdGhpcy5waXRjaENsYXNzZXMubGVuZ3RoOyBwKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobGFiZWxzW3NdID4+IHAgJiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGVTZXF1ZW5jZS5ub3Rlcy5wdXNoKE5vdGVTZXF1ZW5jZS5Ob3RlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwaXRjaDogdGhpcy5waXRjaENsYXNzZXNbcF1bMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRTdGFydFN0ZXA6IHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRFbmRTdGVwOiBzICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRHJ1bTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG5vdGVTZXF1ZW5jZS50b3RhbFF1YW50aXplZFN0ZXBzID0gbGFiZWxzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5vdGVTZXF1ZW5jZTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgRHJ1bVJvbGxDb252ZXJ0ZXIgZXh0ZW5kcyBEcnVtc0NvbnZlcnRlciB7XG4gICAgYXN5bmMgdG9Ob3RlU2VxdWVuY2Uocm9sbCwgc3RlcHNQZXJRdWFydGVyLCBxcG0pIHtcbiAgICAgICAgY29uc3Qgbm90ZVNlcXVlbmNlID0gc2VxdWVuY2VzLmNyZWF0ZVF1YW50aXplZE5vdGVTZXF1ZW5jZShzdGVwc1BlclF1YXJ0ZXIsIHFwbSk7XG4gICAgICAgIGNvbnN0IGZsYXRSb2xsID0gYXdhaXQgcm9sbC5kYXRhKCk7XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgcm9sbC5zaGFwZVswXTsgKytzKSB7XG4gICAgICAgICAgICBjb25zdCBwaXRjaGVzID0gZmxhdFJvbGwuc2xpY2UocyAqIHRoaXMucGl0Y2hDbGFzc2VzLmxlbmd0aCwgKHMgKyAxKSAqIHRoaXMucGl0Y2hDbGFzc2VzLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCA8IHBpdGNoZXMubGVuZ3RoOyArK3ApIHtcbiAgICAgICAgICAgICAgICBpZiAocGl0Y2hlc1twXSkge1xuICAgICAgICAgICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2g6IHRoaXMucGl0Y2hDbGFzc2VzW3BdWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkU3RhcnRTdGVwOiBzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkRW5kU3RlcDogcyArIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0RydW06IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBub3RlU2VxdWVuY2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IHJvbGwuc2hhcGVbMF07XG4gICAgICAgIHJldHVybiBub3RlU2VxdWVuY2U7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIERydW1zT25lSG90Q29udmVydGVyIGV4dGVuZHMgRHJ1bXNDb252ZXJ0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG4gICAgICAgIHRoaXMuZGVwdGggPSBNYXRoLnBvdygyLCB0aGlzLnBpdGNoQ2xhc3Nlcy5sZW5ndGgpO1xuICAgIH1cbiAgICB0b1RlbnNvcihub3RlU2VxdWVuY2UpIHtcbiAgICAgICAgc2VxdWVuY2VzLmFzc2VydElzUmVsYXRpdmVRdWFudGl6ZWRTZXF1ZW5jZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBjb25zdCBudW1TdGVwcyA9IHRoaXMubnVtU3RlcHMgfHwgbm90ZVNlcXVlbmNlLnRvdGFsUXVhbnRpemVkU3RlcHM7XG4gICAgICAgIGNvbnN0IGxhYmVscyA9IEFycmF5KG51bVN0ZXBzKS5maWxsKDApO1xuICAgICAgICBmb3IgKGNvbnN0IHsgcGl0Y2gsIHF1YW50aXplZFN0YXJ0U3RlcCB9IG9mIG5vdGVTZXF1ZW5jZS5ub3Rlcykge1xuICAgICAgICAgICAgbGFiZWxzW3F1YW50aXplZFN0YXJ0U3RlcF0gKz0gTWF0aC5wb3coMiwgdGhpcy5waXRjaFRvQ2xhc3MuZ2V0KHBpdGNoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRmLnRpZHkoKCkgPT4gdGYub25lSG90KHRmLnRlbnNvcjFkKGxhYmVscywgJ2ludDMyJyksIHRoaXMuZGVwdGgpKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTWVsb2R5Q29udmVydGVyIGV4dGVuZHMgRGF0YUNvbnZlcnRlciB7XG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcbiAgICAgICAgdGhpcy5OT1RFX09GRiA9IDE7XG4gICAgICAgIHRoaXMuRklSU1RfUElUQ0ggPSAyO1xuICAgICAgICB0aGlzLm1pblBpdGNoID0gYXJncy5taW5QaXRjaDtcbiAgICAgICAgdGhpcy5tYXhQaXRjaCA9IGFyZ3MubWF4UGl0Y2g7XG4gICAgICAgIHRoaXMuaWdub3JlUG9seXBob255ID0gYXJncy5pZ25vcmVQb2x5cGhvbnk7XG4gICAgICAgIHRoaXMuZGVwdGggPSBhcmdzLm1heFBpdGNoIC0gYXJncy5taW5QaXRjaCArIDEgKyB0aGlzLkZJUlNUX1BJVENIO1xuICAgIH1cbiAgICB0b1RlbnNvcihub3RlU2VxdWVuY2UpIHtcbiAgICAgICAgY29uc3QgbWVsb2R5ID0gTWVsb2R5LmZyb21Ob3RlU2VxdWVuY2Uobm90ZVNlcXVlbmNlLCB0aGlzLm1pblBpdGNoLCB0aGlzLm1heFBpdGNoLCB0aGlzLmlnbm9yZVBvbHlwaG9ueSwgdGhpcy5udW1TdGVwcyk7XG4gICAgICAgIHJldHVybiB0Zi50aWR5KCgpID0+IHRmLm9uZUhvdCh0Zi50ZW5zb3IobWVsb2R5LmV2ZW50cywgW21lbG9keS5ldmVudHMubGVuZ3RoXSwgJ2ludDMyJyksIHRoaXMuZGVwdGgpKTtcbiAgICB9XG4gICAgYXN5bmMgdG9Ob3RlU2VxdWVuY2Uob2gsIHN0ZXBzUGVyUXVhcnRlciwgcXBtKSB7XG4gICAgICAgIGNvbnN0IGxhYmVsc1RlbnNvciA9IG9oLmFyZ01heCgxKTtcbiAgICAgICAgY29uc3QgbGFiZWxzID0gYXdhaXQgbGFiZWxzVGVuc29yLmRhdGEoKTtcbiAgICAgICAgbGFiZWxzVGVuc29yLmRpc3Bvc2UoKTtcbiAgICAgICAgY29uc3QgbWVsb2R5ID0gbmV3IE1lbG9keShsYWJlbHMsIHRoaXMubWluUGl0Y2gsIHRoaXMubWF4UGl0Y2gpO1xuICAgICAgICByZXR1cm4gbWVsb2R5LnRvTm90ZVNlcXVlbmNlKHN0ZXBzUGVyUXVhcnRlciwgcXBtKTtcbiAgICB9XG59XG5jbGFzcyBNZWxvZHlDb250cm9sQ29udmVydGVyIGV4dGVuZHMgRGF0YUNvbnZlcnRlciB7XG4gICAgY29uc3RydWN0b3IoYXJncywgbWVsb2R5Q29udHJvbCkge1xuICAgICAgICBzdXBlcihhcmdzKTtcbiAgICAgICAgdGhpcy5taW5QaXRjaCA9IGFyZ3MubWluUGl0Y2g7XG4gICAgICAgIHRoaXMubWF4UGl0Y2ggPSBhcmdzLm1heFBpdGNoO1xuICAgICAgICB0aGlzLmlnbm9yZVBvbHlwaG9ueSA9IGFyZ3MuaWdub3JlUG9seXBob255O1xuICAgICAgICB0aGlzLm1lbG9keUNvbnRyb2wgPSBtZWxvZHlDb250cm9sO1xuICAgICAgICB0aGlzLmRlcHRoID0gbWVsb2R5Q29udHJvbC5kZXB0aDtcbiAgICB9XG4gICAgdG9UZW5zb3Iobm90ZVNlcXVlbmNlKSB7XG4gICAgICAgIGNvbnN0IG1lbG9keSA9IE1lbG9keS5mcm9tTm90ZVNlcXVlbmNlKG5vdGVTZXF1ZW5jZSwgdGhpcy5taW5QaXRjaCwgdGhpcy5tYXhQaXRjaCwgdGhpcy5pZ25vcmVQb2x5cGhvbnksIHRoaXMubnVtU3RlcHMpO1xuICAgICAgICByZXR1cm4gdGhpcy5tZWxvZHlDb250cm9sLmV4dHJhY3QobWVsb2R5KTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTWVsb2R5Umh5dGhtQ29udmVydGVyIGV4dGVuZHMgTWVsb2R5Q29udHJvbENvbnZlcnRlciB7XG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzLCBuZXcgTWVsb2R5Umh5dGhtKCkpO1xuICAgIH1cbiAgICBhc3luYyB0b05vdGVTZXF1ZW5jZSh0ZW5zb3IsIHN0ZXBzUGVyUXVhcnRlciwgcXBtKSB7XG4gICAgICAgIGNvbnN0IG5vdGVTZXF1ZW5jZSA9IHNlcXVlbmNlcy5jcmVhdGVRdWFudGl6ZWROb3RlU2VxdWVuY2Uoc3RlcHNQZXJRdWFydGVyLCBxcG0pO1xuICAgICAgICBjb25zdCByaHl0aG0gPSBhd2FpdCB0ZW5zb3IuZGF0YSgpO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IHJoeXRobS5sZW5ndGg7ICsrcykge1xuICAgICAgICAgICAgaWYgKHJoeXRobVtzXSkge1xuICAgICAgICAgICAgICAgIG5vdGVTZXF1ZW5jZS5ub3Rlcy5wdXNoKE5vdGVTZXF1ZW5jZS5Ob3RlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHBpdGNoOiBERUZBVUxUX0RSVU1fUElUQ0hfQ0xBU1NFU1sxXVswXSxcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkU3RhcnRTdGVwOiBzLFxuICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRFbmRTdGVwOiBzICsgMSxcbiAgICAgICAgICAgICAgICAgICAgaXNEcnVtOiB0cnVlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG5vdGVTZXF1ZW5jZS50b3RhbFF1YW50aXplZFN0ZXBzID0gcmh5dGhtLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5vdGVTZXF1ZW5jZTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTWVsb2R5U2hhcGVDb252ZXJ0ZXIgZXh0ZW5kcyBNZWxvZHlDb250cm9sQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MsIG5ldyBNZWxvZHlTaGFwZSgpKTtcbiAgICB9XG4gICAgYXN5bmMgdG9Ob3RlU2VxdWVuY2Uob2gsIHN0ZXBzUGVyUXVhcnRlciwgcXBtKSB7XG4gICAgICAgIGNvbnN0IG5vdGVTZXF1ZW5jZSA9IHNlcXVlbmNlcy5jcmVhdGVRdWFudGl6ZWROb3RlU2VxdWVuY2Uoc3RlcHNQZXJRdWFydGVyLCBxcG0pO1xuICAgICAgICBjb25zdCBzaGFwZVRlbnNvciA9IG9oLmFyZ01heCgxKTtcbiAgICAgICAgY29uc3Qgc2hhcGUgPSBhd2FpdCBzaGFwZVRlbnNvci5kYXRhKCk7XG4gICAgICAgIHNoYXBlVGVuc29yLmRpc3Bvc2UoKTtcbiAgICAgICAgbGV0IHBpdGNoID0gTWF0aC5yb3VuZCgodGhpcy5tYXhQaXRjaCArIHRoaXMubWluUGl0Y2gpIC8gMik7XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgc2hhcGUubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoc2hhcGVbc10pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIHBpdGNoIC09IDE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwaXRjaCA8IHRoaXMubWluUGl0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpdGNoID0gdGhpcy5taW5QaXRjaDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcubG9nKCdQaXRjaCByYW5nZSBleGNlZWRlZCB3aGVuIGNyZWF0aW5nIE5vdGVTZXF1ZW5jZSBmcm9tIHNoYXBlLicsICdNZWxvZHlTaGFwZUNvbnZlcnRlcicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgcGl0Y2ggKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpdGNoID4gdGhpcy5tYXhQaXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSB0aGlzLm1heFBpdGNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5sb2coJ1BpdGNoIHJhbmdlIGV4Y2VlZGVkIHdoZW4gY3JlYXRpbmcgTm90ZVNlcXVlbmNlIGZyb20gc2hhcGUuJywgJ01lbG9keVNoYXBlQ29udmVydGVyJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoeyBwaXRjaCwgcXVhbnRpemVkU3RhcnRTdGVwOiBzLCBxdWFudGl6ZWRFbmRTdGVwOiBzICsgMSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgbm90ZVNlcXVlbmNlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSBzaGFwZS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBub3RlU2VxdWVuY2U7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFRyaW9Db252ZXJ0ZXIgZXh0ZW5kcyBEYXRhQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLk5VTV9TUExJVFMgPSAzO1xuICAgICAgICB0aGlzLk1FTF9QUk9HX1JBTkdFID0gWzAsIDMxXTtcbiAgICAgICAgdGhpcy5CQVNTX1BST0dfUkFOR0UgPSBbMzIsIDM5XTtcbiAgICAgICAgYXJncy5tZWxBcmdzLm51bVN0ZXBzID0gYXJncy5udW1TdGVwcztcbiAgICAgICAgYXJncy5iYXNzQXJncy5udW1TdGVwcyA9IGFyZ3MubnVtU3RlcHM7XG4gICAgICAgIGFyZ3MuZHJ1bXNBcmdzLm51bVN0ZXBzID0gYXJncy5udW1TdGVwcztcbiAgICAgICAgdGhpcy5tZWxDb252ZXJ0ZXIgPSBuZXcgTWVsb2R5Q29udmVydGVyKGFyZ3MubWVsQXJncyk7XG4gICAgICAgIHRoaXMuYmFzc0NvbnZlcnRlciA9IG5ldyBNZWxvZHlDb252ZXJ0ZXIoYXJncy5iYXNzQXJncyk7XG4gICAgICAgIHRoaXMuZHJ1bXNDb252ZXJ0ZXIgPSBuZXcgRHJ1bXNPbmVIb3RDb252ZXJ0ZXIoYXJncy5kcnVtc0FyZ3MpO1xuICAgICAgICB0aGlzLmRlcHRoID1cbiAgICAgICAgICAgICh0aGlzLm1lbENvbnZlcnRlci5kZXB0aCArIHRoaXMuYmFzc0NvbnZlcnRlci5kZXB0aCArXG4gICAgICAgICAgICAgICAgdGhpcy5kcnVtc0NvbnZlcnRlci5kZXB0aCk7XG4gICAgfVxuICAgIHRvVGVuc29yKG5vdGVTZXF1ZW5jZSkge1xuICAgICAgICBzZXF1ZW5jZXMuYXNzZXJ0SXNRdWFudGl6ZWRTZXF1ZW5jZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBjb25zdCBtZWxTZXEgPSBzZXF1ZW5jZXMuY2xvbmUobm90ZVNlcXVlbmNlKTtcbiAgICAgICAgY29uc3QgYmFzc1NlcSA9IHNlcXVlbmNlcy5jbG9uZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBjb25zdCBkcnVtc1NlcSA9IHNlcXVlbmNlcy5jbG9uZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBtZWxTZXEubm90ZXMgPSBub3RlU2VxdWVuY2Uubm90ZXMuZmlsdGVyKG4gPT4gKCFuLmlzRHJ1bSAmJiBuLnByb2dyYW0gPj0gdGhpcy5NRUxfUFJPR19SQU5HRVswXSAmJlxuICAgICAgICAgICAgbi5wcm9ncmFtIDw9IHRoaXMuTUVMX1BST0dfUkFOR0VbMV0pKTtcbiAgICAgICAgYmFzc1NlcS5ub3RlcyA9IG5vdGVTZXF1ZW5jZS5ub3Rlcy5maWx0ZXIobiA9PiAoIW4uaXNEcnVtICYmIG4ucHJvZ3JhbSA+PSB0aGlzLkJBU1NfUFJPR19SQU5HRVswXSAmJlxuICAgICAgICAgICAgbi5wcm9ncmFtIDw9IHRoaXMuQkFTU19QUk9HX1JBTkdFWzFdKSk7XG4gICAgICAgIGRydW1zU2VxLm5vdGVzID0gbm90ZVNlcXVlbmNlLm5vdGVzLmZpbHRlcihuID0+IG4uaXNEcnVtKTtcbiAgICAgICAgcmV0dXJuIHRmLnRpZHkoKCkgPT4gdGYuY29uY2F0KFtcbiAgICAgICAgICAgIHRoaXMubWVsQ29udmVydGVyLnRvVGVuc29yKG1lbFNlcSksXG4gICAgICAgICAgICB0aGlzLmJhc3NDb252ZXJ0ZXIudG9UZW5zb3IoYmFzc1NlcSksXG4gICAgICAgICAgICB0aGlzLmRydW1zQ29udmVydGVyLnRvVGVuc29yKGRydW1zU2VxKVxuICAgICAgICBdLCAtMSkpO1xuICAgIH1cbiAgICBhc3luYyB0b05vdGVTZXF1ZW5jZSh0aCwgc3RlcHNQZXJRdWFydGVyLCBxcG0pIHtcbiAgICAgICAgY29uc3Qgb2hzID0gdGYuc3BsaXQodGgsIFtcbiAgICAgICAgICAgIHRoaXMubWVsQ29udmVydGVyLmRlcHRoLCB0aGlzLmJhc3NDb252ZXJ0ZXIuZGVwdGgsXG4gICAgICAgICAgICB0aGlzLmRydW1zQ29udmVydGVyLmRlcHRoXG4gICAgICAgIF0sIC0xKTtcbiAgICAgICAgY29uc3QgbnMgPSBhd2FpdCB0aGlzLm1lbENvbnZlcnRlci50b05vdGVTZXF1ZW5jZShvaHNbMF0sIHN0ZXBzUGVyUXVhcnRlciwgcXBtKTtcbiAgICAgICAgbnMubm90ZXMuZm9yRWFjaChuID0+IHtcbiAgICAgICAgICAgIG4uaW5zdHJ1bWVudCA9IDA7XG4gICAgICAgICAgICBuLnByb2dyYW0gPSAwO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYmFzc05zID0gYXdhaXQgdGhpcy5iYXNzQ29udmVydGVyLnRvTm90ZVNlcXVlbmNlKG9oc1sxXSwgc3RlcHNQZXJRdWFydGVyLCBxcG0pO1xuICAgICAgICBucy5ub3Rlcy5wdXNoKC4uLmJhc3NOcy5ub3Rlcy5tYXAobiA9PiB7XG4gICAgICAgICAgICBuLmluc3RydW1lbnQgPSAxO1xuICAgICAgICAgICAgbi5wcm9ncmFtID0gdGhpcy5CQVNTX1BST0dfUkFOR0VbMF07XG4gICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBkcnVtc05zID0gYXdhaXQgdGhpcy5kcnVtc0NvbnZlcnRlci50b05vdGVTZXF1ZW5jZShvaHNbMl0sIHN0ZXBzUGVyUXVhcnRlciwgcXBtKTtcbiAgICAgICAgbnMubm90ZXMucHVzaCguLi5kcnVtc05zLm5vdGVzLm1hcChuID0+IHtcbiAgICAgICAgICAgIG4uaW5zdHJ1bWVudCA9IDI7XG4gICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgfSkpO1xuICAgICAgICBvaHMuZm9yRWFjaChvaCA9PiBvaC5kaXNwb3NlKCkpO1xuICAgICAgICByZXR1cm4gbnM7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFRyaW9SaHl0aG1Db252ZXJ0ZXIgZXh0ZW5kcyBEYXRhQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLk5VTV9TUExJVFMgPSAzO1xuICAgICAgICB0aGlzLnRyaW9Db252ZXJ0ZXIgPSBuZXcgVHJpb0NvbnZlcnRlcihhcmdzKTtcbiAgICAgICAgdGhpcy5kZXB0aCA9IDM7XG4gICAgfVxuICAgIHRvVGVuc29yKG5vdGVTZXF1ZW5jZSkge1xuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0cmlvVGVuc29yID0gdGhpcy50cmlvQ29udmVydGVyLnRvVGVuc29yKG5vdGVTZXF1ZW5jZSk7XG4gICAgICAgICAgICBjb25zdCBpbnN0cnVtZW50VGVuc29ycyA9IHRmLnNwbGl0KHRyaW9UZW5zb3IsIFtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaW9Db252ZXJ0ZXIubWVsQ29udmVydGVyLmRlcHRoLFxuICAgICAgICAgICAgICAgIHRoaXMudHJpb0NvbnZlcnRlci5iYXNzQ29udmVydGVyLmRlcHRoLFxuICAgICAgICAgICAgICAgIHRoaXMudHJpb0NvbnZlcnRlci5kcnVtc0NvbnZlcnRlci5kZXB0aFxuICAgICAgICAgICAgXSwgMSk7XG4gICAgICAgICAgICBjb25zdCBtZWxvZHlFdmVudHMgPSB0Zi5hcmdNYXgoaW5zdHJ1bWVudFRlbnNvcnNbMF0sIDEpO1xuICAgICAgICAgICAgY29uc3QgYmFzc0V2ZW50cyA9IHRmLmFyZ01heChpbnN0cnVtZW50VGVuc29yc1sxXSwgMSk7XG4gICAgICAgICAgICBjb25zdCBkcnVtc0V2ZW50cyA9IHRmLmFyZ01heChpbnN0cnVtZW50VGVuc29yc1syXSwgMSk7XG4gICAgICAgICAgICBjb25zdCBtZWxvZHlSaHl0aG0gPSB0Zi5ncmVhdGVyKG1lbG9keUV2ZW50cywgMSk7XG4gICAgICAgICAgICBjb25zdCBiYXNzUmh5dGhtID0gdGYuZ3JlYXRlcihiYXNzRXZlbnRzLCAxKTtcbiAgICAgICAgICAgIGNvbnN0IGRydW1zUmh5dGhtID0gdGYuZ3JlYXRlcihkcnVtc0V2ZW50cywgMCk7XG4gICAgICAgICAgICByZXR1cm4gdGYuc3RhY2soW21lbG9keVJoeXRobSwgYmFzc1JoeXRobSwgZHJ1bXNSaHl0aG1dLCAxKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIHRvTm90ZVNlcXVlbmNlKHRlbnNvciwgc3RlcHNQZXJRdWFydGVyLCBxcG0pIHtcbiAgICAgICAgY29uc3Qgcmh5dGhtVGVuc29ycyA9IHRmLnNwbGl0KHRlbnNvciwgMywgMSk7XG4gICAgICAgIGNvbnN0IHJoeXRobXMgPSBhd2FpdCBQcm9taXNlLmFsbChyaHl0aG1UZW5zb3JzLm1hcCh0ID0+IHQuZGF0YSgpKSk7XG4gICAgICAgIGNvbnN0IG5vdGVTZXF1ZW5jZSA9IHNlcXVlbmNlcy5jcmVhdGVRdWFudGl6ZWROb3RlU2VxdWVuY2Uoc3RlcHNQZXJRdWFydGVyLCBxcG0pO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IHRoaXMubnVtU3RlcHM7ICsrcykge1xuICAgICAgICAgICAgaWYgKHJoeXRobXNbMF1bc10pIHtcbiAgICAgICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBwaXRjaDogNzIsXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aXplZFN0YXJ0U3RlcDogcyxcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkRW5kU3RlcDogcyArIDEsXG4gICAgICAgICAgICAgICAgICAgIGluc3RydW1lbnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHByb2dyYW06IDAsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJoeXRobXNbMV1bc10pIHtcbiAgICAgICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBwaXRjaDogMzYsXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aXplZFN0YXJ0U3RlcDogcyxcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkRW5kU3RlcDogcyArIDEsXG4gICAgICAgICAgICAgICAgICAgIGluc3RydW1lbnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgIHByb2dyYW06IDMyLFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyaHl0aG1zWzJdW3NdKSB7XG4gICAgICAgICAgICAgICAgbm90ZVNlcXVlbmNlLm5vdGVzLnB1c2goTm90ZVNlcXVlbmNlLk5vdGUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgcGl0Y2g6IERFRkFVTFRfRFJVTV9QSVRDSF9DTEFTU0VTWzFdWzBdLFxuICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRTdGFydFN0ZXA6IHMsXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aXplZEVuZFN0ZXA6IHMgKyAxLFxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVtZW50OiAyLFxuICAgICAgICAgICAgICAgICAgICBpc0RydW06IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbm90ZVNlcXVlbmNlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSB0aGlzLm51bVN0ZXBzO1xuICAgICAgICByZXR1cm4gbm90ZVNlcXVlbmNlO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBNdWx0aXRyYWNrQ29udmVydGVyIGV4dGVuZHMgRGF0YUNvbnZlcnRlciB7XG4gICAgY29uc3RydWN0b3IoYXJncykge1xuICAgICAgICBzdXBlcihhcmdzKTtcbiAgICAgICAgdGhpcy5TRUdNRU5URURfQllfVFJBQ0sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0ZXBzUGVyUXVhcnRlciA9IGFyZ3Muc3RlcHNQZXJRdWFydGVyO1xuICAgICAgICB0aGlzLnRvdGFsU3RlcHMgPSBhcmdzLnRvdGFsU3RlcHM7XG4gICAgICAgIHRoaXMubnVtVmVsb2NpdHlCaW5zID0gYXJncy5udW1WZWxvY2l0eUJpbnM7XG4gICAgICAgIHRoaXMubWluUGl0Y2ggPSBhcmdzLm1pblBpdGNoID8gYXJncy5taW5QaXRjaCA6IGNvbnN0YW50cy5NSU5fTUlESV9QSVRDSDtcbiAgICAgICAgdGhpcy5tYXhQaXRjaCA9IGFyZ3MubWF4UGl0Y2ggPyBhcmdzLm1heFBpdGNoIDogY29uc3RhbnRzLk1BWF9NSURJX1BJVENIO1xuICAgICAgICB0aGlzLm51bVBpdGNoZXMgPSB0aGlzLm1heFBpdGNoIC0gdGhpcy5taW5QaXRjaCArIDE7XG4gICAgICAgIHRoaXMucGVyZm9ybWFuY2VFdmVudERlcHRoID1cbiAgICAgICAgICAgIDIgKiB0aGlzLm51bVBpdGNoZXMgKyB0aGlzLnRvdGFsU3RlcHMgKyB0aGlzLm51bVZlbG9jaXR5QmlucztcbiAgICAgICAgdGhpcy5udW1Qcm9ncmFtcyA9XG4gICAgICAgICAgICBjb25zdGFudHMuTUFYX01JRElfUFJPR1JBTSAtIGNvbnN0YW50cy5NSU5fTUlESV9QUk9HUkFNICsgMjtcbiAgICAgICAgdGhpcy5lbmRUb2tlbiA9IHRoaXMucGVyZm9ybWFuY2VFdmVudERlcHRoICsgdGhpcy5udW1Qcm9ncmFtcztcbiAgICAgICAgdGhpcy5kZXB0aCA9IHRoaXMuZW5kVG9rZW4gKyAxO1xuICAgICAgICB0aGlzLmVuZFRlbnNvciA9IHRmLnRpZHkoKCkgPT4gdGYub25lSG90KHRmLnRlbnNvcjFkKFt0aGlzLmVuZFRva2VuXSwgJ2ludDMyJyksIHRoaXMuZGVwdGgpXG4gICAgICAgICAgICAuYXMxRCgpKTtcbiAgICB9XG4gICAgdHJhY2tUb1RlbnNvcih0cmFjaykge1xuICAgICAgICBjb25zdCBtYXhFdmVudHNQZXJUcmFjayA9IHRoaXMubnVtU3RlcHMgLyB0aGlzLm51bVNlZ21lbnRzO1xuICAgICAgICBsZXQgdG9rZW5zID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodHJhY2spIHtcbiAgICAgICAgICAgIHdoaWxlICh0cmFjay5ldmVudHMubGVuZ3RoID4gbWF4RXZlbnRzUGVyVHJhY2sgLSAyKSB7XG4gICAgICAgICAgICAgICAgdHJhY2suZXZlbnRzLnBvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG9rZW5zID0gdGYuYnVmZmVyKFt0cmFjay5ldmVudHMubGVuZ3RoICsgMl0sICdpbnQzMicpO1xuICAgICAgICAgICAgdG9rZW5zLnNldCh0aGlzLnBlcmZvcm1hbmNlRXZlbnREZXB0aCArXG4gICAgICAgICAgICAgICAgKHRyYWNrLmlzRHJ1bSA/IHRoaXMubnVtUHJvZ3JhbXMgLSAxIDogdHJhY2sucHJvZ3JhbSksIDApO1xuICAgICAgICAgICAgdHJhY2suZXZlbnRzLmZvckVhY2goKGV2ZW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdub3RlLW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2Vucy5zZXQoZXZlbnQucGl0Y2ggLSB0aGlzLm1pblBpdGNoLCBpbmRleCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25vdGUtb2ZmJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2Vucy5zZXQodGhpcy5udW1QaXRjaGVzICsgZXZlbnQucGl0Y2ggLSB0aGlzLm1pblBpdGNoLCBpbmRleCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RpbWUtc2hpZnQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnNldCgyICogdGhpcy5udW1QaXRjaGVzICsgZXZlbnQuc3RlcHMgLSAxLCBpbmRleCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZlbG9jaXR5LWNoYW5nZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMuc2V0KDIgKiB0aGlzLm51bVBpdGNoZXMgKyB0aGlzLnRvdGFsU3RlcHMgKyBldmVudC52ZWxvY2l0eUJpbiAtIDEsIGluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWNvZ25pemVkIHBlcmZvcm1hbmNlIGV2ZW50OiAke2V2ZW50fWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdG9rZW5zLnNldCh0aGlzLmVuZFRva2VuLCB0cmFjay5ldmVudHMubGVuZ3RoICsgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b2tlbnMgPSB0Zi5idWZmZXIoWzFdLCAnaW50MzInLCBuZXcgSW50MzJBcnJheShbdGhpcy5lbmRUb2tlbl0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvaCA9IHRmLm9uZUhvdCh0b2tlbnMudG9UZW5zb3IoKSwgdGhpcy5kZXB0aCk7XG4gICAgICAgICAgICByZXR1cm4gb2gucGFkKFtbMCwgbWF4RXZlbnRzUGVyVHJhY2sgLSBvaC5zaGFwZVswXV0sIFswLCAwXV0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdG9UZW5zb3Iobm90ZVNlcXVlbmNlKSB7XG4gICAgICAgIHNlcXVlbmNlcy5hc3NlcnRJc1JlbGF0aXZlUXVhbnRpemVkU2VxdWVuY2Uobm90ZVNlcXVlbmNlKTtcbiAgICAgICAgaWYgKG5vdGVTZXF1ZW5jZS5xdWFudGl6YXRpb25JbmZvLnN0ZXBzUGVyUXVhcnRlciAhPT1cbiAgICAgICAgICAgIHRoaXMuc3RlcHNQZXJRdWFydGVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFN0ZXBzIHBlciBxdWFydGVyIG5vdGUgbWlzbWF0Y2g6ICR7bm90ZVNlcXVlbmNlLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyfSAhPSAke3RoaXMuc3RlcHNQZXJRdWFydGVyfWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlcSA9IHNlcXVlbmNlcy5jbG9uZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBzZXEubm90ZXMgPSBub3RlU2VxdWVuY2Uubm90ZXMuZmlsdGVyKG5vdGUgPT4gbm90ZS5waXRjaCA+PSB0aGlzLm1pblBpdGNoICYmIG5vdGUucGl0Y2ggPD0gdGhpcy5tYXhQaXRjaCk7XG4gICAgICAgIGNvbnN0IGluc3RydW1lbnRzID0gbmV3IFNldChzZXEubm90ZXMubWFwKG5vdGUgPT4gbm90ZS5pbnN0cnVtZW50KSk7XG4gICAgICAgIGNvbnN0IHRyYWNrcyA9IEFycmF5LmZyb20oaW5zdHJ1bWVudHMpXG4gICAgICAgICAgICAubWFwKGluc3RydW1lbnQgPT4gcGVyZm9ybWFuY2UuUGVyZm9ybWFuY2UuZnJvbU5vdGVTZXF1ZW5jZShzZXEsIHRoaXMudG90YWxTdGVwcywgdGhpcy5udW1WZWxvY2l0eUJpbnMsIGluc3RydW1lbnQpKTtcbiAgICAgICAgY29uc3Qgc29ydGVkVHJhY2tzID0gdHJhY2tzLnNvcnQoKGEsIGIpID0+IGIuaXNEcnVtID8gLTEgOiAoYS5pc0RydW0gPyAxIDogYS5wcm9ncmFtIC0gYi5wcm9ncmFtKSk7XG4gICAgICAgIHdoaWxlIChzb3J0ZWRUcmFja3MubGVuZ3RoID4gdGhpcy5udW1TZWdtZW50cykge1xuICAgICAgICAgICAgc29ydGVkVHJhY2tzLnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIHNvcnRlZFRyYWNrcy5mb3JFYWNoKCh0cmFjaykgPT4gdHJhY2suc2V0TnVtU3RlcHModGhpcy50b3RhbFN0ZXBzKSk7XG4gICAgICAgIHdoaWxlIChzb3J0ZWRUcmFja3MubGVuZ3RoIDwgdGhpcy5udW1TZWdtZW50cykge1xuICAgICAgICAgICAgc29ydGVkVHJhY2tzLnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGYudGlkeSgoKSA9PiB0Zi5jb25jYXQoc29ydGVkVHJhY2tzLm1hcCgodHJhY2spID0+IHRoaXMudHJhY2tUb1RlbnNvcih0cmFjaykpLCAwKSk7XG4gICAgfVxuICAgIHRva2Vuc1RvVHJhY2sodG9rZW5zKSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRva2Vucy5pbmRleE9mKHRoaXMuZW5kVG9rZW4pO1xuICAgICAgICBjb25zdCBlbmRJbmRleCA9IGlkeCA+PSAwID8gaWR4IDogdG9rZW5zLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdHJhY2tUb2tlbnMgPSB0b2tlbnMuc2xpY2UoMCwgZW5kSW5kZXgpO1xuICAgICAgICBjb25zdCBldmVudFRva2VucyA9IHRyYWNrVG9rZW5zLmZpbHRlcigodG9rZW4pID0+IHRva2VuIDwgdGhpcy5wZXJmb3JtYW5jZUV2ZW50RGVwdGgpO1xuICAgICAgICBjb25zdCBwcm9ncmFtVG9rZW5zID0gdHJhY2tUb2tlbnMuZmlsdGVyKCh0b2tlbikgPT4gdG9rZW4gPj0gdGhpcy5wZXJmb3JtYW5jZUV2ZW50RGVwdGgpO1xuICAgICAgICBjb25zdCBbcHJvZ3JhbSwgaXNEcnVtXSA9IHByb2dyYW1Ub2tlbnMubGVuZ3RoID9cbiAgICAgICAgICAgIChwcm9ncmFtVG9rZW5zWzBdIC0gdGhpcy5wZXJmb3JtYW5jZUV2ZW50RGVwdGggPCB0aGlzLm51bVByb2dyYW1zIC0gMSA/XG4gICAgICAgICAgICAgICAgW3Byb2dyYW1Ub2tlbnNbMF0gLSB0aGlzLnBlcmZvcm1hbmNlRXZlbnREZXB0aCwgZmFsc2VdIDpcbiAgICAgICAgICAgICAgICBbMCwgdHJ1ZV0pIDpcbiAgICAgICAgICAgIFswLCBmYWxzZV07XG4gICAgICAgIGNvbnN0IGV2ZW50cyA9IEFycmF5LmZyb20oZXZlbnRUb2tlbnMpLm1hcCgodG9rZW4pID0+IHtcbiAgICAgICAgICAgIGlmICh0b2tlbiA8IHRoaXMubnVtUGl0Y2hlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdub3RlLW9uJywgcGl0Y2g6IHRoaXMubWluUGl0Y2ggKyB0b2tlbiB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPCAyICogdGhpcy5udW1QaXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ25vdGUtb2ZmJyxcbiAgICAgICAgICAgICAgICAgICAgcGl0Y2g6IHRoaXMubWluUGl0Y2ggKyB0b2tlbiAtIHRoaXMubnVtUGl0Y2hlc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA8IDIgKiB0aGlzLm51bVBpdGNoZXMgKyB0aGlzLnRvdGFsU3RlcHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGltZS1zaGlmdCcsXG4gICAgICAgICAgICAgICAgICAgIHN0ZXBzOiB0b2tlbiAtIDIgKiB0aGlzLm51bVBpdGNoZXMgKyAxXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuIDxcbiAgICAgICAgICAgICAgICAyICogdGhpcy5udW1QaXRjaGVzICsgdGhpcy50b3RhbFN0ZXBzICsgdGhpcy5udW1WZWxvY2l0eUJpbnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndmVsb2NpdHktY2hhbmdlJyxcbiAgICAgICAgICAgICAgICAgICAgdmVsb2NpdHlCaW46IHRva2VuIC0gMiAqIHRoaXMubnVtUGl0Y2hlcyAtIHRoaXMudG90YWxTdGVwcyArIDFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBlcmZvcm1hbmNlIGV2ZW50IHRva2VuOiAke3Rva2VufWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBwZXJmb3JtYW5jZS5QZXJmb3JtYW5jZShldmVudHMsIHRoaXMudG90YWxTdGVwcywgdGhpcy5udW1WZWxvY2l0eUJpbnMsIHByb2dyYW0sIGlzRHJ1bSk7XG4gICAgfVxuICAgIGFzeW5jIHRvTm90ZVNlcXVlbmNlKG9oLCBzdGVwc1BlclF1YXJ0ZXIgPSB0aGlzLnN0ZXBzUGVyUXVhcnRlciwgcXBtKSB7XG4gICAgICAgIGNvbnN0IG5vdGVTZXF1ZW5jZSA9IHNlcXVlbmNlcy5jcmVhdGVRdWFudGl6ZWROb3RlU2VxdWVuY2Uoc3RlcHNQZXJRdWFydGVyLCBxcG0pO1xuICAgICAgICBub3RlU2VxdWVuY2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IHRoaXMudG90YWxTdGVwcztcbiAgICAgICAgY29uc3QgdGVuc29ycyA9IHRmLnRpZHkoKCkgPT4gdGYuc3BsaXQob2guYXJnTWF4KDEpLCB0aGlzLm51bVNlZ21lbnRzKSk7XG4gICAgICAgIGNvbnN0IHRyYWNrcyA9IGF3YWl0IFByb21pc2UuYWxsKHRlbnNvcnMubWFwKGFzeW5jICh0ZW5zb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRva2VucyA9IGF3YWl0IHRlbnNvci5kYXRhKCk7XG4gICAgICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMudG9rZW5zVG9UcmFjayh0b2tlbnMpO1xuICAgICAgICAgICAgdGVuc29yLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIHJldHVybiB0cmFjaztcbiAgICAgICAgfSkpO1xuICAgICAgICB0cmFja3MuZm9yRWFjaCgodHJhY2ssIGluc3RydW1lbnQpID0+IHtcbiAgICAgICAgICAgIHRyYWNrLnNldE51bVN0ZXBzKHRoaXMudG90YWxTdGVwcyk7XG4gICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaCguLi50cmFjay50b05vdGVTZXF1ZW5jZShpbnN0cnVtZW50KS5ub3Rlcyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbm90ZVNlcXVlbmNlO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBHcm9vdmVDb252ZXJ0ZXIgZXh0ZW5kcyBEYXRhQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLlRBUElGWV9DSEFOTkVMID0gMztcbiAgICAgICAgdGhpcy5zdGVwc1BlclF1YXJ0ZXIgPVxuICAgICAgICAgICAgYXJncy5zdGVwc1BlclF1YXJ0ZXIgfHwgY29uc3RhbnRzLkRFRkFVTFRfU1RFUFNfUEVSX1FVQVJURVI7XG4gICAgICAgIHRoaXMucGl0Y2hDbGFzc2VzID0gYXJncy5waXRjaENsYXNzZXMgfHwgREVGQVVMVF9EUlVNX1BJVENIX0NMQVNTRVM7XG4gICAgICAgIHRoaXMucGl0Y2hUb0NsYXNzID0gbmV3IE1hcCgpO1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHRoaXMucGl0Y2hDbGFzc2VzLmxlbmd0aDsgKytjKSB7XG4gICAgICAgICAgICB0aGlzLnBpdGNoQ2xhc3Nlc1tjXS5mb3JFYWNoKChwKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5waXRjaFRvQ2xhc3Muc2V0KHAsIGMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5odW1hbml6ZSA9IGFyZ3MuaHVtYW5pemUgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMudGFwaWZ5ID0gYXJncy50YXBpZnkgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuc3BsaXRJbnN0cnVtZW50cyA9IGFyZ3Muc3BsaXRJbnN0cnVtZW50cyB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5kZXB0aCA9IDM7XG4gICAgfVxuICAgIHRvVGVuc29yKG5zKSB7XG4gICAgICAgIGNvbnN0IHFucyA9IHNlcXVlbmNlcy5pc1JlbGF0aXZlUXVhbnRpemVkU2VxdWVuY2UobnMpID9cbiAgICAgICAgICAgIG5zIDpcbiAgICAgICAgICAgIHNlcXVlbmNlcy5xdWFudGl6ZU5vdGVTZXF1ZW5jZShucywgdGhpcy5zdGVwc1BlclF1YXJ0ZXIpO1xuICAgICAgICBjb25zdCBudW1TdGVwcyA9IHRoaXMubnVtU3RlcHM7XG4gICAgICAgIGNvbnN0IHFwbSA9IChxbnMudGVtcG9zICYmIHFucy50ZW1wb3MubGVuZ3RoKSA/XG4gICAgICAgICAgICBxbnMudGVtcG9zWzBdLnFwbSA6XG4gICAgICAgICAgICBjb25zdGFudHMuREVGQVVMVF9RVUFSVEVSU19QRVJfTUlOVVRFO1xuICAgICAgICBjb25zdCBzdGVwTGVuZ3RoID0gKDYwLiAvIHFwbSkgLyB0aGlzLnN0ZXBzUGVyUXVhcnRlcjtcbiAgICAgICAgY29uc3Qgc3RlcE5vdGVzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU3RlcHM7ICsraSkge1xuICAgICAgICAgICAgc3RlcE5vdGVzLnB1c2gobmV3IE1hcCgpKTtcbiAgICAgICAgfVxuICAgICAgICBxbnMubm90ZXMuZm9yRWFjaChuID0+IHtcbiAgICAgICAgICAgIGlmICghKHRoaXMudGFwaWZ5IHx8IHRoaXMucGl0Y2hUb0NsYXNzLmhhcyhuLnBpdGNoKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzID0gbi5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgICAgICBpZiAocyA+PSBzdGVwTm90ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1vZGVsIGRvZXMgbm90IHN1cHBvcnQgc2VxdWVuY2VzIHdpdGggbW9yZSB0aGFuICR7bnVtU3RlcHN9IHN0ZXBzICgke251bVN0ZXBzICogc3RlcExlbmd0aH0gc2Vjb25kcyBhdCBxcG0gJHtxcG19KS5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLnRhcGlmeSA/IHRoaXMuVEFQSUZZX0NIQU5ORUwgOiB0aGlzLnBpdGNoVG9DbGFzcy5nZXQobi5waXRjaCk7XG4gICAgICAgICAgICBpZiAoIXN0ZXBOb3Rlc1tzXS5oYXMoZCkgfHwgc3RlcE5vdGVzW3NdLmdldChkKS52ZWxvY2l0eSA8IG4udmVsb2NpdHkpIHtcbiAgICAgICAgICAgICAgICBzdGVwTm90ZXNbc10uc2V0KGQsIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbnVtRHJ1bXMgPSB0aGlzLnBpdGNoQ2xhc3Nlcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGhpdFZlY3RvcnMgPSB0Zi5idWZmZXIoW251bVN0ZXBzLCBudW1EcnVtc10pO1xuICAgICAgICBjb25zdCB2ZWxvY2l0eVZlY3RvcnMgPSB0Zi5idWZmZXIoW251bVN0ZXBzLCBudW1EcnVtc10pO1xuICAgICAgICBjb25zdCBvZmZzZXRWZWN0b3JzID0gdGYuYnVmZmVyKFtudW1TdGVwcywgbnVtRHJ1bXNdKTtcbiAgICAgICAgZnVuY3Rpb24gZ2V0T2Zmc2V0KG4pIHtcbiAgICAgICAgICAgIGlmIChuLnN0YXJ0VGltZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0T25zZXQgPSBuLnN0YXJ0VGltZTtcbiAgICAgICAgICAgIGNvbnN0IHFPbnNldCA9IG4ucXVhbnRpemVkU3RhcnRTdGVwICogc3RlcExlbmd0aDtcbiAgICAgICAgICAgIHJldHVybiAyICogKHFPbnNldCAtIHRPbnNldCkgLyBzdGVwTGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgbnVtU3RlcHM7ICsrcykge1xuICAgICAgICAgICAgZm9yIChsZXQgZCA9IDA7IGQgPCBudW1EcnVtczsgKytkKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm90ZSA9IHN0ZXBOb3Rlc1tzXS5nZXQoZCk7XG4gICAgICAgICAgICAgICAgaGl0VmVjdG9ycy5zZXQobm90ZSA/IDEgOiAwLCBzLCBkKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaHVtYW5pemUgJiYgIXRoaXMudGFwaWZ5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5VmVjdG9ycy5zZXQobm90ZSA/IG5vdGUudmVsb2NpdHkgLyBjb25zdGFudHMuTUFYX01JRElfVkVMT0NJVFkgOiAwLCBzLCBkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmh1bWFuaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldFZlY3RvcnMuc2V0KG5vdGUgPyBnZXRPZmZzZXQobm90ZSkgOiAwLCBzLCBkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRmLnRpZHkoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaGl0cyA9IGhpdFZlY3RvcnMudG9UZW5zb3IoKTtcbiAgICAgICAgICAgIGNvbnN0IHZlbG9jaXRpZXMgPSB2ZWxvY2l0eVZlY3RvcnMudG9UZW5zb3IoKTtcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldHMgPSBvZmZzZXRWZWN0b3JzLnRvVGVuc29yKCk7XG4gICAgICAgICAgICBjb25zdCBvdXRMZW5ndGggPSB0aGlzLnNwbGl0SW5zdHJ1bWVudHMgPyBudW1TdGVwcyAqIG51bURydW1zIDogbnVtU3RlcHM7XG4gICAgICAgICAgICByZXR1cm4gdGYuY29uY2F0KFtcbiAgICAgICAgICAgICAgICBoaXRzLmFzMkQob3V0TGVuZ3RoLCAtMSksIHZlbG9jaXRpZXMuYXMyRChvdXRMZW5ndGgsIC0xKSxcbiAgICAgICAgICAgICAgICBvZmZzZXRzLmFzMkQob3V0TGVuZ3RoLCAtMSlcbiAgICAgICAgICAgIF0sIDEpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgdG9Ob3RlU2VxdWVuY2UodCwgc3RlcHNQZXJRdWFydGVyLCBxcG0gPSBjb25zdGFudHMuREVGQVVMVF9RVUFSVEVSU19QRVJfTUlOVVRFKSB7XG4gICAgICAgIGlmIChzdGVwc1BlclF1YXJ0ZXIgJiYgc3RlcHNQZXJRdWFydGVyICE9PSB0aGlzLnN0ZXBzUGVyUXVhcnRlcikge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ2BzdGVwc1BlclF1YXJ0ZXJgIGlzIHNldCBieSB0aGUgbW9kZWwuJyk7XG4gICAgICAgIH1cbiAgICAgICAgc3RlcHNQZXJRdWFydGVyID0gdGhpcy5zdGVwc1BlclF1YXJ0ZXI7XG4gICAgICAgIGNvbnN0IG51bVN0ZXBzID0gdGhpcy5zcGxpdEluc3RydW1lbnRzID9cbiAgICAgICAgICAgIHQuc2hhcGVbMF0gLyB0aGlzLnBpdGNoQ2xhc3Nlcy5sZW5ndGggOlxuICAgICAgICAgICAgdC5zaGFwZVswXTtcbiAgICAgICAgY29uc3Qgc3RlcExlbmd0aCA9ICg2MC4gLyBxcG0pIC8gdGhpcy5zdGVwc1BlclF1YXJ0ZXI7XG4gICAgICAgIGNvbnN0IG5zID0gTm90ZVNlcXVlbmNlLmNyZWF0ZSh7IHRvdGFsVGltZTogbnVtU3RlcHMgKiBzdGVwTGVuZ3RoLCB0ZW1wb3M6IFt7IHFwbSB9XSB9KTtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHQuZGF0YSgpO1xuICAgICAgICBmdW5jdGlvbiBjbGlwKHYsIG1pbiwgbWF4KSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodiwgbWluKSwgbWF4KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBudW1EcnVtcyA9IHRoaXMucGl0Y2hDbGFzc2VzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCBudW1TdGVwczsgKytzKSB7XG4gICAgICAgICAgICBjb25zdCBzdGVwUmVzdWx0cyA9IHJlc3VsdHMuc2xpY2UocyAqIG51bURydW1zICogdGhpcy5kZXB0aCwgKHMgKyAxKSAqIG51bURydW1zICogdGhpcy5kZXB0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBkID0gMDsgZCA8IG51bURydW1zOyArK2QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoaXRPdXRwdXQgPSBzdGVwUmVzdWx0c1t0aGlzLnNwbGl0SW5zdHJ1bWVudHMgPyBkICogdGhpcy5kZXB0aCA6IGRdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZlbEkgPSB0aGlzLnNwbGl0SW5zdHJ1bWVudHMgPyAoZCAqIHRoaXMuZGVwdGggKyAxKSA6IChudW1EcnVtcyArIGQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZlbE91dHB1dCA9IHN0ZXBSZXN1bHRzW3ZlbEldO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldEkgPSB0aGlzLnNwbGl0SW5zdHJ1bWVudHMgPyAoZCAqIHRoaXMuZGVwdGggKyAyKSA6ICgyICogbnVtRHJ1bXMgKyBkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRPdXRwdXQgPSBzdGVwUmVzdWx0c1tvZmZzZXRJXTtcbiAgICAgICAgICAgICAgICBpZiAoaGl0T3V0cHV0ID4gMC41KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlbG9jaXR5ID0gY2xpcChNYXRoLnJvdW5kKHZlbE91dHB1dCAqIGNvbnN0YW50cy5NQVhfTUlESV9WRUxPQ0lUWSksIGNvbnN0YW50cy5NSU5fTUlESV9WRUxPQ0lUWSwgY29uc3RhbnRzLk1BWF9NSURJX1ZFTE9DSVRZKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gY2xpcChvZmZzZXRPdXRwdXQgLyAyLCAtMC41LCAwLjUpO1xuICAgICAgICAgICAgICAgICAgICBucy5ub3Rlcy5wdXNoKE5vdGVTZXF1ZW5jZS5Ob3RlLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwaXRjaDogdGhpcy5waXRjaENsYXNzZXNbZF1bMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IChzIC0gb2Zmc2V0KSAqIHN0ZXBMZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRUaW1lOiAocyAtIG9mZnNldCArIDEpICogc3RlcExlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNEcnVtOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5zO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGEuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/data.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/index.js":
/*!*********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/index.js ***!
  \*********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BasePlayer: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.BasePlayer),\n/* harmony export */   BasePlayerCallback: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.BasePlayerCallback),\n/* harmony export */   BaseRecorderCallback: () => (/* reexport safe */ _recorder__WEBPACK_IMPORTED_MODULE_11__.BaseRecorderCallback),\n/* harmony export */   BaseSVGVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.BaseSVGVisualizer),\n/* harmony export */   BaseVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.BaseVisualizer),\n/* harmony export */   MIDIPlayer: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.MIDIPlayer),\n/* harmony export */   Metronome: () => (/* reexport safe */ _metronome__WEBPACK_IMPORTED_MODULE_8__.Metronome),\n/* harmony export */   MetronomeCallbackObject: () => (/* reexport safe */ _metronome__WEBPACK_IMPORTED_MODULE_8__.MetronomeCallbackObject),\n/* harmony export */   MidiConversionError: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.MidiConversionError),\n/* harmony export */   PianoRollCanvasVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.PianoRollCanvasVisualizer),\n/* harmony export */   PianoRollSVGVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.PianoRollSVGVisualizer),\n/* harmony export */   Player: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.Player),\n/* harmony export */   PlayerWithClick: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.PlayerWithClick),\n/* harmony export */   Recorder: () => (/* reexport safe */ _recorder__WEBPACK_IMPORTED_MODULE_11__.Recorder),\n/* harmony export */   ScrollType: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.ScrollType),\n/* harmony export */   SoundFontPlayer: () => (/* reexport safe */ _player__WEBPACK_IMPORTED_MODULE_10__.SoundFontPlayer),\n/* harmony export */   StaffSVGVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.StaffSVGVisualizer),\n/* harmony export */   Visualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.Visualizer),\n/* harmony export */   WaterfallSVGVisualizer: () => (/* reexport safe */ _visualizer__WEBPACK_IMPORTED_MODULE_12__.WaterfallSVGVisualizer),\n/* harmony export */   aux_inputs: () => (/* reexport module object */ _aux_inputs__WEBPACK_IMPORTED_MODULE_0__),\n/* harmony export */   blobToNoteSequence: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.blobToNoteSequence),\n/* harmony export */   chords: () => (/* reexport module object */ _chords__WEBPACK_IMPORTED_MODULE_1__),\n/* harmony export */   constants: () => (/* reexport module object */ _constants__WEBPACK_IMPORTED_MODULE_2__),\n/* harmony export */   data: () => (/* reexport module object */ _data__WEBPACK_IMPORTED_MODULE_3__),\n/* harmony export */   logging: () => (/* reexport module object */ _logging__WEBPACK_IMPORTED_MODULE_4__),\n/* harmony export */   melodies: () => (/* reexport module object */ _melodies__WEBPACK_IMPORTED_MODULE_5__),\n/* harmony export */   midiToSequenceProto: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.midiToSequenceProto),\n/* harmony export */   performance: () => (/* reexport module object */ _performance__WEBPACK_IMPORTED_MODULE_6__),\n/* harmony export */   sequenceProtoToMidi: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.sequenceProtoToMidi),\n/* harmony export */   sequences: () => (/* reexport module object */ _sequences__WEBPACK_IMPORTED_MODULE_7__),\n/* harmony export */   urlToBlob: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.urlToBlob),\n/* harmony export */   urlToNoteSequence: () => (/* reexport safe */ _midi_io__WEBPACK_IMPORTED_MODULE_9__.urlToNoteSequence)\n/* harmony export */ });\n/* harmony import */ var _aux_inputs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./aux_inputs */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/aux_inputs.js\");\n/* harmony import */ var _chords__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./chords */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/chords.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./data */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/data.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n/* harmony import */ var _melodies__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./melodies */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/melodies.js\");\n/* harmony import */ var _performance__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./performance */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/performance.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n/* harmony import */ var _metronome__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./metronome */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/metronome.js\");\n/* harmony import */ var _midi_io__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./midi_io */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/midi_io.js\");\n/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./player */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/player.js\");\n/* harmony import */ var _recorder__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./recorder */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/recorder.js\");\n/* harmony import */ var _visualizer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./visualizer */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/visualizer.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMkM7QUFDUjtBQUNNO0FBQ1Y7QUFDTTtBQUNFO0FBQ007QUFDSjtBQUNpRDtBQUM5RDtBQUNGO0FBQ0Q7QUFDRTtBQUNFO0FBQzdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvaW5kZXguanM/MDIzZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBhdXhfaW5wdXRzIGZyb20gJy4vYXV4X2lucHV0cyc7XG5pbXBvcnQgKiBhcyBjaG9yZHMgZnJvbSAnLi9jaG9yZHMnO1xuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCAqIGFzIGRhdGEgZnJvbSAnLi9kYXRhJztcbmltcG9ydCAqIGFzIGxvZ2dpbmcgZnJvbSAnLi9sb2dnaW5nJztcbmltcG9ydCAqIGFzIG1lbG9kaWVzIGZyb20gJy4vbWVsb2RpZXMnO1xuaW1wb3J0ICogYXMgcGVyZm9ybWFuY2UgZnJvbSAnLi9wZXJmb3JtYW5jZSc7XG5pbXBvcnQgKiBhcyBzZXF1ZW5jZXMgZnJvbSAnLi9zZXF1ZW5jZXMnO1xuZXhwb3J0IHsgYXV4X2lucHV0cywgY2hvcmRzLCBjb25zdGFudHMsIGRhdGEsIGxvZ2dpbmcsIG1lbG9kaWVzLCBwZXJmb3JtYW5jZSwgc2VxdWVuY2VzIH07XG5leHBvcnQgKiBmcm9tICcuL21ldHJvbm9tZSc7XG5leHBvcnQgKiBmcm9tICcuL21pZGlfaW8nO1xuZXhwb3J0ICogZnJvbSAnLi9wbGF5ZXInO1xuZXhwb3J0ICogZnJvbSAnLi9yZWNvcmRlcic7XG5leHBvcnQgKiBmcm9tICcuL3Zpc3VhbGl6ZXInO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js":
/*!***********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js ***!
  \***********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Level: () => (/* binding */ Level),\n/* harmony export */   log: () => (/* binding */ log),\n/* harmony export */   logWithDuration: () => (/* binding */ logWithDuration),\n/* harmony export */   setVerbosity: () => (/* binding */ setVerbosity),\n/* harmony export */   verbosity: () => (/* binding */ verbosity)\n/* harmony export */ });\n/* harmony import */ var _core_compat_global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/compat/global */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\");\n\nvar Level;\n(function (Level) {\n    Level[Level[\"NONE\"] = 0] = \"NONE\";\n    Level[Level[\"WARN\"] = 5] = \"WARN\";\n    Level[Level[\"INFO\"] = 10] = \"INFO\";\n    Level[Level[\"DEBUG\"] = 20] = \"DEBUG\";\n})(Level || (Level = {}));\nlet verbosity = 10;\nfunction setVerbosity(verbosity) {\n    verbosity = verbosity;\n}\nfunction log(msg, prefix = 'Magenta.js', level = 10) {\n    if (level === 0) {\n        throw Error('Logging level cannot be NONE.');\n    }\n    if (verbosity >= level) {\n        const logMethod = level === 5 ? console.warn : console.log;\n        logMethod(`%c ${prefix} `, 'background:magenta; color:white', msg);\n    }\n}\nfunction logWithDuration(msg, startTime, prefix = 'Magenta.js', level = 10) {\n    const durationSeconds = (_core_compat_global__WEBPACK_IMPORTED_MODULE_0__.performance.now() - startTime) / 1000;\n    log(`${msg} in ${durationSeconds.toPrecision(3)}s`, prefix, level);\n}\n//# sourceMappingURL=logging.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9sb2dnaW5nLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFvRDtBQUM3QztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHNCQUFzQjtBQUNoQjtBQUNBO0FBQ1A7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixRQUFRLHdCQUF3QjtBQUN4RDtBQUNBO0FBQ087QUFDUCw2QkFBNkIsNERBQVc7QUFDeEMsV0FBVyxLQUFLLEtBQUssK0JBQStCO0FBQ3BEO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb21vbmdhaC5naXRodWIuaW8vLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9sb2dnaW5nLmpzPzk2YTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGVyZm9ybWFuY2UgfSBmcm9tICcuLi9jb3JlL2NvbXBhdC9nbG9iYWwnO1xuZXhwb3J0IHZhciBMZXZlbDtcbihmdW5jdGlvbiAoTGV2ZWwpIHtcbiAgICBMZXZlbFtMZXZlbFtcIk5PTkVcIl0gPSAwXSA9IFwiTk9ORVwiO1xuICAgIExldmVsW0xldmVsW1wiV0FSTlwiXSA9IDVdID0gXCJXQVJOXCI7XG4gICAgTGV2ZWxbTGV2ZWxbXCJJTkZPXCJdID0gMTBdID0gXCJJTkZPXCI7XG4gICAgTGV2ZWxbTGV2ZWxbXCJERUJVR1wiXSA9IDIwXSA9IFwiREVCVUdcIjtcbn0pKExldmVsIHx8IChMZXZlbCA9IHt9KSk7XG5leHBvcnQgbGV0IHZlcmJvc2l0eSA9IDEwO1xuZXhwb3J0IGZ1bmN0aW9uIHNldFZlcmJvc2l0eSh2ZXJib3NpdHkpIHtcbiAgICB2ZXJib3NpdHkgPSB2ZXJib3NpdHk7XG59XG5leHBvcnQgZnVuY3Rpb24gbG9nKG1zZywgcHJlZml4ID0gJ01hZ2VudGEuanMnLCBsZXZlbCA9IDEwKSB7XG4gICAgaWYgKGxldmVsID09PSAwKSB7XG4gICAgICAgIHRocm93IEVycm9yKCdMb2dnaW5nIGxldmVsIGNhbm5vdCBiZSBOT05FLicpO1xuICAgIH1cbiAgICBpZiAodmVyYm9zaXR5ID49IGxldmVsKSB7XG4gICAgICAgIGNvbnN0IGxvZ01ldGhvZCA9IGxldmVsID09PSA1ID8gY29uc29sZS53YXJuIDogY29uc29sZS5sb2c7XG4gICAgICAgIGxvZ01ldGhvZChgJWMgJHtwcmVmaXh9IGAsICdiYWNrZ3JvdW5kOm1hZ2VudGE7IGNvbG9yOndoaXRlJywgbXNnKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gbG9nV2l0aER1cmF0aW9uKG1zZywgc3RhcnRUaW1lLCBwcmVmaXggPSAnTWFnZW50YS5qcycsIGxldmVsID0gMTApIHtcbiAgICBjb25zdCBkdXJhdGlvblNlY29uZHMgPSAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpIC8gMTAwMDtcbiAgICBsb2coYCR7bXNnfSBpbiAke2R1cmF0aW9uU2Vjb25kcy50b1ByZWNpc2lvbigzKX1zYCwgcHJlZml4LCBsZXZlbCk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1sb2dnaW5nLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/melodies.js":
/*!************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/melodies.js ***!
  \************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Melody: () => (/* binding */ Melody),\n/* harmony export */   MelodyRegister: () => (/* binding */ MelodyRegister),\n/* harmony export */   MelodyRhythm: () => (/* binding */ MelodyRhythm),\n/* harmony export */   MelodyShape: () => (/* binding */ MelodyShape),\n/* harmony export */   NOTE_OFF: () => (/* binding */ NOTE_OFF),\n/* harmony export */   NO_EVENT: () => (/* binding */ NO_EVENT)\n/* harmony export */ });\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tensorflow/tfjs */ \"(ssr)/./node_modules/.pnpm/@tensorflow+tfjs@2.8.6_seedrandom@2.4.4/node_modules/@tensorflow/tfjs/dist/tf.node.js\");\n/* harmony import */ var _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n\n\n\nconst NO_EVENT = 0;\nconst NOTE_OFF = 1;\nconst FIRST_PITCH = 2;\nclass Melody {\n    constructor(events, minPitch, maxPitch) {\n        this.events = events;\n        this.minPitch = minPitch;\n        this.maxPitch = maxPitch;\n    }\n    static fromNoteSequence(noteSequence, minPitch, maxPitch, ignorePolyphony = true, numSteps) {\n        _sequences__WEBPACK_IMPORTED_MODULE_2__.assertIsQuantizedSequence(noteSequence);\n        const sortedNotes = noteSequence.notes.sort((n1, n2) => {\n            if (n1.quantizedStartStep === n2.quantizedStartStep) {\n                return n2.pitch - n1.pitch;\n            }\n            return n1.quantizedStartStep - n2.quantizedStartStep;\n        });\n        const events = new Int32Array(numSteps || noteSequence.totalQuantizedSteps);\n        let lastStart = -1;\n        sortedNotes.forEach(n => {\n            if (n.quantizedStartStep === lastStart) {\n                if (!ignorePolyphony) {\n                    throw new Error('`NoteSequence` is not monophonic.');\n                }\n                else {\n                    return;\n                }\n            }\n            if (n.pitch < minPitch || n.pitch > maxPitch) {\n                throw Error('`NoteSequence` has a pitch outside of the valid range: ' +\n                    `${n.pitch}`);\n            }\n            events[n.quantizedStartStep] = n.pitch - minPitch + FIRST_PITCH;\n            events[n.quantizedEndStep] = NOTE_OFF;\n            lastStart = n.quantizedStartStep;\n        });\n        return new Melody(events, minPitch, maxPitch);\n    }\n    toNoteSequence(stepsPerQuarter, qpm) {\n        const noteSequence = _sequences__WEBPACK_IMPORTED_MODULE_2__.createQuantizedNoteSequence(stepsPerQuarter, qpm);\n        let currNote = null;\n        for (let s = 0; s < this.events.length; ++s) {\n            const event = this.events[s];\n            switch (event) {\n                case NO_EVENT:\n                    break;\n                case NOTE_OFF:\n                    if (currNote) {\n                        currNote.quantizedEndStep = s;\n                        noteSequence.notes.push(currNote);\n                        currNote = null;\n                    }\n                    break;\n                default:\n                    if (currNote) {\n                        currNote.quantizedEndStep = s;\n                        noteSequence.notes.push(currNote);\n                    }\n                    currNote = _protobuf_index__WEBPACK_IMPORTED_MODULE_1__.NoteSequence.Note.create({\n                        pitch: event - FIRST_PITCH + this.minPitch,\n                        quantizedStartStep: s\n                    });\n            }\n        }\n        if (currNote) {\n            currNote.quantizedEndStep = this.events.length;\n            noteSequence.notes.push(currNote);\n        }\n        noteSequence.totalQuantizedSteps = this.events.length;\n        return noteSequence;\n    }\n}\nclass MelodyRhythm {\n    constructor() {\n        this.depth = 1;\n    }\n    extract(melody) {\n        const numSteps = melody.events.length;\n        const buffer = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, 1]);\n        for (let step = 0; step < numSteps; ++step) {\n            buffer.set(melody.events[step] >= FIRST_PITCH ? 1 : 0, step, 0);\n        }\n        return buffer.toTensor().as2D(numSteps, 1);\n    }\n}\nclass MelodyShape {\n    constructor() {\n        this.depth = 3;\n    }\n    extract(melody) {\n        const numSteps = melody.events.length;\n        const buffer = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, 3]);\n        let lastIndex = null;\n        let lastPitch = null;\n        for (let step = 0; step < numSteps; ++step) {\n            if (melody.events[step] >= FIRST_PITCH) {\n                if (lastIndex !== null) {\n                    if (buffer.get(lastIndex, 0) === 0 &&\n                        buffer.get(lastIndex, 1) === 0 &&\n                        buffer.get(lastIndex, 2) === 0) {\n                        lastIndex = -1;\n                    }\n                    let direction;\n                    if (melody.events[step] < lastPitch) {\n                        direction = 0;\n                    }\n                    else if (melody.events[step] > lastPitch) {\n                        direction = 2;\n                    }\n                    else {\n                        direction = 1;\n                    }\n                    for (let i = step; i > lastIndex; --i) {\n                        buffer.set(1, i, direction);\n                    }\n                }\n                lastIndex = step;\n                lastPitch = melody.events[step];\n            }\n        }\n        if (lastIndex !== numSteps - 1) {\n            if ((lastIndex === null) ||\n                (buffer.get(lastIndex, 0) === 0 && buffer.get(lastIndex, 1) === 0 &&\n                    buffer.get(lastIndex, 2) === 0)) {\n                for (let i = 0; i < numSteps; ++i) {\n                    buffer.set(1, i, 1);\n                }\n            }\n            else {\n                for (let i = numSteps - 1; i > lastIndex; --i) {\n                    for (let j = 0; j < 3; j++) {\n                        buffer.set(buffer.get(lastIndex, j), i, j);\n                    }\n                }\n            }\n        }\n        return buffer.toTensor().as2D(numSteps, 3);\n    }\n}\nclass MelodyRegister {\n    constructor(boundaryPitches) {\n        this.boundaryPitches = boundaryPitches;\n        this.depth = boundaryPitches.length + 1;\n    }\n    meanMelodyPitch(melody) {\n        let total = 0;\n        let count = 0;\n        let currentPitch = null;\n        for (let step = 0; step < melody.events.length; ++step) {\n            if (melody.events[step] === NOTE_OFF) {\n                currentPitch = null;\n            }\n            else if (melody.events[step] >= FIRST_PITCH) {\n                currentPitch = melody.minPitch + melody.events[step] - FIRST_PITCH;\n            }\n            if (currentPitch !== null) {\n                total += currentPitch;\n                count += 1;\n            }\n        }\n        if (count) {\n            return total / count;\n        }\n        else {\n            return null;\n        }\n    }\n    extract(melody) {\n        const numSteps = melody.events.length;\n        const meanPitch = this.meanMelodyPitch(melody);\n        if (meanPitch === null) {\n            return _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.zeros([numSteps, this.depth]);\n        }\n        let bin = 0;\n        while (bin < this.boundaryPitches.length &&\n            meanPitch >= this.boundaryPitches[bin]) {\n            bin++;\n        }\n        const buffer = _tensorflow_tfjs__WEBPACK_IMPORTED_MODULE_0__.buffer([numSteps, this.depth]);\n        for (let step = 0; step < numSteps; ++step) {\n            buffer.set(1, step, bin);\n        }\n        return buffer.toTensor().as2D(numSteps, this.depth);\n    }\n}\n//# sourceMappingURL=melodies.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9tZWxvZGllcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXVDO0FBQ1U7QUFDUjtBQUNsQztBQUNBO0FBQ1A7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQW1DO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsUUFBUTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsbUVBQXFDO0FBQ2xFO0FBQ0Esd0JBQXdCLHdCQUF3QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix5REFBWTtBQUMzQztBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG9EQUFTO0FBQ2hDLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixvREFBUztBQUNoQztBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGVBQWU7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxjQUFjO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGVBQWU7QUFDMUQsb0NBQW9DLE9BQU87QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw2QkFBNkI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsbURBQVE7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG9EQUFTO0FBQ2hDLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvbWVsb2RpZXMuanM/NmMxNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB0ZiBmcm9tICdAdGVuc29yZmxvdy90ZmpzJztcbmltcG9ydCB7IE5vdGVTZXF1ZW5jZSB9IGZyb20gJy4uL3Byb3RvYnVmL2luZGV4JztcbmltcG9ydCAqIGFzIHNlcXVlbmNlcyBmcm9tICcuL3NlcXVlbmNlcyc7XG5leHBvcnQgY29uc3QgTk9fRVZFTlQgPSAwO1xuZXhwb3J0IGNvbnN0IE5PVEVfT0ZGID0gMTtcbmNvbnN0IEZJUlNUX1BJVENIID0gMjtcbmV4cG9ydCBjbGFzcyBNZWxvZHkge1xuICAgIGNvbnN0cnVjdG9yKGV2ZW50cywgbWluUGl0Y2gsIG1heFBpdGNoKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgICAgICB0aGlzLm1pblBpdGNoID0gbWluUGl0Y2g7XG4gICAgICAgIHRoaXMubWF4UGl0Y2ggPSBtYXhQaXRjaDtcbiAgICB9XG4gICAgc3RhdGljIGZyb21Ob3RlU2VxdWVuY2Uobm90ZVNlcXVlbmNlLCBtaW5QaXRjaCwgbWF4UGl0Y2gsIGlnbm9yZVBvbHlwaG9ueSA9IHRydWUsIG51bVN0ZXBzKSB7XG4gICAgICAgIHNlcXVlbmNlcy5hc3NlcnRJc1F1YW50aXplZFNlcXVlbmNlKG5vdGVTZXF1ZW5jZSk7XG4gICAgICAgIGNvbnN0IHNvcnRlZE5vdGVzID0gbm90ZVNlcXVlbmNlLm5vdGVzLnNvcnQoKG4xLCBuMikgPT4ge1xuICAgICAgICAgICAgaWYgKG4xLnF1YW50aXplZFN0YXJ0U3RlcCA9PT0gbjIucXVhbnRpemVkU3RhcnRTdGVwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4yLnBpdGNoIC0gbjEucGl0Y2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbjEucXVhbnRpemVkU3RhcnRTdGVwIC0gbjIucXVhbnRpemVkU3RhcnRTdGVwO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZXZlbnRzID0gbmV3IEludDMyQXJyYXkobnVtU3RlcHMgfHwgbm90ZVNlcXVlbmNlLnRvdGFsUXVhbnRpemVkU3RlcHMpO1xuICAgICAgICBsZXQgbGFzdFN0YXJ0ID0gLTE7XG4gICAgICAgIHNvcnRlZE5vdGVzLmZvckVhY2gobiA9PiB7XG4gICAgICAgICAgICBpZiAobi5xdWFudGl6ZWRTdGFydFN0ZXAgPT09IGxhc3RTdGFydCkge1xuICAgICAgICAgICAgICAgIGlmICghaWdub3JlUG9seXBob255KSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYE5vdGVTZXF1ZW5jZWAgaXMgbm90IG1vbm9waG9uaWMuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG4ucGl0Y2ggPCBtaW5QaXRjaCB8fCBuLnBpdGNoID4gbWF4UGl0Y2gpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignYE5vdGVTZXF1ZW5jZWAgaGFzIGEgcGl0Y2ggb3V0c2lkZSBvZiB0aGUgdmFsaWQgcmFuZ2U6ICcgK1xuICAgICAgICAgICAgICAgICAgICBgJHtuLnBpdGNofWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnRzW24ucXVhbnRpemVkU3RhcnRTdGVwXSA9IG4ucGl0Y2ggLSBtaW5QaXRjaCArIEZJUlNUX1BJVENIO1xuICAgICAgICAgICAgZXZlbnRzW24ucXVhbnRpemVkRW5kU3RlcF0gPSBOT1RFX09GRjtcbiAgICAgICAgICAgIGxhc3RTdGFydCA9IG4ucXVhbnRpemVkU3RhcnRTdGVwO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBNZWxvZHkoZXZlbnRzLCBtaW5QaXRjaCwgbWF4UGl0Y2gpO1xuICAgIH1cbiAgICB0b05vdGVTZXF1ZW5jZShzdGVwc1BlclF1YXJ0ZXIsIHFwbSkge1xuICAgICAgICBjb25zdCBub3RlU2VxdWVuY2UgPSBzZXF1ZW5jZXMuY3JlYXRlUXVhbnRpemVkTm90ZVNlcXVlbmNlKHN0ZXBzUGVyUXVhcnRlciwgcXBtKTtcbiAgICAgICAgbGV0IGN1cnJOb3RlID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCB0aGlzLmV2ZW50cy5sZW5ndGg7ICsrcykge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLmV2ZW50c1tzXTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIE5PX0VWRU5UOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE5PVEVfT0ZGOlxuICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyck5vdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJOb3RlLnF1YW50aXplZEVuZFN0ZXAgPSBzO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90ZVNlcXVlbmNlLm5vdGVzLnB1c2goY3Vyck5vdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3Vyck5vdGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyTm90ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3Vyck5vdGUucXVhbnRpemVkRW5kU3RlcCA9IHM7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChjdXJyTm90ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3Vyck5vdGUgPSBOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2g6IGV2ZW50IC0gRklSU1RfUElUQ0ggKyB0aGlzLm1pblBpdGNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkU3RhcnRTdGVwOiBzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyTm90ZSkge1xuICAgICAgICAgICAgY3Vyck5vdGUucXVhbnRpemVkRW5kU3RlcCA9IHRoaXMuZXZlbnRzLmxlbmd0aDtcbiAgICAgICAgICAgIG5vdGVTZXF1ZW5jZS5ub3Rlcy5wdXNoKGN1cnJOb3RlKTtcbiAgICAgICAgfVxuICAgICAgICBub3RlU2VxdWVuY2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IHRoaXMuZXZlbnRzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG5vdGVTZXF1ZW5jZTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTWVsb2R5Umh5dGhtIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5kZXB0aCA9IDE7XG4gICAgfVxuICAgIGV4dHJhY3QobWVsb2R5KSB7XG4gICAgICAgIGNvbnN0IG51bVN0ZXBzID0gbWVsb2R5LmV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRmLmJ1ZmZlcihbbnVtU3RlcHMsIDFdKTtcbiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBudW1TdGVwczsgKytzdGVwKSB7XG4gICAgICAgICAgICBidWZmZXIuc2V0KG1lbG9keS5ldmVudHNbc3RlcF0gPj0gRklSU1RfUElUQ0ggPyAxIDogMCwgc3RlcCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlci50b1RlbnNvcigpLmFzMkQobnVtU3RlcHMsIDEpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBNZWxvZHlTaGFwZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZGVwdGggPSAzO1xuICAgIH1cbiAgICBleHRyYWN0KG1lbG9keSkge1xuICAgICAgICBjb25zdCBudW1TdGVwcyA9IG1lbG9keS5ldmVudHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBidWZmZXIgPSB0Zi5idWZmZXIoW251bVN0ZXBzLCAzXSk7XG4gICAgICAgIGxldCBsYXN0SW5kZXggPSBudWxsO1xuICAgICAgICBsZXQgbGFzdFBpdGNoID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBudW1TdGVwczsgKytzdGVwKSB7XG4gICAgICAgICAgICBpZiAobWVsb2R5LmV2ZW50c1tzdGVwXSA+PSBGSVJTVF9QSVRDSCkge1xuICAgICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlci5nZXQobGFzdEluZGV4LCAwKSA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmdldChsYXN0SW5kZXgsIDEpID09PSAwICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIuZ2V0KGxhc3RJbmRleCwgMikgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RJbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxldCBkaXJlY3Rpb247XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZWxvZHkuZXZlbnRzW3N0ZXBdIDwgbGFzdFBpdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1lbG9keS5ldmVudHNbc3RlcF0gPiBsYXN0UGl0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IDI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGVwOyBpID4gbGFzdEluZGV4OyAtLWkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5zZXQoMSwgaSwgZGlyZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsYXN0SW5kZXggPSBzdGVwO1xuICAgICAgICAgICAgICAgIGxhc3RQaXRjaCA9IG1lbG9keS5ldmVudHNbc3RlcF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3RJbmRleCAhPT0gbnVtU3RlcHMgLSAxKSB7XG4gICAgICAgICAgICBpZiAoKGxhc3RJbmRleCA9PT0gbnVsbCkgfHxcbiAgICAgICAgICAgICAgICAoYnVmZmVyLmdldChsYXN0SW5kZXgsIDApID09PSAwICYmIGJ1ZmZlci5nZXQobGFzdEluZGV4LCAxKSA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICBidWZmZXIuZ2V0KGxhc3RJbmRleCwgMikgPT09IDApKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TdGVwczsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5zZXQoMSwgaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IG51bVN0ZXBzIC0gMTsgaSA+IGxhc3RJbmRleDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIuc2V0KGJ1ZmZlci5nZXQobGFzdEluZGV4LCBqKSwgaSwgaik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlci50b1RlbnNvcigpLmFzMkQobnVtU3RlcHMsIDMpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBNZWxvZHlSZWdpc3RlciB7XG4gICAgY29uc3RydWN0b3IoYm91bmRhcnlQaXRjaGVzKSB7XG4gICAgICAgIHRoaXMuYm91bmRhcnlQaXRjaGVzID0gYm91bmRhcnlQaXRjaGVzO1xuICAgICAgICB0aGlzLmRlcHRoID0gYm91bmRhcnlQaXRjaGVzLmxlbmd0aCArIDE7XG4gICAgfVxuICAgIG1lYW5NZWxvZHlQaXRjaChtZWxvZHkpIHtcbiAgICAgICAgbGV0IHRvdGFsID0gMDtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgbGV0IGN1cnJlbnRQaXRjaCA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IHN0ZXAgPSAwOyBzdGVwIDwgbWVsb2R5LmV2ZW50cy5sZW5ndGg7ICsrc3RlcCkge1xuICAgICAgICAgICAgaWYgKG1lbG9keS5ldmVudHNbc3RlcF0gPT09IE5PVEVfT0ZGKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBpdGNoID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG1lbG9keS5ldmVudHNbc3RlcF0gPj0gRklSU1RfUElUQ0gpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50UGl0Y2ggPSBtZWxvZHkubWluUGl0Y2ggKyBtZWxvZHkuZXZlbnRzW3N0ZXBdIC0gRklSU1RfUElUQ0g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudFBpdGNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdG90YWwgKz0gY3VycmVudFBpdGNoO1xuICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdG90YWwgLyBjb3VudDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGV4dHJhY3QobWVsb2R5KSB7XG4gICAgICAgIGNvbnN0IG51bVN0ZXBzID0gbWVsb2R5LmV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IG1lYW5QaXRjaCA9IHRoaXMubWVhbk1lbG9keVBpdGNoKG1lbG9keSk7XG4gICAgICAgIGlmIChtZWFuUGl0Y2ggPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0Zi56ZXJvcyhbbnVtU3RlcHMsIHRoaXMuZGVwdGhdKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYmluID0gMDtcbiAgICAgICAgd2hpbGUgKGJpbiA8IHRoaXMuYm91bmRhcnlQaXRjaGVzLmxlbmd0aCAmJlxuICAgICAgICAgICAgbWVhblBpdGNoID49IHRoaXMuYm91bmRhcnlQaXRjaGVzW2Jpbl0pIHtcbiAgICAgICAgICAgIGJpbisrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRmLmJ1ZmZlcihbbnVtU3RlcHMsIHRoaXMuZGVwdGhdKTtcbiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBudW1TdGVwczsgKytzdGVwKSB7XG4gICAgICAgICAgICBidWZmZXIuc2V0KDEsIHN0ZXAsIGJpbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlci50b1RlbnNvcigpLmFzMkQobnVtU3RlcHMsIHRoaXMuZGVwdGgpO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1lbG9kaWVzLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/melodies.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/metronome.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/metronome.js ***!
  \*************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Metronome: () => (/* binding */ Metronome),\n/* harmony export */   MetronomeCallbackObject: () => (/* binding */ MetronomeCallbackObject)\n/* harmony export */ });\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tone */ \"(ssr)/./node_modules/.pnpm/tone@14.7.77/node_modules/tone/build/Tone.js\");\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_0__);\n\nconst QUARTERS_PER_BAR = 4;\nclass MetronomeCallbackObject {\n}\nclass Metronome {\n    constructor(callbackObject, clicksPerQuarter = 1) {\n        this.clicksPerQuarter = 1;\n        this.muted = false;\n        this.loClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.hiClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.loClickNote = 'c5';\n        this.hiClickNote = 'g5';\n        this.ticking = false;\n        this.startedAt = null;\n        this.step = -1;\n        this.reset();\n        this.callbackObject = callbackObject;\n        this.clicksPerQuarter = clicksPerQuarter;\n    }\n    isTicking() {\n        return this.ticking;\n    }\n    getStartedAt() {\n        return this.startedAt;\n    }\n    getOffsetTime() {\n        return tone__WEBPACK_IMPORTED_MODULE_0__.immediate() - this.startedAt;\n    }\n    start(bpm = 120) {\n        this.reset();\n        this.ticking = true;\n        if (!this.callbackObject.click) {\n            this.callbackObject.click = () => { };\n        }\n        if (!this.callbackObject.quarter) {\n            this.callbackObject.quarter = () => { };\n        }\n        if (!this.callbackObject.bar) {\n            this.callbackObject.bar = () => { };\n        }\n        let bar = 0;\n        const clicksInBar = QUARTERS_PER_BAR * this.clicksPerQuarter;\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.scheduleRepeat((time) => {\n            if (!this.startedAt) {\n                this.startedAt = time;\n            }\n            const offsetTime = time - this.startedAt;\n            this.step++;\n            const clickInBar = this.step % clicksInBar;\n            const clickInQuarter = Math.floor(clickInBar / this.clicksPerQuarter);\n            const quarter = clickInBar % this.clicksPerQuarter;\n            this.callbackObject.click(offsetTime, clickInBar);\n            if (quarter === 0) {\n                this.callbackObject.quarter(offsetTime, clickInQuarter);\n            }\n            if (!this.muted) {\n                if (clickInBar === 0) {\n                    this.hiClick.triggerAttack(this.hiClickNote, time, 0.1);\n                }\n                else {\n                    this.loClick.triggerAttack(this.loClickNote, time, 0.1);\n                }\n            }\n            if (clickInBar === 0) {\n                this.callbackObject.bar(offsetTime, bar);\n                bar++;\n            }\n        }, `${clicksInBar}n`);\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = bpm;\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.start();\n    }\n    stop() {\n        this.ticking = false;\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.cancel();\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.stop();\n    }\n    reset() {\n        this.muted = false;\n        this.ticking = false;\n        this.step = -1;\n        this.startedAt = null;\n    }\n}\n//# sourceMappingURL=metronome.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9tZXRyb25vbWUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUE2QjtBQUM3QjtBQUNPO0FBQ1A7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwrQ0FDRDtBQUMxQjtBQUNBLHdCQUF3Qix1Q0FBdUM7QUFDL0QsU0FBUztBQUNUO0FBQ0EsMkJBQTJCLCtDQUNEO0FBQzFCO0FBQ0Esd0JBQXdCLHVDQUF1QztBQUMvRCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMkNBQWM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyQ0FBYztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLEtBQUssWUFBWTtBQUMxQixRQUFRLDJDQUFjO0FBQ3RCLFFBQVEsMkNBQWM7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSwyQ0FBYztBQUN0QixRQUFRLDJDQUFjO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9jb3JlL21ldHJvbm9tZS5qcz9iM2VhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFRvbmUgZnJvbSAndG9uZSc7XG5jb25zdCBRVUFSVEVSU19QRVJfQkFSID0gNDtcbmV4cG9ydCBjbGFzcyBNZXRyb25vbWVDYWxsYmFja09iamVjdCB7XG59XG5leHBvcnQgY2xhc3MgTWV0cm9ub21lIHtcbiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja09iamVjdCwgY2xpY2tzUGVyUXVhcnRlciA9IDEpIHtcbiAgICAgICAgdGhpcy5jbGlja3NQZXJRdWFydGVyID0gMTtcbiAgICAgICAgdGhpcy5tdXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxvQ2xpY2sgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1lbWJyYW5lU3ludGgoe1xuICAgICAgICAgICAgcGl0Y2hEZWNheTogMC4wMDgsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMC4zLCBzdXN0YWluOiAwIH0sXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLmhpQ2xpY2sgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1lbWJyYW5lU3ludGgoe1xuICAgICAgICAgICAgcGl0Y2hEZWNheTogMC4wMDgsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMC4zLCBzdXN0YWluOiAwIH0sXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLmxvQ2xpY2tOb3RlID0gJ2M1JztcbiAgICAgICAgdGhpcy5oaUNsaWNrTm90ZSA9ICdnNSc7XG4gICAgICAgIHRoaXMudGlja2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXJ0ZWRBdCA9IG51bGw7XG4gICAgICAgIHRoaXMuc3RlcCA9IC0xO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QgPSBjYWxsYmFja09iamVjdDtcbiAgICAgICAgdGhpcy5jbGlja3NQZXJRdWFydGVyID0gY2xpY2tzUGVyUXVhcnRlcjtcbiAgICB9XG4gICAgaXNUaWNraW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aWNraW5nO1xuICAgIH1cbiAgICBnZXRTdGFydGVkQXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0ZWRBdDtcbiAgICB9XG4gICAgZ2V0T2Zmc2V0VGltZSgpIHtcbiAgICAgICAgcmV0dXJuIFRvbmUuaW1tZWRpYXRlKCkgLSB0aGlzLnN0YXJ0ZWRBdDtcbiAgICB9XG4gICAgc3RhcnQoYnBtID0gMTIwKSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgdGhpcy50aWNraW5nID0gdHJ1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmNhbGxiYWNrT2JqZWN0LmNsaWNrKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrT2JqZWN0LmNsaWNrID0gKCkgPT4geyB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5jYWxsYmFja09iamVjdC5xdWFydGVyKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrT2JqZWN0LnF1YXJ0ZXIgPSAoKSA9PiB7IH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNhbGxiYWNrT2JqZWN0LmJhcikge1xuICAgICAgICAgICAgdGhpcy5jYWxsYmFja09iamVjdC5iYXIgPSAoKSA9PiB7IH07XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGJhciA9IDA7XG4gICAgICAgIGNvbnN0IGNsaWNrc0luQmFyID0gUVVBUlRFUlNfUEVSX0JBUiAqIHRoaXMuY2xpY2tzUGVyUXVhcnRlcjtcbiAgICAgICAgVG9uZS5UcmFuc3BvcnQuc2NoZWR1bGVSZXBlYXQoKHRpbWUpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zdGFydGVkQXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ZWRBdCA9IHRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvZmZzZXRUaW1lID0gdGltZSAtIHRoaXMuc3RhcnRlZEF0O1xuICAgICAgICAgICAgdGhpcy5zdGVwKys7XG4gICAgICAgICAgICBjb25zdCBjbGlja0luQmFyID0gdGhpcy5zdGVwICUgY2xpY2tzSW5CYXI7XG4gICAgICAgICAgICBjb25zdCBjbGlja0luUXVhcnRlciA9IE1hdGguZmxvb3IoY2xpY2tJbkJhciAvIHRoaXMuY2xpY2tzUGVyUXVhcnRlcik7XG4gICAgICAgICAgICBjb25zdCBxdWFydGVyID0gY2xpY2tJbkJhciAlIHRoaXMuY2xpY2tzUGVyUXVhcnRlcjtcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QuY2xpY2sob2Zmc2V0VGltZSwgY2xpY2tJbkJhcik7XG4gICAgICAgICAgICBpZiAocXVhcnRlciA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QucXVhcnRlcihvZmZzZXRUaW1lLCBjbGlja0luUXVhcnRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMubXV0ZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2xpY2tJbkJhciA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpQ2xpY2sudHJpZ2dlckF0dGFjayh0aGlzLmhpQ2xpY2tOb3RlLCB0aW1lLCAwLjEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb0NsaWNrLnRyaWdnZXJBdHRhY2sodGhpcy5sb0NsaWNrTm90ZSwgdGltZSwgMC4xKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2xpY2tJbkJhciA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QuYmFyKG9mZnNldFRpbWUsIGJhcik7XG4gICAgICAgICAgICAgICAgYmFyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGAke2NsaWNrc0luQmFyfW5gKTtcbiAgICAgICAgVG9uZS5UcmFuc3BvcnQuYnBtLnZhbHVlID0gYnBtO1xuICAgICAgICBUb25lLlRyYW5zcG9ydC5zdGFydCgpO1xuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICB0aGlzLnRpY2tpbmcgPSBmYWxzZTtcbiAgICAgICAgVG9uZS5UcmFuc3BvcnQuY2FuY2VsKCk7XG4gICAgICAgIFRvbmUuVHJhbnNwb3J0LnN0b3AoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50aWNraW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RlcCA9IC0xO1xuICAgICAgICB0aGlzLnN0YXJ0ZWRBdCA9IG51bGw7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWV0cm9ub21lLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/metronome.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/midi_io.js":
/*!***********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/midi_io.js ***!
  \***********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MidiConversionError: () => (/* binding */ MidiConversionError),\n/* harmony export */   blobToNoteSequence: () => (/* binding */ blobToNoteSequence),\n/* harmony export */   midiToSequenceProto: () => (/* binding */ midiToSequenceProto),\n/* harmony export */   sequenceProtoToMidi: () => (/* binding */ sequenceProtoToMidi),\n/* harmony export */   urlToBlob: () => (/* binding */ urlToBlob),\n/* harmony export */   urlToNoteSequence: () => (/* binding */ urlToNoteSequence)\n/* harmony export */ });\n/* harmony import */ var _tonejs_midi__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tonejs/midi */ \"(ssr)/./node_modules/.pnpm/@tonejs+midi@2.0.28/node_modules/@tonejs/midi/build/Midi.js\");\n/* harmony import */ var _tonejs_midi__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_tonejs_midi__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _core_compat_global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/compat/global */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\");\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n\n\n\n\n\nclass MidiConversionError extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nfunction midiToSequenceProto(midi) {\n    const parsedMidi = new _tonejs_midi__WEBPACK_IMPORTED_MODULE_0__.Midi(midi);\n    const ns = _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.create();\n    ns.ticksPerQuarter = parsedMidi.header.ppq;\n    ns.sourceInfo = _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.SourceInfo.create({\n        parser: _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.SourceInfo.Parser.TONEJS_MIDI_CONVERT,\n        encodingType: _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.SourceInfo.EncodingType.MIDI\n    });\n    for (const ts of parsedMidi.header.timeSignatures) {\n        ns.timeSignatures.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.TimeSignature.create({\n            time: parsedMidi.header.ticksToSeconds(ts.ticks),\n            numerator: ts.timeSignature[0],\n            denominator: ts.timeSignature[1],\n        }));\n    }\n    if (!ns.timeSignatures.length) {\n        ns.timeSignatures.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.TimeSignature.create({\n            time: 0,\n            numerator: 4,\n            denominator: 4,\n        }));\n    }\n    for (const tempo of parsedMidi.header.tempos) {\n        ns.tempos.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.Tempo.create({\n            time: tempo.time,\n            qpm: tempo.bpm,\n        }));\n    }\n    let instrumentNumber = -1;\n    for (const track of parsedMidi.tracks) {\n        if (track.notes.length > 0) {\n            instrumentNumber += 1;\n        }\n        for (const note of track.notes) {\n            const startTime = note.time;\n            const duration = note.duration;\n            const endTime = startTime + duration;\n            ns.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.Note.create({\n                instrument: instrumentNumber,\n                program: track.instrument.number,\n                startTime,\n                endTime,\n                pitch: note.midi,\n                velocity: Math.floor(note.velocity * _constants__WEBPACK_IMPORTED_MODULE_3__.MIDI_VELOCITIES),\n                isDrum: track.instrument.percussion\n            }));\n            if (endTime > ns.totalTime) {\n                ns.totalTime = endTime;\n            }\n        }\n        const controlChangeValues = Object.values(track.controlChanges);\n        const flattenedControlChangeValues = [].concat.apply([], controlChangeValues);\n        for (const controlChange of flattenedControlChangeValues) {\n            ns.controlChanges.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.ControlChange.create({\n                time: controlChange.time,\n                controlNumber: controlChange.number,\n                controlValue: Math.floor(controlChange.value * (_constants__WEBPACK_IMPORTED_MODULE_3__.MIDI_VELOCITIES - 1)),\n                instrument: instrumentNumber,\n                program: track.instrument.number,\n                isDrum: track.instrument.percussion\n            }));\n        }\n    }\n    return ns;\n}\nfunction sequenceProtoToMidi(ns) {\n    if (_sequences__WEBPACK_IMPORTED_MODULE_4__.isQuantizedSequence(ns)) {\n        ns = _sequences__WEBPACK_IMPORTED_MODULE_4__.unquantizeSequence(ns);\n    }\n    const midi = new _tonejs_midi__WEBPACK_IMPORTED_MODULE_0__.Midi();\n    midi.fromJSON({\n        header: {\n            name: '',\n            ppq: ns.ticksPerQuarter || _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_TICKS_PER_QUARTER,\n            tempos: [],\n            timeSignatures: [],\n            keySignatures: [],\n            meta: []\n        },\n        tracks: []\n    });\n    const tempos = Array.from(ns.tempos || []);\n    if (tempos.length === 0) {\n        tempos.push({ time: 0, qpm: _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_QUARTERS_PER_MINUTE });\n    }\n    tempos.sort((a, b) => a.time - b.time);\n    for (const tempo of tempos) {\n        midi.header.tempos.push({ ticks: midi.header.secondsToTicks(tempo.time),\n            bpm: tempo.qpm });\n        midi.header.update();\n    }\n    if (!ns.timeSignatures || ns.timeSignatures.length === 0) {\n        midi.header.timeSignatures.push({ ticks: 0, timeSignature: [4, 4] });\n    }\n    else {\n        for (const ts of ns.timeSignatures) {\n            midi.header.timeSignatures.push({\n                ticks: midi.header.secondsToTicks(ts.time),\n                timeSignature: [ts.numerator, ts.denominator]\n            });\n        }\n    }\n    midi.header.update();\n    const tracks = new Map();\n    for (const note of ns.notes) {\n        const instrument = note.instrument ? note.instrument : 0;\n        const program = (note.program === undefined) ? _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_PROGRAM :\n            note.program;\n        const isDrum = !!note.isDrum;\n        const key = JSON.stringify([instrument, program, isDrum]);\n        if (!tracks.has(key)) {\n            tracks.set(key, { notes: [], controlChanges: [] });\n        }\n        tracks.get(key).notes.push(note);\n    }\n    for (const controlChange of ns.controlChanges) {\n        const instrument = controlChange.instrument ? controlChange.instrument : 0;\n        const program = (controlChange.program === undefined)\n            ? _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_PROGRAM : controlChange.program;\n        const isDrum = !!controlChange.isDrum;\n        const key = JSON.stringify([instrument, program, isDrum]);\n        if (!tracks.has(key)) {\n            tracks.set(key, { notes: [], controlChanges: [] });\n        }\n        tracks.get(key).controlChanges.push(controlChange);\n    }\n    tracks.forEach((trackData, key) => {\n        const [program, isDrum] = JSON.parse(key).slice(1);\n        const track = midi.addTrack();\n        if (isDrum) {\n            track.channel = _constants__WEBPACK_IMPORTED_MODULE_3__.DRUM_CHANNEL;\n        }\n        else {\n            track.channel = _constants__WEBPACK_IMPORTED_MODULE_3__.NON_DRUM_CHANNELS[(midi.tracks.length - 1) % _constants__WEBPACK_IMPORTED_MODULE_3__.NON_DRUM_CHANNELS.length];\n        }\n        track.instrument.number = program;\n        for (const note of trackData.notes) {\n            const velocity = (note.velocity === undefined) ?\n                _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_VELOCITY :\n                note.velocity;\n            track.addNote({\n                midi: note.pitch,\n                time: note.startTime,\n                duration: note.endTime - note.startTime,\n                velocity: (velocity + 1) / _constants__WEBPACK_IMPORTED_MODULE_3__.MIDI_VELOCITIES\n            });\n        }\n        for (const controlChange of trackData.controlChanges) {\n            track.addCC({\n                number: controlChange.controlNumber,\n                value: controlChange.controlValue,\n                time: controlChange.time\n            });\n        }\n    });\n    return midi.toArray();\n}\nfunction urlToBlob(url) {\n    return new Promise((resolve, reject) => {\n        (0,_core_compat_global__WEBPACK_IMPORTED_MODULE_1__.fetch)(url)\n            .then((response) => {\n            return response.blob();\n        })\n            .then((blob) => {\n            resolve(blob);\n        })\n            .catch((error) => reject(error));\n    });\n}\nfunction blobToNoteSequence(blob) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const ns = midiToSequenceProto(reader.result);\n                resolve(ns);\n            }\n            catch (error) {\n                reject(error);\n            }\n        };\n        reader.onerror = (e) => reject(e);\n        reader.readAsArrayBuffer(blob);\n    });\n}\nfunction urlToNoteSequence(url) {\n    return urlToBlob(url).then(blobToNoteSequence);\n}\n//# sourceMappingURL=midi_io.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9taWRpX2lvLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFvQztBQUNVO0FBQ0c7QUFDUjtBQUNBO0FBQ2xDO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsMkJBQTJCLDhDQUFJO0FBQy9CLGVBQWUseURBQVk7QUFDM0I7QUFDQSxvQkFBb0IseURBQVk7QUFDaEMsZ0JBQWdCLHlEQUFZO0FBQzVCLHNCQUFzQix5REFBWTtBQUNsQyxLQUFLO0FBQ0w7QUFDQSwrQkFBK0IseURBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0IseURBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx1QkFBdUIseURBQVk7QUFDbkM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix5REFBWTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELHVEQUF5QjtBQUM5RTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyx5REFBWTtBQUMvQztBQUNBO0FBQ0EsZ0VBQWdFLHVEQUF5QjtBQUN6RjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQLFFBQVEsMkRBQTZCO0FBQ3JDLGFBQWEsMERBQTRCO0FBQ3pDO0FBQ0EscUJBQXFCLDhDQUFJO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxpRUFBbUM7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHNCQUFzQixjQUFjLG1FQUFxQyxFQUFFO0FBQzNFO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQyw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGlDQUFpQztBQUMzRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELHVEQUF5QjtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QiwrQkFBK0I7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx1REFBeUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLCtCQUErQjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixvREFBc0I7QUFDbEQ7QUFDQTtBQUNBLDRCQUE0Qix5REFBMkIsNEJBQTRCLHlEQUEyQjtBQUM5RztBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix3REFBMEI7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyx1REFBeUI7QUFDcEUsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ087QUFDUDtBQUNBLFFBQVEsMERBQUs7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ087QUFDUDtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb21vbmdhaC5naXRodWIuaW8vLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9taWRpX2lvLmpzP2I3ZmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWlkaSB9IGZyb20gJ0B0b25lanMvbWlkaSc7XG5pbXBvcnQgeyBmZXRjaCB9IGZyb20gJy4uL2NvcmUvY29tcGF0L2dsb2JhbCc7XG5pbXBvcnQgeyBOb3RlU2VxdWVuY2UgfSBmcm9tICcuLi9wcm90b2J1Zi9pbmRleCc7XG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0ICogYXMgc2VxdWVuY2VzIGZyb20gJy4vc2VxdWVuY2VzJztcbmV4cG9ydCBjbGFzcyBNaWRpQ29udmVyc2lvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIG1pZGlUb1NlcXVlbmNlUHJvdG8obWlkaSkge1xuICAgIGNvbnN0IHBhcnNlZE1pZGkgPSBuZXcgTWlkaShtaWRpKTtcbiAgICBjb25zdCBucyA9IE5vdGVTZXF1ZW5jZS5jcmVhdGUoKTtcbiAgICBucy50aWNrc1BlclF1YXJ0ZXIgPSBwYXJzZWRNaWRpLmhlYWRlci5wcHE7XG4gICAgbnMuc291cmNlSW5mbyA9IE5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLmNyZWF0ZSh7XG4gICAgICAgIHBhcnNlcjogTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8uUGFyc2VyLlRPTkVKU19NSURJX0NPTlZFUlQsXG4gICAgICAgIGVuY29kaW5nVHlwZTogTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8uRW5jb2RpbmdUeXBlLk1JRElcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IHRzIG9mIHBhcnNlZE1pZGkuaGVhZGVyLnRpbWVTaWduYXR1cmVzKSB7XG4gICAgICAgIG5zLnRpbWVTaWduYXR1cmVzLnB1c2goTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmUuY3JlYXRlKHtcbiAgICAgICAgICAgIHRpbWU6IHBhcnNlZE1pZGkuaGVhZGVyLnRpY2tzVG9TZWNvbmRzKHRzLnRpY2tzKSxcbiAgICAgICAgICAgIG51bWVyYXRvcjogdHMudGltZVNpZ25hdHVyZVswXSxcbiAgICAgICAgICAgIGRlbm9taW5hdG9yOiB0cy50aW1lU2lnbmF0dXJlWzFdLFxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGlmICghbnMudGltZVNpZ25hdHVyZXMubGVuZ3RoKSB7XG4gICAgICAgIG5zLnRpbWVTaWduYXR1cmVzLnB1c2goTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmUuY3JlYXRlKHtcbiAgICAgICAgICAgIHRpbWU6IDAsXG4gICAgICAgICAgICBudW1lcmF0b3I6IDQsXG4gICAgICAgICAgICBkZW5vbWluYXRvcjogNCxcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHRlbXBvIG9mIHBhcnNlZE1pZGkuaGVhZGVyLnRlbXBvcykge1xuICAgICAgICBucy50ZW1wb3MucHVzaChOb3RlU2VxdWVuY2UuVGVtcG8uY3JlYXRlKHtcbiAgICAgICAgICAgIHRpbWU6IHRlbXBvLnRpbWUsXG4gICAgICAgICAgICBxcG06IHRlbXBvLmJwbSxcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBsZXQgaW5zdHJ1bWVudE51bWJlciA9IC0xO1xuICAgIGZvciAoY29uc3QgdHJhY2sgb2YgcGFyc2VkTWlkaS50cmFja3MpIHtcbiAgICAgICAgaWYgKHRyYWNrLm5vdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGluc3RydW1lbnROdW1iZXIgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IG5vdGUgb2YgdHJhY2subm90ZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5vdGUudGltZTtcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gbm90ZS5kdXJhdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IGVuZFRpbWUgPSBzdGFydFRpbWUgKyBkdXJhdGlvbjtcbiAgICAgICAgICAgIG5zLm5vdGVzLnB1c2goTm90ZVNlcXVlbmNlLk5vdGUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBpbnN0cnVtZW50OiBpbnN0cnVtZW50TnVtYmVyLFxuICAgICAgICAgICAgICAgIHByb2dyYW06IHRyYWNrLmluc3RydW1lbnQubnVtYmVyLFxuICAgICAgICAgICAgICAgIHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lLFxuICAgICAgICAgICAgICAgIHBpdGNoOiBub3RlLm1pZGksXG4gICAgICAgICAgICAgICAgdmVsb2NpdHk6IE1hdGguZmxvb3Iobm90ZS52ZWxvY2l0eSAqIGNvbnN0YW50cy5NSURJX1ZFTE9DSVRJRVMpLFxuICAgICAgICAgICAgICAgIGlzRHJ1bTogdHJhY2suaW5zdHJ1bWVudC5wZXJjdXNzaW9uXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpZiAoZW5kVGltZSA+IG5zLnRvdGFsVGltZSkge1xuICAgICAgICAgICAgICAgIG5zLnRvdGFsVGltZSA9IGVuZFRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udHJvbENoYW5nZVZhbHVlcyA9IE9iamVjdC52YWx1ZXModHJhY2suY29udHJvbENoYW5nZXMpO1xuICAgICAgICBjb25zdCBmbGF0dGVuZWRDb250cm9sQ2hhbmdlVmFsdWVzID0gW10uY29uY2F0LmFwcGx5KFtdLCBjb250cm9sQ2hhbmdlVmFsdWVzKTtcbiAgICAgICAgZm9yIChjb25zdCBjb250cm9sQ2hhbmdlIG9mIGZsYXR0ZW5lZENvbnRyb2xDaGFuZ2VWYWx1ZXMpIHtcbiAgICAgICAgICAgIG5zLmNvbnRyb2xDaGFuZ2VzLnB1c2goTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2UuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICB0aW1lOiBjb250cm9sQ2hhbmdlLnRpbWUsXG4gICAgICAgICAgICAgICAgY29udHJvbE51bWJlcjogY29udHJvbENoYW5nZS5udW1iZXIsXG4gICAgICAgICAgICAgICAgY29udHJvbFZhbHVlOiBNYXRoLmZsb29yKGNvbnRyb2xDaGFuZ2UudmFsdWUgKiAoY29uc3RhbnRzLk1JRElfVkVMT0NJVElFUyAtIDEpKSxcbiAgICAgICAgICAgICAgICBpbnN0cnVtZW50OiBpbnN0cnVtZW50TnVtYmVyLFxuICAgICAgICAgICAgICAgIHByb2dyYW06IHRyYWNrLmluc3RydW1lbnQubnVtYmVyLFxuICAgICAgICAgICAgICAgIGlzRHJ1bTogdHJhY2suaW5zdHJ1bWVudC5wZXJjdXNzaW9uXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5zO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlUHJvdG9Ub01pZGkobnMpIHtcbiAgICBpZiAoc2VxdWVuY2VzLmlzUXVhbnRpemVkU2VxdWVuY2UobnMpKSB7XG4gICAgICAgIG5zID0gc2VxdWVuY2VzLnVucXVhbnRpemVTZXF1ZW5jZShucyk7XG4gICAgfVxuICAgIGNvbnN0IG1pZGkgPSBuZXcgTWlkaSgpO1xuICAgIG1pZGkuZnJvbUpTT04oe1xuICAgICAgICBoZWFkZXI6IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgcHBxOiBucy50aWNrc1BlclF1YXJ0ZXIgfHwgY29uc3RhbnRzLkRFRkFVTFRfVElDS1NfUEVSX1FVQVJURVIsXG4gICAgICAgICAgICB0ZW1wb3M6IFtdLFxuICAgICAgICAgICAgdGltZVNpZ25hdHVyZXM6IFtdLFxuICAgICAgICAgICAga2V5U2lnbmF0dXJlczogW10sXG4gICAgICAgICAgICBtZXRhOiBbXVxuICAgICAgICB9LFxuICAgICAgICB0cmFja3M6IFtdXG4gICAgfSk7XG4gICAgY29uc3QgdGVtcG9zID0gQXJyYXkuZnJvbShucy50ZW1wb3MgfHwgW10pO1xuICAgIGlmICh0ZW1wb3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRlbXBvcy5wdXNoKHsgdGltZTogMCwgcXBtOiBjb25zdGFudHMuREVGQVVMVF9RVUFSVEVSU19QRVJfTUlOVVRFIH0pO1xuICAgIH1cbiAgICB0ZW1wb3Muc29ydCgoYSwgYikgPT4gYS50aW1lIC0gYi50aW1lKTtcbiAgICBmb3IgKGNvbnN0IHRlbXBvIG9mIHRlbXBvcykge1xuICAgICAgICBtaWRpLmhlYWRlci50ZW1wb3MucHVzaCh7IHRpY2tzOiBtaWRpLmhlYWRlci5zZWNvbmRzVG9UaWNrcyh0ZW1wby50aW1lKSxcbiAgICAgICAgICAgIGJwbTogdGVtcG8ucXBtIH0pO1xuICAgICAgICBtaWRpLmhlYWRlci51cGRhdGUoKTtcbiAgICB9XG4gICAgaWYgKCFucy50aW1lU2lnbmF0dXJlcyB8fCBucy50aW1lU2lnbmF0dXJlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbWlkaS5oZWFkZXIudGltZVNpZ25hdHVyZXMucHVzaCh7IHRpY2tzOiAwLCB0aW1lU2lnbmF0dXJlOiBbNCwgNF0gfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBmb3IgKGNvbnN0IHRzIG9mIG5zLnRpbWVTaWduYXR1cmVzKSB7XG4gICAgICAgICAgICBtaWRpLmhlYWRlci50aW1lU2lnbmF0dXJlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0aWNrczogbWlkaS5oZWFkZXIuc2Vjb25kc1RvVGlja3ModHMudGltZSksXG4gICAgICAgICAgICAgICAgdGltZVNpZ25hdHVyZTogW3RzLm51bWVyYXRvciwgdHMuZGVub21pbmF0b3JdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBtaWRpLmhlYWRlci51cGRhdGUoKTtcbiAgICBjb25zdCB0cmFja3MgPSBuZXcgTWFwKCk7XG4gICAgZm9yIChjb25zdCBub3RlIG9mIG5zLm5vdGVzKSB7XG4gICAgICAgIGNvbnN0IGluc3RydW1lbnQgPSBub3RlLmluc3RydW1lbnQgPyBub3RlLmluc3RydW1lbnQgOiAwO1xuICAgICAgICBjb25zdCBwcm9ncmFtID0gKG5vdGUucHJvZ3JhbSA9PT0gdW5kZWZpbmVkKSA/IGNvbnN0YW50cy5ERUZBVUxUX1BST0dSQU0gOlxuICAgICAgICAgICAgbm90ZS5wcm9ncmFtO1xuICAgICAgICBjb25zdCBpc0RydW0gPSAhIW5vdGUuaXNEcnVtO1xuICAgICAgICBjb25zdCBrZXkgPSBKU09OLnN0cmluZ2lmeShbaW5zdHJ1bWVudCwgcHJvZ3JhbSwgaXNEcnVtXSk7XG4gICAgICAgIGlmICghdHJhY2tzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICB0cmFja3Muc2V0KGtleSwgeyBub3RlczogW10sIGNvbnRyb2xDaGFuZ2VzOiBbXSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0cmFja3MuZ2V0KGtleSkubm90ZXMucHVzaChub3RlKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBjb250cm9sQ2hhbmdlIG9mIG5zLmNvbnRyb2xDaGFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IGluc3RydW1lbnQgPSBjb250cm9sQ2hhbmdlLmluc3RydW1lbnQgPyBjb250cm9sQ2hhbmdlLmluc3RydW1lbnQgOiAwO1xuICAgICAgICBjb25zdCBwcm9ncmFtID0gKGNvbnRyb2xDaGFuZ2UucHJvZ3JhbSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgPyBjb25zdGFudHMuREVGQVVMVF9QUk9HUkFNIDogY29udHJvbENoYW5nZS5wcm9ncmFtO1xuICAgICAgICBjb25zdCBpc0RydW0gPSAhIWNvbnRyb2xDaGFuZ2UuaXNEcnVtO1xuICAgICAgICBjb25zdCBrZXkgPSBKU09OLnN0cmluZ2lmeShbaW5zdHJ1bWVudCwgcHJvZ3JhbSwgaXNEcnVtXSk7XG4gICAgICAgIGlmICghdHJhY2tzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICB0cmFja3Muc2V0KGtleSwgeyBub3RlczogW10sIGNvbnRyb2xDaGFuZ2VzOiBbXSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0cmFja3MuZ2V0KGtleSkuY29udHJvbENoYW5nZXMucHVzaChjb250cm9sQ2hhbmdlKTtcbiAgICB9XG4gICAgdHJhY2tzLmZvckVhY2goKHRyYWNrRGF0YSwga2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IFtwcm9ncmFtLCBpc0RydW1dID0gSlNPTi5wYXJzZShrZXkpLnNsaWNlKDEpO1xuICAgICAgICBjb25zdCB0cmFjayA9IG1pZGkuYWRkVHJhY2soKTtcbiAgICAgICAgaWYgKGlzRHJ1bSkge1xuICAgICAgICAgICAgdHJhY2suY2hhbm5lbCA9IGNvbnN0YW50cy5EUlVNX0NIQU5ORUw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0cmFjay5jaGFubmVsID0gY29uc3RhbnRzLk5PTl9EUlVNX0NIQU5ORUxTWyhtaWRpLnRyYWNrcy5sZW5ndGggLSAxKSAlIGNvbnN0YW50cy5OT05fRFJVTV9DSEFOTkVMUy5sZW5ndGhdO1xuICAgICAgICB9XG4gICAgICAgIHRyYWNrLmluc3RydW1lbnQubnVtYmVyID0gcHJvZ3JhbTtcbiAgICAgICAgZm9yIChjb25zdCBub3RlIG9mIHRyYWNrRGF0YS5ub3Rlcykge1xuICAgICAgICAgICAgY29uc3QgdmVsb2NpdHkgPSAobm90ZS52ZWxvY2l0eSA9PT0gdW5kZWZpbmVkKSA/XG4gICAgICAgICAgICAgICAgY29uc3RhbnRzLkRFRkFVTFRfVkVMT0NJVFkgOlxuICAgICAgICAgICAgICAgIG5vdGUudmVsb2NpdHk7XG4gICAgICAgICAgICB0cmFjay5hZGROb3RlKHtcbiAgICAgICAgICAgICAgICBtaWRpOiBub3RlLnBpdGNoLFxuICAgICAgICAgICAgICAgIHRpbWU6IG5vdGUuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBub3RlLmVuZFRpbWUgLSBub3RlLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogKHZlbG9jaXR5ICsgMSkgLyBjb25zdGFudHMuTUlESV9WRUxPQ0lUSUVTXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNvbnRyb2xDaGFuZ2Ugb2YgdHJhY2tEYXRhLmNvbnRyb2xDaGFuZ2VzKSB7XG4gICAgICAgICAgICB0cmFjay5hZGRDQyh7XG4gICAgICAgICAgICAgICAgbnVtYmVyOiBjb250cm9sQ2hhbmdlLmNvbnRyb2xOdW1iZXIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGNvbnRyb2xDaGFuZ2UuY29udHJvbFZhbHVlLFxuICAgICAgICAgICAgICAgIHRpbWU6IGNvbnRyb2xDaGFuZ2UudGltZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWlkaS50b0FycmF5KCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdXJsVG9CbG9iKHVybCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZldGNoKHVybClcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmJsb2IoKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKChibG9iKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKGJsb2IpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gYmxvYlRvTm90ZVNlcXVlbmNlKGJsb2IpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbnMgPSBtaWRpVG9TZXF1ZW5jZVByb3RvKHJlYWRlci5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUobnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoZSkgPT4gcmVqZWN0KGUpO1xuICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdXJsVG9Ob3RlU2VxdWVuY2UodXJsKSB7XG4gICAgcmV0dXJuIHVybFRvQmxvYih1cmwpLnRoZW4oYmxvYlRvTm90ZVNlcXVlbmNlKTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1pZGlfaW8uanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/midi_io.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/performance.js":
/*!***************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/performance.js ***!
  \***************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Performance: () => (/* binding */ Performance)\n/* harmony export */ });\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n\n\n\n\nclass Performance {\n    constructor(events, maxShiftSteps, numVelocityBins, program, isDrum) {\n        this.events = events;\n        this.maxShiftSteps = maxShiftSteps;\n        this.numVelocityBins = numVelocityBins;\n        this.program = program;\n        this.isDrum = isDrum;\n    }\n    static fromNoteSequence(noteSequence, maxShiftSteps, numVelocityBins, instrument) {\n        _sequences__WEBPACK_IMPORTED_MODULE_2__.assertIsQuantizedSequence(noteSequence);\n        const notes = noteSequence.notes.filter((note, _) => instrument !== undefined ? note.instrument === instrument : true);\n        const sortedNotes = notes.sort((a, b) => a.startTime === b.startTime ? a.pitch - b.pitch :\n            a.startTime - b.startTime);\n        const onsets = sortedNotes.map((note, i) => ({ step: note.quantizedStartStep, index: i, isOffset: 0 }));\n        const offsets = sortedNotes.map((note, i) => ({ step: note.quantizedEndStep, index: i, isOffset: 1 }));\n        const noteEvents = onsets.concat(offsets).sort((a, b) => a.step === b.step ?\n            (a.index === b.index ? a.isOffset - b.isOffset :\n                a.index - b.index) :\n            a.step - b.step);\n        const velocityBinSize = numVelocityBins ?\n            Math.ceil((_constants__WEBPACK_IMPORTED_MODULE_1__.MIDI_VELOCITIES - 1) / numVelocityBins) :\n            undefined;\n        const events = [];\n        let currentStep = 0;\n        let currentVelocityBin = numVelocityBins;\n        for (const e of noteEvents) {\n            if (e.step > currentStep) {\n                while (e.step > currentStep + maxShiftSteps) {\n                    events.push({ type: 'time-shift', steps: maxShiftSteps });\n                    currentStep += maxShiftSteps;\n                }\n                events.push({ type: 'time-shift', steps: e.step - currentStep });\n                currentStep = e.step;\n            }\n            if (e.isOffset) {\n                events.push({ type: 'note-off', pitch: sortedNotes[e.index].pitch });\n            }\n            else {\n                if (velocityBinSize) {\n                    const velocityBin = Math.floor((sortedNotes[e.index].velocity -\n                        _constants__WEBPACK_IMPORTED_MODULE_1__.MIN_MIDI_VELOCITY - 1) /\n                        velocityBinSize) +\n                        1;\n                    if (velocityBin !== currentVelocityBin) {\n                        events.push({ type: 'velocity-change', velocityBin });\n                        currentVelocityBin = velocityBin;\n                    }\n                }\n                events.push({ type: 'note-on', pitch: sortedNotes[e.index].pitch });\n            }\n        }\n        const isDrum = notes.some(note => note.isDrum) ?\n            (notes.some(note => !note.isDrum) ? undefined : true) :\n            false;\n        const programs = Array.from(new Set(notes.map(note => note.program)));\n        const program = (!isDrum && programs.length === 1) ? programs[0] : undefined;\n        const performance = new Performance(events, maxShiftSteps, numVelocityBins, program, isDrum);\n        performance.setNumSteps(noteSequence.totalQuantizedSteps);\n        return performance;\n    }\n    getNumSteps() {\n        return this.events.filter((event) => event.type === 'time-shift')\n            .map((event) => event.steps)\n            .reduce((a, b) => a + b, 0);\n    }\n    setNumSteps(numSteps) {\n        let currentNumSteps = this.getNumSteps();\n        if (currentNumSteps < numSteps) {\n            if (this.events.length) {\n                const event = this.events[this.events.length - 1];\n                if (event.type === 'time-shift') {\n                    const steps = Math.min(numSteps - currentNumSteps, this.maxShiftSteps - event.steps);\n                    event.steps += steps;\n                    currentNumSteps += steps;\n                }\n            }\n            while (currentNumSteps < numSteps) {\n                if (currentNumSteps + this.maxShiftSteps > numSteps) {\n                    this.events.push({ type: 'time-shift', steps: numSteps - currentNumSteps });\n                    currentNumSteps = numSteps;\n                }\n                else {\n                    this.events.push({ type: 'time-shift', steps: this.maxShiftSteps });\n                    currentNumSteps += this.maxShiftSteps;\n                }\n            }\n        }\n        else if (currentNumSteps > numSteps) {\n            while (this.events.length && currentNumSteps > numSteps) {\n                const event = this.events[this.events.length - 1];\n                if (event.type === 'time-shift') {\n                    if (currentNumSteps - event.steps < numSteps) {\n                        event.steps -= currentNumSteps - numSteps;\n                        currentNumSteps = numSteps;\n                    }\n                    else {\n                        this.events.pop();\n                        currentNumSteps -= event.steps;\n                    }\n                }\n                else {\n                    this.events.pop();\n                }\n            }\n        }\n    }\n    toNoteSequence(instrument) {\n        const velocityBinSize = this.numVelocityBins ?\n            Math.ceil((_constants__WEBPACK_IMPORTED_MODULE_1__.MIDI_VELOCITIES - 1) / this.numVelocityBins) :\n            undefined;\n        const noteSequence = _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.create();\n        let currentStep = 0;\n        let currentVelocity = undefined;\n        const pitchStartStepsAndVelocities = new Map();\n        for (let i = _constants__WEBPACK_IMPORTED_MODULE_1__.MIN_MIDI_PITCH; i <= _constants__WEBPACK_IMPORTED_MODULE_1__.MAX_MIDI_PITCH; ++i) {\n            pitchStartStepsAndVelocities.set(i, []);\n        }\n        for (const event of this.events) {\n            switch (event.type) {\n                case 'note-on':\n                    pitchStartStepsAndVelocities.get(event.pitch).push([\n                        currentStep, currentVelocity\n                    ]);\n                    break;\n                case 'note-off':\n                    const startStepsAndVelocities = pitchStartStepsAndVelocities.get(event.pitch);\n                    if (startStepsAndVelocities.length) {\n                        const [startStep, velocity] = startStepsAndVelocities.shift();\n                        if (currentStep > startStep) {\n                            noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create({\n                                pitch: event.pitch,\n                                velocity,\n                                instrument,\n                                quantizedStartStep: startStep,\n                                quantizedEndStep: currentStep,\n                                program: this.program,\n                                isDrum: this.isDrum,\n                            }));\n                        }\n                        else {\n                            _logging__WEBPACK_IMPORTED_MODULE_3__.log('Ignoring zero-length note: ' +\n                                `(pitch = ${event.pitch}, step = ${currentStep})`, 'Performance');\n                        }\n                    }\n                    else {\n                        _logging__WEBPACK_IMPORTED_MODULE_3__.log('Ignoring note-off with no previous note-on:' +\n                            `(pitch = ${event.pitch}, step = ${currentStep})`, 'Performance');\n                    }\n                    break;\n                case 'time-shift':\n                    currentStep += event.steps;\n                    break;\n                case 'velocity-change':\n                    if (velocityBinSize) {\n                        currentVelocity = _constants__WEBPACK_IMPORTED_MODULE_1__.MIN_MIDI_VELOCITY +\n                            (event.velocityBin - 1) * velocityBinSize + 1;\n                    }\n                    else {\n                        throw new Error(`Unexpected velocity change event: ${event}`);\n                    }\n                    break;\n                default:\n                    throw new Error(`Unrecognized performance event: ${event}`);\n            }\n        }\n        pitchStartStepsAndVelocities.forEach((startStepsAndVelocities, pitch) => {\n            for (const [startStep, velocity] of startStepsAndVelocities) {\n                if (currentStep > startStep) {\n                    noteSequence.notes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create({\n                        pitch,\n                        velocity,\n                        instrument,\n                        quantizedStartStep: startStep,\n                        quantizedEndStep: currentStep,\n                        program: this.program,\n                        isDrum: this.isDrum\n                    }));\n                }\n                else {\n                    _logging__WEBPACK_IMPORTED_MODULE_3__.log('Ignoring zero-length note: ' +\n                        `(pitch = ${pitch}, step = ${currentStep})`, 'Performance');\n                }\n            }\n        });\n        noteSequence.totalQuantizedSteps = currentStep;\n        return noteSequence;\n    }\n}\n//# sourceMappingURL=performance.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9wZXJmb3JtYW5jZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFpRDtBQUNSO0FBQ0E7QUFDSjtBQUM5QjtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFtQztBQUMzQztBQUNBO0FBQ0E7QUFDQSx1REFBdUQsc0RBQXNEO0FBQzdHLHdEQUF3RCxvREFBb0Q7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix1REFBeUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMENBQTBDO0FBQzVFO0FBQ0E7QUFDQSw4QkFBOEIsaURBQWlEO0FBQy9FO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixxREFBcUQ7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseURBQTJCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxzQ0FBc0M7QUFDNUU7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLG9EQUFvRDtBQUNsRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHVEQUF1RDtBQUM5RjtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsK0NBQStDO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHVEQUF5QjtBQUNoRDtBQUNBLDZCQUE2Qix5REFBWTtBQUN6QztBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsc0RBQXdCLEVBQUUsS0FBSyxzREFBd0IsRUFBRTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELHlEQUFZO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSw0QkFBNEIseUNBQVc7QUFDdkMsNENBQTRDLFlBQVksV0FBVyxZQUFZO0FBQy9FO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5Q0FBVztBQUNuQyx3Q0FBd0MsWUFBWSxXQUFXLFlBQVk7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMseURBQTJCO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxNQUFNO0FBQ25GO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSxNQUFNO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMseURBQVk7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLG9CQUFvQix5Q0FBVztBQUMvQixvQ0FBb0MsTUFBTSxXQUFXLFlBQVk7QUFDakU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvcGVyZm9ybWFuY2UuanM/ZTJlMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb3RlU2VxdWVuY2UgfSBmcm9tICcuLi9wcm90b2J1Zi9pbmRleCc7XG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0ICogYXMgc2VxdWVuY2VzIGZyb20gJy4vc2VxdWVuY2VzJztcbmltcG9ydCAqIGFzIGxvZ2dpbmcgZnJvbSAnLi9sb2dnaW5nJztcbmV4cG9ydCBjbGFzcyBQZXJmb3JtYW5jZSB7XG4gICAgY29uc3RydWN0b3IoZXZlbnRzLCBtYXhTaGlmdFN0ZXBzLCBudW1WZWxvY2l0eUJpbnMsIHByb2dyYW0sIGlzRHJ1bSkge1xuICAgICAgICB0aGlzLmV2ZW50cyA9IGV2ZW50cztcbiAgICAgICAgdGhpcy5tYXhTaGlmdFN0ZXBzID0gbWF4U2hpZnRTdGVwcztcbiAgICAgICAgdGhpcy5udW1WZWxvY2l0eUJpbnMgPSBudW1WZWxvY2l0eUJpbnM7XG4gICAgICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW07XG4gICAgICAgIHRoaXMuaXNEcnVtID0gaXNEcnVtO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbU5vdGVTZXF1ZW5jZShub3RlU2VxdWVuY2UsIG1heFNoaWZ0U3RlcHMsIG51bVZlbG9jaXR5QmlucywgaW5zdHJ1bWVudCkge1xuICAgICAgICBzZXF1ZW5jZXMuYXNzZXJ0SXNRdWFudGl6ZWRTZXF1ZW5jZShub3RlU2VxdWVuY2UpO1xuICAgICAgICBjb25zdCBub3RlcyA9IG5vdGVTZXF1ZW5jZS5ub3Rlcy5maWx0ZXIoKG5vdGUsIF8pID0+IGluc3RydW1lbnQgIT09IHVuZGVmaW5lZCA/IG5vdGUuaW5zdHJ1bWVudCA9PT0gaW5zdHJ1bWVudCA6IHRydWUpO1xuICAgICAgICBjb25zdCBzb3J0ZWROb3RlcyA9IG5vdGVzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnRUaW1lID09PSBiLnN0YXJ0VGltZSA/IGEucGl0Y2ggLSBiLnBpdGNoIDpcbiAgICAgICAgICAgIGEuc3RhcnRUaW1lIC0gYi5zdGFydFRpbWUpO1xuICAgICAgICBjb25zdCBvbnNldHMgPSBzb3J0ZWROb3Rlcy5tYXAoKG5vdGUsIGkpID0+ICh7IHN0ZXA6IG5vdGUucXVhbnRpemVkU3RhcnRTdGVwLCBpbmRleDogaSwgaXNPZmZzZXQ6IDAgfSkpO1xuICAgICAgICBjb25zdCBvZmZzZXRzID0gc29ydGVkTm90ZXMubWFwKChub3RlLCBpKSA9PiAoeyBzdGVwOiBub3RlLnF1YW50aXplZEVuZFN0ZXAsIGluZGV4OiBpLCBpc09mZnNldDogMSB9KSk7XG4gICAgICAgIGNvbnN0IG5vdGVFdmVudHMgPSBvbnNldHMuY29uY2F0KG9mZnNldHMpLnNvcnQoKGEsIGIpID0+IGEuc3RlcCA9PT0gYi5zdGVwID9cbiAgICAgICAgICAgIChhLmluZGV4ID09PSBiLmluZGV4ID8gYS5pc09mZnNldCAtIGIuaXNPZmZzZXQgOlxuICAgICAgICAgICAgICAgIGEuaW5kZXggLSBiLmluZGV4KSA6XG4gICAgICAgICAgICBhLnN0ZXAgLSBiLnN0ZXApO1xuICAgICAgICBjb25zdCB2ZWxvY2l0eUJpblNpemUgPSBudW1WZWxvY2l0eUJpbnMgP1xuICAgICAgICAgICAgTWF0aC5jZWlsKChjb25zdGFudHMuTUlESV9WRUxPQ0lUSUVTIC0gMSkgLyBudW1WZWxvY2l0eUJpbnMpIDpcbiAgICAgICAgICAgIHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgZXZlbnRzID0gW107XG4gICAgICAgIGxldCBjdXJyZW50U3RlcCA9IDA7XG4gICAgICAgIGxldCBjdXJyZW50VmVsb2NpdHlCaW4gPSBudW1WZWxvY2l0eUJpbnM7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBub3RlRXZlbnRzKSB7XG4gICAgICAgICAgICBpZiAoZS5zdGVwID4gY3VycmVudFN0ZXApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZS5zdGVwID4gY3VycmVudFN0ZXAgKyBtYXhTaGlmdFN0ZXBzKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50cy5wdXNoKHsgdHlwZTogJ3RpbWUtc2hpZnQnLCBzdGVwczogbWF4U2hpZnRTdGVwcyB9KTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0ZXAgKz0gbWF4U2hpZnRTdGVwcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXZlbnRzLnB1c2goeyB0eXBlOiAndGltZS1zaGlmdCcsIHN0ZXBzOiBlLnN0ZXAgLSBjdXJyZW50U3RlcCB9KTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U3RlcCA9IGUuc3RlcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlLmlzT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgZXZlbnRzLnB1c2goeyB0eXBlOiAnbm90ZS1vZmYnLCBwaXRjaDogc29ydGVkTm90ZXNbZS5pbmRleF0ucGl0Y2ggfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodmVsb2NpdHlCaW5TaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlbG9jaXR5QmluID0gTWF0aC5mbG9vcigoc29ydGVkTm90ZXNbZS5pbmRleF0udmVsb2NpdHkgLVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RhbnRzLk1JTl9NSURJX1ZFTE9DSVRZIC0gMSkgL1xuICAgICAgICAgICAgICAgICAgICAgICAgdmVsb2NpdHlCaW5TaXplKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAxO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmVsb2NpdHlCaW4gIT09IGN1cnJlbnRWZWxvY2l0eUJpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzLnB1c2goeyB0eXBlOiAndmVsb2NpdHktY2hhbmdlJywgdmVsb2NpdHlCaW4gfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmVsb2NpdHlCaW4gPSB2ZWxvY2l0eUJpbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBldmVudHMucHVzaCh7IHR5cGU6ICdub3RlLW9uJywgcGl0Y2g6IHNvcnRlZE5vdGVzW2UuaW5kZXhdLnBpdGNoIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzRHJ1bSA9IG5vdGVzLnNvbWUobm90ZSA9PiBub3RlLmlzRHJ1bSkgP1xuICAgICAgICAgICAgKG5vdGVzLnNvbWUobm90ZSA9PiAhbm90ZS5pc0RydW0pID8gdW5kZWZpbmVkIDogdHJ1ZSkgOlxuICAgICAgICAgICAgZmFsc2U7XG4gICAgICAgIGNvbnN0IHByb2dyYW1zID0gQXJyYXkuZnJvbShuZXcgU2V0KG5vdGVzLm1hcChub3RlID0+IG5vdGUucHJvZ3JhbSkpKTtcbiAgICAgICAgY29uc3QgcHJvZ3JhbSA9ICghaXNEcnVtICYmIHByb2dyYW1zLmxlbmd0aCA9PT0gMSkgPyBwcm9ncmFtc1swXSA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgcGVyZm9ybWFuY2UgPSBuZXcgUGVyZm9ybWFuY2UoZXZlbnRzLCBtYXhTaGlmdFN0ZXBzLCBudW1WZWxvY2l0eUJpbnMsIHByb2dyYW0sIGlzRHJ1bSk7XG4gICAgICAgIHBlcmZvcm1hbmNlLnNldE51bVN0ZXBzKG5vdGVTZXF1ZW5jZS50b3RhbFF1YW50aXplZFN0ZXBzKTtcbiAgICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlO1xuICAgIH1cbiAgICBnZXROdW1TdGVwcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcigoZXZlbnQpID0+IGV2ZW50LnR5cGUgPT09ICd0aW1lLXNoaWZ0JylcbiAgICAgICAgICAgIC5tYXAoKGV2ZW50KSA9PiBldmVudC5zdGVwcylcbiAgICAgICAgICAgIC5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgICB9XG4gICAgc2V0TnVtU3RlcHMobnVtU3RlcHMpIHtcbiAgICAgICAgbGV0IGN1cnJlbnROdW1TdGVwcyA9IHRoaXMuZ2V0TnVtU3RlcHMoKTtcbiAgICAgICAgaWYgKGN1cnJlbnROdW1TdGVwcyA8IG51bVN0ZXBzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5ldmVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLmV2ZW50c1t0aGlzLmV2ZW50cy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RpbWUtc2hpZnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ZXBzID0gTWF0aC5taW4obnVtU3RlcHMgLSBjdXJyZW50TnVtU3RlcHMsIHRoaXMubWF4U2hpZnRTdGVwcyAtIGV2ZW50LnN0ZXBzKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RlcHMgKz0gc3RlcHM7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnROdW1TdGVwcyArPSBzdGVwcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aGlsZSAoY3VycmVudE51bVN0ZXBzIDwgbnVtU3RlcHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE51bVN0ZXBzICsgdGhpcy5tYXhTaGlmdFN0ZXBzID4gbnVtU3RlcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudHMucHVzaCh7IHR5cGU6ICd0aW1lLXNoaWZ0Jywgc3RlcHM6IG51bVN0ZXBzIC0gY3VycmVudE51bVN0ZXBzIH0pO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TnVtU3RlcHMgPSBudW1TdGVwcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRzLnB1c2goeyB0eXBlOiAndGltZS1zaGlmdCcsIHN0ZXBzOiB0aGlzLm1heFNoaWZ0U3RlcHMgfSk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnROdW1TdGVwcyArPSB0aGlzLm1heFNoaWZ0U3RlcHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnROdW1TdGVwcyA+IG51bVN0ZXBzKSB7XG4gICAgICAgICAgICB3aGlsZSAodGhpcy5ldmVudHMubGVuZ3RoICYmIGN1cnJlbnROdW1TdGVwcyA+IG51bVN0ZXBzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLmV2ZW50c1t0aGlzLmV2ZW50cy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RpbWUtc2hpZnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TnVtU3RlcHMgLSBldmVudC5zdGVwcyA8IG51bVN0ZXBzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdGVwcyAtPSBjdXJyZW50TnVtU3RlcHMgLSBudW1TdGVwcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROdW1TdGVwcyA9IG51bVN0ZXBzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TnVtU3RlcHMgLT0gZXZlbnQuc3RlcHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRzLnBvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICB0b05vdGVTZXF1ZW5jZShpbnN0cnVtZW50KSB7XG4gICAgICAgIGNvbnN0IHZlbG9jaXR5QmluU2l6ZSA9IHRoaXMubnVtVmVsb2NpdHlCaW5zID9cbiAgICAgICAgICAgIE1hdGguY2VpbCgoY29uc3RhbnRzLk1JRElfVkVMT0NJVElFUyAtIDEpIC8gdGhpcy5udW1WZWxvY2l0eUJpbnMpIDpcbiAgICAgICAgICAgIHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgbm90ZVNlcXVlbmNlID0gTm90ZVNlcXVlbmNlLmNyZWF0ZSgpO1xuICAgICAgICBsZXQgY3VycmVudFN0ZXAgPSAwO1xuICAgICAgICBsZXQgY3VycmVudFZlbG9jaXR5ID0gdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBwaXRjaFN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzID0gbmV3IE1hcCgpO1xuICAgICAgICBmb3IgKGxldCBpID0gY29uc3RhbnRzLk1JTl9NSURJX1BJVENIOyBpIDw9IGNvbnN0YW50cy5NQVhfTUlESV9QSVRDSDsgKytpKSB7XG4gICAgICAgICAgICBwaXRjaFN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzLnNldChpLCBbXSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBldmVudCBvZiB0aGlzLmV2ZW50cykge1xuICAgICAgICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbm90ZS1vbic6XG4gICAgICAgICAgICAgICAgICAgIHBpdGNoU3RhcnRTdGVwc0FuZFZlbG9jaXRpZXMuZ2V0KGV2ZW50LnBpdGNoKS5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGVwLCBjdXJyZW50VmVsb2NpdHlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ25vdGUtb2ZmJzpcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRTdGVwc0FuZFZlbG9jaXRpZXMgPSBwaXRjaFN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzLmdldChldmVudC5waXRjaCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydFN0ZXBzQW5kVmVsb2NpdGllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtzdGFydFN0ZXAsIHZlbG9jaXR5XSA9IHN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0ZXAgPiBzdGFydFN0ZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RlU2VxdWVuY2Uubm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXRjaDogZXZlbnQucGl0Y2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRTdGFydFN0ZXA6IHN0YXJ0U3RlcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkRW5kU3RlcDogY3VycmVudFN0ZXAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyYW06IHRoaXMucHJvZ3JhbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEcnVtOiB0aGlzLmlzRHJ1bSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmxvZygnSWdub3JpbmcgemVyby1sZW5ndGggbm90ZTogJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAocGl0Y2ggPSAke2V2ZW50LnBpdGNofSwgc3RlcCA9ICR7Y3VycmVudFN0ZXB9KWAsICdQZXJmb3JtYW5jZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5sb2coJ0lnbm9yaW5nIG5vdGUtb2ZmIHdpdGggbm8gcHJldmlvdXMgbm90ZS1vbjonICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKHBpdGNoID0gJHtldmVudC5waXRjaH0sIHN0ZXAgPSAke2N1cnJlbnRTdGVwfSlgLCAnUGVyZm9ybWFuY2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd0aW1lLXNoaWZ0JzpcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0ZXAgKz0gZXZlbnQuc3RlcHM7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3ZlbG9jaXR5LWNoYW5nZSc6XG4gICAgICAgICAgICAgICAgICAgIGlmICh2ZWxvY2l0eUJpblNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWZWxvY2l0eSA9IGNvbnN0YW50cy5NSU5fTUlESV9WRUxPQ0lUWSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGV2ZW50LnZlbG9jaXR5QmluIC0gMSkgKiB2ZWxvY2l0eUJpblNpemUgKyAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIHZlbG9jaXR5IGNoYW5nZSBldmVudDogJHtldmVudH1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCBwZXJmb3JtYW5jZSBldmVudDogJHtldmVudH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwaXRjaFN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzLmZvckVhY2goKHN0YXJ0U3RlcHNBbmRWZWxvY2l0aWVzLCBwaXRjaCkgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbc3RhcnRTdGVwLCB2ZWxvY2l0eV0gb2Ygc3RhcnRTdGVwc0FuZFZlbG9jaXRpZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0ZXAgPiBzdGFydFN0ZXApIHtcbiAgICAgICAgICAgICAgICAgICAgbm90ZVNlcXVlbmNlLm5vdGVzLnB1c2goTm90ZVNlcXVlbmNlLk5vdGUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpdGNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmVsb2NpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpemVkU3RhcnRTdGVwOiBzdGFydFN0ZXAsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl6ZWRFbmRTdGVwOiBjdXJyZW50U3RlcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyYW06IHRoaXMucHJvZ3JhbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRHJ1bTogdGhpcy5pc0RydW1cbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5sb2coJ0lnbm9yaW5nIHplcm8tbGVuZ3RoIG5vdGU6ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgYChwaXRjaCA9ICR7cGl0Y2h9LCBzdGVwID0gJHtjdXJyZW50U3RlcH0pYCwgJ1BlcmZvcm1hbmNlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbm90ZVNlcXVlbmNlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSBjdXJyZW50U3RlcDtcbiAgICAgICAgcmV0dXJuIG5vdGVTZXF1ZW5jZTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wZXJmb3JtYW5jZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/performance.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/player.js":
/*!**********************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/player.js ***!
  \**********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BasePlayer: () => (/* binding */ BasePlayer),\n/* harmony export */   BasePlayerCallback: () => (/* binding */ BasePlayerCallback),\n/* harmony export */   MIDIPlayer: () => (/* binding */ MIDIPlayer),\n/* harmony export */   Player: () => (/* binding */ Player),\n/* harmony export */   PlayerWithClick: () => (/* binding */ PlayerWithClick),\n/* harmony export */   SoundFontPlayer: () => (/* binding */ SoundFontPlayer)\n/* harmony export */ });\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tone */ \"(ssr)/./node_modules/.pnpm/tone@14.7.77/node_modules/tone/build/Tone.js\");\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _core_compat_global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/compat/global */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\");\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _soundfont__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./soundfont */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/soundfont.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n\n\n\n\n\n\nfunction compareQuantizedNotes(a, b) {\n    if (a.quantizedStartStep < b.quantizedStartStep) {\n        return -1;\n    }\n    if (a.quantizedStartStep > b.quantizedStartStep) {\n        return 1;\n    }\n    if (a.pitch < b.pitch) {\n        return -1;\n    }\n    return 1;\n}\nclass BasePlayerCallback {\n}\nclass BasePlayer {\n    constructor(playClick = false, callbackObject) {\n        this.playClick = playClick;\n        this.callbackObject = callbackObject;\n        this.desiredQPM = undefined;\n    }\n    setTempo(qpm) {\n        this.desiredQPM = qpm;\n        if (tone__WEBPACK_IMPORTED_MODULE_0__.Transport.state === 'started') {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = qpm;\n        }\n    }\n    makeClickSequence(seq) {\n        const clickSeq = _sequences__WEBPACK_IMPORTED_MODULE_5__.clone(seq);\n        const sixteenthEnds = clickSeq.notes.map((n) => n.quantizedEndStep);\n        const lastSixteenth = Math.max(...sixteenthEnds);\n        for (let i = 0; i < lastSixteenth; i += 4) {\n            const click = {\n                pitch: i % 16 === 0 ? _constants__WEBPACK_IMPORTED_MODULE_3__.LO_CLICK_PITCH :\n                    _constants__WEBPACK_IMPORTED_MODULE_3__.HI_CLICK_PITCH,\n                quantizedStartStep: i,\n                isDrum: true,\n                quantizedEndStep: i + 1,\n            };\n            clickSeq.notes.push(click);\n        }\n        clickSeq.notes.sort(compareQuantizedNotes);\n        return clickSeq;\n    }\n    resumeContext() {\n        tone__WEBPACK_IMPORTED_MODULE_0__.context.resume();\n    }\n    start(seq, qpm, offset = 0) {\n        if (this.getPlayState() === 'started') {\n            throw new Error('Cannot start playback; player is already playing.');\n        }\n        else if (this.getPlayState() === 'paused') {\n            throw new Error('Cannot `start()` a paused player; use `resume()`.');\n        }\n        if (tone__WEBPACK_IMPORTED_MODULE_0__.Transport.state !== 'stopped') {\n            throw new Error('Cannot start playback while `Tone.Transport` is in use.');\n        }\n        this.resumeContext();\n        const isQuantized = _sequences__WEBPACK_IMPORTED_MODULE_5__.isQuantizedSequence(seq);\n        if (this.playClick && isQuantized) {\n            seq = this.makeClickSequence(seq);\n        }\n        if (qpm) {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = qpm;\n        }\n        else if (seq.tempos && seq.tempos.length > 0 && seq.tempos[0].qpm > 0) {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = seq.tempos[0].qpm;\n        }\n        else {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_QUARTERS_PER_MINUTE;\n        }\n        if (isQuantized) {\n            seq = _sequences__WEBPACK_IMPORTED_MODULE_5__.unquantizeSequence(seq, qpm);\n        }\n        else if (qpm) {\n            throw new Error('Cannot specify a `qpm` for a non-quantized sequence.');\n        }\n        const thisPart = new tone__WEBPACK_IMPORTED_MODULE_0__.Part((t, n) => {\n            if (this.currentPart !== thisPart) {\n                return;\n            }\n            this.playNote(t, n);\n            if (this.callbackObject) {\n                tone__WEBPACK_IMPORTED_MODULE_0__.Draw.schedule(() => {\n                    this.callbackObject.run(n, t);\n                }, t);\n            }\n        }, seq.notes.map((n) => [n.startTime, n]));\n        this.currentPart = thisPart;\n        if (this.desiredQPM) {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = this.desiredQPM;\n        }\n        this.currentPart.start(undefined, offset);\n        if (tone__WEBPACK_IMPORTED_MODULE_0__.Transport.state !== 'started') {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.start();\n        }\n        return new Promise((resolve) => {\n            this.scheduledStop = tone__WEBPACK_IMPORTED_MODULE_0__.Transport.schedule(() => {\n                this.stop();\n                resolve();\n                if (this.callbackObject) {\n                    this.callbackObject.stop();\n                }\n            }, `+${seq.totalTime}`);\n        });\n    }\n    stop() {\n        if (this.isPlaying()) {\n            this.currentPart.stop();\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.stop();\n            this.currentPart = null;\n        }\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.clear(this.scheduledStop);\n        this.scheduledStop = undefined;\n        this.desiredQPM = undefined;\n    }\n    pause() {\n        if (!this.isPlaying()) {\n            throw new Error('Cannot pause playback while the player is stopped.');\n        }\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.pause();\n    }\n    resume() {\n        if (this.getPlayState() !== 'paused') {\n            throw new Error(`Cannot resume playback while \"${this.getPlayState()}\".`);\n        }\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.start();\n    }\n    seekTo(seconds) {\n        if (!this.isPlaying()) {\n            throw new Error('Cannot seek while the player is stopped.');\n        }\n        tone__WEBPACK_IMPORTED_MODULE_0__.Transport.seconds = seconds;\n    }\n    isPlaying() {\n        return !!this.currentPart;\n    }\n    getPlayState() {\n        return this.isPlaying() ? tone__WEBPACK_IMPORTED_MODULE_0__.Transport.state : 'stopped';\n    }\n}\nclass DrumKit {\n    constructor() {\n        this.DRUM_PITCH_TO_CLASS = new Map();\n        this.kick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth().toDestination();\n        this.tomLow = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.01, decay: 0.5, sustain: 0 },\n        })\n            .toDestination();\n        this.tomMid = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.01, decay: 0.5, sustain: 0 },\n        })\n            .toDestination();\n        this.tomHigh = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.01, decay: 0.5, sustain: 0 },\n        })\n            .toDestination();\n        this.closedHihat = new tone__WEBPACK_IMPORTED_MODULE_0__.MetalSynth({\n            frequency: 400,\n            envelope: { attack: 0.001, decay: 0.1, release: 0.8 },\n            harmonicity: 5.1,\n            modulationIndex: 32,\n            resonance: 4000,\n            octaves: 1,\n        })\n            .toDestination();\n        this.openHihat = new tone__WEBPACK_IMPORTED_MODULE_0__.MetalSynth({\n            frequency: 400,\n            envelope: { attack: 0.001, decay: 0.5, release: 0.8, sustain: 1 },\n            harmonicity: 5.1,\n            modulationIndex: 32,\n            resonance: 4000,\n            octaves: 1,\n        })\n            .toDestination();\n        this.ride = new tone__WEBPACK_IMPORTED_MODULE_0__.MetalSynth().toDestination();\n        this.crash = new tone__WEBPACK_IMPORTED_MODULE_0__.MetalSynth({\n            frequency: 300,\n            envelope: { attack: 0.001, decay: 1, release: 3 },\n            harmonicity: 5.1,\n            modulationIndex: 64,\n            resonance: 4000,\n            octaves: 1.5,\n        })\n            .toDestination();\n        this.snare = new tone__WEBPACK_IMPORTED_MODULE_0__.NoiseSynth({\n            noise: { type: 'white' },\n            envelope: { attack: 0.005, decay: 0.05, sustain: 0.1, release: 0.4 },\n        })\n            .toDestination();\n        this.loClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.hiClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.pitchPlayers = [\n            (time, velocity = 1) => this.kick.triggerAttackRelease('C2', '8n', time, velocity),\n            (time, velocity = 1) => this.snare.triggerAttackRelease('16n', time, velocity),\n            (time, velocity = 1) => this.closedHihat.triggerAttack(time, 0.3, velocity),\n            (time, velocity = 1) => this.openHihat.triggerAttack(time, 0.3, velocity),\n            (time, velocity = 0.5) => this.tomLow.triggerAttack('G3', time, velocity),\n            (time, velocity = 0.5) => this.tomMid.triggerAttack('C4', time, velocity),\n            (time, velocity = 0.5) => this.tomHigh.triggerAttack('F4', time, velocity),\n            (time, velocity = 1) => this.crash.triggerAttack(time, 1.0, velocity),\n            (time, velocity = 1) => this.ride.triggerAttack(time, 0.5, velocity),\n            (time, velocity = 0.5) => this.loClick.triggerAttack('G5', time, velocity),\n            (time, velocity = 0.5) => this.hiClick.triggerAttack('C6', time, velocity),\n        ];\n        for (let c = 0; c < _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_DRUM_PITCH_CLASSES.length; ++c) {\n            _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_DRUM_PITCH_CLASSES[c].forEach((p) => {\n                this.DRUM_PITCH_TO_CLASS.set(p, c);\n            });\n        }\n        this.DRUM_PITCH_TO_CLASS.set(_constants__WEBPACK_IMPORTED_MODULE_3__.LO_CLICK_PITCH, _constants__WEBPACK_IMPORTED_MODULE_3__.LO_CLICK_CLASS);\n        this.DRUM_PITCH_TO_CLASS.set(_constants__WEBPACK_IMPORTED_MODULE_3__.HI_CLICK_PITCH, _constants__WEBPACK_IMPORTED_MODULE_3__.HI_CLICK_CLASS);\n    }\n    static getInstance() {\n        if (!DrumKit.instance) {\n            DrumKit.instance = new DrumKit();\n        }\n        return DrumKit.instance;\n    }\n    playNote(pitch, time, velocity) {\n        this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(pitch)](time, velocity);\n    }\n}\nclass Player extends BasePlayer {\n    constructor() {\n        super(...arguments);\n        this.drumKit = DrumKit.getInstance();\n        this.bassSynth = new tone__WEBPACK_IMPORTED_MODULE_0__.Synth({\n            volume: 5,\n            oscillator: { type: 'triangle' },\n        })\n            .toDestination();\n        this.polySynth = new tone__WEBPACK_IMPORTED_MODULE_0__.PolySynth().toDestination();\n    }\n    playNote(time, note) {\n        const velocity = note.hasOwnProperty('velocity') ?\n            note.velocity / _constants__WEBPACK_IMPORTED_MODULE_3__.MAX_MIDI_VELOCITY :\n            undefined;\n        if (note.isDrum) {\n            this.drumKit.playNote(note.pitch, time, velocity);\n        }\n        else {\n            const freq = tone__WEBPACK_IMPORTED_MODULE_0__.Frequency(note.pitch, 'midi').toFrequency();\n            const dur = note.endTime - note.startTime;\n            this.getSynth(note.instrument, note.program)\n                .triggerAttackRelease(freq, dur, time, velocity);\n        }\n    }\n    getSynth(instrument, program) {\n        if (program !== undefined && program >= 32 && program <= 39) {\n            return this.bassSynth;\n        }\n        else {\n            return this.polySynth;\n        }\n    }\n}\nPlayer.tone = tone__WEBPACK_IMPORTED_MODULE_0__;\nclass SoundFontPlayer extends BasePlayer {\n    constructor(soundFontURL, output = tone__WEBPACK_IMPORTED_MODULE_0__.Master, programOutputs, drumOutputs, callbackObject) {\n        super(false, callbackObject);\n        this.soundFont = new _soundfont__WEBPACK_IMPORTED_MODULE_4__.SoundFont(soundFontURL);\n        this.output = output;\n        this.programOutputs = programOutputs;\n        this.drumOutputs = drumOutputs;\n    }\n    async loadSamples(seq) {\n        await this.soundFont.loadSamples(seq.notes.map((note) => ({\n            pitch: note.pitch,\n            velocity: note.velocity,\n            program: note.program || 0,\n            isDrum: note.isDrum || false,\n        })));\n    }\n    async loadAllSamples(program = 0, isDrum = false) {\n        const ns = _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.create();\n        const min = isDrum ? _constants__WEBPACK_IMPORTED_MODULE_3__.MIN_DRUM_PITCH : _constants__WEBPACK_IMPORTED_MODULE_3__.MIN_PIANO_PITCH;\n        const max = isDrum ? _constants__WEBPACK_IMPORTED_MODULE_3__.MAX_DRUM_PITCH : _constants__WEBPACK_IMPORTED_MODULE_3__.MAX_PIANO_PITCH;\n        for (let i = min; i <= max; i++) {\n            for (let j = _constants__WEBPACK_IMPORTED_MODULE_3__.MIN_MIDI_VELOCITY; j < _constants__WEBPACK_IMPORTED_MODULE_3__.MAX_MIDI_VELOCITY; j++) {\n                ns.notes.push({ pitch: i, velocity: j, program, isDrum });\n            }\n        }\n        return this.loadSamples(ns);\n    }\n    resumeContext() {\n        tone__WEBPACK_IMPORTED_MODULE_0__.context.resume();\n    }\n    start(seq, qpm, offset = 0) {\n        this.resumeContext();\n        return this.loadSamples(seq).then(() => super.start(seq, qpm, offset));\n    }\n    playNote(time, note) {\n        this.soundFont.playNote(note.pitch, note.velocity, time, note.endTime - note.startTime, note.program, note.isDrum, this.getAudioNodeOutput(note));\n    }\n    playNoteDown(note) {\n        this.soundFont.playNoteDown(note.pitch, note.velocity, note.program, note.isDrum, this.getAudioNodeOutput(note));\n    }\n    playNoteUp(note) {\n        this.soundFont.playNoteUp(note.pitch, note.velocity, note.program, note.isDrum, this.getAudioNodeOutput(note));\n    }\n    getAudioNodeOutput(note) {\n        let output = this.output;\n        if (this.programOutputs && !note.isDrum) {\n            if (this.programOutputs.has(note.program)) {\n                output = this.programOutputs.get(note.program);\n            }\n        }\n        else if (this.drumOutputs && note.isDrum) {\n            if (this.drumOutputs.has(note.pitch)) {\n                output = this.drumOutputs.get(note.pitch);\n            }\n        }\n        return output;\n    }\n}\nclass PlayerWithClick extends Player {\n    constructor(callbackObject) {\n        super(true, callbackObject);\n    }\n}\nclass MIDIPlayer extends BasePlayer {\n    constructor(callbackObject) {\n        super(false, callbackObject);\n        this.outputs = [];\n        this.outputChannel = 0;\n        this.availableOutputs = [];\n        this.NOTE_ON = 0x90;\n        this.NOTE_OFF = 0x80;\n    }\n    async requestMIDIAccess() {\n        if (navigator.requestMIDIAccess) {\n            return new Promise((resolve, reject) => {\n                navigator.requestMIDIAccess().then((midi) => {\n                    midi.addEventListener('statechange', (event) => this.initOutputs(midi));\n                    resolve(this.initOutputs(midi));\n                }, (err) => console.log('Something went wrong', reject(err)));\n            });\n        }\n        else {\n            return null;\n        }\n    }\n    initOutputs(midi) {\n        const outputs = midi.outputs.values();\n        for (let output = outputs.next(); output && !output.done; output = outputs.next()) {\n            this.availableOutputs.push(output.value);\n        }\n        return this.availableOutputs;\n    }\n    playNote(time, note) {\n        const velocity = note.velocity || 100;\n        const length = (note.endTime - note.startTime) * 1000;\n        const msgOn = [this.NOTE_ON + this.outputChannel, note.pitch, velocity];\n        const msgOff = [this.NOTE_OFF + this.outputChannel, note.pitch, velocity];\n        const outputs = this.outputs ? this.outputs : this.availableOutputs;\n        for (let i = 0; i < outputs.length; i++) {\n            this.sendMessageToOutput(outputs[i], msgOn);\n            this.sendMessageToOutput(outputs[i], msgOff, _core_compat_global__WEBPACK_IMPORTED_MODULE_1__.performance.now() + length);\n        }\n    }\n    sendMessageToOutput(output, message, time) {\n        if (output) {\n            output.send(message, time);\n        }\n    }\n    playNoteDown(note) {\n        const msgOn = [this.NOTE_ON, note.pitch, note.velocity];\n        const outputs = this.outputs ? this.outputs : this.availableOutputs;\n        for (let i = 0; i < outputs.length; i++) {\n            this.sendMessageToOutput(outputs[i], msgOn);\n        }\n    }\n    playNoteUp(note) {\n        const msgOff = [this.NOTE_OFF, note.pitch, note.velocity];\n        const outputs = this.outputs ? this.outputs : this.availableOutputs;\n        for (let i = 0; i < outputs.length; i++) {\n            this.sendMessageToOutput(outputs[i], msgOff, note.endTime - note.startTime);\n        }\n    }\n}\n//# sourceMappingURL=player.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9wbGF5ZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUE2QjtBQUN1QjtBQUNIO0FBQ1I7QUFDQTtBQUNBO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyQ0FBYztBQUMxQixZQUFZLDJDQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qiw2Q0FBZTtBQUN4QztBQUNBO0FBQ0Esd0JBQXdCLG1CQUFtQjtBQUMzQztBQUNBLHNDQUFzQyxzREFBd0I7QUFDOUQsb0JBQW9CLHNEQUF3QjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEseUNBQVk7QUFDcEI7QUFDQTtBQUNBO0FBQ0Esb0RBQW9EO0FBQ3BEO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQSxZQUFZLDJDQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwyREFBNkI7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDJDQUFjO0FBQzFCO0FBQ0E7QUFDQSxZQUFZLDJDQUFjO0FBQzFCO0FBQ0E7QUFDQSxZQUFZLDJDQUFjLGFBQWEsbUVBQXFDO0FBQzVFO0FBQ0E7QUFDQSxrQkFBa0IsMERBQTRCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHNDQUFTO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isc0NBQVM7QUFDekI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxTQUFT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QUFDakYsMEJBQTBCLFVBQVU7QUFDcEMseUJBQXlCLHlEQUEyQixFQUFFLElBQUkseURBQTJCLEVBQUU7QUFDdkYsZ0NBQWdDLHdDQUF3QztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSx5Q0FBWTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsd0JBQXdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9CQUFvQjtBQUM1QztBQUNBLHlEQUF5RCw0REFBVztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvQkFBb0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9CQUFvQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL2NvcmUvcGxheWVyLmpzP2JmYjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgVG9uZSBmcm9tICd0b25lJztcbmltcG9ydCB7IHBlcmZvcm1hbmNlIH0gZnJvbSAnLi4vY29yZS9jb21wYXQvZ2xvYmFsJztcbmltcG9ydCB7IE5vdGVTZXF1ZW5jZSB9IGZyb20gJy4uL3Byb3RvYnVmL2luZGV4JztcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgKiBhcyBzb3VuZGZvbnQgZnJvbSAnLi9zb3VuZGZvbnQnO1xuaW1wb3J0ICogYXMgc2VxdWVuY2VzIGZyb20gJy4vc2VxdWVuY2VzJztcbmZ1bmN0aW9uIGNvbXBhcmVRdWFudGl6ZWROb3RlcyhhLCBiKSB7XG4gICAgaWYgKGEucXVhbnRpemVkU3RhcnRTdGVwIDwgYi5xdWFudGl6ZWRTdGFydFN0ZXApIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoYS5xdWFudGl6ZWRTdGFydFN0ZXAgPiBiLnF1YW50aXplZFN0YXJ0U3RlcCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgaWYgKGEucGl0Y2ggPCBiLnBpdGNoKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgcmV0dXJuIDE7XG59XG5leHBvcnQgY2xhc3MgQmFzZVBsYXllckNhbGxiYWNrIHtcbn1cbmV4cG9ydCBjbGFzcyBCYXNlUGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcihwbGF5Q2xpY2sgPSBmYWxzZSwgY2FsbGJhY2tPYmplY3QpIHtcbiAgICAgICAgdGhpcy5wbGF5Q2xpY2sgPSBwbGF5Q2xpY2s7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QgPSBjYWxsYmFja09iamVjdDtcbiAgICAgICAgdGhpcy5kZXNpcmVkUVBNID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBzZXRUZW1wbyhxcG0pIHtcbiAgICAgICAgdGhpcy5kZXNpcmVkUVBNID0gcXBtO1xuICAgICAgICBpZiAoVG9uZS5UcmFuc3BvcnQuc3RhdGUgPT09ICdzdGFydGVkJykge1xuICAgICAgICAgICAgVG9uZS5UcmFuc3BvcnQuYnBtLnZhbHVlID0gcXBtO1xuICAgICAgICB9XG4gICAgfVxuICAgIG1ha2VDbGlja1NlcXVlbmNlKHNlcSkge1xuICAgICAgICBjb25zdCBjbGlja1NlcSA9IHNlcXVlbmNlcy5jbG9uZShzZXEpO1xuICAgICAgICBjb25zdCBzaXh0ZWVudGhFbmRzID0gY2xpY2tTZXEubm90ZXMubWFwKChuKSA9PiBuLnF1YW50aXplZEVuZFN0ZXApO1xuICAgICAgICBjb25zdCBsYXN0U2l4dGVlbnRoID0gTWF0aC5tYXgoLi4uc2l4dGVlbnRoRW5kcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGFzdFNpeHRlZW50aDsgaSArPSA0KSB7XG4gICAgICAgICAgICBjb25zdCBjbGljayA9IHtcbiAgICAgICAgICAgICAgICBwaXRjaDogaSAlIDE2ID09PSAwID8gY29uc3RhbnRzLkxPX0NMSUNLX1BJVENIIDpcbiAgICAgICAgICAgICAgICAgICAgY29uc3RhbnRzLkhJX0NMSUNLX1BJVENILFxuICAgICAgICAgICAgICAgIHF1YW50aXplZFN0YXJ0U3RlcDogaSxcbiAgICAgICAgICAgICAgICBpc0RydW06IHRydWUsXG4gICAgICAgICAgICAgICAgcXVhbnRpemVkRW5kU3RlcDogaSArIDEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2xpY2tTZXEubm90ZXMucHVzaChjbGljayk7XG4gICAgICAgIH1cbiAgICAgICAgY2xpY2tTZXEubm90ZXMuc29ydChjb21wYXJlUXVhbnRpemVkTm90ZXMpO1xuICAgICAgICByZXR1cm4gY2xpY2tTZXE7XG4gICAgfVxuICAgIHJlc3VtZUNvbnRleHQoKSB7XG4gICAgICAgIFRvbmUuY29udGV4dC5yZXN1bWUoKTtcbiAgICB9XG4gICAgc3RhcnQoc2VxLCBxcG0sIG9mZnNldCA9IDApIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0UGxheVN0YXRlKCkgPT09ICdzdGFydGVkJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc3RhcnQgcGxheWJhY2s7IHBsYXllciBpcyBhbHJlYWR5IHBsYXlpbmcuJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5nZXRQbGF5U3RhdGUoKSA9PT0gJ3BhdXNlZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGBzdGFydCgpYCBhIHBhdXNlZCBwbGF5ZXI7IHVzZSBgcmVzdW1lKClgLicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUb25lLlRyYW5zcG9ydC5zdGF0ZSAhPT0gJ3N0b3BwZWQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzdGFydCBwbGF5YmFjayB3aGlsZSBgVG9uZS5UcmFuc3BvcnRgIGlzIGluIHVzZS4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc3VtZUNvbnRleHQoKTtcbiAgICAgICAgY29uc3QgaXNRdWFudGl6ZWQgPSBzZXF1ZW5jZXMuaXNRdWFudGl6ZWRTZXF1ZW5jZShzZXEpO1xuICAgICAgICBpZiAodGhpcy5wbGF5Q2xpY2sgJiYgaXNRdWFudGl6ZWQpIHtcbiAgICAgICAgICAgIHNlcSA9IHRoaXMubWFrZUNsaWNrU2VxdWVuY2Uoc2VxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXBtKSB7XG4gICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5icG0udmFsdWUgPSBxcG07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2VxLnRlbXBvcyAmJiBzZXEudGVtcG9zLmxlbmd0aCA+IDAgJiYgc2VxLnRlbXBvc1swXS5xcG0gPiAwKSB7XG4gICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5icG0udmFsdWUgPSBzZXEudGVtcG9zWzBdLnFwbTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFRvbmUuVHJhbnNwb3J0LmJwbS52YWx1ZSA9IGNvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUXVhbnRpemVkKSB7XG4gICAgICAgICAgICBzZXEgPSBzZXF1ZW5jZXMudW5xdWFudGl6ZVNlcXVlbmNlKHNlcSwgcXBtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChxcG0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNwZWNpZnkgYSBgcXBtYCBmb3IgYSBub24tcXVhbnRpemVkIHNlcXVlbmNlLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRoaXNQYXJ0ID0gbmV3IFRvbmUuUGFydCgodCwgbikgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFBhcnQgIT09IHRoaXNQYXJ0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wbGF5Tm90ZSh0LCBuKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgVG9uZS5EcmF3LnNjaGVkdWxlKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja09iamVjdC5ydW4obiwgdCk7XG4gICAgICAgICAgICAgICAgfSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHNlcS5ub3Rlcy5tYXAoKG4pID0+IFtuLnN0YXJ0VGltZSwgbl0pKTtcbiAgICAgICAgdGhpcy5jdXJyZW50UGFydCA9IHRoaXNQYXJ0O1xuICAgICAgICBpZiAodGhpcy5kZXNpcmVkUVBNKSB7XG4gICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5icG0udmFsdWUgPSB0aGlzLmRlc2lyZWRRUE07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50UGFydC5zdGFydCh1bmRlZmluZWQsIG9mZnNldCk7XG4gICAgICAgIGlmIChUb25lLlRyYW5zcG9ydC5zdGF0ZSAhPT0gJ3N0YXJ0ZWQnKSB7XG4gICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5zdGFydCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWRTdG9wID0gVG9uZS5UcmFuc3BvcnQuc2NoZWR1bGUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFja09iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrT2JqZWN0LnN0b3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBgKyR7c2VxLnRvdGFsVGltZX1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUGxheWluZygpKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYXJ0LnN0b3AoKTtcbiAgICAgICAgICAgIFRvbmUuVHJhbnNwb3J0LnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhcnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIFRvbmUuVHJhbnNwb3J0LmNsZWFyKHRoaXMuc2NoZWR1bGVkU3RvcCk7XG4gICAgICAgIHRoaXMuc2NoZWR1bGVkU3RvcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kZXNpcmVkUVBNID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBwYXVzZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUGxheWluZygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBwYXVzZSBwbGF5YmFjayB3aGlsZSB0aGUgcGxheWVyIGlzIHN0b3BwZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgVG9uZS5UcmFuc3BvcnQucGF1c2UoKTtcbiAgICB9XG4gICAgcmVzdW1lKCkge1xuICAgICAgICBpZiAodGhpcy5nZXRQbGF5U3RhdGUoKSAhPT0gJ3BhdXNlZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHJlc3VtZSBwbGF5YmFjayB3aGlsZSBcIiR7dGhpcy5nZXRQbGF5U3RhdGUoKX1cIi5gKTtcbiAgICAgICAgfVxuICAgICAgICBUb25lLlRyYW5zcG9ydC5zdGFydCgpO1xuICAgIH1cbiAgICBzZWVrVG8oc2Vjb25kcykge1xuICAgICAgICBpZiAoIXRoaXMuaXNQbGF5aW5nKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNlZWsgd2hpbGUgdGhlIHBsYXllciBpcyBzdG9wcGVkLicpO1xuICAgICAgICB9XG4gICAgICAgIFRvbmUuVHJhbnNwb3J0LnNlY29uZHMgPSBzZWNvbmRzO1xuICAgIH1cbiAgICBpc1BsYXlpbmcoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuY3VycmVudFBhcnQ7XG4gICAgfVxuICAgIGdldFBsYXlTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNQbGF5aW5nKCkgPyBUb25lLlRyYW5zcG9ydC5zdGF0ZSA6ICdzdG9wcGVkJztcbiAgICB9XG59XG5jbGFzcyBEcnVtS2l0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5EUlVNX1BJVENIX1RPX0NMQVNTID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmtpY2sgPSBuZXcgVG9uZS5NZW1icmFuZVN5bnRoKCkudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLnRvbUxvdyA9IG5ldyBUb25lXG4gICAgICAgICAgICAuTWVtYnJhbmVTeW50aCh7XG4gICAgICAgICAgICBwaXRjaERlY2F5OiAwLjAwOCxcbiAgICAgICAgICAgIGVudmVsb3BlOiB7IGF0dGFjazogMC4wMSwgZGVjYXk6IDAuNSwgc3VzdGFpbjogMCB9LFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy50b21NaWQgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1lbWJyYW5lU3ludGgoe1xuICAgICAgICAgICAgcGl0Y2hEZWNheTogMC4wMDgsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDEsIGRlY2F5OiAwLjUsIHN1c3RhaW46IDAgfSxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50b0Rlc3RpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMudG9tSGlnaCA9IG5ldyBUb25lXG4gICAgICAgICAgICAuTWVtYnJhbmVTeW50aCh7XG4gICAgICAgICAgICBwaXRjaERlY2F5OiAwLjAwOCxcbiAgICAgICAgICAgIGVudmVsb3BlOiB7IGF0dGFjazogMC4wMSwgZGVjYXk6IDAuNSwgc3VzdGFpbjogMCB9LFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy5jbG9zZWRIaWhhdCA9IG5ldyBUb25lXG4gICAgICAgICAgICAuTWV0YWxTeW50aCh7XG4gICAgICAgICAgICBmcmVxdWVuY3k6IDQwMCxcbiAgICAgICAgICAgIGVudmVsb3BlOiB7IGF0dGFjazogMC4wMDEsIGRlY2F5OiAwLjEsIHJlbGVhc2U6IDAuOCB9LFxuICAgICAgICAgICAgaGFybW9uaWNpdHk6IDUuMSxcbiAgICAgICAgICAgIG1vZHVsYXRpb25JbmRleDogMzIsXG4gICAgICAgICAgICByZXNvbmFuY2U6IDQwMDAsXG4gICAgICAgICAgICBvY3RhdmVzOiAxLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy5vcGVuSGloYXQgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1ldGFsU3ludGgoe1xuICAgICAgICAgICAgZnJlcXVlbmN5OiA0MDAsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMC41LCByZWxlYXNlOiAwLjgsIHN1c3RhaW46IDEgfSxcbiAgICAgICAgICAgIGhhcm1vbmljaXR5OiA1LjEsXG4gICAgICAgICAgICBtb2R1bGF0aW9uSW5kZXg6IDMyLFxuICAgICAgICAgICAgcmVzb25hbmNlOiA0MDAwLFxuICAgICAgICAgICAgb2N0YXZlczogMSxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50b0Rlc3RpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMucmlkZSA9IG5ldyBUb25lLk1ldGFsU3ludGgoKS50b0Rlc3RpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMuY3Jhc2ggPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1ldGFsU3ludGgoe1xuICAgICAgICAgICAgZnJlcXVlbmN5OiAzMDAsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMSwgcmVsZWFzZTogMyB9LFxuICAgICAgICAgICAgaGFybW9uaWNpdHk6IDUuMSxcbiAgICAgICAgICAgIG1vZHVsYXRpb25JbmRleDogNjQsXG4gICAgICAgICAgICByZXNvbmFuY2U6IDQwMDAsXG4gICAgICAgICAgICBvY3RhdmVzOiAxLjUsXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLnNuYXJlID0gbmV3IFRvbmVcbiAgICAgICAgICAgIC5Ob2lzZVN5bnRoKHtcbiAgICAgICAgICAgIG5vaXNlOiB7IHR5cGU6ICd3aGl0ZScgfSxcbiAgICAgICAgICAgIGVudmVsb3BlOiB7IGF0dGFjazogMC4wMDUsIGRlY2F5OiAwLjA1LCBzdXN0YWluOiAwLjEsIHJlbGVhc2U6IDAuNCB9LFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy5sb0NsaWNrID0gbmV3IFRvbmVcbiAgICAgICAgICAgIC5NZW1icmFuZVN5bnRoKHtcbiAgICAgICAgICAgIHBpdGNoRGVjYXk6IDAuMDA4LFxuICAgICAgICAgICAgZW52ZWxvcGU6IHsgYXR0YWNrOiAwLjAwMSwgZGVjYXk6IDAuMywgc3VzdGFpbjogMCB9LFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy5oaUNsaWNrID0gbmV3IFRvbmVcbiAgICAgICAgICAgIC5NZW1icmFuZVN5bnRoKHtcbiAgICAgICAgICAgIHBpdGNoRGVjYXk6IDAuMDA4LFxuICAgICAgICAgICAgZW52ZWxvcGU6IHsgYXR0YWNrOiAwLjAwMSwgZGVjYXk6IDAuMywgc3VzdGFpbjogMCB9LFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvRGVzdGluYXRpb24oKTtcbiAgICAgICAgdGhpcy5waXRjaFBsYXllcnMgPSBbXG4gICAgICAgICAgICAodGltZSwgdmVsb2NpdHkgPSAxKSA9PiB0aGlzLmtpY2sudHJpZ2dlckF0dGFja1JlbGVhc2UoJ0MyJywgJzhuJywgdGltZSwgdmVsb2NpdHkpLFxuICAgICAgICAgICAgKHRpbWUsIHZlbG9jaXR5ID0gMSkgPT4gdGhpcy5zbmFyZS50cmlnZ2VyQXR0YWNrUmVsZWFzZSgnMTZuJywgdGltZSwgdmVsb2NpdHkpLFxuICAgICAgICAgICAgKHRpbWUsIHZlbG9jaXR5ID0gMSkgPT4gdGhpcy5jbG9zZWRIaWhhdC50cmlnZ2VyQXR0YWNrKHRpbWUsIDAuMywgdmVsb2NpdHkpLFxuICAgICAgICAgICAgKHRpbWUsIHZlbG9jaXR5ID0gMSkgPT4gdGhpcy5vcGVuSGloYXQudHJpZ2dlckF0dGFjayh0aW1lLCAwLjMsIHZlbG9jaXR5KSxcbiAgICAgICAgICAgICh0aW1lLCB2ZWxvY2l0eSA9IDAuNSkgPT4gdGhpcy50b21Mb3cudHJpZ2dlckF0dGFjaygnRzMnLCB0aW1lLCB2ZWxvY2l0eSksXG4gICAgICAgICAgICAodGltZSwgdmVsb2NpdHkgPSAwLjUpID0+IHRoaXMudG9tTWlkLnRyaWdnZXJBdHRhY2soJ0M0JywgdGltZSwgdmVsb2NpdHkpLFxuICAgICAgICAgICAgKHRpbWUsIHZlbG9jaXR5ID0gMC41KSA9PiB0aGlzLnRvbUhpZ2gudHJpZ2dlckF0dGFjaygnRjQnLCB0aW1lLCB2ZWxvY2l0eSksXG4gICAgICAgICAgICAodGltZSwgdmVsb2NpdHkgPSAxKSA9PiB0aGlzLmNyYXNoLnRyaWdnZXJBdHRhY2sodGltZSwgMS4wLCB2ZWxvY2l0eSksXG4gICAgICAgICAgICAodGltZSwgdmVsb2NpdHkgPSAxKSA9PiB0aGlzLnJpZGUudHJpZ2dlckF0dGFjayh0aW1lLCAwLjUsIHZlbG9jaXR5KSxcbiAgICAgICAgICAgICh0aW1lLCB2ZWxvY2l0eSA9IDAuNSkgPT4gdGhpcy5sb0NsaWNrLnRyaWdnZXJBdHRhY2soJ0c1JywgdGltZSwgdmVsb2NpdHkpLFxuICAgICAgICAgICAgKHRpbWUsIHZlbG9jaXR5ID0gMC41KSA9PiB0aGlzLmhpQ2xpY2sudHJpZ2dlckF0dGFjaygnQzYnLCB0aW1lLCB2ZWxvY2l0eSksXG4gICAgICAgIF07XG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgY29uc3RhbnRzLkRFRkFVTFRfRFJVTV9QSVRDSF9DTEFTU0VTLmxlbmd0aDsgKytjKSB7XG4gICAgICAgICAgICBjb25zdGFudHMuREVGQVVMVF9EUlVNX1BJVENIX0NMQVNTRVNbY10uZm9yRWFjaCgocCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuRFJVTV9QSVRDSF9UT19DTEFTUy5zZXQocCwgYyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLkRSVU1fUElUQ0hfVE9fQ0xBU1Muc2V0KGNvbnN0YW50cy5MT19DTElDS19QSVRDSCwgY29uc3RhbnRzLkxPX0NMSUNLX0NMQVNTKTtcbiAgICAgICAgdGhpcy5EUlVNX1BJVENIX1RPX0NMQVNTLnNldChjb25zdGFudHMuSElfQ0xJQ0tfUElUQ0gsIGNvbnN0YW50cy5ISV9DTElDS19DTEFTUyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICAgICAgaWYgKCFEcnVtS2l0Lmluc3RhbmNlKSB7XG4gICAgICAgICAgICBEcnVtS2l0Lmluc3RhbmNlID0gbmV3IERydW1LaXQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gRHJ1bUtpdC5pbnN0YW5jZTtcbiAgICB9XG4gICAgcGxheU5vdGUocGl0Y2gsIHRpbWUsIHZlbG9jaXR5KSB7XG4gICAgICAgIHRoaXMucGl0Y2hQbGF5ZXJzW3RoaXMuRFJVTV9QSVRDSF9UT19DTEFTUy5nZXQocGl0Y2gpXSh0aW1lLCB2ZWxvY2l0eSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFBsYXllciBleHRlbmRzIEJhc2VQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLmRydW1LaXQgPSBEcnVtS2l0LmdldEluc3RhbmNlKCk7XG4gICAgICAgIHRoaXMuYmFzc1N5bnRoID0gbmV3IFRvbmVcbiAgICAgICAgICAgIC5TeW50aCh7XG4gICAgICAgICAgICB2b2x1bWU6IDUsXG4gICAgICAgICAgICBvc2NpbGxhdG9yOiB7IHR5cGU6ICd0cmlhbmdsZScgfSxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50b0Rlc3RpbmF0aW9uKCk7XG4gICAgICAgIHRoaXMucG9seVN5bnRoID0gbmV3IFRvbmUuUG9seVN5bnRoKCkudG9EZXN0aW5hdGlvbigpO1xuICAgIH1cbiAgICBwbGF5Tm90ZSh0aW1lLCBub3RlKSB7XG4gICAgICAgIGNvbnN0IHZlbG9jaXR5ID0gbm90ZS5oYXNPd25Qcm9wZXJ0eSgndmVsb2NpdHknKSA/XG4gICAgICAgICAgICBub3RlLnZlbG9jaXR5IC8gY29uc3RhbnRzLk1BWF9NSURJX1ZFTE9DSVRZIDpcbiAgICAgICAgICAgIHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG5vdGUuaXNEcnVtKSB7XG4gICAgICAgICAgICB0aGlzLmRydW1LaXQucGxheU5vdGUobm90ZS5waXRjaCwgdGltZSwgdmVsb2NpdHkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZnJlcSA9IFRvbmUuRnJlcXVlbmN5KG5vdGUucGl0Y2gsICdtaWRpJykudG9GcmVxdWVuY3koKTtcbiAgICAgICAgICAgIGNvbnN0IGR1ciA9IG5vdGUuZW5kVGltZSAtIG5vdGUuc3RhcnRUaW1lO1xuICAgICAgICAgICAgdGhpcy5nZXRTeW50aChub3RlLmluc3RydW1lbnQsIG5vdGUucHJvZ3JhbSlcbiAgICAgICAgICAgICAgICAudHJpZ2dlckF0dGFja1JlbGVhc2UoZnJlcSwgZHVyLCB0aW1lLCB2ZWxvY2l0eSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0U3ludGgoaW5zdHJ1bWVudCwgcHJvZ3JhbSkge1xuICAgICAgICBpZiAocHJvZ3JhbSAhPT0gdW5kZWZpbmVkICYmIHByb2dyYW0gPj0gMzIgJiYgcHJvZ3JhbSA8PSAzOSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFzc1N5bnRoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9seVN5bnRoO1xuICAgICAgICB9XG4gICAgfVxufVxuUGxheWVyLnRvbmUgPSBUb25lO1xuZXhwb3J0IGNsYXNzIFNvdW5kRm9udFBsYXllciBleHRlbmRzIEJhc2VQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKHNvdW5kRm9udFVSTCwgb3V0cHV0ID0gVG9uZS5NYXN0ZXIsIHByb2dyYW1PdXRwdXRzLCBkcnVtT3V0cHV0cywgY2FsbGJhY2tPYmplY3QpIHtcbiAgICAgICAgc3VwZXIoZmFsc2UsIGNhbGxiYWNrT2JqZWN0KTtcbiAgICAgICAgdGhpcy5zb3VuZEZvbnQgPSBuZXcgc291bmRmb250LlNvdW5kRm9udChzb3VuZEZvbnRVUkwpO1xuICAgICAgICB0aGlzLm91dHB1dCA9IG91dHB1dDtcbiAgICAgICAgdGhpcy5wcm9ncmFtT3V0cHV0cyA9IHByb2dyYW1PdXRwdXRzO1xuICAgICAgICB0aGlzLmRydW1PdXRwdXRzID0gZHJ1bU91dHB1dHM7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRTYW1wbGVzKHNlcSkge1xuICAgICAgICBhd2FpdCB0aGlzLnNvdW5kRm9udC5sb2FkU2FtcGxlcyhzZXEubm90ZXMubWFwKChub3RlKSA9PiAoe1xuICAgICAgICAgICAgcGl0Y2g6IG5vdGUucGl0Y2gsXG4gICAgICAgICAgICB2ZWxvY2l0eTogbm90ZS52ZWxvY2l0eSxcbiAgICAgICAgICAgIHByb2dyYW06IG5vdGUucHJvZ3JhbSB8fCAwLFxuICAgICAgICAgICAgaXNEcnVtOiBub3RlLmlzRHJ1bSB8fCBmYWxzZSxcbiAgICAgICAgfSkpKTtcbiAgICB9XG4gICAgYXN5bmMgbG9hZEFsbFNhbXBsZXMocHJvZ3JhbSA9IDAsIGlzRHJ1bSA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IG5zID0gTm90ZVNlcXVlbmNlLmNyZWF0ZSgpO1xuICAgICAgICBjb25zdCBtaW4gPSBpc0RydW0gPyBjb25zdGFudHMuTUlOX0RSVU1fUElUQ0ggOiBjb25zdGFudHMuTUlOX1BJQU5PX1BJVENIO1xuICAgICAgICBjb25zdCBtYXggPSBpc0RydW0gPyBjb25zdGFudHMuTUFYX0RSVU1fUElUQ0ggOiBjb25zdGFudHMuTUFYX1BJQU5PX1BJVENIO1xuICAgICAgICBmb3IgKGxldCBpID0gbWluOyBpIDw9IG1heDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gY29uc3RhbnRzLk1JTl9NSURJX1ZFTE9DSVRZOyBqIDwgY29uc3RhbnRzLk1BWF9NSURJX1ZFTE9DSVRZOyBqKyspIHtcbiAgICAgICAgICAgICAgICBucy5ub3Rlcy5wdXNoKHsgcGl0Y2g6IGksIHZlbG9jaXR5OiBqLCBwcm9ncmFtLCBpc0RydW0gfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZFNhbXBsZXMobnMpO1xuICAgIH1cbiAgICByZXN1bWVDb250ZXh0KCkge1xuICAgICAgICBUb25lLmNvbnRleHQucmVzdW1lKCk7XG4gICAgfVxuICAgIHN0YXJ0KHNlcSwgcXBtLCBvZmZzZXQgPSAwKSB7XG4gICAgICAgIHRoaXMucmVzdW1lQ29udGV4dCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkU2FtcGxlcyhzZXEpLnRoZW4oKCkgPT4gc3VwZXIuc3RhcnQoc2VxLCBxcG0sIG9mZnNldCkpO1xuICAgIH1cbiAgICBwbGF5Tm90ZSh0aW1lLCBub3RlKSB7XG4gICAgICAgIHRoaXMuc291bmRGb250LnBsYXlOb3RlKG5vdGUucGl0Y2gsIG5vdGUudmVsb2NpdHksIHRpbWUsIG5vdGUuZW5kVGltZSAtIG5vdGUuc3RhcnRUaW1lLCBub3RlLnByb2dyYW0sIG5vdGUuaXNEcnVtLCB0aGlzLmdldEF1ZGlvTm9kZU91dHB1dChub3RlKSk7XG4gICAgfVxuICAgIHBsYXlOb3RlRG93bihub3RlKSB7XG4gICAgICAgIHRoaXMuc291bmRGb250LnBsYXlOb3RlRG93bihub3RlLnBpdGNoLCBub3RlLnZlbG9jaXR5LCBub3RlLnByb2dyYW0sIG5vdGUuaXNEcnVtLCB0aGlzLmdldEF1ZGlvTm9kZU91dHB1dChub3RlKSk7XG4gICAgfVxuICAgIHBsYXlOb3RlVXAobm90ZSkge1xuICAgICAgICB0aGlzLnNvdW5kRm9udC5wbGF5Tm90ZVVwKG5vdGUucGl0Y2gsIG5vdGUudmVsb2NpdHksIG5vdGUucHJvZ3JhbSwgbm90ZS5pc0RydW0sIHRoaXMuZ2V0QXVkaW9Ob2RlT3V0cHV0KG5vdGUpKTtcbiAgICB9XG4gICAgZ2V0QXVkaW9Ob2RlT3V0cHV0KG5vdGUpIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IHRoaXMub3V0cHV0O1xuICAgICAgICBpZiAodGhpcy5wcm9ncmFtT3V0cHV0cyAmJiAhbm90ZS5pc0RydW0pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb2dyYW1PdXRwdXRzLmhhcyhub3RlLnByb2dyYW0pKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5wcm9ncmFtT3V0cHV0cy5nZXQobm90ZS5wcm9ncmFtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmRydW1PdXRwdXRzICYmIG5vdGUuaXNEcnVtKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kcnVtT3V0cHV0cy5oYXMobm90ZS5waXRjaCkpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSB0aGlzLmRydW1PdXRwdXRzLmdldChub3RlLnBpdGNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBQbGF5ZXJXaXRoQ2xpY2sgZXh0ZW5kcyBQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKGNhbGxiYWNrT2JqZWN0KSB7XG4gICAgICAgIHN1cGVyKHRydWUsIGNhbGxiYWNrT2JqZWN0KTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTUlESVBsYXllciBleHRlbmRzIEJhc2VQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKGNhbGxiYWNrT2JqZWN0KSB7XG4gICAgICAgIHN1cGVyKGZhbHNlLCBjYWxsYmFja09iamVjdCk7XG4gICAgICAgIHRoaXMub3V0cHV0cyA9IFtdO1xuICAgICAgICB0aGlzLm91dHB1dENoYW5uZWwgPSAwO1xuICAgICAgICB0aGlzLmF2YWlsYWJsZU91dHB1dHMgPSBbXTtcbiAgICAgICAgdGhpcy5OT1RFX09OID0gMHg5MDtcbiAgICAgICAgdGhpcy5OT1RFX09GRiA9IDB4ODA7XG4gICAgfVxuICAgIGFzeW5jIHJlcXVlc3RNSURJQWNjZXNzKCkge1xuICAgICAgICBpZiAobmF2aWdhdG9yLnJlcXVlc3RNSURJQWNjZXNzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIG5hdmlnYXRvci5yZXF1ZXN0TUlESUFjY2VzcygpLnRoZW4oKG1pZGkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbWlkaS5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsIChldmVudCkgPT4gdGhpcy5pbml0T3V0cHV0cyhtaWRpKSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5pbml0T3V0cHV0cyhtaWRpKSk7XG4gICAgICAgICAgICAgICAgfSwgKGVycikgPT4gY29uc29sZS5sb2coJ1NvbWV0aGluZyB3ZW50IHdyb25nJywgcmVqZWN0KGVycikpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaW5pdE91dHB1dHMobWlkaSkge1xuICAgICAgICBjb25zdCBvdXRwdXRzID0gbWlkaS5vdXRwdXRzLnZhbHVlcygpO1xuICAgICAgICBmb3IgKGxldCBvdXRwdXQgPSBvdXRwdXRzLm5leHQoKTsgb3V0cHV0ICYmICFvdXRwdXQuZG9uZTsgb3V0cHV0ID0gb3V0cHV0cy5uZXh0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlT3V0cHV0cy5wdXNoKG91dHB1dC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYXZhaWxhYmxlT3V0cHV0cztcbiAgICB9XG4gICAgcGxheU5vdGUodGltZSwgbm90ZSkge1xuICAgICAgICBjb25zdCB2ZWxvY2l0eSA9IG5vdGUudmVsb2NpdHkgfHwgMTAwO1xuICAgICAgICBjb25zdCBsZW5ndGggPSAobm90ZS5lbmRUaW1lIC0gbm90ZS5zdGFydFRpbWUpICogMTAwMDtcbiAgICAgICAgY29uc3QgbXNnT24gPSBbdGhpcy5OT1RFX09OICsgdGhpcy5vdXRwdXRDaGFubmVsLCBub3RlLnBpdGNoLCB2ZWxvY2l0eV07XG4gICAgICAgIGNvbnN0IG1zZ09mZiA9IFt0aGlzLk5PVEVfT0ZGICsgdGhpcy5vdXRwdXRDaGFubmVsLCBub3RlLnBpdGNoLCB2ZWxvY2l0eV07XG4gICAgICAgIGNvbnN0IG91dHB1dHMgPSB0aGlzLm91dHB1dHMgPyB0aGlzLm91dHB1dHMgOiB0aGlzLmF2YWlsYWJsZU91dHB1dHM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0cHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZVRvT3V0cHV0KG91dHB1dHNbaV0sIG1zZ09uKTtcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb091dHB1dChvdXRwdXRzW2ldLCBtc2dPZmYsIHBlcmZvcm1hbmNlLm5vdygpICsgbGVuZ3RoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZW5kTWVzc2FnZVRvT3V0cHV0KG91dHB1dCwgbWVzc2FnZSwgdGltZSkge1xuICAgICAgICBpZiAob3V0cHV0KSB7XG4gICAgICAgICAgICBvdXRwdXQuc2VuZChtZXNzYWdlLCB0aW1lKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwbGF5Tm90ZURvd24obm90ZSkge1xuICAgICAgICBjb25zdCBtc2dPbiA9IFt0aGlzLk5PVEVfT04sIG5vdGUucGl0Y2gsIG5vdGUudmVsb2NpdHldO1xuICAgICAgICBjb25zdCBvdXRwdXRzID0gdGhpcy5vdXRwdXRzID8gdGhpcy5vdXRwdXRzIDogdGhpcy5hdmFpbGFibGVPdXRwdXRzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dHB1dHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VUb091dHB1dChvdXRwdXRzW2ldLCBtc2dPbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGxheU5vdGVVcChub3RlKSB7XG4gICAgICAgIGNvbnN0IG1zZ09mZiA9IFt0aGlzLk5PVEVfT0ZGLCBub3RlLnBpdGNoLCBub3RlLnZlbG9jaXR5XTtcbiAgICAgICAgY29uc3Qgb3V0cHV0cyA9IHRoaXMub3V0cHV0cyA/IHRoaXMub3V0cHV0cyA6IHRoaXMuYXZhaWxhYmxlT3V0cHV0cztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvdXRwdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlVG9PdXRwdXQob3V0cHV0c1tpXSwgbXNnT2ZmLCBub3RlLmVuZFRpbWUgLSBub3RlLnN0YXJ0VGltZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wbGF5ZXIuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/player.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/recorder.js":
/*!************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/recorder.js ***!
  \************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BaseRecorderCallback: () => (/* binding */ BaseRecorderCallback),\n/* harmony export */   Recorder: () => (/* binding */ Recorder)\n/* harmony export */ });\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tone */ \"(ssr)/./node_modules/.pnpm/tone@14.7.77/node_modules/tone/build/Tone.js\");\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _core_compat_global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/compat/global */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\");\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n\n\n\n\n\nclass BaseRecorderCallback {\n}\nclass Recorder {\n    constructor(config = {}, callbackObject) {\n        this.notes = [];\n        this.midiInputs = [];\n        this.loClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.hiClick = new tone__WEBPACK_IMPORTED_MODULE_0__.MembraneSynth({\n            pitchDecay: 0.008,\n            envelope: { attack: 0.001, decay: 0.3, sustain: 0 },\n        })\n            .toDestination();\n        this.config = {\n            playClick: config.playClick,\n            qpm: config.qpm || _constants__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_QUARTERS_PER_MINUTE,\n            playCountIn: config.playCountIn,\n            startRecordingAtFirstNote: config.startRecordingAtFirstNote || false,\n        };\n        this.callbackObject = callbackObject;\n        this.recording = false;\n        this.onNotes = new Map();\n    }\n    async initialize() {\n        await navigator\n            .requestMIDIAccess()\n            .then((midi) => this.midiReady(midi), (err) => console.log('Something went wrong', err));\n    }\n    midiReady(midi) {\n        _logging__WEBPACK_IMPORTED_MODULE_4__.log('Initialized Recorder', 'Recorder');\n        const inputs = midi.inputs.values();\n        for (let input = inputs.next(); input && !input.done; input = inputs.next()) {\n            this.midiInputs.push(input.value);\n        }\n    }\n    isRecording() {\n        return this.recording;\n    }\n    setTempo(qpm) {\n        this.config.qpm = qpm;\n        if (tone__WEBPACK_IMPORTED_MODULE_0__.Transport.state === 'started') {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = qpm;\n        }\n    }\n    enablePlayClick(playClick) {\n        this.config.playClick = playClick;\n    }\n    enablePlayCountIn(countIn) {\n        this.config.playCountIn = countIn;\n    }\n    initClickLoop() {\n        let clickStep = 0;\n        this.clickLoop = new tone__WEBPACK_IMPORTED_MODULE_0__.Loop((time) => {\n            if (clickStep % 4 === 0) {\n                this.loClick.triggerAttack('G5', time);\n            }\n            else {\n                this.hiClick.triggerAttack('C6', time);\n            }\n            clickStep++;\n            if (this.config.playCountIn && clickStep === 4) {\n                tone__WEBPACK_IMPORTED_MODULE_0__.Transport.stop();\n                this.clickLoop.stop();\n            }\n        }, '4n');\n    }\n    getMIDIInputs() {\n        return this.midiInputs;\n    }\n    start(midiInputs) {\n        const list = midiInputs ? midiInputs : this.midiInputs;\n        for (const input of list) {\n            input.onmidimessage = (event) => {\n                this.midiMessageReceived(event);\n            };\n        }\n        if (this.config.playClick || this.config.playCountIn) {\n            this.initClickLoop();\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.bpm.value = this.config.qpm;\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.start();\n            this.clickLoop.start();\n        }\n        else {\n            this.clickLoop = null;\n        }\n        this.recording = true;\n        this.firstNoteTimestamp = undefined;\n        this.notes = [];\n        this.onNotes = new Map();\n        if (!this.startRecordingAtFirstNote) {\n            const timeStamp = Date.now();\n            this.firstNoteTimestamp = timeStamp;\n        }\n    }\n    stop() {\n        this.recording = false;\n        const timeStamp = Date.now();\n        this.onNotes.forEach((pitch, note) => {\n            this.noteOff(note, timeStamp);\n        });\n        for (const input of this.midiInputs) {\n            input.onmidimessage = null;\n        }\n        if (this.clickLoop) {\n            tone__WEBPACK_IMPORTED_MODULE_0__.Transport.stop();\n            this.clickLoop.stop();\n        }\n        if (this.notes.length === 0) {\n            return null;\n        }\n        return this.getNoteSequence();\n    }\n    getNoteSequence() {\n        if (this.notes.length === 0) {\n            return null;\n        }\n        return _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.create({\n            notes: this.notes,\n            totalTime: this.notes[this.notes.length - 1].endTime,\n        });\n    }\n    reset() {\n        const noteSequence = this.stop();\n        this.firstNoteTimestamp = undefined;\n        this.notes = [];\n        this.onNotes = new Map();\n        return noteSequence;\n    }\n    midiMessageReceived(event) {\n        if (!this.recording) {\n            return;\n        }\n        let timeStampOffset;\n        if (event.timeStamp !== undefined && event.timeStamp !== 0) {\n            timeStampOffset = event.timeStamp;\n        }\n        else {\n            timeStampOffset = _core_compat_global__WEBPACK_IMPORTED_MODULE_1__.performance.now();\n        }\n        const timeStamp = timeStampOffset + _core_compat_global__WEBPACK_IMPORTED_MODULE_1__.performance.timing.navigationStart;\n        if (this.firstNoteTimestamp === undefined) {\n            this.firstNoteTimestamp = timeStamp;\n        }\n        const NOTE_ON = 9;\n        const NOTE_OFF = 8;\n        const cmd = event.data[0] >> 4;\n        const pitch = event.data[1];\n        const velocity = event.data.length > 2 ? event.data[2] : 1;\n        const device = event.srcElement;\n        if (cmd === NOTE_OFF || (cmd === NOTE_ON && velocity === 0)) {\n            if (this.callbackObject && this.callbackObject.noteOff) {\n                this.callbackObject.noteOff(pitch, velocity, device);\n            }\n            this.noteOff(pitch, timeStamp);\n            if (this.callbackObject && this.callbackObject.run) {\n                this.callbackObject.run(this.getNoteSequence());\n            }\n        }\n        else if (cmd === NOTE_ON) {\n            if (this.callbackObject && this.callbackObject.noteOn) {\n                this.callbackObject.noteOn(pitch, velocity, device);\n            }\n            this.noteOn(pitch, velocity, timeStamp);\n        }\n    }\n    noteOn(pitch, velocity, timeStamp) {\n        const MILLIS_PER_SECOND = 1000;\n        const note = new _protobuf_index__WEBPACK_IMPORTED_MODULE_2__.NoteSequence.Note();\n        note.pitch = pitch;\n        note.startTime = (timeStamp - this.firstNoteTimestamp) / MILLIS_PER_SECOND;\n        note.velocity = velocity;\n        this.onNotes.set(pitch, note);\n    }\n    noteOff(pitch, timeStamp) {\n        const MILLIS_PER_SECOND = 1000;\n        const note = this.onNotes.get(pitch);\n        if (note) {\n            note.endTime = (timeStamp - this.firstNoteTimestamp) / MILLIS_PER_SECOND;\n            this.notes.push(note);\n        }\n        this.onNotes.delete(pitch);\n    }\n}\n//# sourceMappingURL=recorder.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9yZWNvcmRlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUE2QjtBQUN1QjtBQUNIO0FBQ1M7QUFDckI7QUFDOUI7QUFDUDtBQUNPO0FBQ1AsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQSwyQkFBMkIsK0NBQ0Q7QUFDMUI7QUFDQSx3QkFBd0IsdUNBQXVDO0FBQy9ELFNBQVM7QUFDVDtBQUNBLDJCQUEyQiwrQ0FDRDtBQUMxQjtBQUNBLHdCQUF3Qix1Q0FBdUM7QUFDL0QsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtRUFBMkI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHlDQUFXO0FBQ25CO0FBQ0Esd0NBQXdDLHNCQUFzQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwyQ0FBYztBQUMxQixZQUFZLDJDQUFjO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHNDQUFTO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMkNBQWM7QUFDOUI7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkNBQWM7QUFDMUIsWUFBWSwyQ0FBYztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkNBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUseURBQVk7QUFDM0I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDREQUFXO0FBQ3pDO0FBQ0EsNENBQTRDLDREQUFXO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qix5REFBWTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9jb3JlL3JlY29yZGVyLmpzPzA3MjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgVG9uZSBmcm9tICd0b25lJztcbmltcG9ydCB7IHBlcmZvcm1hbmNlIH0gZnJvbSAnLi4vY29yZS9jb21wYXQvZ2xvYmFsJztcbmltcG9ydCB7IE5vdGVTZXF1ZW5jZSB9IGZyb20gJy4uL3Byb3RvYnVmL2luZGV4JztcbmltcG9ydCB7IERFRkFVTFRfUVVBUlRFUlNfUEVSX01JTlVURSB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCAqIGFzIGxvZ2dpbmcgZnJvbSAnLi9sb2dnaW5nJztcbmV4cG9ydCBjbGFzcyBCYXNlUmVjb3JkZXJDYWxsYmFjayB7XG59XG5leHBvcnQgY2xhc3MgUmVjb3JkZXIge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZyA9IHt9LCBjYWxsYmFja09iamVjdCkge1xuICAgICAgICB0aGlzLm5vdGVzID0gW107XG4gICAgICAgIHRoaXMubWlkaUlucHV0cyA9IFtdO1xuICAgICAgICB0aGlzLmxvQ2xpY2sgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1lbWJyYW5lU3ludGgoe1xuICAgICAgICAgICAgcGl0Y2hEZWNheTogMC4wMDgsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMC4zLCBzdXN0YWluOiAwIH0sXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLmhpQ2xpY2sgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLk1lbWJyYW5lU3ludGgoe1xuICAgICAgICAgICAgcGl0Y2hEZWNheTogMC4wMDgsXG4gICAgICAgICAgICBlbnZlbG9wZTogeyBhdHRhY2s6IDAuMDAxLCBkZWNheTogMC4zLCBzdXN0YWluOiAwIH0sXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudG9EZXN0aW5hdGlvbigpO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgICAgICAgIHBsYXlDbGljazogY29uZmlnLnBsYXlDbGljayxcbiAgICAgICAgICAgIHFwbTogY29uZmlnLnFwbSB8fCBERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEUsXG4gICAgICAgICAgICBwbGF5Q291bnRJbjogY29uZmlnLnBsYXlDb3VudEluLFxuICAgICAgICAgICAgc3RhcnRSZWNvcmRpbmdBdEZpcnN0Tm90ZTogY29uZmlnLnN0YXJ0UmVjb3JkaW5nQXRGaXJzdE5vdGUgfHwgZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QgPSBjYWxsYmFja09iamVjdDtcbiAgICAgICAgdGhpcy5yZWNvcmRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbk5vdGVzID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplKCkge1xuICAgICAgICBhd2FpdCBuYXZpZ2F0b3JcbiAgICAgICAgICAgIC5yZXF1ZXN0TUlESUFjY2VzcygpXG4gICAgICAgICAgICAudGhlbigobWlkaSkgPT4gdGhpcy5taWRpUmVhZHkobWlkaSksIChlcnIpID0+IGNvbnNvbGUubG9nKCdTb21ldGhpbmcgd2VudCB3cm9uZycsIGVycikpO1xuICAgIH1cbiAgICBtaWRpUmVhZHkobWlkaSkge1xuICAgICAgICBsb2dnaW5nLmxvZygnSW5pdGlhbGl6ZWQgUmVjb3JkZXInLCAnUmVjb3JkZXInKTtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gbWlkaS5pbnB1dHMudmFsdWVzKCk7XG4gICAgICAgIGZvciAobGV0IGlucHV0ID0gaW5wdXRzLm5leHQoKTsgaW5wdXQgJiYgIWlucHV0LmRvbmU7IGlucHV0ID0gaW5wdXRzLm5leHQoKSkge1xuICAgICAgICAgICAgdGhpcy5taWRpSW5wdXRzLnB1c2goaW5wdXQudmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzUmVjb3JkaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWNvcmRpbmc7XG4gICAgfVxuICAgIHNldFRlbXBvKHFwbSkge1xuICAgICAgICB0aGlzLmNvbmZpZy5xcG0gPSBxcG07XG4gICAgICAgIGlmIChUb25lLlRyYW5zcG9ydC5zdGF0ZSA9PT0gJ3N0YXJ0ZWQnKSB7XG4gICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5icG0udmFsdWUgPSBxcG07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW5hYmxlUGxheUNsaWNrKHBsYXlDbGljaykge1xuICAgICAgICB0aGlzLmNvbmZpZy5wbGF5Q2xpY2sgPSBwbGF5Q2xpY2s7XG4gICAgfVxuICAgIGVuYWJsZVBsYXlDb3VudEluKGNvdW50SW4pIHtcbiAgICAgICAgdGhpcy5jb25maWcucGxheUNvdW50SW4gPSBjb3VudEluO1xuICAgIH1cbiAgICBpbml0Q2xpY2tMb29wKCkge1xuICAgICAgICBsZXQgY2xpY2tTdGVwID0gMDtcbiAgICAgICAgdGhpcy5jbGlja0xvb3AgPSBuZXcgVG9uZS5Mb29wKCh0aW1lKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2xpY2tTdGVwICUgNCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9DbGljay50cmlnZ2VyQXR0YWNrKCdHNScsIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaUNsaWNrLnRyaWdnZXJBdHRhY2soJ0M2JywgdGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGlja1N0ZXArKztcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5wbGF5Q291bnRJbiAmJiBjbGlja1N0ZXAgPT09IDQpIHtcbiAgICAgICAgICAgICAgICBUb25lLlRyYW5zcG9ydC5zdG9wKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGlja0xvb3Auc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAnNG4nKTtcbiAgICB9XG4gICAgZ2V0TUlESUlucHV0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWlkaUlucHV0cztcbiAgICB9XG4gICAgc3RhcnQobWlkaUlucHV0cykge1xuICAgICAgICBjb25zdCBsaXN0ID0gbWlkaUlucHV0cyA/IG1pZGlJbnB1dHMgOiB0aGlzLm1pZGlJbnB1dHM7XG4gICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2YgbGlzdCkge1xuICAgICAgICAgICAgaW5wdXQub25taWRpbWVzc2FnZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWlkaU1lc3NhZ2VSZWNlaXZlZChldmVudCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5wbGF5Q2xpY2sgfHwgdGhpcy5jb25maWcucGxheUNvdW50SW4pIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdENsaWNrTG9vcCgpO1xuICAgICAgICAgICAgVG9uZS5UcmFuc3BvcnQuYnBtLnZhbHVlID0gdGhpcy5jb25maWcucXBtO1xuICAgICAgICAgICAgVG9uZS5UcmFuc3BvcnQuc3RhcnQoKTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tMb29wLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsaWNrTG9vcCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWNvcmRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmZpcnN0Tm90ZVRpbWVzdGFtcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ub3RlcyA9IFtdO1xuICAgICAgICB0aGlzLm9uTm90ZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGlmICghdGhpcy5zdGFydFJlY29yZGluZ0F0Rmlyc3ROb3RlKSB7XG4gICAgICAgICAgICBjb25zdCB0aW1lU3RhbXAgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgdGhpcy5maXJzdE5vdGVUaW1lc3RhbXAgPSB0aW1lU3RhbXA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RvcCgpIHtcbiAgICAgICAgdGhpcy5yZWNvcmRpbmcgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgdGltZVN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5vbk5vdGVzLmZvckVhY2goKHBpdGNoLCBub3RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5vdGVPZmYobm90ZSwgdGltZVN0YW1wKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2YgdGhpcy5taWRpSW5wdXRzKSB7XG4gICAgICAgICAgICBpbnB1dC5vbm1pZGltZXNzYWdlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jbGlja0xvb3ApIHtcbiAgICAgICAgICAgIFRvbmUuVHJhbnNwb3J0LnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tMb29wLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ub3Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldE5vdGVTZXF1ZW5jZSgpO1xuICAgIH1cbiAgICBnZXROb3RlU2VxdWVuY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLm5vdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE5vdGVTZXF1ZW5jZS5jcmVhdGUoe1xuICAgICAgICAgICAgbm90ZXM6IHRoaXMubm90ZXMsXG4gICAgICAgICAgICB0b3RhbFRpbWU6IHRoaXMubm90ZXNbdGhpcy5ub3Rlcy5sZW5ndGggLSAxXS5lbmRUaW1lLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IG5vdGVTZXF1ZW5jZSA9IHRoaXMuc3RvcCgpO1xuICAgICAgICB0aGlzLmZpcnN0Tm90ZVRpbWVzdGFtcCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ub3RlcyA9IFtdO1xuICAgICAgICB0aGlzLm9uTm90ZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHJldHVybiBub3RlU2VxdWVuY2U7XG4gICAgfVxuICAgIG1pZGlNZXNzYWdlUmVjZWl2ZWQoZXZlbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJlY29yZGluZykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0aW1lU3RhbXBPZmZzZXQ7XG4gICAgICAgIGlmIChldmVudC50aW1lU3RhbXAgIT09IHVuZGVmaW5lZCAmJiBldmVudC50aW1lU3RhbXAgIT09IDApIHtcbiAgICAgICAgICAgIHRpbWVTdGFtcE9mZnNldCA9IGV2ZW50LnRpbWVTdGFtcDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRpbWVTdGFtcE9mZnNldCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRpbWVTdGFtcCA9IHRpbWVTdGFtcE9mZnNldCArIHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7XG4gICAgICAgIGlmICh0aGlzLmZpcnN0Tm90ZVRpbWVzdGFtcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZpcnN0Tm90ZVRpbWVzdGFtcCA9IHRpbWVTdGFtcDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBOT1RFX09OID0gOTtcbiAgICAgICAgY29uc3QgTk9URV9PRkYgPSA4O1xuICAgICAgICBjb25zdCBjbWQgPSBldmVudC5kYXRhWzBdID4+IDQ7XG4gICAgICAgIGNvbnN0IHBpdGNoID0gZXZlbnQuZGF0YVsxXTtcbiAgICAgICAgY29uc3QgdmVsb2NpdHkgPSBldmVudC5kYXRhLmxlbmd0aCA+IDIgPyBldmVudC5kYXRhWzJdIDogMTtcbiAgICAgICAgY29uc3QgZGV2aWNlID0gZXZlbnQuc3JjRWxlbWVudDtcbiAgICAgICAgaWYgKGNtZCA9PT0gTk9URV9PRkYgfHwgKGNtZCA9PT0gTk9URV9PTiAmJiB2ZWxvY2l0eSA9PT0gMCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrT2JqZWN0ICYmIHRoaXMuY2FsbGJhY2tPYmplY3Qubm90ZU9mZikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3Qubm90ZU9mZihwaXRjaCwgdmVsb2NpdHksIGRldmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5vdGVPZmYocGl0Y2gsIHRpbWVTdGFtcCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFja09iamVjdCAmJiB0aGlzLmNhbGxiYWNrT2JqZWN0LnJ1bikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tPYmplY3QucnVuKHRoaXMuZ2V0Tm90ZVNlcXVlbmNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gTk9URV9PTikge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tPYmplY3QgJiYgdGhpcy5jYWxsYmFja09iamVjdC5ub3RlT24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrT2JqZWN0Lm5vdGVPbihwaXRjaCwgdmVsb2NpdHksIGRldmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5vdGVPbihwaXRjaCwgdmVsb2NpdHksIHRpbWVTdGFtcCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbm90ZU9uKHBpdGNoLCB2ZWxvY2l0eSwgdGltZVN0YW1wKSB7XG4gICAgICAgIGNvbnN0IE1JTExJU19QRVJfU0VDT05EID0gMTAwMDtcbiAgICAgICAgY29uc3Qgbm90ZSA9IG5ldyBOb3RlU2VxdWVuY2UuTm90ZSgpO1xuICAgICAgICBub3RlLnBpdGNoID0gcGl0Y2g7XG4gICAgICAgIG5vdGUuc3RhcnRUaW1lID0gKHRpbWVTdGFtcCAtIHRoaXMuZmlyc3ROb3RlVGltZXN0YW1wKSAvIE1JTExJU19QRVJfU0VDT05EO1xuICAgICAgICBub3RlLnZlbG9jaXR5ID0gdmVsb2NpdHk7XG4gICAgICAgIHRoaXMub25Ob3Rlcy5zZXQocGl0Y2gsIG5vdGUpO1xuICAgIH1cbiAgICBub3RlT2ZmKHBpdGNoLCB0aW1lU3RhbXApIHtcbiAgICAgICAgY29uc3QgTUlMTElTX1BFUl9TRUNPTkQgPSAxMDAwO1xuICAgICAgICBjb25zdCBub3RlID0gdGhpcy5vbk5vdGVzLmdldChwaXRjaCk7XG4gICAgICAgIGlmIChub3RlKSB7XG4gICAgICAgICAgICBub3RlLmVuZFRpbWUgPSAodGltZVN0YW1wIC0gdGhpcy5maXJzdE5vdGVUaW1lc3RhbXApIC8gTUlMTElTX1BFUl9TRUNPTkQ7XG4gICAgICAgICAgICB0aGlzLm5vdGVzLnB1c2gobm90ZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbk5vdGVzLmRlbGV0ZShwaXRjaCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVjb3JkZXIuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/recorder.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js ***!
  \*************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BadTimeSignatureException: () => (/* binding */ BadTimeSignatureException),\n/* harmony export */   MultipleTempoException: () => (/* binding */ MultipleTempoException),\n/* harmony export */   MultipleTimeSignatureException: () => (/* binding */ MultipleTimeSignatureException),\n/* harmony export */   NegativeTimeException: () => (/* binding */ NegativeTimeException),\n/* harmony export */   QuantizationStatusException: () => (/* binding */ QuantizationStatusException),\n/* harmony export */   applySustainControlChanges: () => (/* binding */ applySustainControlChanges),\n/* harmony export */   assertIsAbsoluteQuantizedSequence: () => (/* binding */ assertIsAbsoluteQuantizedSequence),\n/* harmony export */   assertIsQuantizedSequence: () => (/* binding */ assertIsQuantizedSequence),\n/* harmony export */   assertIsRelativeQuantizedSequence: () => (/* binding */ assertIsRelativeQuantizedSequence),\n/* harmony export */   clone: () => (/* binding */ clone),\n/* harmony export */   concatenate: () => (/* binding */ concatenate),\n/* harmony export */   createQuantizedNoteSequence: () => (/* binding */ createQuantizedNoteSequence),\n/* harmony export */   isAbsoluteQuantizedSequence: () => (/* binding */ isAbsoluteQuantizedSequence),\n/* harmony export */   isQuantizedSequence: () => (/* binding */ isQuantizedSequence),\n/* harmony export */   isRelativeQuantizedSequence: () => (/* binding */ isRelativeQuantizedSequence),\n/* harmony export */   mergeConsecutiveNotes: () => (/* binding */ mergeConsecutiveNotes),\n/* harmony export */   mergeInstruments: () => (/* binding */ mergeInstruments),\n/* harmony export */   quantizeNoteSequence: () => (/* binding */ quantizeNoteSequence),\n/* harmony export */   quantizeToStep: () => (/* binding */ quantizeToStep),\n/* harmony export */   replaceInstruments: () => (/* binding */ replaceInstruments),\n/* harmony export */   split: () => (/* binding */ split),\n/* harmony export */   stepsPerQuarterToStepsPerSecond: () => (/* binding */ stepsPerQuarterToStepsPerSecond),\n/* harmony export */   trim: () => (/* binding */ trim),\n/* harmony export */   unquantizeSequence: () => (/* binding */ unquantizeSequence)\n/* harmony export */ });\n/* harmony import */ var _protobuf_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../protobuf/index */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n\n\nconst QUANTIZE_CUTOFF = 0.5;\nclass MultipleTimeSignatureException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass BadTimeSignatureException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass NegativeTimeException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass MultipleTempoException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nclass QuantizationStatusException extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\nfunction isPowerOf2(n) {\n    return n && (n & (n - 1)) === 0;\n}\nfunction clone(ns) {\n    return _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.decode(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.encode(ns).finish());\n}\nfunction stepsPerQuarterToStepsPerSecond(stepsPerQuarter, qpm) {\n    return stepsPerQuarter * qpm / 60.0;\n}\nfunction quantizeToStep(unquantizedSeconds, stepsPerSecond, quantizeCutoff = QUANTIZE_CUTOFF) {\n    const unquantizedSteps = unquantizedSeconds * stepsPerSecond;\n    return Math.floor(unquantizedSteps + (1 - quantizeCutoff));\n}\nfunction getQuantizedTimeEvents(ns) {\n    return ns.controlChanges.concat(ns.textAnnotations);\n}\nfunction quantizeNotesAndEvents(ns, stepsPerSecond) {\n    for (const note of ns.notes) {\n        note.quantizedStartStep = quantizeToStep(note.startTime, stepsPerSecond);\n        note.quantizedEndStep = quantizeToStep(note.endTime, stepsPerSecond);\n        if (note.quantizedEndStep === note.quantizedStartStep) {\n            note.quantizedEndStep += 1;\n        }\n        if (note.quantizedStartStep < 0 || note.quantizedEndStep < 0) {\n            throw new NegativeTimeException(`Got negative note time: start_step = ` +\n                `${note.quantizedStartStep}, end_step = ` +\n                `${note.quantizedEndStep}`);\n        }\n        if (note.quantizedEndStep > ns.totalQuantizedSteps) {\n            ns.totalQuantizedSteps = note.quantizedEndStep;\n        }\n    }\n    getQuantizedTimeEvents(ns).forEach(event => {\n        event.quantizedStep = quantizeToStep(event.time, stepsPerSecond);\n        if (event.quantizedStep < 0) {\n            throw new NegativeTimeException(`Got negative event time: step = ${event.quantizedStep}`);\n        }\n    });\n}\nfunction assertSingleTempo(ns) {\n    if (!ns.tempos || ns.tempos.length === 0) {\n        return;\n    }\n    ns.tempos.sort((a, b) => a.time - b.time);\n    if (ns.tempos[0].time !== 0 &&\n        ns.tempos[0].qpm !== _constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_QUARTERS_PER_MINUTE) {\n        throw new MultipleTempoException('NoteSequence has an implicit tempo change from initial ' +\n            `${_constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_QUARTERS_PER_MINUTE} qpm to ` +\n            `${ns.tempos[0].qpm} qpm at ${ns.tempos[0].time} seconds.`);\n    }\n    for (let i = 1; i < ns.tempos.length; i++) {\n        if (ns.tempos[i].qpm !== ns.tempos[0].qpm) {\n            throw new MultipleTempoException('NoteSequence has at least one tempo change from ' +\n                `${ns.tempos[0].qpm} qpm to ${ns.tempos[i].qpm}` +\n                `qpm at ${ns.tempos[i].time} seconds.`);\n        }\n    }\n}\nfunction quantizeNoteSequence(ns, stepsPerQuarter) {\n    const qns = clone(ns);\n    qns.quantizationInfo =\n        _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.QuantizationInfo.create({ stepsPerQuarter });\n    if (qns.timeSignatures.length > 0) {\n        qns.timeSignatures.sort((a, b) => a.time - b.time);\n        if (qns.timeSignatures[0].time !== 0 &&\n            !(qns.timeSignatures[0].numerator === 4 &&\n                qns.timeSignatures[0].denominator === 4)) {\n            throw new MultipleTimeSignatureException('NoteSequence has an implicit change from initial 4/4 time ' +\n                `signature to ${qns.timeSignatures[0].numerator}/` +\n                `${qns.timeSignatures[0].denominator} at ` +\n                `${qns.timeSignatures[0].time} seconds.`);\n        }\n        for (let i = 1; i < qns.timeSignatures.length; i++) {\n            const timeSignature = qns.timeSignatures[i];\n            if (timeSignature.numerator !== qns.timeSignatures[0].numerator ||\n                timeSignature.denominator !== qns.timeSignatures[0].denominator) {\n                throw new MultipleTimeSignatureException('NoteSequence has at least one time signature change from ' +\n                    `${qns.timeSignatures[0].numerator}/` +\n                    `${qns.timeSignatures[0].denominator} to ` +\n                    `${timeSignature.numerator}/${timeSignature.denominator} ` +\n                    `at ${timeSignature.time} seconds`);\n            }\n        }\n        qns.timeSignatures[0].time = 0;\n        qns.timeSignatures = [qns.timeSignatures[0]];\n    }\n    else {\n        const timeSignature = _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.TimeSignature.create({ numerator: 4, denominator: 4, time: 0 });\n        qns.timeSignatures.push(timeSignature);\n    }\n    const firstTS = qns.timeSignatures[0];\n    if (!isPowerOf2(firstTS.denominator)) {\n        throw new BadTimeSignatureException('Denominator is not a power of 2. Time signature: ' +\n            `${firstTS.numerator}/${firstTS.denominator}`);\n    }\n    if (firstTS.numerator === 0) {\n        throw new BadTimeSignatureException('Numerator is 0. Time signature: ' +\n            `${firstTS.numerator}/${firstTS.denominator}`);\n    }\n    if (qns.tempos.length > 0) {\n        assertSingleTempo(qns);\n        qns.tempos[0].time = 0;\n        qns.tempos = [qns.tempos[0]];\n    }\n    else {\n        const tempo = _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Tempo.create({ qpm: _constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_QUARTERS_PER_MINUTE, time: 0 });\n        qns.tempos.push(tempo);\n    }\n    const stepsPerSecond = stepsPerQuarterToStepsPerSecond(stepsPerQuarter, qns.tempos[0].qpm);\n    qns.totalQuantizedSteps = quantizeToStep(ns.totalTime, stepsPerSecond);\n    quantizeNotesAndEvents(qns, stepsPerSecond);\n    return qns;\n}\nfunction isQuantizedSequence(ns) {\n    return ns.quantizationInfo &&\n        (ns.quantizationInfo.stepsPerQuarter > 0 ||\n            ns.quantizationInfo.stepsPerSecond > 0);\n}\nfunction assertIsQuantizedSequence(ns) {\n    if (!isQuantizedSequence(ns)) {\n        throw new QuantizationStatusException(`NoteSequence ${ns.id} is not quantized (missing quantizationInfo)`);\n    }\n}\nfunction isRelativeQuantizedSequence(ns) {\n    return ns.quantizationInfo && ns.quantizationInfo.stepsPerQuarter > 0;\n}\nfunction assertIsRelativeQuantizedSequence(ns) {\n    if (!isRelativeQuantizedSequence(ns)) {\n        throw new QuantizationStatusException(`NoteSequence ${ns.id} is not quantized or is quantized based on absolute timing`);\n    }\n}\nfunction isAbsoluteQuantizedSequence(ns) {\n    return ns.quantizationInfo && ns.quantizationInfo.stepsPerSecond > 0;\n}\nfunction assertIsAbsoluteQuantizedSequence(ns) {\n    if (!isAbsoluteQuantizedSequence(ns)) {\n        throw new QuantizationStatusException(`NoteSequence ${ns.id} is not quantized or is quantized based on relative timing`);\n    }\n}\nfunction unquantizeSequence(qns, qpm) {\n    assertIsRelativeQuantizedSequence(qns);\n    assertSingleTempo(qns);\n    const ns = clone(qns);\n    if (qpm) {\n        if (ns.tempos && ns.tempos.length > 0) {\n            ns.tempos[0].qpm = qpm;\n        }\n        else {\n            ns.tempos.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Tempo.create({ time: 0, qpm }));\n        }\n    }\n    else {\n        qpm = (qns.tempos && qns.tempos.length > 0) ?\n            ns.tempos[0].qpm :\n            _constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_QUARTERS_PER_MINUTE;\n    }\n    const stepToSeconds = (step) => step / ns.quantizationInfo.stepsPerQuarter * (60 / qpm);\n    ns.totalTime = stepToSeconds(ns.totalQuantizedSteps);\n    ns.notes.forEach(n => {\n        n.startTime = stepToSeconds(n.quantizedStartStep);\n        n.endTime = stepToSeconds(n.quantizedEndStep);\n        ns.totalTime = Math.max(ns.totalTime, n.endTime);\n        delete n.quantizedStartStep;\n        delete n.quantizedEndStep;\n    });\n    getQuantizedTimeEvents(ns).forEach(event => {\n        event.time = stepToSeconds(event.time);\n    });\n    delete ns.totalQuantizedSteps;\n    delete ns.quantizationInfo;\n    return ns;\n}\nfunction createQuantizedNoteSequence(stepsPerQuarter = _constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_STEPS_PER_QUARTER, qpm = _constants__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_QUARTERS_PER_MINUTE) {\n    return _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.create({ quantizationInfo: { stepsPerQuarter }, tempos: [{ qpm }] });\n}\nfunction mergeInstruments(ns) {\n    const result = clone(ns);\n    const events = result.notes.concat(result.pitchBends).concat(result.controlChanges);\n    const programs = Array.from(new Set(events.filter(e => !e.isDrum).map(e => e.program)));\n    events.forEach(e => {\n        if (e.isDrum) {\n            e.program = 0;\n            e.instrument = programs.length;\n        }\n        else {\n            e.instrument = programs.indexOf(e.program);\n        }\n    });\n    return result;\n}\nfunction replaceInstruments(originalSequence, replaceSequence) {\n    const instrumentsInOriginal = new Set(originalSequence.notes.map(n => n.instrument));\n    const instrumentsInReplace = new Set(replaceSequence.notes.map(n => n.instrument));\n    const newNotes = [];\n    originalSequence.notes.forEach(n => {\n        if (!instrumentsInReplace.has(n.instrument)) {\n            newNotes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create(n));\n        }\n    });\n    replaceSequence.notes.forEach(n => {\n        if (instrumentsInOriginal.has(n.instrument)) {\n            newNotes.push(_protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create(n));\n        }\n    });\n    const output = clone(originalSequence);\n    output.notes = newNotes.sort((a, b) => {\n        const voiceCompare = a.instrument - b.instrument;\n        if (voiceCompare) {\n            return voiceCompare;\n        }\n        return a.quantizedStartStep - b.quantizedStartStep;\n    });\n    return output;\n}\nfunction mergeConsecutiveNotes(sequence) {\n    assertIsQuantizedSequence(sequence);\n    const output = clone(sequence);\n    output.notes = [];\n    const newNotes = sequence.notes.sort((a, b) => {\n        const voiceCompare = a.instrument - b.instrument;\n        if (voiceCompare) {\n            return voiceCompare;\n        }\n        return a.quantizedStartStep - b.quantizedStartStep;\n    });\n    const note = new _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note();\n    note.pitch = newNotes[0].pitch;\n    note.instrument = newNotes[0].instrument;\n    note.quantizedStartStep = newNotes[0].quantizedStartStep;\n    note.quantizedEndStep = newNotes[0].quantizedEndStep;\n    output.notes.push(note);\n    let o = 0;\n    for (let i = 1; i < newNotes.length; i++) {\n        const thisNote = newNotes[i];\n        const previousNote = output.notes[o];\n        if (previousNote.instrument === thisNote.instrument &&\n            previousNote.pitch === thisNote.pitch &&\n            thisNote.quantizedStartStep === previousNote.quantizedEndStep &&\n            thisNote.quantizedStartStep % 16 !== 0) {\n            output.notes[o].quantizedEndStep +=\n                thisNote.quantizedEndStep - thisNote.quantizedStartStep;\n        }\n        else {\n            const note = new _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note();\n            note.pitch = newNotes[i].pitch;\n            note.instrument = newNotes[i].instrument;\n            note.quantizedStartStep = newNotes[i].quantizedStartStep;\n            note.quantizedEndStep = newNotes[i].quantizedEndStep;\n            output.notes.push(note);\n            o++;\n        }\n    }\n    return output;\n}\nfunction applySustainControlChanges(noteSequence, sustainControlNumber = 64) {\n    let MessageType;\n    (function (MessageType) {\n        MessageType[MessageType[\"SUSTAIN_ON\"] = 0] = \"SUSTAIN_ON\";\n        MessageType[MessageType[\"SUSTAIN_OFF\"] = 1] = \"SUSTAIN_OFF\";\n        MessageType[MessageType[\"NOTE_ON\"] = 2] = \"NOTE_ON\";\n        MessageType[MessageType[\"NOTE_OFF\"] = 3] = \"NOTE_OFF\";\n    })(MessageType || (MessageType = {}));\n    const isQuantized = isQuantizedSequence(noteSequence);\n    if (isQuantized) {\n        throw new Error('Can only apply sustain to unquantized NoteSequence.');\n    }\n    const sequence = clone(noteSequence);\n    const events = [];\n    for (const note of sequence.notes) {\n        if (note.isDrum === false) {\n            if (note.startTime !== null) {\n                events.push({\n                    time: note.startTime,\n                    type: MessageType.NOTE_ON,\n                    event: note\n                });\n            }\n            if (note.endTime !== null) {\n                events.push({\n                    time: note.endTime,\n                    type: MessageType.NOTE_OFF,\n                    event: note\n                });\n            }\n        }\n    }\n    for (const cc of sequence.controlChanges) {\n        if (cc.controlNumber === sustainControlNumber) {\n            const value = cc.controlValue;\n            if ((value < 0) || (value > 127)) {\n            }\n            if (value >= 64) {\n                events.push({\n                    time: cc.time,\n                    type: MessageType.SUSTAIN_ON,\n                    event: cc\n                });\n            }\n            else if (value < 64) {\n                events.push({\n                    time: cc.time,\n                    type: MessageType.SUSTAIN_OFF,\n                    event: cc\n                });\n            }\n        }\n    }\n    events.sort((a, b) => a.time - b.time);\n    const activeNotes = {};\n    const susActive = {};\n    let time = 0;\n    for (const item of events) {\n        time = item.time;\n        const type = item.type;\n        const event = item.event;\n        if (type === MessageType.SUSTAIN_ON) {\n            susActive[event.instrument] = true;\n        }\n        else if (type === MessageType.SUSTAIN_OFF) {\n            susActive[event.instrument] = false;\n            const newActiveNotes = [];\n            if (!(event.instrument in activeNotes)) {\n                activeNotes[event.instrument] = [];\n            }\n            for (const note of activeNotes[event.instrument]) {\n                if (note.endTime < time) {\n                    note.endTime = time;\n                    if (time > sequence.totalTime) {\n                        sequence.totalTime = time;\n                    }\n                }\n                else {\n                    newActiveNotes.push(note);\n                }\n            }\n            activeNotes[event.instrument] = newActiveNotes;\n        }\n        else if (type === MessageType.NOTE_ON) {\n            if (susActive[event.instrument] === true) {\n                const newActiveNotes = [];\n                if (!(event.instrument in activeNotes)) {\n                    activeNotes[event.instrument] = [];\n                }\n                for (const note of activeNotes[event.instrument]) {\n                    if (note.pitch === event.pitch) {\n                        note.endTime = time;\n                        if (note.startTime === note.endTime) {\n                            sequence.notes.push(note);\n                        }\n                    }\n                    else {\n                        newActiveNotes.push(note);\n                    }\n                }\n                activeNotes[event.instrument] = newActiveNotes;\n            }\n            if (!(event.instrument in activeNotes)) {\n                activeNotes[event.instrument] = [];\n            }\n            activeNotes[event.instrument].push(event);\n        }\n        else if (type === MessageType.NOTE_OFF) {\n            if (susActive[event.instrument] === true) {\n            }\n            else {\n                const index = activeNotes[event.instrument].indexOf(event);\n                if (index > -1) {\n                    activeNotes[event.instrument].splice(index, 1);\n                }\n            }\n        }\n    }\n    for (const instrument of Object.values(activeNotes)) {\n        for (const note of instrument) {\n            note.endTime = time;\n            sequence.totalTime = time;\n        }\n    }\n    return sequence;\n}\nfunction concatenate(concatenateSequences, sequenceDurations) {\n    if (sequenceDurations &&\n        sequenceDurations.length !== concatenateSequences.length) {\n        throw new Error(`Number of sequences to concatenate and their individual\n durations does not match.`);\n    }\n    if (isQuantizedSequence(concatenateSequences[0])) {\n        for (let i = 0; i < concatenateSequences.length; ++i) {\n            assertIsQuantizedSequence(concatenateSequences[i]);\n            if (concatenateSequences[i].quantizationInfo.stepsPerQuarter !==\n                concatenateSequences[0].quantizationInfo.stepsPerQuarter) {\n                throw new Error('Not all sequences have the same quantizationInfo');\n            }\n        }\n        return concatenateHelper(concatenateSequences, 'totalQuantizedSteps', 'quantizedStartStep', 'quantizedEndStep', sequenceDurations);\n    }\n    else {\n        return concatenateHelper(concatenateSequences, 'totalTime', 'startTime', 'endTime', sequenceDurations);\n    }\n}\nfunction trim(ns, start, end, truncateEndNotes) {\n    return isQuantizedSequence(ns) ?\n        trimHelper(ns, start, end, 'totalQuantizedSteps', 'quantizedStartStep', 'quantizedEndStep', truncateEndNotes) :\n        trimHelper(ns, start, end, 'totalTime', 'startTime', 'endTime', truncateEndNotes);\n}\nfunction concatenateHelper(seqs, totalKey, startKey, endKey, sequenceDurations) {\n    let concatSeq;\n    let totalDuration = 0;\n    for (let i = 0; i < seqs.length; ++i) {\n        const seqDuration = sequenceDurations ? sequenceDurations[i] : seqs[i][totalKey];\n        if (seqDuration === 0) {\n            throw Error(`Sequence ${seqs[i].id} has no ${totalKey}, and no individual duration was provided.`);\n        }\n        if (i === 0) {\n            concatSeq = clone(seqs[0]);\n        }\n        else {\n            Array.prototype.push.apply(concatSeq.notes, seqs[i].notes.map(n => {\n                const newN = _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create(n);\n                newN[startKey] += totalDuration;\n                newN[endKey] += totalDuration;\n                return newN;\n            }));\n        }\n        totalDuration += seqDuration;\n    }\n    concatSeq[totalKey] = totalDuration;\n    return concatSeq;\n}\nfunction trimHelper(ns, start, end, totalKey, startKey, endKey, truncateEndNotes) {\n    const result = clone(ns);\n    result[totalKey] = end;\n    result.notes = result.notes.filter(n => n[startKey] >= start && n[startKey] <= end &&\n        (truncateEndNotes || n[endKey] <= end));\n    result[totalKey] -= start;\n    for (let i = 0; i < result.notes.length; i++) {\n        result.notes[i][startKey] -= start;\n        result.notes[i][endKey] -= start;\n        if (truncateEndNotes) {\n            result.notes[i][endKey] = Math.min(result.notes[i][endKey], result[totalKey]);\n        }\n    }\n    return result;\n}\nfunction split(seq, chunkSize) {\n    assertIsQuantizedSequence(seq);\n    const ns = clone(seq);\n    const notesBystartStep = ns.notes.sort((a, b) => a.quantizedStartStep - b.quantizedStartStep);\n    const chunks = [];\n    let startStep = 0;\n    let currentNotes = [];\n    for (let i = 0; i < notesBystartStep.length; i++) {\n        const note = notesBystartStep[i];\n        const originalStartStep = note.quantizedStartStep;\n        const originalEndStep = note.quantizedEndStep;\n        note.quantizedStartStep -= startStep;\n        note.quantizedEndStep -= startStep;\n        if (note.quantizedStartStep < 0) {\n            continue;\n        }\n        if (note.quantizedEndStep <= chunkSize) {\n            currentNotes.push(note);\n        }\n        else {\n            if (note.quantizedStartStep < chunkSize) {\n                const newNote = _protobuf_index__WEBPACK_IMPORTED_MODULE_0__.NoteSequence.Note.create(note);\n                newNote.quantizedEndStep = chunkSize;\n                newNote.startTime = newNote.endTime = undefined;\n                currentNotes.push(newNote);\n                note.quantizedStartStep = startStep + chunkSize;\n                note.quantizedEndStep = originalEndStep;\n            }\n            else {\n                note.quantizedStartStep = originalStartStep;\n                note.quantizedEndStep = originalEndStep;\n            }\n            if (note.quantizedEndStep > chunkSize ||\n                note.quantizedStartStep > chunkSize) {\n                i = i - 1;\n            }\n            if (currentNotes.length !== 0) {\n                const newSequence = clone(ns);\n                newSequence.notes = currentNotes;\n                newSequence.totalQuantizedSteps = chunkSize;\n                chunks.push(newSequence);\n            }\n            currentNotes = [];\n            startStep += chunkSize;\n        }\n    }\n    if (currentNotes.length !== 0) {\n        const newSequence = clone(ns);\n        newSequence.notes = currentNotes;\n        newSequence.totalQuantizedSteps = chunkSize;\n        chunks.push(newSequence);\n    }\n    return chunks;\n}\n//# sourceMappingURL=sequences.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9zZXF1ZW5jZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBaUQ7QUFDUjtBQUN6QztBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsV0FBVyx5REFBWSxRQUFRLHlEQUFZO0FBQzNDO0FBQ087QUFDUDtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsd0JBQXdCO0FBQzNDLG1CQUFtQixzQkFBc0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSxvQkFBb0I7QUFDbkc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsbUVBQXFDO0FBQ2xFO0FBQ0EsZUFBZSxtRUFBcUMsRUFBRTtBQUN0RCxlQUFlLGtCQUFrQixTQUFTLG1CQUFtQjtBQUM3RDtBQUNBLG9CQUFvQixzQkFBc0I7QUFDMUM7QUFDQTtBQUNBLG1CQUFtQixrQkFBa0IsU0FBUyxpQkFBaUI7QUFDL0QsMEJBQTBCLG1CQUFtQjtBQUM3QztBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSxRQUFRLHlEQUFZLDJCQUEyQixpQkFBaUI7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9jb3JlL3NlcXVlbmNlcy5qcz9hN2VjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vdGVTZXF1ZW5jZSB9IGZyb20gJy4uL3Byb3RvYnVmL2luZGV4JztcbmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5jb25zdCBRVUFOVElaRV9DVVRPRkYgPSAwLjU7XG5leHBvcnQgY2xhc3MgTXVsdGlwbGVUaW1lU2lnbmF0dXJlRXhjZXB0aW9uIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEJhZFRpbWVTaWduYXR1cmVFeGNlcHRpb24gZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTmVnYXRpdmVUaW1lRXhjZXB0aW9uIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIE11bHRpcGxlVGVtcG9FeGNlcHRpb24gZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIG5ldy50YXJnZXQucHJvdG90eXBlKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUXVhbnRpemF0aW9uU3RhdHVzRXhjZXB0aW9uIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNQb3dlck9mMihuKSB7XG4gICAgcmV0dXJuIG4gJiYgKG4gJiAobiAtIDEpKSA9PT0gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjbG9uZShucykge1xuICAgIHJldHVybiBOb3RlU2VxdWVuY2UuZGVjb2RlKE5vdGVTZXF1ZW5jZS5lbmNvZGUobnMpLmZpbmlzaCgpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdGVwc1BlclF1YXJ0ZXJUb1N0ZXBzUGVyU2Vjb25kKHN0ZXBzUGVyUXVhcnRlciwgcXBtKSB7XG4gICAgcmV0dXJuIHN0ZXBzUGVyUXVhcnRlciAqIHFwbSAvIDYwLjA7XG59XG5leHBvcnQgZnVuY3Rpb24gcXVhbnRpemVUb1N0ZXAodW5xdWFudGl6ZWRTZWNvbmRzLCBzdGVwc1BlclNlY29uZCwgcXVhbnRpemVDdXRvZmYgPSBRVUFOVElaRV9DVVRPRkYpIHtcbiAgICBjb25zdCB1bnF1YW50aXplZFN0ZXBzID0gdW5xdWFudGl6ZWRTZWNvbmRzICogc3RlcHNQZXJTZWNvbmQ7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodW5xdWFudGl6ZWRTdGVwcyArICgxIC0gcXVhbnRpemVDdXRvZmYpKTtcbn1cbmZ1bmN0aW9uIGdldFF1YW50aXplZFRpbWVFdmVudHMobnMpIHtcbiAgICByZXR1cm4gbnMuY29udHJvbENoYW5nZXMuY29uY2F0KG5zLnRleHRBbm5vdGF0aW9ucyk7XG59XG5mdW5jdGlvbiBxdWFudGl6ZU5vdGVzQW5kRXZlbnRzKG5zLCBzdGVwc1BlclNlY29uZCkge1xuICAgIGZvciAoY29uc3Qgbm90ZSBvZiBucy5ub3Rlcykge1xuICAgICAgICBub3RlLnF1YW50aXplZFN0YXJ0U3RlcCA9IHF1YW50aXplVG9TdGVwKG5vdGUuc3RhcnRUaW1lLCBzdGVwc1BlclNlY29uZCk7XG4gICAgICAgIG5vdGUucXVhbnRpemVkRW5kU3RlcCA9IHF1YW50aXplVG9TdGVwKG5vdGUuZW5kVGltZSwgc3RlcHNQZXJTZWNvbmQpO1xuICAgICAgICBpZiAobm90ZS5xdWFudGl6ZWRFbmRTdGVwID09PSBub3RlLnF1YW50aXplZFN0YXJ0U3RlcCkge1xuICAgICAgICAgICAgbm90ZS5xdWFudGl6ZWRFbmRTdGVwICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vdGUucXVhbnRpemVkU3RhcnRTdGVwIDwgMCB8fCBub3RlLnF1YW50aXplZEVuZFN0ZXAgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTmVnYXRpdmVUaW1lRXhjZXB0aW9uKGBHb3QgbmVnYXRpdmUgbm90ZSB0aW1lOiBzdGFydF9zdGVwID0gYCArXG4gICAgICAgICAgICAgICAgYCR7bm90ZS5xdWFudGl6ZWRTdGFydFN0ZXB9LCBlbmRfc3RlcCA9IGAgK1xuICAgICAgICAgICAgICAgIGAke25vdGUucXVhbnRpemVkRW5kU3RlcH1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm90ZS5xdWFudGl6ZWRFbmRTdGVwID4gbnMudG90YWxRdWFudGl6ZWRTdGVwcykge1xuICAgICAgICAgICAgbnMudG90YWxRdWFudGl6ZWRTdGVwcyA9IG5vdGUucXVhbnRpemVkRW5kU3RlcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRRdWFudGl6ZWRUaW1lRXZlbnRzKG5zKS5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgICAgZXZlbnQucXVhbnRpemVkU3RlcCA9IHF1YW50aXplVG9TdGVwKGV2ZW50LnRpbWUsIHN0ZXBzUGVyU2Vjb25kKTtcbiAgICAgICAgaWYgKGV2ZW50LnF1YW50aXplZFN0ZXAgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTmVnYXRpdmVUaW1lRXhjZXB0aW9uKGBHb3QgbmVnYXRpdmUgZXZlbnQgdGltZTogc3RlcCA9ICR7ZXZlbnQucXVhbnRpemVkU3RlcH1gKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gYXNzZXJ0U2luZ2xlVGVtcG8obnMpIHtcbiAgICBpZiAoIW5zLnRlbXBvcyB8fCBucy50ZW1wb3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbnMudGVtcG9zLnNvcnQoKGEsIGIpID0+IGEudGltZSAtIGIudGltZSk7XG4gICAgaWYgKG5zLnRlbXBvc1swXS50aW1lICE9PSAwICYmXG4gICAgICAgIG5zLnRlbXBvc1swXS5xcG0gIT09IGNvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEUpIHtcbiAgICAgICAgdGhyb3cgbmV3IE11bHRpcGxlVGVtcG9FeGNlcHRpb24oJ05vdGVTZXF1ZW5jZSBoYXMgYW4gaW1wbGljaXQgdGVtcG8gY2hhbmdlIGZyb20gaW5pdGlhbCAnICtcbiAgICAgICAgICAgIGAke2NvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEV9IHFwbSB0byBgICtcbiAgICAgICAgICAgIGAke25zLnRlbXBvc1swXS5xcG19IHFwbSBhdCAke25zLnRlbXBvc1swXS50aW1lfSBzZWNvbmRzLmApO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IG5zLnRlbXBvcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobnMudGVtcG9zW2ldLnFwbSAhPT0gbnMudGVtcG9zWzBdLnFwbSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IE11bHRpcGxlVGVtcG9FeGNlcHRpb24oJ05vdGVTZXF1ZW5jZSBoYXMgYXQgbGVhc3Qgb25lIHRlbXBvIGNoYW5nZSBmcm9tICcgK1xuICAgICAgICAgICAgICAgIGAke25zLnRlbXBvc1swXS5xcG19IHFwbSB0byAke25zLnRlbXBvc1tpXS5xcG19YCArXG4gICAgICAgICAgICAgICAgYHFwbSBhdCAke25zLnRlbXBvc1tpXS50aW1lfSBzZWNvbmRzLmApO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHF1YW50aXplTm90ZVNlcXVlbmNlKG5zLCBzdGVwc1BlclF1YXJ0ZXIpIHtcbiAgICBjb25zdCBxbnMgPSBjbG9uZShucyk7XG4gICAgcW5zLnF1YW50aXphdGlvbkluZm8gPVxuICAgICAgICBOb3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mby5jcmVhdGUoeyBzdGVwc1BlclF1YXJ0ZXIgfSk7XG4gICAgaWYgKHFucy50aW1lU2lnbmF0dXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHFucy50aW1lU2lnbmF0dXJlcy5zb3J0KChhLCBiKSA9PiBhLnRpbWUgLSBiLnRpbWUpO1xuICAgICAgICBpZiAocW5zLnRpbWVTaWduYXR1cmVzWzBdLnRpbWUgIT09IDAgJiZcbiAgICAgICAgICAgICEocW5zLnRpbWVTaWduYXR1cmVzWzBdLm51bWVyYXRvciA9PT0gNCAmJlxuICAgICAgICAgICAgICAgIHFucy50aW1lU2lnbmF0dXJlc1swXS5kZW5vbWluYXRvciA9PT0gNCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBNdWx0aXBsZVRpbWVTaWduYXR1cmVFeGNlcHRpb24oJ05vdGVTZXF1ZW5jZSBoYXMgYW4gaW1wbGljaXQgY2hhbmdlIGZyb20gaW5pdGlhbCA0LzQgdGltZSAnICtcbiAgICAgICAgICAgICAgICBgc2lnbmF0dXJlIHRvICR7cW5zLnRpbWVTaWduYXR1cmVzWzBdLm51bWVyYXRvcn0vYCArXG4gICAgICAgICAgICAgICAgYCR7cW5zLnRpbWVTaWduYXR1cmVzWzBdLmRlbm9taW5hdG9yfSBhdCBgICtcbiAgICAgICAgICAgICAgICBgJHtxbnMudGltZVNpZ25hdHVyZXNbMF0udGltZX0gc2Vjb25kcy5gKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHFucy50aW1lU2lnbmF0dXJlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdGltZVNpZ25hdHVyZSA9IHFucy50aW1lU2lnbmF0dXJlc1tpXTtcbiAgICAgICAgICAgIGlmICh0aW1lU2lnbmF0dXJlLm51bWVyYXRvciAhPT0gcW5zLnRpbWVTaWduYXR1cmVzWzBdLm51bWVyYXRvciB8fFxuICAgICAgICAgICAgICAgIHRpbWVTaWduYXR1cmUuZGVub21pbmF0b3IgIT09IHFucy50aW1lU2lnbmF0dXJlc1swXS5kZW5vbWluYXRvcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBNdWx0aXBsZVRpbWVTaWduYXR1cmVFeGNlcHRpb24oJ05vdGVTZXF1ZW5jZSBoYXMgYXQgbGVhc3Qgb25lIHRpbWUgc2lnbmF0dXJlIGNoYW5nZSBmcm9tICcgK1xuICAgICAgICAgICAgICAgICAgICBgJHtxbnMudGltZVNpZ25hdHVyZXNbMF0ubnVtZXJhdG9yfS9gICtcbiAgICAgICAgICAgICAgICAgICAgYCR7cW5zLnRpbWVTaWduYXR1cmVzWzBdLmRlbm9taW5hdG9yfSB0byBgICtcbiAgICAgICAgICAgICAgICAgICAgYCR7dGltZVNpZ25hdHVyZS5udW1lcmF0b3J9LyR7dGltZVNpZ25hdHVyZS5kZW5vbWluYXRvcn0gYCArXG4gICAgICAgICAgICAgICAgICAgIGBhdCAke3RpbWVTaWduYXR1cmUudGltZX0gc2Vjb25kc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHFucy50aW1lU2lnbmF0dXJlc1swXS50aW1lID0gMDtcbiAgICAgICAgcW5zLnRpbWVTaWduYXR1cmVzID0gW3Fucy50aW1lU2lnbmF0dXJlc1swXV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCB0aW1lU2lnbmF0dXJlID0gTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmUuY3JlYXRlKHsgbnVtZXJhdG9yOiA0LCBkZW5vbWluYXRvcjogNCwgdGltZTogMCB9KTtcbiAgICAgICAgcW5zLnRpbWVTaWduYXR1cmVzLnB1c2godGltZVNpZ25hdHVyZSk7XG4gICAgfVxuICAgIGNvbnN0IGZpcnN0VFMgPSBxbnMudGltZVNpZ25hdHVyZXNbMF07XG4gICAgaWYgKCFpc1Bvd2VyT2YyKGZpcnN0VFMuZGVub21pbmF0b3IpKSB7XG4gICAgICAgIHRocm93IG5ldyBCYWRUaW1lU2lnbmF0dXJlRXhjZXB0aW9uKCdEZW5vbWluYXRvciBpcyBub3QgYSBwb3dlciBvZiAyLiBUaW1lIHNpZ25hdHVyZTogJyArXG4gICAgICAgICAgICBgJHtmaXJzdFRTLm51bWVyYXRvcn0vJHtmaXJzdFRTLmRlbm9taW5hdG9yfWApO1xuICAgIH1cbiAgICBpZiAoZmlyc3RUUy5udW1lcmF0b3IgPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFRpbWVTaWduYXR1cmVFeGNlcHRpb24oJ051bWVyYXRvciBpcyAwLiBUaW1lIHNpZ25hdHVyZTogJyArXG4gICAgICAgICAgICBgJHtmaXJzdFRTLm51bWVyYXRvcn0vJHtmaXJzdFRTLmRlbm9taW5hdG9yfWApO1xuICAgIH1cbiAgICBpZiAocW5zLnRlbXBvcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGFzc2VydFNpbmdsZVRlbXBvKHFucyk7XG4gICAgICAgIHFucy50ZW1wb3NbMF0udGltZSA9IDA7XG4gICAgICAgIHFucy50ZW1wb3MgPSBbcW5zLnRlbXBvc1swXV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCB0ZW1wbyA9IE5vdGVTZXF1ZW5jZS5UZW1wby5jcmVhdGUoeyBxcG06IGNvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEUsIHRpbWU6IDAgfSk7XG4gICAgICAgIHFucy50ZW1wb3MucHVzaCh0ZW1wbyk7XG4gICAgfVxuICAgIGNvbnN0IHN0ZXBzUGVyU2Vjb25kID0gc3RlcHNQZXJRdWFydGVyVG9TdGVwc1BlclNlY29uZChzdGVwc1BlclF1YXJ0ZXIsIHFucy50ZW1wb3NbMF0ucXBtKTtcbiAgICBxbnMudG90YWxRdWFudGl6ZWRTdGVwcyA9IHF1YW50aXplVG9TdGVwKG5zLnRvdGFsVGltZSwgc3RlcHNQZXJTZWNvbmQpO1xuICAgIHF1YW50aXplTm90ZXNBbmRFdmVudHMocW5zLCBzdGVwc1BlclNlY29uZCk7XG4gICAgcmV0dXJuIHFucztcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc1F1YW50aXplZFNlcXVlbmNlKG5zKSB7XG4gICAgcmV0dXJuIG5zLnF1YW50aXphdGlvbkluZm8gJiZcbiAgICAgICAgKG5zLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyID4gMCB8fFxuICAgICAgICAgICAgbnMucXVhbnRpemF0aW9uSW5mby5zdGVwc1BlclNlY29uZCA+IDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydElzUXVhbnRpemVkU2VxdWVuY2UobnMpIHtcbiAgICBpZiAoIWlzUXVhbnRpemVkU2VxdWVuY2UobnMpKSB7XG4gICAgICAgIHRocm93IG5ldyBRdWFudGl6YXRpb25TdGF0dXNFeGNlcHRpb24oYE5vdGVTZXF1ZW5jZSAke25zLmlkfSBpcyBub3QgcXVhbnRpemVkIChtaXNzaW5nIHF1YW50aXphdGlvbkluZm8pYCk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVsYXRpdmVRdWFudGl6ZWRTZXF1ZW5jZShucykge1xuICAgIHJldHVybiBucy5xdWFudGl6YXRpb25JbmZvICYmIG5zLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyID4gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRJc1JlbGF0aXZlUXVhbnRpemVkU2VxdWVuY2UobnMpIHtcbiAgICBpZiAoIWlzUmVsYXRpdmVRdWFudGl6ZWRTZXF1ZW5jZShucykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFF1YW50aXphdGlvblN0YXR1c0V4Y2VwdGlvbihgTm90ZVNlcXVlbmNlICR7bnMuaWR9IGlzIG5vdCBxdWFudGl6ZWQgb3IgaXMgcXVhbnRpemVkIGJhc2VkIG9uIGFic29sdXRlIHRpbWluZ2ApO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0Fic29sdXRlUXVhbnRpemVkU2VxdWVuY2UobnMpIHtcbiAgICByZXR1cm4gbnMucXVhbnRpemF0aW9uSW5mbyAmJiBucy5xdWFudGl6YXRpb25JbmZvLnN0ZXBzUGVyU2Vjb25kID4gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRJc0Fic29sdXRlUXVhbnRpemVkU2VxdWVuY2UobnMpIHtcbiAgICBpZiAoIWlzQWJzb2x1dGVRdWFudGl6ZWRTZXF1ZW5jZShucykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFF1YW50aXphdGlvblN0YXR1c0V4Y2VwdGlvbihgTm90ZVNlcXVlbmNlICR7bnMuaWR9IGlzIG5vdCBxdWFudGl6ZWQgb3IgaXMgcXVhbnRpemVkIGJhc2VkIG9uIHJlbGF0aXZlIHRpbWluZ2ApO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB1bnF1YW50aXplU2VxdWVuY2UocW5zLCBxcG0pIHtcbiAgICBhc3NlcnRJc1JlbGF0aXZlUXVhbnRpemVkU2VxdWVuY2UocW5zKTtcbiAgICBhc3NlcnRTaW5nbGVUZW1wbyhxbnMpO1xuICAgIGNvbnN0IG5zID0gY2xvbmUocW5zKTtcbiAgICBpZiAocXBtKSB7XG4gICAgICAgIGlmIChucy50ZW1wb3MgJiYgbnMudGVtcG9zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG5zLnRlbXBvc1swXS5xcG0gPSBxcG07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBucy50ZW1wb3MucHVzaChOb3RlU2VxdWVuY2UuVGVtcG8uY3JlYXRlKHsgdGltZTogMCwgcXBtIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcXBtID0gKHFucy50ZW1wb3MgJiYgcW5zLnRlbXBvcy5sZW5ndGggPiAwKSA/XG4gICAgICAgICAgICBucy50ZW1wb3NbMF0ucXBtIDpcbiAgICAgICAgICAgIGNvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEU7XG4gICAgfVxuICAgIGNvbnN0IHN0ZXBUb1NlY29uZHMgPSAoc3RlcCkgPT4gc3RlcCAvIG5zLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyICogKDYwIC8gcXBtKTtcbiAgICBucy50b3RhbFRpbWUgPSBzdGVwVG9TZWNvbmRzKG5zLnRvdGFsUXVhbnRpemVkU3RlcHMpO1xuICAgIG5zLm5vdGVzLmZvckVhY2gobiA9PiB7XG4gICAgICAgIG4uc3RhcnRUaW1lID0gc3RlcFRvU2Vjb25kcyhuLnF1YW50aXplZFN0YXJ0U3RlcCk7XG4gICAgICAgIG4uZW5kVGltZSA9IHN0ZXBUb1NlY29uZHMobi5xdWFudGl6ZWRFbmRTdGVwKTtcbiAgICAgICAgbnMudG90YWxUaW1lID0gTWF0aC5tYXgobnMudG90YWxUaW1lLCBuLmVuZFRpbWUpO1xuICAgICAgICBkZWxldGUgbi5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgIGRlbGV0ZSBuLnF1YW50aXplZEVuZFN0ZXA7XG4gICAgfSk7XG4gICAgZ2V0UXVhbnRpemVkVGltZUV2ZW50cyhucykuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnRpbWUgPSBzdGVwVG9TZWNvbmRzKGV2ZW50LnRpbWUpO1xuICAgIH0pO1xuICAgIGRlbGV0ZSBucy50b3RhbFF1YW50aXplZFN0ZXBzO1xuICAgIGRlbGV0ZSBucy5xdWFudGl6YXRpb25JbmZvO1xuICAgIHJldHVybiBucztcbn1cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVRdWFudGl6ZWROb3RlU2VxdWVuY2Uoc3RlcHNQZXJRdWFydGVyID0gY29uc3RhbnRzLkRFRkFVTFRfU1RFUFNfUEVSX1FVQVJURVIsIHFwbSA9IGNvbnN0YW50cy5ERUZBVUxUX1FVQVJURVJTX1BFUl9NSU5VVEUpIHtcbiAgICByZXR1cm4gTm90ZVNlcXVlbmNlLmNyZWF0ZSh7IHF1YW50aXphdGlvbkluZm86IHsgc3RlcHNQZXJRdWFydGVyIH0sIHRlbXBvczogW3sgcXBtIH1dIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlSW5zdHJ1bWVudHMobnMpIHtcbiAgICBjb25zdCByZXN1bHQgPSBjbG9uZShucyk7XG4gICAgY29uc3QgZXZlbnRzID0gcmVzdWx0Lm5vdGVzLmNvbmNhdChyZXN1bHQucGl0Y2hCZW5kcykuY29uY2F0KHJlc3VsdC5jb250cm9sQ2hhbmdlcyk7XG4gICAgY29uc3QgcHJvZ3JhbXMgPSBBcnJheS5mcm9tKG5ldyBTZXQoZXZlbnRzLmZpbHRlcihlID0+ICFlLmlzRHJ1bSkubWFwKGUgPT4gZS5wcm9ncmFtKSkpO1xuICAgIGV2ZW50cy5mb3JFYWNoKGUgPT4ge1xuICAgICAgICBpZiAoZS5pc0RydW0pIHtcbiAgICAgICAgICAgIGUucHJvZ3JhbSA9IDA7XG4gICAgICAgICAgICBlLmluc3RydW1lbnQgPSBwcm9ncmFtcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlLmluc3RydW1lbnQgPSBwcm9ncmFtcy5pbmRleE9mKGUucHJvZ3JhbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2VJbnN0cnVtZW50cyhvcmlnaW5hbFNlcXVlbmNlLCByZXBsYWNlU2VxdWVuY2UpIHtcbiAgICBjb25zdCBpbnN0cnVtZW50c0luT3JpZ2luYWwgPSBuZXcgU2V0KG9yaWdpbmFsU2VxdWVuY2Uubm90ZXMubWFwKG4gPT4gbi5pbnN0cnVtZW50KSk7XG4gICAgY29uc3QgaW5zdHJ1bWVudHNJblJlcGxhY2UgPSBuZXcgU2V0KHJlcGxhY2VTZXF1ZW5jZS5ub3Rlcy5tYXAobiA9PiBuLmluc3RydW1lbnQpKTtcbiAgICBjb25zdCBuZXdOb3RlcyA9IFtdO1xuICAgIG9yaWdpbmFsU2VxdWVuY2Uubm90ZXMuZm9yRWFjaChuID0+IHtcbiAgICAgICAgaWYgKCFpbnN0cnVtZW50c0luUmVwbGFjZS5oYXMobi5pbnN0cnVtZW50KSkge1xuICAgICAgICAgICAgbmV3Tm90ZXMucHVzaChOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUobikpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmVwbGFjZVNlcXVlbmNlLm5vdGVzLmZvckVhY2gobiA9PiB7XG4gICAgICAgIGlmIChpbnN0cnVtZW50c0luT3JpZ2luYWwuaGFzKG4uaW5zdHJ1bWVudCkpIHtcbiAgICAgICAgICAgIG5ld05vdGVzLnB1c2goTm90ZVNlcXVlbmNlLk5vdGUuY3JlYXRlKG4pKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IG91dHB1dCA9IGNsb25lKG9yaWdpbmFsU2VxdWVuY2UpO1xuICAgIG91dHB1dC5ub3RlcyA9IG5ld05vdGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3Qgdm9pY2VDb21wYXJlID0gYS5pbnN0cnVtZW50IC0gYi5pbnN0cnVtZW50O1xuICAgICAgICBpZiAodm9pY2VDb21wYXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gdm9pY2VDb21wYXJlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhLnF1YW50aXplZFN0YXJ0U3RlcCAtIGIucXVhbnRpemVkU3RhcnRTdGVwO1xuICAgIH0pO1xuICAgIHJldHVybiBvdXRwdXQ7XG59XG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VDb25zZWN1dGl2ZU5vdGVzKHNlcXVlbmNlKSB7XG4gICAgYXNzZXJ0SXNRdWFudGl6ZWRTZXF1ZW5jZShzZXF1ZW5jZSk7XG4gICAgY29uc3Qgb3V0cHV0ID0gY2xvbmUoc2VxdWVuY2UpO1xuICAgIG91dHB1dC5ub3RlcyA9IFtdO1xuICAgIGNvbnN0IG5ld05vdGVzID0gc2VxdWVuY2Uubm90ZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBjb25zdCB2b2ljZUNvbXBhcmUgPSBhLmluc3RydW1lbnQgLSBiLmluc3RydW1lbnQ7XG4gICAgICAgIGlmICh2b2ljZUNvbXBhcmUpIHtcbiAgICAgICAgICAgIHJldHVybiB2b2ljZUNvbXBhcmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGEucXVhbnRpemVkU3RhcnRTdGVwIC0gYi5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgfSk7XG4gICAgY29uc3Qgbm90ZSA9IG5ldyBOb3RlU2VxdWVuY2UuTm90ZSgpO1xuICAgIG5vdGUucGl0Y2ggPSBuZXdOb3Rlc1swXS5waXRjaDtcbiAgICBub3RlLmluc3RydW1lbnQgPSBuZXdOb3Rlc1swXS5pbnN0cnVtZW50O1xuICAgIG5vdGUucXVhbnRpemVkU3RhcnRTdGVwID0gbmV3Tm90ZXNbMF0ucXVhbnRpemVkU3RhcnRTdGVwO1xuICAgIG5vdGUucXVhbnRpemVkRW5kU3RlcCA9IG5ld05vdGVzWzBdLnF1YW50aXplZEVuZFN0ZXA7XG4gICAgb3V0cHV0Lm5vdGVzLnB1c2gobm90ZSk7XG4gICAgbGV0IG8gPSAwO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbmV3Tm90ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgdGhpc05vdGUgPSBuZXdOb3Rlc1tpXTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNOb3RlID0gb3V0cHV0Lm5vdGVzW29dO1xuICAgICAgICBpZiAocHJldmlvdXNOb3RlLmluc3RydW1lbnQgPT09IHRoaXNOb3RlLmluc3RydW1lbnQgJiZcbiAgICAgICAgICAgIHByZXZpb3VzTm90ZS5waXRjaCA9PT0gdGhpc05vdGUucGl0Y2ggJiZcbiAgICAgICAgICAgIHRoaXNOb3RlLnF1YW50aXplZFN0YXJ0U3RlcCA9PT0gcHJldmlvdXNOb3RlLnF1YW50aXplZEVuZFN0ZXAgJiZcbiAgICAgICAgICAgIHRoaXNOb3RlLnF1YW50aXplZFN0YXJ0U3RlcCAlIDE2ICE9PSAwKSB7XG4gICAgICAgICAgICBvdXRwdXQubm90ZXNbb10ucXVhbnRpemVkRW5kU3RlcCArPVxuICAgICAgICAgICAgICAgIHRoaXNOb3RlLnF1YW50aXplZEVuZFN0ZXAgLSB0aGlzTm90ZS5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBub3RlID0gbmV3IE5vdGVTZXF1ZW5jZS5Ob3RlKCk7XG4gICAgICAgICAgICBub3RlLnBpdGNoID0gbmV3Tm90ZXNbaV0ucGl0Y2g7XG4gICAgICAgICAgICBub3RlLmluc3RydW1lbnQgPSBuZXdOb3Rlc1tpXS5pbnN0cnVtZW50O1xuICAgICAgICAgICAgbm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAgPSBuZXdOb3Rlc1tpXS5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgICAgICBub3RlLnF1YW50aXplZEVuZFN0ZXAgPSBuZXdOb3Rlc1tpXS5xdWFudGl6ZWRFbmRTdGVwO1xuICAgICAgICAgICAgb3V0cHV0Lm5vdGVzLnB1c2gobm90ZSk7XG4gICAgICAgICAgICBvKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG91dHB1dDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVN1c3RhaW5Db250cm9sQ2hhbmdlcyhub3RlU2VxdWVuY2UsIHN1c3RhaW5Db250cm9sTnVtYmVyID0gNjQpIHtcbiAgICBsZXQgTWVzc2FnZVR5cGU7XG4gICAgKGZ1bmN0aW9uIChNZXNzYWdlVHlwZSkge1xuICAgICAgICBNZXNzYWdlVHlwZVtNZXNzYWdlVHlwZVtcIlNVU1RBSU5fT05cIl0gPSAwXSA9IFwiU1VTVEFJTl9PTlwiO1xuICAgICAgICBNZXNzYWdlVHlwZVtNZXNzYWdlVHlwZVtcIlNVU1RBSU5fT0ZGXCJdID0gMV0gPSBcIlNVU1RBSU5fT0ZGXCI7XG4gICAgICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiTk9URV9PTlwiXSA9IDJdID0gXCJOT1RFX09OXCI7XG4gICAgICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiTk9URV9PRkZcIl0gPSAzXSA9IFwiTk9URV9PRkZcIjtcbiAgICB9KShNZXNzYWdlVHlwZSB8fCAoTWVzc2FnZVR5cGUgPSB7fSkpO1xuICAgIGNvbnN0IGlzUXVhbnRpemVkID0gaXNRdWFudGl6ZWRTZXF1ZW5jZShub3RlU2VxdWVuY2UpO1xuICAgIGlmIChpc1F1YW50aXplZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IGFwcGx5IHN1c3RhaW4gdG8gdW5xdWFudGl6ZWQgTm90ZVNlcXVlbmNlLicpO1xuICAgIH1cbiAgICBjb25zdCBzZXF1ZW5jZSA9IGNsb25lKG5vdGVTZXF1ZW5jZSk7XG4gICAgY29uc3QgZXZlbnRzID0gW107XG4gICAgZm9yIChjb25zdCBub3RlIG9mIHNlcXVlbmNlLm5vdGVzKSB7XG4gICAgICAgIGlmIChub3RlLmlzRHJ1bSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChub3RlLnN0YXJ0VGltZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGV2ZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGltZTogbm90ZS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IE1lc3NhZ2VUeXBlLk5PVEVfT04sXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiBub3RlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm90ZS5lbmRUaW1lICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiBub3RlLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IE1lc3NhZ2VUeXBlLk5PVEVfT0ZGLFxuICAgICAgICAgICAgICAgICAgICBldmVudDogbm90ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAoY29uc3QgY2Mgb2Ygc2VxdWVuY2UuY29udHJvbENoYW5nZXMpIHtcbiAgICAgICAgaWYgKGNjLmNvbnRyb2xOdW1iZXIgPT09IHN1c3RhaW5Db250cm9sTnVtYmVyKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNjLmNvbnRyb2xWYWx1ZTtcbiAgICAgICAgICAgIGlmICgodmFsdWUgPCAwKSB8fCAodmFsdWUgPiAxMjcpKSB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUgPj0gNjQpIHtcbiAgICAgICAgICAgICAgICBldmVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IGNjLnRpbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IE1lc3NhZ2VUeXBlLlNVU1RBSU5fT04sXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiBjY1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCA2NCkge1xuICAgICAgICAgICAgICAgIGV2ZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGltZTogY2MudGltZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogTWVzc2FnZVR5cGUuU1VTVEFJTl9PRkYsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiBjY1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGV2ZW50cy5zb3J0KChhLCBiKSA9PiBhLnRpbWUgLSBiLnRpbWUpO1xuICAgIGNvbnN0IGFjdGl2ZU5vdGVzID0ge307XG4gICAgY29uc3Qgc3VzQWN0aXZlID0ge307XG4gICAgbGV0IHRpbWUgPSAwO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBldmVudHMpIHtcbiAgICAgICAgdGltZSA9IGl0ZW0udGltZTtcbiAgICAgICAgY29uc3QgdHlwZSA9IGl0ZW0udHlwZTtcbiAgICAgICAgY29uc3QgZXZlbnQgPSBpdGVtLmV2ZW50O1xuICAgICAgICBpZiAodHlwZSA9PT0gTWVzc2FnZVR5cGUuU1VTVEFJTl9PTikge1xuICAgICAgICAgICAgc3VzQWN0aXZlW2V2ZW50Lmluc3RydW1lbnRdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlID09PSBNZXNzYWdlVHlwZS5TVVNUQUlOX09GRikge1xuICAgICAgICAgICAgc3VzQWN0aXZlW2V2ZW50Lmluc3RydW1lbnRdID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zdCBuZXdBY3RpdmVOb3RlcyA9IFtdO1xuICAgICAgICAgICAgaWYgKCEoZXZlbnQuaW5zdHJ1bWVudCBpbiBhY3RpdmVOb3RlcykpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVOb3Rlc1tldmVudC5pbnN0cnVtZW50XSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBub3RlIG9mIGFjdGl2ZU5vdGVzW2V2ZW50Lmluc3RydW1lbnRdKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGUuZW5kVGltZSA8IHRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90ZS5lbmRUaW1lID0gdGltZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWUgPiBzZXF1ZW5jZS50b3RhbFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlLnRvdGFsVGltZSA9IHRpbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vdGVzLnB1c2gobm90ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWN0aXZlTm90ZXNbZXZlbnQuaW5zdHJ1bWVudF0gPSBuZXdBY3RpdmVOb3RlcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlID09PSBNZXNzYWdlVHlwZS5OT1RFX09OKSB7XG4gICAgICAgICAgICBpZiAoc3VzQWN0aXZlW2V2ZW50Lmluc3RydW1lbnRdID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3QWN0aXZlTm90ZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIShldmVudC5pbnN0cnVtZW50IGluIGFjdGl2ZU5vdGVzKSkge1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVOb3Rlc1tldmVudC5pbnN0cnVtZW50XSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vdGUgb2YgYWN0aXZlTm90ZXNbZXZlbnQuaW5zdHJ1bWVudF0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vdGUucGl0Y2ggPT09IGV2ZW50LnBpdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlLmVuZFRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vdGUuc3RhcnRUaW1lID09PSBub3RlLmVuZFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZS5ub3Rlcy5wdXNoKG5vdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZlTm90ZXMucHVzaChub3RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhY3RpdmVOb3Rlc1tldmVudC5pbnN0cnVtZW50XSA9IG5ld0FjdGl2ZU5vdGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEoZXZlbnQuaW5zdHJ1bWVudCBpbiBhY3RpdmVOb3RlcykpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVOb3Rlc1tldmVudC5pbnN0cnVtZW50XSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWN0aXZlTm90ZXNbZXZlbnQuaW5zdHJ1bWVudF0ucHVzaChldmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gTWVzc2FnZVR5cGUuTk9URV9PRkYpIHtcbiAgICAgICAgICAgIGlmIChzdXNBY3RpdmVbZXZlbnQuaW5zdHJ1bWVudF0gPT09IHRydWUpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYWN0aXZlTm90ZXNbZXZlbnQuaW5zdHJ1bWVudF0uaW5kZXhPZihldmVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlTm90ZXNbZXZlbnQuaW5zdHJ1bWVudF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBpbnN0cnVtZW50IG9mIE9iamVjdC52YWx1ZXMoYWN0aXZlTm90ZXMpKSB7XG4gICAgICAgIGZvciAoY29uc3Qgbm90ZSBvZiBpbnN0cnVtZW50KSB7XG4gICAgICAgICAgICBub3RlLmVuZFRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgc2VxdWVuY2UudG90YWxUaW1lID0gdGltZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc2VxdWVuY2U7XG59XG5leHBvcnQgZnVuY3Rpb24gY29uY2F0ZW5hdGUoY29uY2F0ZW5hdGVTZXF1ZW5jZXMsIHNlcXVlbmNlRHVyYXRpb25zKSB7XG4gICAgaWYgKHNlcXVlbmNlRHVyYXRpb25zICYmXG4gICAgICAgIHNlcXVlbmNlRHVyYXRpb25zLmxlbmd0aCAhPT0gY29uY2F0ZW5hdGVTZXF1ZW5jZXMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTnVtYmVyIG9mIHNlcXVlbmNlcyB0byBjb25jYXRlbmF0ZSBhbmQgdGhlaXIgaW5kaXZpZHVhbFxuIGR1cmF0aW9ucyBkb2VzIG5vdCBtYXRjaC5gKTtcbiAgICB9XG4gICAgaWYgKGlzUXVhbnRpemVkU2VxdWVuY2UoY29uY2F0ZW5hdGVTZXF1ZW5jZXNbMF0pKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29uY2F0ZW5hdGVTZXF1ZW5jZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGFzc2VydElzUXVhbnRpemVkU2VxdWVuY2UoY29uY2F0ZW5hdGVTZXF1ZW5jZXNbaV0pO1xuICAgICAgICAgICAgaWYgKGNvbmNhdGVuYXRlU2VxdWVuY2VzW2ldLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyICE9PVxuICAgICAgICAgICAgICAgIGNvbmNhdGVuYXRlU2VxdWVuY2VzWzBdLnF1YW50aXphdGlvbkluZm8uc3RlcHNQZXJRdWFydGVyKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgYWxsIHNlcXVlbmNlcyBoYXZlIHRoZSBzYW1lIHF1YW50aXphdGlvbkluZm8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uY2F0ZW5hdGVIZWxwZXIoY29uY2F0ZW5hdGVTZXF1ZW5jZXMsICd0b3RhbFF1YW50aXplZFN0ZXBzJywgJ3F1YW50aXplZFN0YXJ0U3RlcCcsICdxdWFudGl6ZWRFbmRTdGVwJywgc2VxdWVuY2VEdXJhdGlvbnMpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvbmNhdGVuYXRlSGVscGVyKGNvbmNhdGVuYXRlU2VxdWVuY2VzLCAndG90YWxUaW1lJywgJ3N0YXJ0VGltZScsICdlbmRUaW1lJywgc2VxdWVuY2VEdXJhdGlvbnMpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltKG5zLCBzdGFydCwgZW5kLCB0cnVuY2F0ZUVuZE5vdGVzKSB7XG4gICAgcmV0dXJuIGlzUXVhbnRpemVkU2VxdWVuY2UobnMpID9cbiAgICAgICAgdHJpbUhlbHBlcihucywgc3RhcnQsIGVuZCwgJ3RvdGFsUXVhbnRpemVkU3RlcHMnLCAncXVhbnRpemVkU3RhcnRTdGVwJywgJ3F1YW50aXplZEVuZFN0ZXAnLCB0cnVuY2F0ZUVuZE5vdGVzKSA6XG4gICAgICAgIHRyaW1IZWxwZXIobnMsIHN0YXJ0LCBlbmQsICd0b3RhbFRpbWUnLCAnc3RhcnRUaW1lJywgJ2VuZFRpbWUnLCB0cnVuY2F0ZUVuZE5vdGVzKTtcbn1cbmZ1bmN0aW9uIGNvbmNhdGVuYXRlSGVscGVyKHNlcXMsIHRvdGFsS2V5LCBzdGFydEtleSwgZW5kS2V5LCBzZXF1ZW5jZUR1cmF0aW9ucykge1xuICAgIGxldCBjb25jYXRTZXE7XG4gICAgbGV0IHRvdGFsRHVyYXRpb24gPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2Vxcy5sZW5ndGg7ICsraSkge1xuICAgICAgICBjb25zdCBzZXFEdXJhdGlvbiA9IHNlcXVlbmNlRHVyYXRpb25zID8gc2VxdWVuY2VEdXJhdGlvbnNbaV0gOiBzZXFzW2ldW3RvdGFsS2V5XTtcbiAgICAgICAgaWYgKHNlcUR1cmF0aW9uID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgU2VxdWVuY2UgJHtzZXFzW2ldLmlkfSBoYXMgbm8gJHt0b3RhbEtleX0sIGFuZCBubyBpbmRpdmlkdWFsIGR1cmF0aW9uIHdhcyBwcm92aWRlZC5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgY29uY2F0U2VxID0gY2xvbmUoc2Vxc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShjb25jYXRTZXEubm90ZXMsIHNlcXNbaV0ubm90ZXMubWFwKG4gPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld04gPSBOb3RlU2VxdWVuY2UuTm90ZS5jcmVhdGUobik7XG4gICAgICAgICAgICAgICAgbmV3TltzdGFydEtleV0gKz0gdG90YWxEdXJhdGlvbjtcbiAgICAgICAgICAgICAgICBuZXdOW2VuZEtleV0gKz0gdG90YWxEdXJhdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3TjtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICB0b3RhbER1cmF0aW9uICs9IHNlcUR1cmF0aW9uO1xuICAgIH1cbiAgICBjb25jYXRTZXFbdG90YWxLZXldID0gdG90YWxEdXJhdGlvbjtcbiAgICByZXR1cm4gY29uY2F0U2VxO1xufVxuZnVuY3Rpb24gdHJpbUhlbHBlcihucywgc3RhcnQsIGVuZCwgdG90YWxLZXksIHN0YXJ0S2V5LCBlbmRLZXksIHRydW5jYXRlRW5kTm90ZXMpIHtcbiAgICBjb25zdCByZXN1bHQgPSBjbG9uZShucyk7XG4gICAgcmVzdWx0W3RvdGFsS2V5XSA9IGVuZDtcbiAgICByZXN1bHQubm90ZXMgPSByZXN1bHQubm90ZXMuZmlsdGVyKG4gPT4gbltzdGFydEtleV0gPj0gc3RhcnQgJiYgbltzdGFydEtleV0gPD0gZW5kICYmXG4gICAgICAgICh0cnVuY2F0ZUVuZE5vdGVzIHx8IG5bZW5kS2V5XSA8PSBlbmQpKTtcbiAgICByZXN1bHRbdG90YWxLZXldIC09IHN0YXJ0O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lm5vdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJlc3VsdC5ub3Rlc1tpXVtzdGFydEtleV0gLT0gc3RhcnQ7XG4gICAgICAgIHJlc3VsdC5ub3Rlc1tpXVtlbmRLZXldIC09IHN0YXJ0O1xuICAgICAgICBpZiAodHJ1bmNhdGVFbmROb3Rlcykge1xuICAgICAgICAgICAgcmVzdWx0Lm5vdGVzW2ldW2VuZEtleV0gPSBNYXRoLm1pbihyZXN1bHQubm90ZXNbaV1bZW5kS2V5XSwgcmVzdWx0W3RvdGFsS2V5XSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzcGxpdChzZXEsIGNodW5rU2l6ZSkge1xuICAgIGFzc2VydElzUXVhbnRpemVkU2VxdWVuY2Uoc2VxKTtcbiAgICBjb25zdCBucyA9IGNsb25lKHNlcSk7XG4gICAgY29uc3Qgbm90ZXNCeXN0YXJ0U3RlcCA9IG5zLm5vdGVzLnNvcnQoKGEsIGIpID0+IGEucXVhbnRpemVkU3RhcnRTdGVwIC0gYi5xdWFudGl6ZWRTdGFydFN0ZXApO1xuICAgIGNvbnN0IGNodW5rcyA9IFtdO1xuICAgIGxldCBzdGFydFN0ZXAgPSAwO1xuICAgIGxldCBjdXJyZW50Tm90ZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vdGVzQnlzdGFydFN0ZXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgbm90ZSA9IG5vdGVzQnlzdGFydFN0ZXBbaV07XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsU3RhcnRTdGVwID0gbm90ZS5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsRW5kU3RlcCA9IG5vdGUucXVhbnRpemVkRW5kU3RlcDtcbiAgICAgICAgbm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAgLT0gc3RhcnRTdGVwO1xuICAgICAgICBub3RlLnF1YW50aXplZEVuZFN0ZXAgLT0gc3RhcnRTdGVwO1xuICAgICAgICBpZiAobm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAgPCAwKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm90ZS5xdWFudGl6ZWRFbmRTdGVwIDw9IGNodW5rU2l6ZSkge1xuICAgICAgICAgICAgY3VycmVudE5vdGVzLnB1c2gobm90ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAobm90ZS5xdWFudGl6ZWRTdGFydFN0ZXAgPCBjaHVua1NpemUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdOb3RlID0gTm90ZVNlcXVlbmNlLk5vdGUuY3JlYXRlKG5vdGUpO1xuICAgICAgICAgICAgICAgIG5ld05vdGUucXVhbnRpemVkRW5kU3RlcCA9IGNodW5rU2l6ZTtcbiAgICAgICAgICAgICAgICBuZXdOb3RlLnN0YXJ0VGltZSA9IG5ld05vdGUuZW5kVGltZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBjdXJyZW50Tm90ZXMucHVzaChuZXdOb3RlKTtcbiAgICAgICAgICAgICAgICBub3RlLnF1YW50aXplZFN0YXJ0U3RlcCA9IHN0YXJ0U3RlcCArIGNodW5rU2l6ZTtcbiAgICAgICAgICAgICAgICBub3RlLnF1YW50aXplZEVuZFN0ZXAgPSBvcmlnaW5hbEVuZFN0ZXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3RlLnF1YW50aXplZFN0YXJ0U3RlcCA9IG9yaWdpbmFsU3RhcnRTdGVwO1xuICAgICAgICAgICAgICAgIG5vdGUucXVhbnRpemVkRW5kU3RlcCA9IG9yaWdpbmFsRW5kU3RlcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChub3RlLnF1YW50aXplZEVuZFN0ZXAgPiBjaHVua1NpemUgfHxcbiAgICAgICAgICAgICAgICBub3RlLnF1YW50aXplZFN0YXJ0U3RlcCA+IGNodW5rU2l6ZSkge1xuICAgICAgICAgICAgICAgIGkgPSBpIC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50Tm90ZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3U2VxdWVuY2UgPSBjbG9uZShucyk7XG4gICAgICAgICAgICAgICAgbmV3U2VxdWVuY2Uubm90ZXMgPSBjdXJyZW50Tm90ZXM7XG4gICAgICAgICAgICAgICAgbmV3U2VxdWVuY2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IGNodW5rU2l6ZTtcbiAgICAgICAgICAgICAgICBjaHVua3MucHVzaChuZXdTZXF1ZW5jZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50Tm90ZXMgPSBbXTtcbiAgICAgICAgICAgIHN0YXJ0U3RlcCArPSBjaHVua1NpemU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGN1cnJlbnROb3Rlcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgY29uc3QgbmV3U2VxdWVuY2UgPSBjbG9uZShucyk7XG4gICAgICAgIG5ld1NlcXVlbmNlLm5vdGVzID0gY3VycmVudE5vdGVzO1xuICAgICAgICBuZXdTZXF1ZW5jZS50b3RhbFF1YW50aXplZFN0ZXBzID0gY2h1bmtTaXplO1xuICAgICAgICBjaHVua3MucHVzaChuZXdTZXF1ZW5jZSk7XG4gICAgfVxuICAgIHJldHVybiBjaHVua3M7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXF1ZW5jZXMuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/soundfont.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/soundfont.js ***!
  \*************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Instrument: () => (/* binding */ Instrument),\n/* harmony export */   SoundFont: () => (/* binding */ SoundFont)\n/* harmony export */ });\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tone */ \"(ssr)/./node_modules/.pnpm/tone@14.7.77/node_modules/tone/build/Tone.js\");\n/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _core_compat_global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/compat/global */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/compat/global.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n\n\n\n\nclass Instrument {\n    constructor(baseURL) {\n        this.FADE_SECONDS = 0.1;\n        this.baseURL = baseURL;\n        this.buffers = new tone__WEBPACK_IMPORTED_MODULE_0__.ToneAudioBuffers();\n        this.sourceMap = new Map();\n        this.initialized = false;\n    }\n    async initialize() {\n        await (0,_core_compat_global__WEBPACK_IMPORTED_MODULE_1__.fetch)(`${this.baseURL}/instrument.json`)\n            .then((response) => response.json())\n            .then((spec) => {\n            this.name = spec.name;\n            this.minPitch = spec.minPitch;\n            this.maxPitch = spec.maxPitch;\n            this.durationSeconds = spec.durationSeconds;\n            this.releaseSeconds = spec.releaseSeconds;\n            this.percussive = spec.percussive;\n            this.velocities = spec.velocities;\n            this.initialized = true;\n        });\n    }\n    sampleInfoToName(sampleInfo) {\n        if (this.velocities) {\n            return `p${sampleInfo.pitch}_v${sampleInfo.velocity}`;\n        }\n        else {\n            return `p${sampleInfo.pitch}`;\n        }\n    }\n    sampleNameToURL(name) {\n        return `${this.baseURL}/${name}.mp3`;\n    }\n    nearestVelocity(velocity) {\n        if (!this.velocities) {\n            return velocity;\n        }\n        if (!velocity) {\n            velocity = _constants__WEBPACK_IMPORTED_MODULE_2__.DEFAULT_VELOCITY;\n        }\n        let bestVelocity = undefined;\n        let bestDistance = _constants__WEBPACK_IMPORTED_MODULE_2__.MIDI_VELOCITIES;\n        this.velocities.forEach((v) => {\n            const d = Math.abs(v - velocity);\n            if (d < bestDistance) {\n                bestVelocity = v;\n                bestDistance = d;\n            }\n        });\n        return bestVelocity;\n    }\n    async loadSamples(samples) {\n        if (!this.initialized) {\n            await this.initialize();\n        }\n        const nearestSampleNames = samples\n            .filter((info) => {\n            if (info.pitch < this.minPitch || info.pitch > this.maxPitch) {\n                _logging__WEBPACK_IMPORTED_MODULE_3__.log(`Pitch ${info.pitch} is outside the valid range for ${this.name}, ignoring.`, 'SoundFont');\n                return false;\n            }\n            else {\n                return true;\n            }\n        })\n            .map((info) => this.sampleInfoToName({\n            pitch: info.pitch,\n            velocity: this.nearestVelocity(info.velocity)\n        }));\n        const uniqueSampleNames = Array.from(new Set(nearestSampleNames))\n            .filter((name) => !this.buffers.has(name));\n        const sampleNamesAndURLs = uniqueSampleNames.map((name) => ({ name, url: this.sampleNameToURL(name) }));\n        if (sampleNamesAndURLs.length > 0) {\n            sampleNamesAndURLs.forEach((nameAndURL) => this.buffers.add(nameAndURL.name, nameAndURL.url));\n            await tone__WEBPACK_IMPORTED_MODULE_0__.loaded();\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`Loaded samples for ${this.name}.`, 'SoundFont');\n        }\n    }\n    playNote(pitch, velocity, startTime, duration, output) {\n        const buffer = this.getBuffer(pitch, velocity);\n        if (!buffer) {\n            return;\n        }\n        if (duration > this.durationSeconds) {\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`Requested note duration longer than sample duration: ${duration} > ${this.durationSeconds}`, 'SoundFont');\n        }\n        const source = new tone__WEBPACK_IMPORTED_MODULE_0__.ToneBufferSource({\n            url: buffer,\n            fadeOut: this.FADE_SECONDS,\n        })\n            .connect(output);\n        source.start(startTime, 0, undefined, 1);\n        if (!this.percussive && duration < this.durationSeconds) {\n            const releaseSource = new tone__WEBPACK_IMPORTED_MODULE_0__.ToneBufferSource({\n                url: buffer,\n                fadeOut: this.FADE_SECONDS,\n            })\n                .connect(output);\n            source.stop(startTime + duration + this.FADE_SECONDS);\n            releaseSource.start(startTime + duration, this.durationSeconds, undefined, 1);\n        }\n    }\n    playNoteDown(pitch, velocity, output) {\n        const buffer = this.getBuffer(pitch, velocity);\n        if (!buffer) {\n            return;\n        }\n        const source = new tone__WEBPACK_IMPORTED_MODULE_0__.ToneBufferSource(buffer).connect(output);\n        source.start(0, 0, undefined, 1);\n        if (this.sourceMap.has(pitch)) {\n            this.sourceMap.get(pitch).stop(tone__WEBPACK_IMPORTED_MODULE_0__.now() + this.FADE_SECONDS, this.FADE_SECONDS);\n        }\n        this.sourceMap.set(pitch, source);\n    }\n    playNoteUp(pitch, velocity, output) {\n        if (!this.sourceMap.has(pitch)) {\n            return;\n        }\n        const buffer = this.getBuffer(pitch, velocity);\n        if (!buffer) {\n            return;\n        }\n        const releaseSource = new tone__WEBPACK_IMPORTED_MODULE_0__.ToneBufferSource({\n            url: buffer,\n            fadeOut: this.FADE_SECONDS,\n        })\n            .connect(output);\n        releaseSource.start(0, this.durationSeconds, undefined, 1);\n        this.sourceMap.get(pitch).stop(tone__WEBPACK_IMPORTED_MODULE_0__.now() + this.FADE_SECONDS, this.FADE_SECONDS);\n        this.sourceMap.delete(pitch);\n    }\n    getBuffer(pitch, velocity) {\n        if (!this.initialized) {\n            throw new Error('Instrument is not initialized.');\n        }\n        if (pitch < this.minPitch || pitch > this.maxPitch) {\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`Pitch ${pitch} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`, 'SoundFont');\n            return;\n        }\n        const name = this.sampleInfoToName({ pitch, velocity: this.nearestVelocity(velocity) });\n        if (!this.buffers.has(name)) {\n            throw new Error(`Buffer not found for ${this.name}: ${name}`);\n        }\n        const buffer = this.buffers.get(name);\n        if (!buffer.loaded) {\n            throw new Error(`Buffer not loaded for ${this.name}: ${name}`);\n        }\n        return buffer;\n    }\n}\nclass SoundFont {\n    constructor(baseURL) {\n        this.baseURL = baseURL;\n        this.instruments = new Map();\n        this.initialized = false;\n    }\n    async initialize() {\n        await (0,_core_compat_global__WEBPACK_IMPORTED_MODULE_1__.fetch)(`${this.baseURL}/soundfont.json`)\n            .then((response) => response.json())\n            .then((spec) => {\n            this.name = spec.name;\n            for (const program in spec.instruments) {\n                const url = `${this.baseURL}/${spec.instruments[program]}`;\n                this.instruments.set(program === 'drums' ? 'drums' : +program, new Instrument(url));\n            }\n            this.initialized = true;\n        });\n    }\n    async loadSamples(samples) {\n        if (!this.initialized) {\n            await this.initialize();\n        }\n        const instrumentSamples = new Map();\n        samples.forEach((info) => {\n            info.isDrum = info.isDrum || false;\n            info.program = info.program || 0;\n            const instrument = info.isDrum ? 'drums' : info.program;\n            const sampleInfo = { pitch: info.pitch, velocity: info.velocity };\n            if (!instrumentSamples.has(instrument)) {\n                if (!this.instruments.has(instrument)) {\n                    _logging__WEBPACK_IMPORTED_MODULE_3__.log(`No instrument in ${this.name} for: program=${info.program}, isDrum=${info.isDrum}`, 'SoundFont');\n                }\n                else {\n                    instrumentSamples.set(instrument, [sampleInfo]);\n                }\n            }\n            else {\n                instrumentSamples.get(instrument).push(sampleInfo);\n            }\n        });\n        await Promise.all(Array.from(instrumentSamples.keys())\n            .map((info) => this.instruments.get(info).loadSamples(instrumentSamples.get(info))));\n    }\n    playNote(pitch, velocity, startTime, duration, program = 0, isDrum = false, output) {\n        const instrument = isDrum ? 'drums' : program;\n        if (!this.initialized) {\n            throw new Error('SoundFont is not initialized.');\n        }\n        if (!this.instruments.has(instrument)) {\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`No instrument in ${this.name} for: program=${program}, isDrum=${isDrum}`, 'SoundFont');\n            return;\n        }\n        this.instruments.get(instrument)\n            .playNote(pitch, velocity, startTime, duration, output);\n    }\n    playNoteDown(pitch, velocity, program = 0, isDrum = false, output) {\n        const instrument = isDrum ? 'drums' : program;\n        if (!this.initialized) {\n            throw new Error('SoundFont is not initialized.');\n        }\n        if (!this.instruments.has(instrument)) {\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`No instrument in ${this.name} for: program=${program}, isDrum=${isDrum}`, 'SoundFont');\n            return;\n        }\n        this.instruments.get(instrument).playNoteDown(pitch, velocity, output);\n    }\n    playNoteUp(pitch, velocity, program = 0, isDrum = false, output) {\n        const instrument = isDrum ? 'drums' : program;\n        if (!this.initialized) {\n            throw new Error('SoundFont is not initialized.');\n        }\n        if (!this.instruments.has(instrument)) {\n            _logging__WEBPACK_IMPORTED_MODULE_3__.log(`No instrument in ${this.name} for: program=${program}, isDrum=${isDrum}`, 'SoundFont');\n            return;\n        }\n        this.instruments.get(instrument).playNoteUp(pitch, velocity, output);\n    }\n}\n//# sourceMappingURL=soundfont.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9zb3VuZGZvbnQuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUE2QjtBQUNpQjtBQUNMO0FBQ0o7QUFDOUI7QUFDUDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsa0RBQXFCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywwREFBSyxJQUFJLGFBQWE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQixJQUFJLG9CQUFvQjtBQUNoRTtBQUNBO0FBQ0EsdUJBQXVCLGlCQUFpQjtBQUN4QztBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsYUFBYSxHQUFHLEtBQUs7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHdEQUEwQjtBQUNqRDtBQUNBO0FBQ0EsMkJBQTJCLHVEQUF5QjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUFXLFVBQVUsWUFBWSxpQ0FBaUMsVUFBVTtBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esc0VBQXNFLHVDQUF1QztBQUM3RztBQUNBO0FBQ0Esa0JBQWtCLHdDQUFXO0FBQzdCLFlBQVkseUNBQVcsdUJBQXVCLFVBQVU7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseUNBQVcseURBQXlELFVBQVUsSUFBSSxxQkFBcUI7QUFDbkg7QUFDQSwyQkFBMkIsa0RBQ0U7QUFDN0I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0Msa0RBQ0w7QUFDakM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrREFBcUI7QUFDaEQ7QUFDQTtBQUNBLDJDQUEyQyxxQ0FBUTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGtEQUNMO0FBQzdCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVDQUF1QyxxQ0FBUTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseUNBQVcsVUFBVSxPQUFPLGlDQUFpQyxXQUFXLEdBQUcsY0FBYyxHQUFHLGNBQWM7QUFDdEg7QUFDQTtBQUNBLDZDQUE2QyxpREFBaUQ7QUFDOUY7QUFDQSxvREFBb0QsVUFBVSxJQUFJLEtBQUs7QUFDdkU7QUFDQTtBQUNBO0FBQ0EscURBQXFELFVBQVUsSUFBSSxLQUFLO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDBEQUFLLElBQUksYUFBYTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixhQUFhLEdBQUcsMEJBQTBCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0Esb0JBQW9CLHlDQUFXLHFCQUFxQixXQUFXLGVBQWUsYUFBYSxXQUFXLFlBQVk7QUFDbEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHlDQUFXLHFCQUFxQixXQUFXLGVBQWUsUUFBUSxXQUFXLE9BQU87QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseUNBQVcscUJBQXFCLFdBQVcsZUFBZSxRQUFRLFdBQVcsT0FBTztBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkseUNBQVcscUJBQXFCLFdBQVcsZUFBZSxRQUFRLFdBQVcsT0FBTztBQUNoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb21vbmdhaC5naXRodWIuaW8vLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS9zb3VuZGZvbnQuanM/MGFhNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBUb25lIGZyb20gJ3RvbmUnO1xuaW1wb3J0IHsgZmV0Y2ggfSBmcm9tICcuLi9jb3JlL2NvbXBhdC9nbG9iYWwnO1xuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCAqIGFzIGxvZ2dpbmcgZnJvbSAnLi9sb2dnaW5nJztcbmV4cG9ydCBjbGFzcyBJbnN0cnVtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihiYXNlVVJMKSB7XG4gICAgICAgIHRoaXMuRkFERV9TRUNPTkRTID0gMC4xO1xuICAgICAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMO1xuICAgICAgICB0aGlzLmJ1ZmZlcnMgPSBuZXcgVG9uZS5Ub25lQXVkaW9CdWZmZXJzKCk7XG4gICAgICAgIHRoaXMuc291cmNlTWFwID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVSTH0vaW5zdHJ1bWVudC5qc29uYClcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpKVxuICAgICAgICAgICAgLnRoZW4oKHNwZWMpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IHNwZWMubmFtZTtcbiAgICAgICAgICAgIHRoaXMubWluUGl0Y2ggPSBzcGVjLm1pblBpdGNoO1xuICAgICAgICAgICAgdGhpcy5tYXhQaXRjaCA9IHNwZWMubWF4UGl0Y2g7XG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uU2Vjb25kcyA9IHNwZWMuZHVyYXRpb25TZWNvbmRzO1xuICAgICAgICAgICAgdGhpcy5yZWxlYXNlU2Vjb25kcyA9IHNwZWMucmVsZWFzZVNlY29uZHM7XG4gICAgICAgICAgICB0aGlzLnBlcmN1c3NpdmUgPSBzcGVjLnBlcmN1c3NpdmU7XG4gICAgICAgICAgICB0aGlzLnZlbG9jaXRpZXMgPSBzcGVjLnZlbG9jaXRpZXM7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNhbXBsZUluZm9Ub05hbWUoc2FtcGxlSW5mbykge1xuICAgICAgICBpZiAodGhpcy52ZWxvY2l0aWVzKSB7XG4gICAgICAgICAgICByZXR1cm4gYHAke3NhbXBsZUluZm8ucGl0Y2h9X3Yke3NhbXBsZUluZm8udmVsb2NpdHl9YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgcCR7c2FtcGxlSW5mby5waXRjaH1gO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNhbXBsZU5hbWVUb1VSTChuYW1lKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmJhc2VVUkx9LyR7bmFtZX0ubXAzYDtcbiAgICB9XG4gICAgbmVhcmVzdFZlbG9jaXR5KHZlbG9jaXR5KSB7XG4gICAgICAgIGlmICghdGhpcy52ZWxvY2l0aWVzKSB7XG4gICAgICAgICAgICByZXR1cm4gdmVsb2NpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF2ZWxvY2l0eSkge1xuICAgICAgICAgICAgdmVsb2NpdHkgPSBjb25zdGFudHMuREVGQVVMVF9WRUxPQ0lUWTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYmVzdFZlbG9jaXR5ID0gdW5kZWZpbmVkO1xuICAgICAgICBsZXQgYmVzdERpc3RhbmNlID0gY29uc3RhbnRzLk1JRElfVkVMT0NJVElFUztcbiAgICAgICAgdGhpcy52ZWxvY2l0aWVzLmZvckVhY2goKHYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGQgPSBNYXRoLmFicyh2IC0gdmVsb2NpdHkpO1xuICAgICAgICAgICAgaWYgKGQgPCBiZXN0RGlzdGFuY2UpIHtcbiAgICAgICAgICAgICAgICBiZXN0VmVsb2NpdHkgPSB2O1xuICAgICAgICAgICAgICAgIGJlc3REaXN0YW5jZSA9IGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYmVzdFZlbG9jaXR5O1xuICAgIH1cbiAgICBhc3luYyBsb2FkU2FtcGxlcyhzYW1wbGVzKSB7XG4gICAgICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmVhcmVzdFNhbXBsZU5hbWVzID0gc2FtcGxlc1xuICAgICAgICAgICAgLmZpbHRlcigoaW5mbykgPT4ge1xuICAgICAgICAgICAgaWYgKGluZm8ucGl0Y2ggPCB0aGlzLm1pblBpdGNoIHx8IGluZm8ucGl0Y2ggPiB0aGlzLm1heFBpdGNoKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2luZy5sb2coYFBpdGNoICR7aW5mby5waXRjaH0gaXMgb3V0c2lkZSB0aGUgdmFsaWQgcmFuZ2UgZm9yICR7dGhpcy5uYW1lfSwgaWdub3JpbmcuYCwgJ1NvdW5kRm9udCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcCgoaW5mbykgPT4gdGhpcy5zYW1wbGVJbmZvVG9OYW1lKHtcbiAgICAgICAgICAgIHBpdGNoOiBpbmZvLnBpdGNoLFxuICAgICAgICAgICAgdmVsb2NpdHk6IHRoaXMubmVhcmVzdFZlbG9jaXR5KGluZm8udmVsb2NpdHkpXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgdW5pcXVlU2FtcGxlTmFtZXMgPSBBcnJheS5mcm9tKG5ldyBTZXQobmVhcmVzdFNhbXBsZU5hbWVzKSlcbiAgICAgICAgICAgIC5maWx0ZXIoKG5hbWUpID0+ICF0aGlzLmJ1ZmZlcnMuaGFzKG5hbWUpKTtcbiAgICAgICAgY29uc3Qgc2FtcGxlTmFtZXNBbmRVUkxzID0gdW5pcXVlU2FtcGxlTmFtZXMubWFwKChuYW1lKSA9PiAoeyBuYW1lLCB1cmw6IHRoaXMuc2FtcGxlTmFtZVRvVVJMKG5hbWUpIH0pKTtcbiAgICAgICAgaWYgKHNhbXBsZU5hbWVzQW5kVVJMcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzYW1wbGVOYW1lc0FuZFVSTHMuZm9yRWFjaCgobmFtZUFuZFVSTCkgPT4gdGhpcy5idWZmZXJzLmFkZChuYW1lQW5kVVJMLm5hbWUsIG5hbWVBbmRVUkwudXJsKSk7XG4gICAgICAgICAgICBhd2FpdCBUb25lLmxvYWRlZCgpO1xuICAgICAgICAgICAgbG9nZ2luZy5sb2coYExvYWRlZCBzYW1wbGVzIGZvciAke3RoaXMubmFtZX0uYCwgJ1NvdW5kRm9udCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBsYXlOb3RlKHBpdGNoLCB2ZWxvY2l0eSwgc3RhcnRUaW1lLCBkdXJhdGlvbiwgb3V0cHV0KSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZ2V0QnVmZmVyKHBpdGNoLCB2ZWxvY2l0eSk7XG4gICAgICAgIGlmICghYnVmZmVyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGR1cmF0aW9uID4gdGhpcy5kdXJhdGlvblNlY29uZHMpIHtcbiAgICAgICAgICAgIGxvZ2dpbmcubG9nKGBSZXF1ZXN0ZWQgbm90ZSBkdXJhdGlvbiBsb25nZXIgdGhhbiBzYW1wbGUgZHVyYXRpb246ICR7ZHVyYXRpb259ID4gJHt0aGlzLmR1cmF0aW9uU2Vjb25kc31gLCAnU291bmRGb250Jyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc291cmNlID0gbmV3IFRvbmVcbiAgICAgICAgICAgIC5Ub25lQnVmZmVyU291cmNlKHtcbiAgICAgICAgICAgIHVybDogYnVmZmVyLFxuICAgICAgICAgICAgZmFkZU91dDogdGhpcy5GQURFX1NFQ09ORFMsXG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY29ubmVjdChvdXRwdXQpO1xuICAgICAgICBzb3VyY2Uuc3RhcnQoc3RhcnRUaW1lLCAwLCB1bmRlZmluZWQsIDEpO1xuICAgICAgICBpZiAoIXRoaXMucGVyY3Vzc2l2ZSAmJiBkdXJhdGlvbiA8IHRoaXMuZHVyYXRpb25TZWNvbmRzKSB7XG4gICAgICAgICAgICBjb25zdCByZWxlYXNlU291cmNlID0gbmV3IFRvbmVcbiAgICAgICAgICAgICAgICAuVG9uZUJ1ZmZlclNvdXJjZSh7XG4gICAgICAgICAgICAgICAgdXJsOiBidWZmZXIsXG4gICAgICAgICAgICAgICAgZmFkZU91dDogdGhpcy5GQURFX1NFQ09ORFMsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jb25uZWN0KG91dHB1dCk7XG4gICAgICAgICAgICBzb3VyY2Uuc3RvcChzdGFydFRpbWUgKyBkdXJhdGlvbiArIHRoaXMuRkFERV9TRUNPTkRTKTtcbiAgICAgICAgICAgIHJlbGVhc2VTb3VyY2Uuc3RhcnQoc3RhcnRUaW1lICsgZHVyYXRpb24sIHRoaXMuZHVyYXRpb25TZWNvbmRzLCB1bmRlZmluZWQsIDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBsYXlOb3RlRG93bihwaXRjaCwgdmVsb2NpdHksIG91dHB1dCkge1xuICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmdldEJ1ZmZlcihwaXRjaCwgdmVsb2NpdHkpO1xuICAgICAgICBpZiAoIWJ1ZmZlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IG5ldyBUb25lLlRvbmVCdWZmZXJTb3VyY2UoYnVmZmVyKS5jb25uZWN0KG91dHB1dCk7XG4gICAgICAgIHNvdXJjZS5zdGFydCgwLCAwLCB1bmRlZmluZWQsIDEpO1xuICAgICAgICBpZiAodGhpcy5zb3VyY2VNYXAuaGFzKHBpdGNoKSkge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VNYXAuZ2V0KHBpdGNoKS5zdG9wKFRvbmUubm93KCkgKyB0aGlzLkZBREVfU0VDT05EUywgdGhpcy5GQURFX1NFQ09ORFMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc291cmNlTWFwLnNldChwaXRjaCwgc291cmNlKTtcbiAgICB9XG4gICAgcGxheU5vdGVVcChwaXRjaCwgdmVsb2NpdHksIG91dHB1dCkge1xuICAgICAgICBpZiAoIXRoaXMuc291cmNlTWFwLmhhcyhwaXRjaCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmdldEJ1ZmZlcihwaXRjaCwgdmVsb2NpdHkpO1xuICAgICAgICBpZiAoIWJ1ZmZlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbGVhc2VTb3VyY2UgPSBuZXcgVG9uZVxuICAgICAgICAgICAgLlRvbmVCdWZmZXJTb3VyY2Uoe1xuICAgICAgICAgICAgdXJsOiBidWZmZXIsXG4gICAgICAgICAgICBmYWRlT3V0OiB0aGlzLkZBREVfU0VDT05EUyxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jb25uZWN0KG91dHB1dCk7XG4gICAgICAgIHJlbGVhc2VTb3VyY2Uuc3RhcnQoMCwgdGhpcy5kdXJhdGlvblNlY29uZHMsIHVuZGVmaW5lZCwgMSk7XG4gICAgICAgIHRoaXMuc291cmNlTWFwLmdldChwaXRjaCkuc3RvcChUb25lLm5vdygpICsgdGhpcy5GQURFX1NFQ09ORFMsIHRoaXMuRkFERV9TRUNPTkRTKTtcbiAgICAgICAgdGhpcy5zb3VyY2VNYXAuZGVsZXRlKHBpdGNoKTtcbiAgICB9XG4gICAgZ2V0QnVmZmVyKHBpdGNoLCB2ZWxvY2l0eSkge1xuICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW5zdHJ1bWVudCBpcyBub3QgaW5pdGlhbGl6ZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBpdGNoIDwgdGhpcy5taW5QaXRjaCB8fCBwaXRjaCA+IHRoaXMubWF4UGl0Y2gpIHtcbiAgICAgICAgICAgIGxvZ2dpbmcubG9nKGBQaXRjaCAke3BpdGNofSBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBmb3IgJHt0aGlzLm5hbWV9ICgke3RoaXMubWluUGl0Y2h9LSR7dGhpcy5tYXhQaXRjaH0pYCwgJ1NvdW5kRm9udCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLnNhbXBsZUluZm9Ub05hbWUoeyBwaXRjaCwgdmVsb2NpdHk6IHRoaXMubmVhcmVzdFZlbG9jaXR5KHZlbG9jaXR5KSB9KTtcbiAgICAgICAgaWYgKCF0aGlzLmJ1ZmZlcnMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ1ZmZlciBub3QgZm91bmQgZm9yICR7dGhpcy5uYW1lfTogJHtuYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVycy5nZXQobmFtZSk7XG4gICAgICAgIGlmICghYnVmZmVyLmxvYWRlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCdWZmZXIgbm90IGxvYWRlZCBmb3IgJHt0aGlzLm5hbWV9OiAke25hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgU291bmRGb250IHtcbiAgICBjb25zdHJ1Y3RvcihiYXNlVVJMKSB7XG4gICAgICAgIHRoaXMuYmFzZVVSTCA9IGJhc2VVUkw7XG4gICAgICAgIHRoaXMuaW5zdHJ1bWVudHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVVJMfS9zb3VuZGZvbnQuanNvbmApXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgICAgIC50aGVuKChzcGVjKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBzcGVjLm5hbWU7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByb2dyYW0gaW4gc3BlYy5pbnN0cnVtZW50cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVSTH0vJHtzcGVjLmluc3RydW1lbnRzW3Byb2dyYW1dfWA7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnN0cnVtZW50cy5zZXQocHJvZ3JhbSA9PT0gJ2RydW1zJyA/ICdkcnVtcycgOiArcHJvZ3JhbSwgbmV3IEluc3RydW1lbnQodXJsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGxvYWRTYW1wbGVzKHNhbXBsZXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnN0cnVtZW50U2FtcGxlcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgc2FtcGxlcy5mb3JFYWNoKChpbmZvKSA9PiB7XG4gICAgICAgICAgICBpbmZvLmlzRHJ1bSA9IGluZm8uaXNEcnVtIHx8IGZhbHNlO1xuICAgICAgICAgICAgaW5mby5wcm9ncmFtID0gaW5mby5wcm9ncmFtIHx8IDA7XG4gICAgICAgICAgICBjb25zdCBpbnN0cnVtZW50ID0gaW5mby5pc0RydW0gPyAnZHJ1bXMnIDogaW5mby5wcm9ncmFtO1xuICAgICAgICAgICAgY29uc3Qgc2FtcGxlSW5mbyA9IHsgcGl0Y2g6IGluZm8ucGl0Y2gsIHZlbG9jaXR5OiBpbmZvLnZlbG9jaXR5IH07XG4gICAgICAgICAgICBpZiAoIWluc3RydW1lbnRTYW1wbGVzLmhhcyhpbnN0cnVtZW50KSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnN0cnVtZW50cy5oYXMoaW5zdHJ1bWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5sb2coYE5vIGluc3RydW1lbnQgaW4gJHt0aGlzLm5hbWV9IGZvcjogcHJvZ3JhbT0ke2luZm8ucHJvZ3JhbX0sIGlzRHJ1bT0ke2luZm8uaXNEcnVtfWAsICdTb3VuZEZvbnQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGluc3RydW1lbnRTYW1wbGVzLnNldChpbnN0cnVtZW50LCBbc2FtcGxlSW5mb10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGluc3RydW1lbnRTYW1wbGVzLmdldChpbnN0cnVtZW50KS5wdXNoKHNhbXBsZUluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoQXJyYXkuZnJvbShpbnN0cnVtZW50U2FtcGxlcy5rZXlzKCkpXG4gICAgICAgICAgICAubWFwKChpbmZvKSA9PiB0aGlzLmluc3RydW1lbnRzLmdldChpbmZvKS5sb2FkU2FtcGxlcyhpbnN0cnVtZW50U2FtcGxlcy5nZXQoaW5mbykpKSk7XG4gICAgfVxuICAgIHBsYXlOb3RlKHBpdGNoLCB2ZWxvY2l0eSwgc3RhcnRUaW1lLCBkdXJhdGlvbiwgcHJvZ3JhbSA9IDAsIGlzRHJ1bSA9IGZhbHNlLCBvdXRwdXQpIHtcbiAgICAgICAgY29uc3QgaW5zdHJ1bWVudCA9IGlzRHJ1bSA/ICdkcnVtcycgOiBwcm9ncmFtO1xuICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU291bmRGb250IGlzIG5vdCBpbml0aWFsaXplZC4nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuaW5zdHJ1bWVudHMuaGFzKGluc3RydW1lbnQpKSB7XG4gICAgICAgICAgICBsb2dnaW5nLmxvZyhgTm8gaW5zdHJ1bWVudCBpbiAke3RoaXMubmFtZX0gZm9yOiBwcm9ncmFtPSR7cHJvZ3JhbX0sIGlzRHJ1bT0ke2lzRHJ1bX1gLCAnU291bmRGb250Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnN0cnVtZW50cy5nZXQoaW5zdHJ1bWVudClcbiAgICAgICAgICAgIC5wbGF5Tm90ZShwaXRjaCwgdmVsb2NpdHksIHN0YXJ0VGltZSwgZHVyYXRpb24sIG91dHB1dCk7XG4gICAgfVxuICAgIHBsYXlOb3RlRG93bihwaXRjaCwgdmVsb2NpdHksIHByb2dyYW0gPSAwLCBpc0RydW0gPSBmYWxzZSwgb3V0cHV0KSB7XG4gICAgICAgIGNvbnN0IGluc3RydW1lbnQgPSBpc0RydW0gPyAnZHJ1bXMnIDogcHJvZ3JhbTtcbiAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvdW5kRm9udCBpcyBub3QgaW5pdGlhbGl6ZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmluc3RydW1lbnRzLmhhcyhpbnN0cnVtZW50KSkge1xuICAgICAgICAgICAgbG9nZ2luZy5sb2coYE5vIGluc3RydW1lbnQgaW4gJHt0aGlzLm5hbWV9IGZvcjogcHJvZ3JhbT0ke3Byb2dyYW19LCBpc0RydW09JHtpc0RydW19YCwgJ1NvdW5kRm9udCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5zdHJ1bWVudHMuZ2V0KGluc3RydW1lbnQpLnBsYXlOb3RlRG93bihwaXRjaCwgdmVsb2NpdHksIG91dHB1dCk7XG4gICAgfVxuICAgIHBsYXlOb3RlVXAocGl0Y2gsIHZlbG9jaXR5LCBwcm9ncmFtID0gMCwgaXNEcnVtID0gZmFsc2UsIG91dHB1dCkge1xuICAgICAgICBjb25zdCBpbnN0cnVtZW50ID0gaXNEcnVtID8gJ2RydW1zJyA6IHByb2dyYW07XG4gICAgICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTb3VuZEZvbnQgaXMgbm90IGluaXRpYWxpemVkLicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5pbnN0cnVtZW50cy5oYXMoaW5zdHJ1bWVudCkpIHtcbiAgICAgICAgICAgIGxvZ2dpbmcubG9nKGBObyBpbnN0cnVtZW50IGluICR7dGhpcy5uYW1lfSBmb3I6IHByb2dyYW09JHtwcm9ncmFtfSwgaXNEcnVtPSR7aXNEcnVtfWAsICdTb3VuZEZvbnQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc3RydW1lbnRzLmdldChpbnN0cnVtZW50KS5wbGF5Tm90ZVVwKHBpdGNoLCB2ZWxvY2l0eSwgb3V0cHV0KTtcbiAgICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zb3VuZGZvbnQuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/soundfont.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/visualizer.js":
/*!**************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/visualizer.js ***!
  \**************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BaseSVGVisualizer: () => (/* binding */ BaseSVGVisualizer),\n/* harmony export */   BaseVisualizer: () => (/* binding */ BaseVisualizer),\n/* harmony export */   PianoRollCanvasVisualizer: () => (/* binding */ PianoRollCanvasVisualizer),\n/* harmony export */   PianoRollSVGVisualizer: () => (/* binding */ PianoRollSVGVisualizer),\n/* harmony export */   ScrollType: () => (/* binding */ ScrollType),\n/* harmony export */   StaffSVGVisualizer: () => (/* binding */ StaffSVGVisualizer),\n/* harmony export */   Visualizer: () => (/* binding */ Visualizer),\n/* harmony export */   WaterfallSVGVisualizer: () => (/* binding */ WaterfallSVGVisualizer)\n/* harmony export */ });\n/* harmony import */ var staffrender__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! staffrender */ \"(ssr)/./node_modules/.pnpm/staffrender@0.2.1/node_modules/staffrender/node/index.js\");\n/* harmony import */ var staffrender__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(staffrender__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/constants.js\");\n/* harmony import */ var _logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./logging */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/logging.js\");\n/* harmony import */ var _sequences__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sequences */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/sequences.js\");\n\n\n\n\nconst MIN_NOTE_LENGTH = 1;\nclass BaseVisualizer {\n    constructor(sequence, config = {}) {\n        const isQuantized = _sequences__WEBPACK_IMPORTED_MODULE_3__.isQuantizedSequence(sequence);\n        const qpm = (sequence.tempos && sequence.tempos.length > 0) ?\n            sequence.tempos[0].qpm : undefined;\n        this.noteSequence = isQuantized ?\n            _sequences__WEBPACK_IMPORTED_MODULE_3__.unquantizeSequence(sequence, qpm) : sequence;\n        const defaultPixelsPerTimeStep = 30;\n        this.config = {\n            noteHeight: config.noteHeight || 6,\n            noteSpacing: config.noteSpacing || 1,\n            pixelsPerTimeStep: config.pixelsPerTimeStep || defaultPixelsPerTimeStep,\n            noteRGB: config.noteRGB || '8, 41, 64',\n            activeNoteRGB: config.activeNoteRGB || '240, 84, 119',\n            minPitch: config.minPitch,\n            maxPitch: config.maxPitch,\n        };\n        const size = this.getSize();\n        this.width = size.width;\n        this.height = size.height;\n    }\n    updateMinMaxPitches(noExtraPadding = false) {\n        if (this.config.minPitch && this.config.maxPitch) {\n            return;\n        }\n        if (this.config.minPitch === undefined) {\n            this.config.minPitch = _constants__WEBPACK_IMPORTED_MODULE_1__.MAX_MIDI_PITCH;\n        }\n        if (this.config.maxPitch === undefined) {\n            this.config.maxPitch = _constants__WEBPACK_IMPORTED_MODULE_1__.MIN_MIDI_PITCH;\n        }\n        for (const note of this.noteSequence.notes) {\n            this.config.minPitch = Math.min(note.pitch, this.config.minPitch);\n            this.config.maxPitch = Math.max(note.pitch, this.config.maxPitch);\n        }\n        if (!noExtraPadding) {\n            this.config.minPitch -= 2;\n            this.config.maxPitch += 2;\n        }\n    }\n    getSize() {\n        this.updateMinMaxPitches();\n        const height = (this.config.maxPitch - this.config.minPitch) * this.config.noteHeight;\n        const endTime = this.noteSequence.totalTime;\n        if (!endTime) {\n            throw new Error('The sequence you are using with the visualizer does not have a ' +\n                'totalQuantizedSteps or totalTime ' +\n                'field set, so the visualizer can\\'t be horizontally ' +\n                'sized correctly.');\n        }\n        const width = (endTime * this.config.pixelsPerTimeStep);\n        return { width, height };\n    }\n    getNotePosition(note, noteIndex) {\n        const duration = this.getNoteEndTime(note) - this.getNoteStartTime(note);\n        const x = (this.getNoteStartTime(note) * this.config.pixelsPerTimeStep);\n        const w = Math.max(this.config.pixelsPerTimeStep * duration - this.config.noteSpacing, MIN_NOTE_LENGTH);\n        const y = this.height -\n            ((note.pitch - this.config.minPitch) * this.config.noteHeight);\n        return { x, y, w, h: this.config.noteHeight };\n    }\n    scrollIntoViewIfNeeded(scrollIntoView, activeNotePosition) {\n        if (scrollIntoView && this.parentElement) {\n            const containerWidth = this.parentElement.getBoundingClientRect().width;\n            if (activeNotePosition >\n                (this.parentElement.scrollLeft + containerWidth)) {\n                this.parentElement.scrollLeft = activeNotePosition - 20;\n            }\n        }\n    }\n    getNoteStartTime(note) {\n        return Math.round(note.startTime * 100000000) / 100000000;\n    }\n    getNoteEndTime(note) {\n        return Math.round(note.endTime * 100000000) / 100000000;\n    }\n    isPaintingActiveNote(note, playedNote) {\n        const isPlayedNote = this.getNoteStartTime(note) === this.getNoteStartTime(playedNote);\n        const heldDownDuringPlayedNote = this.getNoteStartTime(note) <= this.getNoteStartTime(playedNote) &&\n            this.getNoteEndTime(note) >= this.getNoteEndTime(playedNote);\n        return isPlayedNote || heldDownDuringPlayedNote;\n    }\n}\nclass PianoRollCanvasVisualizer extends BaseVisualizer {\n    constructor(sequence, canvas, config = {}) {\n        super(sequence, config);\n        this.ctx = canvas.getContext('2d');\n        this.parentElement = canvas.parentElement;\n        const dpr = window.devicePixelRatio || 1;\n        if (this.ctx) {\n            this.ctx.canvas.width = dpr * this.width;\n            this.ctx.canvas.height = dpr * this.height;\n            canvas.style.width = `${this.width}px`;\n            canvas.style.height = `${this.height}px`;\n            this.ctx.scale(dpr, dpr);\n        }\n        this.redraw();\n    }\n    redraw(activeNote, scrollIntoView) {\n        this.clear();\n        let activeNotePosition;\n        for (let i = 0; i < this.noteSequence.notes.length; i++) {\n            const note = this.noteSequence.notes[i];\n            const size = this.getNotePosition(note, i);\n            const opacityBaseline = 0.2;\n            const opacity = note.velocity ? note.velocity / 100 + opacityBaseline : 1;\n            const isActive = activeNote && this.isPaintingActiveNote(note, activeNote);\n            const fill = `rgba(${isActive ? this.config.activeNoteRGB : this.config.noteRGB},\n  ${opacity})`;\n            this.redrawNote(size.x, size.y, size.w, size.h, fill);\n            if (isActive && note === activeNote) {\n                activeNotePosition = size.x;\n            }\n        }\n        this.scrollIntoViewIfNeeded(scrollIntoView, activeNotePosition);\n        return activeNotePosition;\n    }\n    clear() {\n        this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    }\n    clearActiveNotes() {\n        this.redraw();\n    }\n    redrawNote(x, y, w, h, fill) {\n        this.ctx.fillStyle = fill;\n        this.ctx.fillRect(Math.round(x), Math.round(y), Math.round(w), Math.round(h));\n    }\n}\nclass Visualizer extends PianoRollCanvasVisualizer {\n    constructor(sequence, canvas, config = {}) {\n        super(sequence, canvas, config);\n        _logging__WEBPACK_IMPORTED_MODULE_2__.log('mm.Visualizer is deprecated, and will be removed in a future \\\n         version. Please use mm.PianoRollCanvasVisualizer instead', 'mm.Visualizer', 5);\n    }\n}\nclass BaseSVGVisualizer extends BaseVisualizer {\n    constructor(sequence, config = {}) {\n        super(sequence, config);\n        this.drawn = false;\n    }\n    redraw(activeNote, scrollIntoView) {\n        if (!this.drawn) {\n            this.draw();\n        }\n        if (!activeNote) {\n            return null;\n        }\n        this.unfillActiveRect(this.svg);\n        let activeNotePosition;\n        for (let i = 0; i < this.noteSequence.notes.length; i++) {\n            const note = this.noteSequence.notes[i];\n            const isActive = activeNote && this.isPaintingActiveNote(note, activeNote);\n            if (!isActive) {\n                continue;\n            }\n            const el = this.svg.querySelector(`rect[data-index=\"${i}\"]`);\n            this.fillActiveRect(el, note);\n            if (note === activeNote) {\n                activeNotePosition = parseFloat(el.getAttribute('x'));\n            }\n        }\n        this.scrollIntoViewIfNeeded(scrollIntoView, activeNotePosition);\n        return activeNotePosition;\n    }\n    fillActiveRect(el, note) {\n        el.setAttribute('fill', this.getNoteFillColor(note, true));\n        el.classList.add('active');\n    }\n    unfillActiveRect(svg) {\n        const els = svg.querySelectorAll('rect.active');\n        for (let i = 0; i < els.length; ++i) {\n            const el = els[i];\n            const fill = this.getNoteFillColor(this.noteSequence.notes[parseInt(el.getAttribute('data-index'), 10)], false);\n            el.setAttribute('fill', fill);\n            el.classList.remove('active');\n        }\n    }\n    draw() {\n        for (let i = 0; i < this.noteSequence.notes.length; i++) {\n            const note = this.noteSequence.notes[i];\n            const size = this.getNotePosition(note, i);\n            const fill = this.getNoteFillColor(note, false);\n            const dataAttributes = [\n                ['index', i],\n                ['instrument', note.instrument],\n                ['program', note.program],\n                ['isDrum', note.isDrum === true],\n                ['pitch', note.pitch],\n            ];\n            const cssProperties = [\n                ['--midi-velocity',\n                    String(note.velocity !== undefined ? note.velocity : 127)]\n            ];\n            this.drawNote(size.x, size.y, size.w, size.h, fill, dataAttributes, cssProperties);\n        }\n        this.drawn = true;\n    }\n    getNoteFillColor(note, isActive) {\n        const opacityBaseline = 0.2;\n        const opacity = note.velocity ? note.velocity / 100 + opacityBaseline : 1;\n        const fill = `rgba(${isActive ? this.config.activeNoteRGB : this.config.noteRGB},\n  ${opacity})`;\n        return fill;\n    }\n    drawNote(x, y, w, h, fill, dataAttributes, cssProperties) {\n        if (!this.svg) {\n            return;\n        }\n        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n        rect.classList.add('note');\n        rect.setAttribute('fill', fill);\n        rect.setAttribute('x', `${Math.round(x)}`);\n        rect.setAttribute('y', `${Math.round(y)}`);\n        rect.setAttribute('width', `${Math.round(w)}`);\n        rect.setAttribute('height', `${Math.round(h)}`);\n        dataAttributes.forEach(([key, value]) => {\n            if (value !== undefined) {\n                rect.dataset[key] = `${value}`;\n            }\n        });\n        cssProperties.forEach(([key, value]) => {\n            rect.style.setProperty(key, value);\n        });\n        this.svg.appendChild(rect);\n    }\n    clear() {\n        this.svg.innerHTML = '';\n        this.drawn = false;\n    }\n    clearActiveNotes() {\n        this.unfillActiveRect(this.svg);\n    }\n}\nclass PianoRollSVGVisualizer extends BaseSVGVisualizer {\n    constructor(sequence, svg, config = {}) {\n        super(sequence, config);\n        if (!(svg instanceof SVGSVGElement)) {\n            throw new Error('This visualizer requires an <svg> element to display the visualization');\n        }\n        this.svg = svg;\n        this.parentElement = svg.parentElement;\n        const size = this.getSize();\n        this.width = size.width;\n        this.height = size.height;\n        this.svg.style.width = `${this.width}px`;\n        this.svg.style.height = `${this.height}px`;\n        this.clear();\n        this.draw();\n    }\n}\nclass WaterfallSVGVisualizer extends BaseSVGVisualizer {\n    constructor(sequence, parentElement, config = {}) {\n        super(sequence, config);\n        this.NOTES_PER_OCTAVE = 12;\n        this.WHITE_NOTES_PER_OCTAVE = 7;\n        this.LOW_C = 24;\n        this.firstDrawnOctave = 0;\n        this.lastDrawnOctave = 6;\n        if (!(parentElement instanceof HTMLDivElement)) {\n            throw new Error('This visualizer requires a <div> element to display the visualization');\n        }\n        this.config.whiteNoteWidth = config.whiteNoteWidth || 20;\n        this.config.blackNoteWidth =\n            config.blackNoteWidth || this.config.whiteNoteWidth * 2 / 3;\n        this.config.whiteNoteHeight = config.whiteNoteHeight || 70;\n        this.config.blackNoteHeight = config.blackNoteHeight || (2 * 70 / 3);\n        this.config.showOnlyOctavesUsed = config.showOnlyOctavesUsed;\n        this.setupDOM(parentElement);\n        const size = this.getSize();\n        this.width = size.width;\n        this.height = size.height;\n        this.svg.style.width = `${this.width}px`;\n        this.svg.style.height = `${this.height}px`;\n        this.svgPiano.style.width = `${this.width}px`;\n        this.svgPiano.style.height = `${this.config.whiteNoteHeight}px`;\n        this.parentElement.style.width =\n            `${this.width + this.config.whiteNoteWidth}px`;\n        this.parentElement.scrollTop = this.parentElement.scrollHeight;\n        this.clear();\n        this.drawPiano();\n        this.draw();\n    }\n    setupDOM(container) {\n        this.parentElement = document.createElement('div');\n        this.parentElement.classList.add('waterfall-notes-container');\n        const height = Math.max(container.getBoundingClientRect().height, 200);\n        this.parentElement.style.paddingTop =\n            `${height - this.config.whiteNoteHeight}px`;\n        this.parentElement.style.height =\n            `${height - this.config.whiteNoteHeight}px`;\n        this.parentElement.style.boxSizing = 'border-box';\n        this.parentElement.style.overflowX = 'hidden';\n        this.parentElement.style.overflowY = 'auto';\n        this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.svgPiano =\n            document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.svg.classList.add('waterfall-notes');\n        this.svgPiano.classList.add('waterfall-piano');\n        this.parentElement.appendChild(this.svg);\n        container.innerHTML = '';\n        container.appendChild(this.parentElement);\n        container.appendChild(this.svgPiano);\n    }\n    redraw(activeNote, scrollIntoView) {\n        if (!this.drawn) {\n            this.draw();\n        }\n        if (!activeNote) {\n            return null;\n        }\n        this.clearActiveNotes();\n        this.parentElement.style.paddingTop = this.parentElement.style.height;\n        for (let i = 0; i < this.noteSequence.notes.length; i++) {\n            const note = this.noteSequence.notes[i];\n            const isActive = activeNote && this.isPaintingActiveNote(note, activeNote);\n            if (!isActive) {\n                continue;\n            }\n            const el = this.svg.querySelector(`rect[data-index=\"${i}\"]`);\n            this.fillActiveRect(el, note);\n            const key = this.svgPiano.querySelector(`rect[data-pitch=\"${note.pitch}\"]`);\n            this.fillActiveRect(key, note);\n            if (note === activeNote) {\n                const y = parseFloat(el.getAttribute('y'));\n                const height = parseFloat(el.getAttribute('height'));\n                if (y < (this.parentElement.scrollTop - height)) {\n                    this.parentElement.scrollTop = y + height;\n                }\n                return y;\n            }\n        }\n        return null;\n    }\n    getSize() {\n        this.updateMinMaxPitches(true);\n        let whiteNotesDrawn = 52;\n        if (this.config.showOnlyOctavesUsed) {\n            let foundFirst = false, foundLast = false;\n            for (let i = 1; i < 7; i++) {\n                const c = this.LOW_C + this.NOTES_PER_OCTAVE * i;\n                if (!foundFirst && c > this.config.minPitch) {\n                    this.firstDrawnOctave = i - 1;\n                    foundFirst = true;\n                }\n                if (!foundLast && c > this.config.maxPitch) {\n                    this.lastDrawnOctave = i - 1;\n                    foundLast = true;\n                }\n            }\n            whiteNotesDrawn = (this.lastDrawnOctave - this.firstDrawnOctave + 1) *\n                this.WHITE_NOTES_PER_OCTAVE;\n        }\n        const width = whiteNotesDrawn * this.config.whiteNoteWidth;\n        const endTime = this.noteSequence.totalTime;\n        if (!endTime) {\n            throw new Error('The sequence you are using with the visualizer does not have a ' +\n                'totalQuantizedSteps or totalTime ' +\n                'field set, so the visualizer can\\'t be horizontally ' +\n                'sized correctly.');\n        }\n        const height = Math.max(endTime * this.config.pixelsPerTimeStep, MIN_NOTE_LENGTH);\n        return { width, height };\n    }\n    getNotePosition(note, noteIndex) {\n        const rect = this.svgPiano.querySelector(`rect[data-pitch=\"${note.pitch}\"]`);\n        if (!rect) {\n            return null;\n        }\n        const len = this.getNoteEndTime(note) - this.getNoteStartTime(note);\n        const x = Number(rect.getAttribute('x'));\n        const w = Number(rect.getAttribute('width'));\n        const h = Math.max(this.config.pixelsPerTimeStep * len - this.config.noteSpacing, MIN_NOTE_LENGTH);\n        const y = this.height -\n            (this.getNoteStartTime(note) * this.config.pixelsPerTimeStep) - h;\n        return { x, y, w, h };\n    }\n    drawPiano() {\n        this.svgPiano.innerHTML = '';\n        const blackNoteOffset = this.config.whiteNoteWidth - this.config.blackNoteWidth / 2;\n        const blackNoteIndexes = [1, 3, 6, 8, 10];\n        let x = 0;\n        let currentPitch = 0;\n        if (this.config.showOnlyOctavesUsed) {\n            currentPitch =\n                (this.firstDrawnOctave * this.NOTES_PER_OCTAVE) + this.LOW_C;\n        }\n        else {\n            currentPitch = this.LOW_C - 3;\n            this.drawWhiteKey(currentPitch, x);\n            this.drawWhiteKey(currentPitch + 2, this.config.whiteNoteWidth);\n            currentPitch += 3;\n            x = 2 * this.config.whiteNoteWidth;\n        }\n        for (let o = this.firstDrawnOctave; o <= this.lastDrawnOctave; o++) {\n            for (let i = 0; i < this.NOTES_PER_OCTAVE; i++) {\n                if (blackNoteIndexes.indexOf(i) === -1) {\n                    this.drawWhiteKey(currentPitch, x);\n                    x += this.config.whiteNoteWidth;\n                }\n                currentPitch++;\n            }\n        }\n        if (this.config.showOnlyOctavesUsed) {\n            currentPitch =\n                (this.firstDrawnOctave * this.NOTES_PER_OCTAVE) + this.LOW_C;\n            x = -this.config.whiteNoteWidth;\n        }\n        else {\n            this.drawWhiteKey(currentPitch, x);\n            currentPitch = this.LOW_C - 3;\n            this.drawBlackKey(currentPitch + 1, blackNoteOffset);\n            currentPitch += 3;\n            x = this.config.whiteNoteWidth;\n        }\n        for (let o = this.firstDrawnOctave; o <= this.lastDrawnOctave; o++) {\n            for (let i = 0; i < this.NOTES_PER_OCTAVE; i++) {\n                if (blackNoteIndexes.indexOf(i) !== -1) {\n                    this.drawBlackKey(currentPitch, x + blackNoteOffset);\n                }\n                else {\n                    x += this.config.whiteNoteWidth;\n                }\n                currentPitch++;\n            }\n        }\n    }\n    drawWhiteKey(index, x) {\n        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n        rect.dataset.pitch = String(index);\n        rect.setAttribute('x', String(x));\n        rect.setAttribute('y', '0');\n        rect.setAttribute('width', String(this.config.whiteNoteWidth));\n        rect.setAttribute('height', String(this.config.whiteNoteHeight));\n        rect.setAttribute('fill', 'white');\n        rect.setAttribute('original-fill', 'white');\n        rect.setAttribute('stroke', 'black');\n        rect.setAttribute('stroke-width', '3px');\n        rect.classList.add('white');\n        this.svgPiano.appendChild(rect);\n        return rect;\n    }\n    drawBlackKey(index, x) {\n        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n        rect.dataset.pitch = String(index);\n        rect.setAttribute('x', String(x));\n        rect.setAttribute('y', '0');\n        rect.setAttribute('width', String(this.config.blackNoteWidth));\n        rect.setAttribute('height', String(this.config.blackNoteHeight));\n        rect.setAttribute('fill', 'black');\n        rect.setAttribute('original-fill', 'black');\n        rect.setAttribute('stroke', 'black');\n        rect.setAttribute('stroke-width', '3px');\n        rect.classList.add('black');\n        this.svgPiano.appendChild(rect);\n        return rect;\n    }\n    clearActiveNotes() {\n        super.unfillActiveRect(this.svg);\n        const els = this.svgPiano.querySelectorAll('rect.active');\n        for (let i = 0; i < els.length; ++i) {\n            const el = els[i];\n            el.setAttribute('fill', el.getAttribute('original-fill'));\n            el.classList.remove('active');\n        }\n    }\n}\nvar ScrollType;\n(function (ScrollType) {\n    ScrollType[ScrollType[\"PAGE\"] = 0] = \"PAGE\";\n    ScrollType[ScrollType[\"NOTE\"] = 1] = \"NOTE\";\n    ScrollType[ScrollType[\"BAR\"] = 2] = \"BAR\";\n})(ScrollType || (ScrollType = {}));\nclass StaffSVGVisualizer extends BaseVisualizer {\n    constructor(sequence, div, config = {}) {\n        super(sequence, config);\n        if (config.pixelsPerTimeStep === undefined ||\n            config.pixelsPerTimeStep <= 0) {\n            this.config.pixelsPerTimeStep = 0;\n        }\n        this.instruments = config.instruments || [];\n        this.render = new staffrender__WEBPACK_IMPORTED_MODULE_0__.StaffSVGRender(this.getScoreInfo(sequence), {\n            noteHeight: this.config.noteHeight,\n            noteSpacing: this.config.noteSpacing,\n            pixelsPerTimeStep: this.config.pixelsPerTimeStep,\n            noteRGB: this.config.noteRGB,\n            activeNoteRGB: this.config.activeNoteRGB,\n            defaultKey: config.defaultKey || 0,\n            scrollType: config.scrollType || ScrollType.PAGE,\n        }, div);\n        this.drawnNotes = sequence.notes.length;\n        this.clear();\n        this.redraw();\n    }\n    clear() {\n        this.render.clear();\n    }\n    redraw(activeNote, scrollIntoView) {\n        if (this.drawnNotes !== this.noteSequence.notes.length) {\n            this.render.scoreInfo = this.getScoreInfo(this.noteSequence);\n        }\n        const activeNoteInfo = activeNote ? this.getNoteInfo(activeNote) : undefined;\n        return this.render.redraw(activeNoteInfo, scrollIntoView);\n    }\n    isNoteInInstruments(note) {\n        if (note.instrument === undefined || this.instruments.length === 0) {\n            return true;\n        }\n        else {\n            return this.instruments.indexOf(note.instrument) >= 0;\n        }\n    }\n    timeToQuarters(time) {\n        const q = time * this.noteSequence.tempos[0].qpm / 60;\n        return Math.round(q * 16) / 16;\n    }\n    getNoteInfo(note) {\n        const startQ = this.timeToQuarters(note.startTime);\n        const endQ = this.timeToQuarters(note.endTime);\n        return {\n            start: startQ,\n            length: endQ - startQ,\n            pitch: note.pitch,\n            intensity: note.velocity\n        };\n    }\n    getScoreInfo(sequence) {\n        const notesInfo = [];\n        sequence.notes.forEach((note) => {\n            if (this.isNoteInInstruments(note)) {\n                notesInfo.push(this.getNoteInfo(note));\n            }\n        });\n        return {\n            notes: notesInfo,\n            tempos: sequence.tempos ?\n                sequence.tempos.map((t) => {\n                    return { start: this.timeToQuarters(t.time), qpm: t.qpm };\n                }) :\n                [],\n            keySignatures: sequence.keySignatures ?\n                sequence.keySignatures.map((ks) => {\n                    return { start: this.timeToQuarters(ks.time), key: ks.key };\n                }) :\n                [],\n            timeSignatures: sequence.timeSignatures ?\n                sequence.timeSignatures.map((ts) => {\n                    return {\n                        start: this.timeToQuarters(ts.time),\n                        numerator: ts.numerator,\n                        denominator: ts.denominator\n                    };\n                }) :\n                []\n        };\n    }\n    clearActiveNotes() {\n        this.redraw();\n    }\n}\n//# sourceMappingURL=visualizer.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vY29yZS92aXN1YWxpemVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBa0M7QUFDMkI7QUFDeEI7QUFDSTtBQUN6QztBQUNPO0FBQ1AscUNBQXFDO0FBQ3JDLDRCQUE0QiwyREFBNkI7QUFDekQ7QUFDQTtBQUNBO0FBQ0EsWUFBWSwwREFBNEI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsc0RBQWM7QUFDakQ7QUFDQTtBQUNBLG1DQUFtQyxzREFBYztBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsNkNBQTZDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFdBQVc7QUFDL0MscUNBQXFDLFlBQVk7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isb0NBQW9DO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMs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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QywyQkFBMkI7QUFDdkUsNEJBQTRCLDJCQUEyQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QywyQkFBMkI7QUFDdkUsNEJBQTRCLDJCQUEyQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnQkFBZ0I7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsZ0NBQWdDO0FBQzFCO0FBQ1AsMENBQTBDO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix1REFBaUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9jb3JlL3Zpc3VhbGl6ZXIuanM/NjU1NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBzciBmcm9tICdzdGFmZnJlbmRlcic7XG5pbXBvcnQgeyBNQVhfTUlESV9QSVRDSCwgTUlOX01JRElfUElUQ0ggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgKiBhcyBsb2dnaW5nIGZyb20gJy4vbG9nZ2luZyc7XG5pbXBvcnQgKiBhcyBzZXF1ZW5jZXMgZnJvbSAnLi9zZXF1ZW5jZXMnO1xuY29uc3QgTUlOX05PVEVfTEVOR1RIID0gMTtcbmV4cG9ydCBjbGFzcyBCYXNlVmlzdWFsaXplciB7XG4gICAgY29uc3RydWN0b3Ioc2VxdWVuY2UsIGNvbmZpZyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGlzUXVhbnRpemVkID0gc2VxdWVuY2VzLmlzUXVhbnRpemVkU2VxdWVuY2Uoc2VxdWVuY2UpO1xuICAgICAgICBjb25zdCBxcG0gPSAoc2VxdWVuY2UudGVtcG9zICYmIHNlcXVlbmNlLnRlbXBvcy5sZW5ndGggPiAwKSA/XG4gICAgICAgICAgICBzZXF1ZW5jZS50ZW1wb3NbMF0ucXBtIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm5vdGVTZXF1ZW5jZSA9IGlzUXVhbnRpemVkID9cbiAgICAgICAgICAgIHNlcXVlbmNlcy51bnF1YW50aXplU2VxdWVuY2Uoc2VxdWVuY2UsIHFwbSkgOiBzZXF1ZW5jZTtcbiAgICAgICAgY29uc3QgZGVmYXVsdFBpeGVsc1BlclRpbWVTdGVwID0gMzA7XG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgICAgICAgbm90ZUhlaWdodDogY29uZmlnLm5vdGVIZWlnaHQgfHwgNixcbiAgICAgICAgICAgIG5vdGVTcGFjaW5nOiBjb25maWcubm90ZVNwYWNpbmcgfHwgMSxcbiAgICAgICAgICAgIHBpeGVsc1BlclRpbWVTdGVwOiBjb25maWcucGl4ZWxzUGVyVGltZVN0ZXAgfHwgZGVmYXVsdFBpeGVsc1BlclRpbWVTdGVwLFxuICAgICAgICAgICAgbm90ZVJHQjogY29uZmlnLm5vdGVSR0IgfHwgJzgsIDQxLCA2NCcsXG4gICAgICAgICAgICBhY3RpdmVOb3RlUkdCOiBjb25maWcuYWN0aXZlTm90ZVJHQiB8fCAnMjQwLCA4NCwgMTE5JyxcbiAgICAgICAgICAgIG1pblBpdGNoOiBjb25maWcubWluUGl0Y2gsXG4gICAgICAgICAgICBtYXhQaXRjaDogY29uZmlnLm1heFBpdGNoLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaXplID0gdGhpcy5nZXRTaXplKCk7XG4gICAgICAgIHRoaXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuICAgIH1cbiAgICB1cGRhdGVNaW5NYXhQaXRjaGVzKG5vRXh0cmFQYWRkaW5nID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLm1pblBpdGNoICYmIHRoaXMuY29uZmlnLm1heFBpdGNoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLm1pblBpdGNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLm1pblBpdGNoID0gTUFYX01JRElfUElUQ0g7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLm1heFBpdGNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLm1heFBpdGNoID0gTUlOX01JRElfUElUQ0g7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBub3RlIG9mIHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5taW5QaXRjaCA9IE1hdGgubWluKG5vdGUucGl0Y2gsIHRoaXMuY29uZmlnLm1pblBpdGNoKTtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLm1heFBpdGNoID0gTWF0aC5tYXgobm90ZS5waXRjaCwgdGhpcy5jb25maWcubWF4UGl0Y2gpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbm9FeHRyYVBhZGRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLm1pblBpdGNoIC09IDI7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5tYXhQaXRjaCArPSAyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFNpemUoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlTWluTWF4UGl0Y2hlcygpO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSAodGhpcy5jb25maWcubWF4UGl0Y2ggLSB0aGlzLmNvbmZpZy5taW5QaXRjaCkgKiB0aGlzLmNvbmZpZy5ub3RlSGVpZ2h0O1xuICAgICAgICBjb25zdCBlbmRUaW1lID0gdGhpcy5ub3RlU2VxdWVuY2UudG90YWxUaW1lO1xuICAgICAgICBpZiAoIWVuZFRpbWUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNlcXVlbmNlIHlvdSBhcmUgdXNpbmcgd2l0aCB0aGUgdmlzdWFsaXplciBkb2VzIG5vdCBoYXZlIGEgJyArXG4gICAgICAgICAgICAgICAgJ3RvdGFsUXVhbnRpemVkU3RlcHMgb3IgdG90YWxUaW1lICcgK1xuICAgICAgICAgICAgICAgICdmaWVsZCBzZXQsIHNvIHRoZSB2aXN1YWxpemVyIGNhblxcJ3QgYmUgaG9yaXpvbnRhbGx5ICcgK1xuICAgICAgICAgICAgICAgICdzaXplZCBjb3JyZWN0bHkuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2lkdGggPSAoZW5kVGltZSAqIHRoaXMuY29uZmlnLnBpeGVsc1BlclRpbWVTdGVwKTtcbiAgICAgICAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9O1xuICAgIH1cbiAgICBnZXROb3RlUG9zaXRpb24obm90ZSwgbm90ZUluZGV4KSB7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGhpcy5nZXROb3RlRW5kVGltZShub3RlKSAtIHRoaXMuZ2V0Tm90ZVN0YXJ0VGltZShub3RlKTtcbiAgICAgICAgY29uc3QgeCA9ICh0aGlzLmdldE5vdGVTdGFydFRpbWUobm90ZSkgKiB0aGlzLmNvbmZpZy5waXhlbHNQZXJUaW1lU3RlcCk7XG4gICAgICAgIGNvbnN0IHcgPSBNYXRoLm1heCh0aGlzLmNvbmZpZy5waXhlbHNQZXJUaW1lU3RlcCAqIGR1cmF0aW9uIC0gdGhpcy5jb25maWcubm90ZVNwYWNpbmcsIE1JTl9OT1RFX0xFTkdUSCk7XG4gICAgICAgIGNvbnN0IHkgPSB0aGlzLmhlaWdodCAtXG4gICAgICAgICAgICAoKG5vdGUucGl0Y2ggLSB0aGlzLmNvbmZpZy5taW5QaXRjaCkgKiB0aGlzLmNvbmZpZy5ub3RlSGVpZ2h0KTtcbiAgICAgICAgcmV0dXJuIHsgeCwgeSwgdywgaDogdGhpcy5jb25maWcubm90ZUhlaWdodCB9O1xuICAgIH1cbiAgICBzY3JvbGxJbnRvVmlld0lmTmVlZGVkKHNjcm9sbEludG9WaWV3LCBhY3RpdmVOb3RlUG9zaXRpb24pIHtcbiAgICAgICAgaWYgKHNjcm9sbEludG9WaWV3ICYmIHRoaXMucGFyZW50RWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgICAgICBpZiAoYWN0aXZlTm90ZVBvc2l0aW9uID5cbiAgICAgICAgICAgICAgICAodGhpcy5wYXJlbnRFbGVtZW50LnNjcm9sbExlZnQgKyBjb250YWluZXJXaWR0aCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQuc2Nyb2xsTGVmdCA9IGFjdGl2ZU5vdGVQb3NpdGlvbiAtIDIwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldE5vdGVTdGFydFRpbWUobm90ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChub3RlLnN0YXJ0VGltZSAqIDEwMDAwMDAwMCkgLyAxMDAwMDAwMDA7XG4gICAgfVxuICAgIGdldE5vdGVFbmRUaW1lKG5vdGUpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobm90ZS5lbmRUaW1lICogMTAwMDAwMDAwKSAvIDEwMDAwMDAwMDtcbiAgICB9XG4gICAgaXNQYWludGluZ0FjdGl2ZU5vdGUobm90ZSwgcGxheWVkTm90ZSkge1xuICAgICAgICBjb25zdCBpc1BsYXllZE5vdGUgPSB0aGlzLmdldE5vdGVTdGFydFRpbWUobm90ZSkgPT09IHRoaXMuZ2V0Tm90ZVN0YXJ0VGltZShwbGF5ZWROb3RlKTtcbiAgICAgICAgY29uc3QgaGVsZERvd25EdXJpbmdQbGF5ZWROb3RlID0gdGhpcy5nZXROb3RlU3RhcnRUaW1lKG5vdGUpIDw9IHRoaXMuZ2V0Tm90ZVN0YXJ0VGltZShwbGF5ZWROb3RlKSAmJlxuICAgICAgICAgICAgdGhpcy5nZXROb3RlRW5kVGltZShub3RlKSA+PSB0aGlzLmdldE5vdGVFbmRUaW1lKHBsYXllZE5vdGUpO1xuICAgICAgICByZXR1cm4gaXNQbGF5ZWROb3RlIHx8IGhlbGREb3duRHVyaW5nUGxheWVkTm90ZTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGlhbm9Sb2xsQ2FudmFzVmlzdWFsaXplciBleHRlbmRzIEJhc2VWaXN1YWxpemVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXF1ZW5jZSwgY2FudmFzLCBjb25maWcgPSB7fSkge1xuICAgICAgICBzdXBlcihzZXF1ZW5jZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50ID0gY2FudmFzLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG4gICAgICAgIGlmICh0aGlzLmN0eCkge1xuICAgICAgICAgICAgdGhpcy5jdHguY2FudmFzLndpZHRoID0gZHByICogdGhpcy53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQgPSBkcHIgKiB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IGAke3RoaXMud2lkdGh9cHhgO1xuICAgICAgICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke3RoaXMuaGVpZ2h0fXB4YDtcbiAgICAgICAgICAgIHRoaXMuY3R4LnNjYWxlKGRwciwgZHByKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZHJhdygpO1xuICAgIH1cbiAgICByZWRyYXcoYWN0aXZlTm90ZSwgc2Nyb2xsSW50b1ZpZXcpIHtcbiAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICBsZXQgYWN0aXZlTm90ZVBvc2l0aW9uO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBub3RlID0gdGhpcy5ub3RlU2VxdWVuY2Uubm90ZXNbaV07XG4gICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5nZXROb3RlUG9zaXRpb24obm90ZSwgaSk7XG4gICAgICAgICAgICBjb25zdCBvcGFjaXR5QmFzZWxpbmUgPSAwLjI7XG4gICAgICAgICAgICBjb25zdCBvcGFjaXR5ID0gbm90ZS52ZWxvY2l0eSA/IG5vdGUudmVsb2NpdHkgLyAxMDAgKyBvcGFjaXR5QmFzZWxpbmUgOiAxO1xuICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBhY3RpdmVOb3RlICYmIHRoaXMuaXNQYWludGluZ0FjdGl2ZU5vdGUobm90ZSwgYWN0aXZlTm90ZSk7XG4gICAgICAgICAgICBjb25zdCBmaWxsID0gYHJnYmEoJHtpc0FjdGl2ZSA/IHRoaXMuY29uZmlnLmFjdGl2ZU5vdGVSR0IgOiB0aGlzLmNvbmZpZy5ub3RlUkdCfSxcbiAgJHtvcGFjaXR5fSlgO1xuICAgICAgICAgICAgdGhpcy5yZWRyYXdOb3RlKHNpemUueCwgc2l6ZS55LCBzaXplLncsIHNpemUuaCwgZmlsbCk7XG4gICAgICAgICAgICBpZiAoaXNBY3RpdmUgJiYgbm90ZSA9PT0gYWN0aXZlTm90ZSkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZU5vdGVQb3NpdGlvbiA9IHNpemUueDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjcm9sbEludG9WaWV3SWZOZWVkZWQoc2Nyb2xsSW50b1ZpZXcsIGFjdGl2ZU5vdGVQb3NpdGlvbik7XG4gICAgICAgIHJldHVybiBhY3RpdmVOb3RlUG9zaXRpb247XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG4gICAgY2xlYXJBY3RpdmVOb3RlcygpIHtcbiAgICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICB9XG4gICAgcmVkcmF3Tm90ZSh4LCB5LCB3LCBoLCBmaWxsKSB7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IGZpbGw7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KE1hdGgucm91bmQoeCksIE1hdGgucm91bmQoeSksIE1hdGgucm91bmQodyksIE1hdGgucm91bmQoaCkpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBWaXN1YWxpemVyIGV4dGVuZHMgUGlhbm9Sb2xsQ2FudmFzVmlzdWFsaXplciB7XG4gICAgY29uc3RydWN0b3Ioc2VxdWVuY2UsIGNhbnZhcywgY29uZmlnID0ge30pIHtcbiAgICAgICAgc3VwZXIoc2VxdWVuY2UsIGNhbnZhcywgY29uZmlnKTtcbiAgICAgICAgbG9nZ2luZy5sb2coJ21tLlZpc3VhbGl6ZXIgaXMgZGVwcmVjYXRlZCwgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSBcXFxuICAgICAgICAgdmVyc2lvbi4gUGxlYXNlIHVzZSBtbS5QaWFub1JvbGxDYW52YXNWaXN1YWxpemVyIGluc3RlYWQnLCAnbW0uVmlzdWFsaXplcicsIDUpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBCYXNlU1ZHVmlzdWFsaXplciBleHRlbmRzIEJhc2VWaXN1YWxpemVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXF1ZW5jZSwgY29uZmlnID0ge30pIHtcbiAgICAgICAgc3VwZXIoc2VxdWVuY2UsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMuZHJhd24gPSBmYWxzZTtcbiAgICB9XG4gICAgcmVkcmF3KGFjdGl2ZU5vdGUsIHNjcm9sbEludG9WaWV3KSB7XG4gICAgICAgIGlmICghdGhpcy5kcmF3bikge1xuICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhY3RpdmVOb3RlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVuZmlsbEFjdGl2ZVJlY3QodGhpcy5zdmcpO1xuICAgICAgICBsZXQgYWN0aXZlTm90ZVBvc2l0aW9uO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBub3RlID0gdGhpcy5ub3RlU2VxdWVuY2Uubm90ZXNbaV07XG4gICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGFjdGl2ZU5vdGUgJiYgdGhpcy5pc1BhaW50aW5nQWN0aXZlTm90ZShub3RlLCBhY3RpdmVOb3RlKTtcbiAgICAgICAgICAgIGlmICghaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy5zdmcucXVlcnlTZWxlY3RvcihgcmVjdFtkYXRhLWluZGV4PVwiJHtpfVwiXWApO1xuICAgICAgICAgICAgdGhpcy5maWxsQWN0aXZlUmVjdChlbCwgbm90ZSk7XG4gICAgICAgICAgICBpZiAobm90ZSA9PT0gYWN0aXZlTm90ZSkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZU5vdGVQb3NpdGlvbiA9IHBhcnNlRmxvYXQoZWwuZ2V0QXR0cmlidXRlKCd4JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZChzY3JvbGxJbnRvVmlldywgYWN0aXZlTm90ZVBvc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuIGFjdGl2ZU5vdGVQb3NpdGlvbjtcbiAgICB9XG4gICAgZmlsbEFjdGl2ZVJlY3QoZWwsIG5vdGUpIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdmaWxsJywgdGhpcy5nZXROb3RlRmlsbENvbG9yKG5vdGUsIHRydWUpKTtcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgfVxuICAgIHVuZmlsbEFjdGl2ZVJlY3Qoc3ZnKSB7XG4gICAgICAgIGNvbnN0IGVscyA9IHN2Zy5xdWVyeVNlbGVjdG9yQWxsKCdyZWN0LmFjdGl2ZScpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVscy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgZWwgPSBlbHNbaV07XG4gICAgICAgICAgICBjb25zdCBmaWxsID0gdGhpcy5nZXROb3RlRmlsbENvbG9yKHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzW3BhcnNlSW50KGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcpLCAxMCldLCBmYWxzZSk7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCBmaWxsKTtcbiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRyYXcoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ub3RlU2VxdWVuY2Uubm90ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG5vdGUgPSB0aGlzLm5vdGVTZXF1ZW5jZS5ub3Rlc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmdldE5vdGVQb3NpdGlvbihub3RlLCBpKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGwgPSB0aGlzLmdldE5vdGVGaWxsQ29sb3Iobm90ZSwgZmFsc2UpO1xuICAgICAgICAgICAgY29uc3QgZGF0YUF0dHJpYnV0ZXMgPSBbXG4gICAgICAgICAgICAgICAgWydpbmRleCcsIGldLFxuICAgICAgICAgICAgICAgIFsnaW5zdHJ1bWVudCcsIG5vdGUuaW5zdHJ1bWVudF0sXG4gICAgICAgICAgICAgICAgWydwcm9ncmFtJywgbm90ZS5wcm9ncmFtXSxcbiAgICAgICAgICAgICAgICBbJ2lzRHJ1bScsIG5vdGUuaXNEcnVtID09PSB0cnVlXSxcbiAgICAgICAgICAgICAgICBbJ3BpdGNoJywgbm90ZS5waXRjaF0sXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgY29uc3QgY3NzUHJvcGVydGllcyA9IFtcbiAgICAgICAgICAgICAgICBbJy0tbWlkaS12ZWxvY2l0eScsXG4gICAgICAgICAgICAgICAgICAgIFN0cmluZyhub3RlLnZlbG9jaXR5ICE9PSB1bmRlZmluZWQgPyBub3RlLnZlbG9jaXR5IDogMTI3KV1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB0aGlzLmRyYXdOb3RlKHNpemUueCwgc2l6ZS55LCBzaXplLncsIHNpemUuaCwgZmlsbCwgZGF0YUF0dHJpYnV0ZXMsIGNzc1Byb3BlcnRpZXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHJhd24gPSB0cnVlO1xuICAgIH1cbiAgICBnZXROb3RlRmlsbENvbG9yKG5vdGUsIGlzQWN0aXZlKSB7XG4gICAgICAgIGNvbnN0IG9wYWNpdHlCYXNlbGluZSA9IDAuMjtcbiAgICAgICAgY29uc3Qgb3BhY2l0eSA9IG5vdGUudmVsb2NpdHkgPyBub3RlLnZlbG9jaXR5IC8gMTAwICsgb3BhY2l0eUJhc2VsaW5lIDogMTtcbiAgICAgICAgY29uc3QgZmlsbCA9IGByZ2JhKCR7aXNBY3RpdmUgPyB0aGlzLmNvbmZpZy5hY3RpdmVOb3RlUkdCIDogdGhpcy5jb25maWcubm90ZVJHQn0sXG4gICR7b3BhY2l0eX0pYDtcbiAgICAgICAgcmV0dXJuIGZpbGw7XG4gICAgfVxuICAgIGRyYXdOb3RlKHgsIHksIHcsIGgsIGZpbGwsIGRhdGFBdHRyaWJ1dGVzLCBjc3NQcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmICghdGhpcy5zdmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdyZWN0Jyk7XG4gICAgICAgIHJlY3QuY2xhc3NMaXN0LmFkZCgnbm90ZScpO1xuICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgnZmlsbCcsIGZpbGwpO1xuICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgneCcsIGAke01hdGgucm91bmQoeCl9YCk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCd5JywgYCR7TWF0aC5yb3VuZCh5KX1gKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7TWF0aC5yb3VuZCh3KX1gKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke01hdGgucm91bmQoaCl9YCk7XG4gICAgICAgIGRhdGFBdHRyaWJ1dGVzLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZWN0LmRhdGFzZXRba2V5XSA9IGAke3ZhbHVlfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjc3NQcm9wZXJ0aWVzLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgcmVjdC5zdHlsZS5zZXRQcm9wZXJ0eShrZXksIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3ZnLmFwcGVuZENoaWxkKHJlY3QpO1xuICAgIH1cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5zdmcuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIHRoaXMuZHJhd24gPSBmYWxzZTtcbiAgICB9XG4gICAgY2xlYXJBY3RpdmVOb3RlcygpIHtcbiAgICAgICAgdGhpcy51bmZpbGxBY3RpdmVSZWN0KHRoaXMuc3ZnKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGlhbm9Sb2xsU1ZHVmlzdWFsaXplciBleHRlbmRzIEJhc2VTVkdWaXN1YWxpemVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXF1ZW5jZSwgc3ZnLCBjb25maWcgPSB7fSkge1xuICAgICAgICBzdXBlcihzZXF1ZW5jZSwgY29uZmlnKTtcbiAgICAgICAgaWYgKCEoc3ZnIGluc3RhbmNlb2YgU1ZHU1ZHRWxlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyB2aXN1YWxpemVyIHJlcXVpcmVzIGFuIDxzdmc+IGVsZW1lbnQgdG8gZGlzcGxheSB0aGUgdmlzdWFsaXphdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3ZnID0gc3ZnO1xuICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQgPSBzdmcucGFyZW50RWxlbWVudDtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuZ2V0U2l6ZSgpO1xuICAgICAgICB0aGlzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgICAgICAgdGhpcy5zdmcuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5zdmcuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZHJhdygpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBXYXRlcmZhbGxTVkdWaXN1YWxpemVyIGV4dGVuZHMgQmFzZVNWR1Zpc3VhbGl6ZXIge1xuICAgIGNvbnN0cnVjdG9yKHNlcXVlbmNlLCBwYXJlbnRFbGVtZW50LCBjb25maWcgPSB7fSkge1xuICAgICAgICBzdXBlcihzZXF1ZW5jZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5OT1RFU19QRVJfT0NUQVZFID0gMTI7XG4gICAgICAgIHRoaXMuV0hJVEVfTk9URVNfUEVSX09DVEFWRSA9IDc7XG4gICAgICAgIHRoaXMuTE9XX0MgPSAyNDtcbiAgICAgICAgdGhpcy5maXJzdERyYXduT2N0YXZlID0gMDtcbiAgICAgICAgdGhpcy5sYXN0RHJhd25PY3RhdmUgPSA2O1xuICAgICAgICBpZiAoIShwYXJlbnRFbGVtZW50IGluc3RhbmNlb2YgSFRNTERpdkVsZW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgdmlzdWFsaXplciByZXF1aXJlcyBhIDxkaXY+IGVsZW1lbnQgdG8gZGlzcGxheSB0aGUgdmlzdWFsaXphdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29uZmlnLndoaXRlTm90ZVdpZHRoID0gY29uZmlnLndoaXRlTm90ZVdpZHRoIHx8IDIwO1xuICAgICAgICB0aGlzLmNvbmZpZy5ibGFja05vdGVXaWR0aCA9XG4gICAgICAgICAgICBjb25maWcuYmxhY2tOb3RlV2lkdGggfHwgdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGggKiAyIC8gMztcbiAgICAgICAgdGhpcy5jb25maWcud2hpdGVOb3RlSGVpZ2h0ID0gY29uZmlnLndoaXRlTm90ZUhlaWdodCB8fCA3MDtcbiAgICAgICAgdGhpcy5jb25maWcuYmxhY2tOb3RlSGVpZ2h0ID0gY29uZmlnLmJsYWNrTm90ZUhlaWdodCB8fCAoMiAqIDcwIC8gMyk7XG4gICAgICAgIHRoaXMuY29uZmlnLnNob3dPbmx5T2N0YXZlc1VzZWQgPSBjb25maWcuc2hvd09ubHlPY3RhdmVzVXNlZDtcbiAgICAgICAgdGhpcy5zZXR1cERPTShwYXJlbnRFbGVtZW50KTtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuZ2V0U2l6ZSgpO1xuICAgICAgICB0aGlzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgICAgICAgdGhpcy5zdmcuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRofXB4YDtcbiAgICAgICAgdGhpcy5zdmcuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLnN2Z1BpYW5vLnN0eWxlLndpZHRoID0gYCR7dGhpcy53aWR0aH1weGA7XG4gICAgICAgIHRoaXMuc3ZnUGlhbm8uc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5jb25maWcud2hpdGVOb3RlSGVpZ2h0fXB4YDtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLndpZHRoID1cbiAgICAgICAgICAgIGAke3RoaXMud2lkdGggKyB0aGlzLmNvbmZpZy53aGl0ZU5vdGVXaWR0aH1weGA7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLnBhcmVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZHJhd1BpYW5vKCk7XG4gICAgICAgIHRoaXMuZHJhdygpO1xuICAgIH1cbiAgICBzZXR1cERPTShjb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCd3YXRlcmZhbGwtbm90ZXMtY29udGFpbmVyJyk7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQsIDIwMCk7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID1cbiAgICAgICAgICAgIGAke2hlaWdodCAtIHRoaXMuY29uZmlnLndoaXRlTm90ZUhlaWdodH1weGA7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPVxuICAgICAgICAgICAgYCR7aGVpZ2h0IC0gdGhpcy5jb25maWcud2hpdGVOb3RlSGVpZ2h0fXB4YDtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLmJveFNpemluZyA9ICdib3JkZXItYm94JztcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93WCA9ICdoaWRkZW4nO1xuICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUub3ZlcmZsb3dZID0gJ2F1dG8nO1xuICAgICAgICB0aGlzLnN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7XG4gICAgICAgIHRoaXMuc3ZnUGlhbm8gPVxuICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgICAgICAgdGhpcy5zdmcuY2xhc3NMaXN0LmFkZCgnd2F0ZXJmYWxsLW5vdGVzJyk7XG4gICAgICAgIHRoaXMuc3ZnUGlhbm8uY2xhc3NMaXN0LmFkZCgnd2F0ZXJmYWxsLXBpYW5vJyk7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnN2Zyk7XG4gICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMucGFyZW50RWxlbWVudCk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnN2Z1BpYW5vKTtcbiAgICB9XG4gICAgcmVkcmF3KGFjdGl2ZU5vdGUsIHNjcm9sbEludG9WaWV3KSB7XG4gICAgICAgIGlmICghdGhpcy5kcmF3bikge1xuICAgICAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhY3RpdmVOb3RlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsZWFyQWN0aXZlTm90ZXMoKTtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSB0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUuaGVpZ2h0O1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBub3RlID0gdGhpcy5ub3RlU2VxdWVuY2Uubm90ZXNbaV07XG4gICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGFjdGl2ZU5vdGUgJiYgdGhpcy5pc1BhaW50aW5nQWN0aXZlTm90ZShub3RlLCBhY3RpdmVOb3RlKTtcbiAgICAgICAgICAgIGlmICghaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy5zdmcucXVlcnlTZWxlY3RvcihgcmVjdFtkYXRhLWluZGV4PVwiJHtpfVwiXWApO1xuICAgICAgICAgICAgdGhpcy5maWxsQWN0aXZlUmVjdChlbCwgbm90ZSk7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLnN2Z1BpYW5vLnF1ZXJ5U2VsZWN0b3IoYHJlY3RbZGF0YS1waXRjaD1cIiR7bm90ZS5waXRjaH1cIl1gKTtcbiAgICAgICAgICAgIHRoaXMuZmlsbEFjdGl2ZVJlY3Qoa2V5LCBub3RlKTtcbiAgICAgICAgICAgIGlmIChub3RlID09PSBhY3RpdmVOb3RlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IHBhcnNlRmxvYXQoZWwuZ2V0QXR0cmlidXRlKCd5JykpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHBhcnNlRmxvYXQoZWwuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSk7XG4gICAgICAgICAgICAgICAgaWYgKHkgPCAodGhpcy5wYXJlbnRFbGVtZW50LnNjcm9sbFRvcCAtIGhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnNjcm9sbFRvcCA9IHkgKyBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXRTaXplKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZU1pbk1heFBpdGNoZXModHJ1ZSk7XG4gICAgICAgIGxldCB3aGl0ZU5vdGVzRHJhd24gPSA1MjtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3dPbmx5T2N0YXZlc1VzZWQpIHtcbiAgICAgICAgICAgIGxldCBmb3VuZEZpcnN0ID0gZmFsc2UsIGZvdW5kTGFzdCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA3OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjID0gdGhpcy5MT1dfQyArIHRoaXMuTk9URVNfUEVSX09DVEFWRSAqIGk7XG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZEZpcnN0ICYmIGMgPiB0aGlzLmNvbmZpZy5taW5QaXRjaCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcnN0RHJhd25PY3RhdmUgPSBpIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgZm91bmRGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZm91bmRMYXN0ICYmIGMgPiB0aGlzLmNvbmZpZy5tYXhQaXRjaCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3REcmF3bk9jdGF2ZSA9IGkgLSAxO1xuICAgICAgICAgICAgICAgICAgICBmb3VuZExhc3QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdoaXRlTm90ZXNEcmF3biA9ICh0aGlzLmxhc3REcmF3bk9jdGF2ZSAtIHRoaXMuZmlyc3REcmF3bk9jdGF2ZSArIDEpICpcbiAgICAgICAgICAgICAgICB0aGlzLldISVRFX05PVEVTX1BFUl9PQ1RBVkU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2lkdGggPSB3aGl0ZU5vdGVzRHJhd24gKiB0aGlzLmNvbmZpZy53aGl0ZU5vdGVXaWR0aDtcbiAgICAgICAgY29uc3QgZW5kVGltZSA9IHRoaXMubm90ZVNlcXVlbmNlLnRvdGFsVGltZTtcbiAgICAgICAgaWYgKCFlbmRUaW1lKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzZXF1ZW5jZSB5b3UgYXJlIHVzaW5nIHdpdGggdGhlIHZpc3VhbGl6ZXIgZG9lcyBub3QgaGF2ZSBhICcgK1xuICAgICAgICAgICAgICAgICd0b3RhbFF1YW50aXplZFN0ZXBzIG9yIHRvdGFsVGltZSAnICtcbiAgICAgICAgICAgICAgICAnZmllbGQgc2V0LCBzbyB0aGUgdmlzdWFsaXplciBjYW5cXCd0IGJlIGhvcml6b250YWxseSAnICtcbiAgICAgICAgICAgICAgICAnc2l6ZWQgY29ycmVjdGx5LicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KGVuZFRpbWUgKiB0aGlzLmNvbmZpZy5waXhlbHNQZXJUaW1lU3RlcCwgTUlOX05PVEVfTEVOR1RIKTtcbiAgICAgICAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9O1xuICAgIH1cbiAgICBnZXROb3RlUG9zaXRpb24obm90ZSwgbm90ZUluZGV4KSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLnN2Z1BpYW5vLnF1ZXJ5U2VsZWN0b3IoYHJlY3RbZGF0YS1waXRjaD1cIiR7bm90ZS5waXRjaH1cIl1gKTtcbiAgICAgICAgaWYgKCFyZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsZW4gPSB0aGlzLmdldE5vdGVFbmRUaW1lKG5vdGUpIC0gdGhpcy5nZXROb3RlU3RhcnRUaW1lKG5vdGUpO1xuICAgICAgICBjb25zdCB4ID0gTnVtYmVyKHJlY3QuZ2V0QXR0cmlidXRlKCd4JykpO1xuICAgICAgICBjb25zdCB3ID0gTnVtYmVyKHJlY3QuZ2V0QXR0cmlidXRlKCd3aWR0aCcpKTtcbiAgICAgICAgY29uc3QgaCA9IE1hdGgubWF4KHRoaXMuY29uZmlnLnBpeGVsc1BlclRpbWVTdGVwICogbGVuIC0gdGhpcy5jb25maWcubm90ZVNwYWNpbmcsIE1JTl9OT1RFX0xFTkdUSCk7XG4gICAgICAgIGNvbnN0IHkgPSB0aGlzLmhlaWdodCAtXG4gICAgICAgICAgICAodGhpcy5nZXROb3RlU3RhcnRUaW1lKG5vdGUpICogdGhpcy5jb25maWcucGl4ZWxzUGVyVGltZVN0ZXApIC0gaDtcbiAgICAgICAgcmV0dXJuIHsgeCwgeSwgdywgaCB9O1xuICAgIH1cbiAgICBkcmF3UGlhbm8oKSB7XG4gICAgICAgIHRoaXMuc3ZnUGlhbm8uaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGNvbnN0IGJsYWNrTm90ZU9mZnNldCA9IHRoaXMuY29uZmlnLndoaXRlTm90ZVdpZHRoIC0gdGhpcy5jb25maWcuYmxhY2tOb3RlV2lkdGggLyAyO1xuICAgICAgICBjb25zdCBibGFja05vdGVJbmRleGVzID0gWzEsIDMsIDYsIDgsIDEwXTtcbiAgICAgICAgbGV0IHggPSAwO1xuICAgICAgICBsZXQgY3VycmVudFBpdGNoID0gMDtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3dPbmx5T2N0YXZlc1VzZWQpIHtcbiAgICAgICAgICAgIGN1cnJlbnRQaXRjaCA9XG4gICAgICAgICAgICAgICAgKHRoaXMuZmlyc3REcmF3bk9jdGF2ZSAqIHRoaXMuTk9URVNfUEVSX09DVEFWRSkgKyB0aGlzLkxPV19DO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudFBpdGNoID0gdGhpcy5MT1dfQyAtIDM7XG4gICAgICAgICAgICB0aGlzLmRyYXdXaGl0ZUtleShjdXJyZW50UGl0Y2gsIHgpO1xuICAgICAgICAgICAgdGhpcy5kcmF3V2hpdGVLZXkoY3VycmVudFBpdGNoICsgMiwgdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGgpO1xuICAgICAgICAgICAgY3VycmVudFBpdGNoICs9IDM7XG4gICAgICAgICAgICB4ID0gMiAqIHRoaXMuY29uZmlnLndoaXRlTm90ZVdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IG8gPSB0aGlzLmZpcnN0RHJhd25PY3RhdmU7IG8gPD0gdGhpcy5sYXN0RHJhd25PY3RhdmU7IG8rKykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLk5PVEVTX1BFUl9PQ1RBVkU7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChibGFja05vdGVJbmRleGVzLmluZGV4T2YoaSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd1doaXRlS2V5KGN1cnJlbnRQaXRjaCwgeCk7XG4gICAgICAgICAgICAgICAgICAgIHggKz0gdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGN1cnJlbnRQaXRjaCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG93T25seU9jdGF2ZXNVc2VkKSB7XG4gICAgICAgICAgICBjdXJyZW50UGl0Y2ggPVxuICAgICAgICAgICAgICAgICh0aGlzLmZpcnN0RHJhd25PY3RhdmUgKiB0aGlzLk5PVEVTX1BFUl9PQ1RBVkUpICsgdGhpcy5MT1dfQztcbiAgICAgICAgICAgIHggPSAtdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdXaGl0ZUtleShjdXJyZW50UGl0Y2gsIHgpO1xuICAgICAgICAgICAgY3VycmVudFBpdGNoID0gdGhpcy5MT1dfQyAtIDM7XG4gICAgICAgICAgICB0aGlzLmRyYXdCbGFja0tleShjdXJyZW50UGl0Y2ggKyAxLCBibGFja05vdGVPZmZzZXQpO1xuICAgICAgICAgICAgY3VycmVudFBpdGNoICs9IDM7XG4gICAgICAgICAgICB4ID0gdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgbyA9IHRoaXMuZmlyc3REcmF3bk9jdGF2ZTsgbyA8PSB0aGlzLmxhc3REcmF3bk9jdGF2ZTsgbysrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuTk9URVNfUEVSX09DVEFWRTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGJsYWNrTm90ZUluZGV4ZXMuaW5kZXhPZihpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmxhY2tLZXkoY3VycmVudFBpdGNoLCB4ICsgYmxhY2tOb3RlT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHggKz0gdGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGN1cnJlbnRQaXRjaCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGRyYXdXaGl0ZUtleShpbmRleCwgeCkge1xuICAgICAgICBjb25zdCByZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdyZWN0Jyk7XG4gICAgICAgIHJlY3QuZGF0YXNldC5waXRjaCA9IFN0cmluZyhpbmRleCk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCd4JywgU3RyaW5nKHgpKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3knLCAnMCcpO1xuICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBTdHJpbmcodGhpcy5jb25maWcud2hpdGVOb3RlV2lkdGgpKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIFN0cmluZyh0aGlzLmNvbmZpZy53aGl0ZU5vdGVIZWlnaHQpKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnd2hpdGUnKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ29yaWdpbmFsLWZpbGwnLCAnd2hpdGUnKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdibGFjaycpO1xuICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzNweCcpO1xuICAgICAgICByZWN0LmNsYXNzTGlzdC5hZGQoJ3doaXRlJyk7XG4gICAgICAgIHRoaXMuc3ZnUGlhbm8uYXBwZW5kQ2hpbGQocmVjdCk7XG4gICAgICAgIHJldHVybiByZWN0O1xuICAgIH1cbiAgICBkcmF3QmxhY2tLZXkoaW5kZXgsIHgpIHtcbiAgICAgICAgY29uc3QgcmVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncmVjdCcpO1xuICAgICAgICByZWN0LmRhdGFzZXQucGl0Y2ggPSBTdHJpbmcoaW5kZXgpO1xuICAgICAgICByZWN0LnNldEF0dHJpYnV0ZSgneCcsIFN0cmluZyh4KSk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCd5JywgJzAnKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKHRoaXMuY29uZmlnLmJsYWNrTm90ZVdpZHRoKSk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBTdHJpbmcodGhpcy5jb25maWcuYmxhY2tOb3RlSGVpZ2h0KSk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCdmaWxsJywgJ2JsYWNrJyk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCdvcmlnaW5hbC1maWxsJywgJ2JsYWNrJyk7XG4gICAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnYmxhY2snKTtcbiAgICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICczcHgnKTtcbiAgICAgICAgcmVjdC5jbGFzc0xpc3QuYWRkKCdibGFjaycpO1xuICAgICAgICB0aGlzLnN2Z1BpYW5vLmFwcGVuZENoaWxkKHJlY3QpO1xuICAgICAgICByZXR1cm4gcmVjdDtcbiAgICB9XG4gICAgY2xlYXJBY3RpdmVOb3RlcygpIHtcbiAgICAgICAgc3VwZXIudW5maWxsQWN0aXZlUmVjdCh0aGlzLnN2Zyk7XG4gICAgICAgIGNvbnN0IGVscyA9IHRoaXMuc3ZnUGlhbm8ucXVlcnlTZWxlY3RvckFsbCgncmVjdC5hY3RpdmUnKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGVsID0gZWxzW2ldO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdmaWxsJywgZWwuZ2V0QXR0cmlidXRlKCdvcmlnaW5hbC1maWxsJykpO1xuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgdmFyIFNjcm9sbFR5cGU7XG4oZnVuY3Rpb24gKFNjcm9sbFR5cGUpIHtcbiAgICBTY3JvbGxUeXBlW1Njcm9sbFR5cGVbXCJQQUdFXCJdID0gMF0gPSBcIlBBR0VcIjtcbiAgICBTY3JvbGxUeXBlW1Njcm9sbFR5cGVbXCJOT1RFXCJdID0gMV0gPSBcIk5PVEVcIjtcbiAgICBTY3JvbGxUeXBlW1Njcm9sbFR5cGVbXCJCQVJcIl0gPSAyXSA9IFwiQkFSXCI7XG59KShTY3JvbGxUeXBlIHx8IChTY3JvbGxUeXBlID0ge30pKTtcbmV4cG9ydCBjbGFzcyBTdGFmZlNWR1Zpc3VhbGl6ZXIgZXh0ZW5kcyBCYXNlVmlzdWFsaXplciB7XG4gICAgY29uc3RydWN0b3Ioc2VxdWVuY2UsIGRpdiwgY29uZmlnID0ge30pIHtcbiAgICAgICAgc3VwZXIoc2VxdWVuY2UsIGNvbmZpZyk7XG4gICAgICAgIGlmIChjb25maWcucGl4ZWxzUGVyVGltZVN0ZXAgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgY29uZmlnLnBpeGVsc1BlclRpbWVTdGVwIDw9IDApIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLnBpeGVsc1BlclRpbWVTdGVwID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc3RydW1lbnRzID0gY29uZmlnLmluc3RydW1lbnRzIHx8IFtdO1xuICAgICAgICB0aGlzLnJlbmRlciA9IG5ldyBzci5TdGFmZlNWR1JlbmRlcih0aGlzLmdldFNjb3JlSW5mbyhzZXF1ZW5jZSksIHtcbiAgICAgICAgICAgIG5vdGVIZWlnaHQ6IHRoaXMuY29uZmlnLm5vdGVIZWlnaHQsXG4gICAgICAgICAgICBub3RlU3BhY2luZzogdGhpcy5jb25maWcubm90ZVNwYWNpbmcsXG4gICAgICAgICAgICBwaXhlbHNQZXJUaW1lU3RlcDogdGhpcy5jb25maWcucGl4ZWxzUGVyVGltZVN0ZXAsXG4gICAgICAgICAgICBub3RlUkdCOiB0aGlzLmNvbmZpZy5ub3RlUkdCLFxuICAgICAgICAgICAgYWN0aXZlTm90ZVJHQjogdGhpcy5jb25maWcuYWN0aXZlTm90ZVJHQixcbiAgICAgICAgICAgIGRlZmF1bHRLZXk6IGNvbmZpZy5kZWZhdWx0S2V5IHx8IDAsXG4gICAgICAgICAgICBzY3JvbGxUeXBlOiBjb25maWcuc2Nyb2xsVHlwZSB8fCBTY3JvbGxUeXBlLlBBR0UsXG4gICAgICAgIH0sIGRpdik7XG4gICAgICAgIHRoaXMuZHJhd25Ob3RlcyA9IHNlcXVlbmNlLm5vdGVzLmxlbmd0aDtcbiAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICB0aGlzLnJlZHJhdygpO1xuICAgIH1cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIuY2xlYXIoKTtcbiAgICB9XG4gICAgcmVkcmF3KGFjdGl2ZU5vdGUsIHNjcm9sbEludG9WaWV3KSB7XG4gICAgICAgIGlmICh0aGlzLmRyYXduTm90ZXMgIT09IHRoaXMubm90ZVNlcXVlbmNlLm5vdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2NvcmVJbmZvID0gdGhpcy5nZXRTY29yZUluZm8odGhpcy5ub3RlU2VxdWVuY2UpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFjdGl2ZU5vdGVJbmZvID0gYWN0aXZlTm90ZSA/IHRoaXMuZ2V0Tm90ZUluZm8oYWN0aXZlTm90ZSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbmRlci5yZWRyYXcoYWN0aXZlTm90ZUluZm8sIHNjcm9sbEludG9WaWV3KTtcbiAgICB9XG4gICAgaXNOb3RlSW5JbnN0cnVtZW50cyhub3RlKSB7XG4gICAgICAgIGlmIChub3RlLmluc3RydW1lbnQgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmluc3RydW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnN0cnVtZW50cy5pbmRleE9mKG5vdGUuaW5zdHJ1bWVudCkgPj0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aW1lVG9RdWFydGVycyh0aW1lKSB7XG4gICAgICAgIGNvbnN0IHEgPSB0aW1lICogdGhpcy5ub3RlU2VxdWVuY2UudGVtcG9zWzBdLnFwbSAvIDYwO1xuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChxICogMTYpIC8gMTY7XG4gICAgfVxuICAgIGdldE5vdGVJbmZvKG5vdGUpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRRID0gdGhpcy50aW1lVG9RdWFydGVycyhub3RlLnN0YXJ0VGltZSk7XG4gICAgICAgIGNvbnN0IGVuZFEgPSB0aGlzLnRpbWVUb1F1YXJ0ZXJzKG5vdGUuZW5kVGltZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGFydDogc3RhcnRRLFxuICAgICAgICAgICAgbGVuZ3RoOiBlbmRRIC0gc3RhcnRRLFxuICAgICAgICAgICAgcGl0Y2g6IG5vdGUucGl0Y2gsXG4gICAgICAgICAgICBpbnRlbnNpdHk6IG5vdGUudmVsb2NpdHlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0U2NvcmVJbmZvKHNlcXVlbmNlKSB7XG4gICAgICAgIGNvbnN0IG5vdGVzSW5mbyA9IFtdO1xuICAgICAgICBzZXF1ZW5jZS5ub3Rlcy5mb3JFYWNoKChub3RlKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc05vdGVJbkluc3RydW1lbnRzKG5vdGUpKSB7XG4gICAgICAgICAgICAgICAgbm90ZXNJbmZvLnB1c2godGhpcy5nZXROb3RlSW5mbyhub3RlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbm90ZXM6IG5vdGVzSW5mbyxcbiAgICAgICAgICAgIHRlbXBvczogc2VxdWVuY2UudGVtcG9zID9cbiAgICAgICAgICAgICAgICBzZXF1ZW5jZS50ZW1wb3MubWFwKCh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHN0YXJ0OiB0aGlzLnRpbWVUb1F1YXJ0ZXJzKHQudGltZSksIHFwbTogdC5xcG0gfTtcbiAgICAgICAgICAgICAgICB9KSA6XG4gICAgICAgICAgICAgICAgW10sXG4gICAgICAgICAgICBrZXlTaWduYXR1cmVzOiBzZXF1ZW5jZS5rZXlTaWduYXR1cmVzID9cbiAgICAgICAgICAgICAgICBzZXF1ZW5jZS5rZXlTaWduYXR1cmVzLm1hcCgoa3MpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgc3RhcnQ6IHRoaXMudGltZVRvUXVhcnRlcnMoa3MudGltZSksIGtleToga3Mua2V5IH07XG4gICAgICAgICAgICAgICAgfSkgOlxuICAgICAgICAgICAgICAgIFtdLFxuICAgICAgICAgICAgdGltZVNpZ25hdHVyZXM6IHNlcXVlbmNlLnRpbWVTaWduYXR1cmVzID9cbiAgICAgICAgICAgICAgICBzZXF1ZW5jZS50aW1lU2lnbmF0dXJlcy5tYXAoKHRzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogdGhpcy50aW1lVG9RdWFydGVycyh0cy50aW1lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWVyYXRvcjogdHMubnVtZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVub21pbmF0b3I6IHRzLmRlbm9taW5hdG9yXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkgOlxuICAgICAgICAgICAgICAgIFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNsZWFyQWN0aXZlTm90ZXMoKSB7XG4gICAgICAgIHRoaXMucmVkcmF3KCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dmlzdWFsaXplci5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/core/visualizer.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js ***!
  \*************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NoteSequence: () => (/* binding */ NoteSequence)\n/* harmony export */ });\n/* harmony import */ var _proto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./proto */ \"(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/proto.js\");\n/* harmony import */ var _proto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_proto__WEBPACK_IMPORTED_MODULE_0__);\n\nvar NoteSequence = _proto__WEBPACK_IMPORTED_MODULE_0__.tensorflow.magenta.NoteSequence;\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vcHJvdG9idWYvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXFDO0FBQ3JDLG1CQUFtQiw4Q0FBVTtBQUNMO0FBQ3hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9tb25nYWguZ2l0aHViLmlvLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BtYWdlbnRhK211c2ljQDEuMjMuMV9AdGVuc29yZmxvdyt0ZmpzLWNvcmVAMi44LjZfc2VlZHJhbmRvbUAyLjQuNC9ub2RlX21vZHVsZXMvQG1hZ2VudGEvbXVzaWMvZXNtL3Byb3RvYnVmL2luZGV4LmpzP2EyOTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdGVuc29yZmxvdyB9IGZyb20gJy4vcHJvdG8nO1xudmFyIE5vdGVTZXF1ZW5jZSA9IHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2U7XG5leHBvcnQgeyBOb3RlU2VxdWVuY2UgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/index.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/proto.js":
/*!*************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/proto.js ***!
  \*************************************************************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("/*eslint-disable block-scoped-var, no-redeclare, no-control-regex, no-prototype-builtins*/\n\n\nvar $protobuf = __webpack_require__(/*! protobufjs/minimal */ \"(ssr)/./node_modules/.pnpm/protobufjs@6.11.4/node_modules/protobufjs/minimal.js\");\n\n// Common aliases\nvar $Reader = $protobuf.Reader, $Writer = $protobuf.Writer, $util = $protobuf.util;\n\n// Exported root namespace\nvar $root = $protobuf.roots[\"default\"] || ($protobuf.roots[\"default\"] = {});\n\n$root.tensorflow = (function() {\n\n    /**\n     * Namespace tensorflow.\n     * @exports tensorflow\n     * @namespace\n     */\n    var tensorflow = {};\n\n    tensorflow.magenta = (function() {\n\n        /**\n         * Namespace magenta.\n         * @memberof tensorflow\n         * @namespace\n         */\n        var magenta = {};\n\n        magenta.NoteSequence = (function() {\n\n            /**\n             * Properties of a NoteSequence.\n             * @memberof tensorflow.magenta\n             * @interface INoteSequence\n             * @property {string|null} [id] NoteSequence id\n             * @property {string|null} [filename] NoteSequence filename\n             * @property {number|null} [referenceNumber] NoteSequence referenceNumber\n             * @property {string|null} [collectionName] NoteSequence collectionName\n             * @property {number|null} [ticksPerQuarter] NoteSequence ticksPerQuarter\n             * @property {Array.<tensorflow.magenta.NoteSequence.ITimeSignature>|null} [timeSignatures] NoteSequence timeSignatures\n             * @property {Array.<tensorflow.magenta.NoteSequence.IKeySignature>|null} [keySignatures] NoteSequence keySignatures\n             * @property {Array.<tensorflow.magenta.NoteSequence.ITempo>|null} [tempos] NoteSequence tempos\n             * @property {Array.<tensorflow.magenta.NoteSequence.INote>|null} [notes] NoteSequence notes\n             * @property {number|null} [totalTime] NoteSequence totalTime\n             * @property {number|null} [totalQuantizedSteps] NoteSequence totalQuantizedSteps\n             * @property {Array.<tensorflow.magenta.NoteSequence.IPitchBend>|null} [pitchBends] NoteSequence pitchBends\n             * @property {Array.<tensorflow.magenta.NoteSequence.IControlChange>|null} [controlChanges] NoteSequence controlChanges\n             * @property {Array.<tensorflow.magenta.NoteSequence.IPartInfo>|null} [partInfos] NoteSequence partInfos\n             * @property {tensorflow.magenta.NoteSequence.ISourceInfo|null} [sourceInfo] NoteSequence sourceInfo\n             * @property {Array.<tensorflow.magenta.NoteSequence.ITextAnnotation>|null} [textAnnotations] NoteSequence textAnnotations\n             * @property {Array.<tensorflow.magenta.NoteSequence.ISectionAnnotation>|null} [sectionAnnotations] NoteSequence sectionAnnotations\n             * @property {Array.<tensorflow.magenta.NoteSequence.ISectionGroup>|null} [sectionGroups] NoteSequence sectionGroups\n             * @property {tensorflow.magenta.NoteSequence.IQuantizationInfo|null} [quantizationInfo] NoteSequence quantizationInfo\n             * @property {tensorflow.magenta.NoteSequence.ISubsequenceInfo|null} [subsequenceInfo] NoteSequence subsequenceInfo\n             * @property {tensorflow.magenta.ISequenceMetadata|null} [sequenceMetadata] NoteSequence sequenceMetadata\n             */\n\n            /**\n             * Constructs a new NoteSequence.\n             * @memberof tensorflow.magenta\n             * @classdesc Represents a NoteSequence.\n             * @implements INoteSequence\n             * @constructor\n             * @param {tensorflow.magenta.INoteSequence=} [properties] Properties to set\n             */\n            function NoteSequence(properties) {\n                this.timeSignatures = [];\n                this.keySignatures = [];\n                this.tempos = [];\n                this.notes = [];\n                this.pitchBends = [];\n                this.controlChanges = [];\n                this.partInfos = [];\n                this.textAnnotations = [];\n                this.sectionAnnotations = [];\n                this.sectionGroups = [];\n                if (properties)\n                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                        if (properties[keys[i]] != null)\n                            this[keys[i]] = properties[keys[i]];\n            }\n\n            /**\n             * NoteSequence id.\n             * @member {string} id\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.id = \"\";\n\n            /**\n             * NoteSequence filename.\n             * @member {string} filename\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.filename = \"\";\n\n            /**\n             * NoteSequence referenceNumber.\n             * @member {number} referenceNumber\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.referenceNumber = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n            /**\n             * NoteSequence collectionName.\n             * @member {string} collectionName\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.collectionName = \"\";\n\n            /**\n             * NoteSequence ticksPerQuarter.\n             * @member {number} ticksPerQuarter\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.ticksPerQuarter = 0;\n\n            /**\n             * NoteSequence timeSignatures.\n             * @member {Array.<tensorflow.magenta.NoteSequence.ITimeSignature>} timeSignatures\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.timeSignatures = $util.emptyArray;\n\n            /**\n             * NoteSequence keySignatures.\n             * @member {Array.<tensorflow.magenta.NoteSequence.IKeySignature>} keySignatures\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.keySignatures = $util.emptyArray;\n\n            /**\n             * NoteSequence tempos.\n             * @member {Array.<tensorflow.magenta.NoteSequence.ITempo>} tempos\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.tempos = $util.emptyArray;\n\n            /**\n             * NoteSequence notes.\n             * @member {Array.<tensorflow.magenta.NoteSequence.INote>} notes\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.notes = $util.emptyArray;\n\n            /**\n             * NoteSequence totalTime.\n             * @member {number} totalTime\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.totalTime = 0;\n\n            /**\n             * NoteSequence totalQuantizedSteps.\n             * @member {number} totalQuantizedSteps\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.totalQuantizedSteps = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n            /**\n             * NoteSequence pitchBends.\n             * @member {Array.<tensorflow.magenta.NoteSequence.IPitchBend>} pitchBends\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.pitchBends = $util.emptyArray;\n\n            /**\n             * NoteSequence controlChanges.\n             * @member {Array.<tensorflow.magenta.NoteSequence.IControlChange>} controlChanges\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.controlChanges = $util.emptyArray;\n\n            /**\n             * NoteSequence partInfos.\n             * @member {Array.<tensorflow.magenta.NoteSequence.IPartInfo>} partInfos\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.partInfos = $util.emptyArray;\n\n            /**\n             * NoteSequence sourceInfo.\n             * @member {tensorflow.magenta.NoteSequence.ISourceInfo|null|undefined} sourceInfo\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.sourceInfo = null;\n\n            /**\n             * NoteSequence textAnnotations.\n             * @member {Array.<tensorflow.magenta.NoteSequence.ITextAnnotation>} textAnnotations\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.textAnnotations = $util.emptyArray;\n\n            /**\n             * NoteSequence sectionAnnotations.\n             * @member {Array.<tensorflow.magenta.NoteSequence.ISectionAnnotation>} sectionAnnotations\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.sectionAnnotations = $util.emptyArray;\n\n            /**\n             * NoteSequence sectionGroups.\n             * @member {Array.<tensorflow.magenta.NoteSequence.ISectionGroup>} sectionGroups\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.sectionGroups = $util.emptyArray;\n\n            /**\n             * NoteSequence quantizationInfo.\n             * @member {tensorflow.magenta.NoteSequence.IQuantizationInfo|null|undefined} quantizationInfo\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.quantizationInfo = null;\n\n            /**\n             * NoteSequence subsequenceInfo.\n             * @member {tensorflow.magenta.NoteSequence.ISubsequenceInfo|null|undefined} subsequenceInfo\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.subsequenceInfo = null;\n\n            /**\n             * NoteSequence sequenceMetadata.\n             * @member {tensorflow.magenta.ISequenceMetadata|null|undefined} sequenceMetadata\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             */\n            NoteSequence.prototype.sequenceMetadata = null;\n\n            /**\n             * Creates a new NoteSequence instance using the specified properties.\n             * @function create\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {tensorflow.magenta.INoteSequence=} [properties] Properties to set\n             * @returns {tensorflow.magenta.NoteSequence} NoteSequence instance\n             */\n            NoteSequence.create = function create(properties) {\n                return new NoteSequence(properties);\n            };\n\n            /**\n             * Encodes the specified NoteSequence message. Does not implicitly {@link tensorflow.magenta.NoteSequence.verify|verify} messages.\n             * @function encode\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {tensorflow.magenta.INoteSequence} message NoteSequence message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            NoteSequence.encode = function encode(message, writer) {\n                if (!writer)\n                    writer = $Writer.create();\n                if (message.id != null && message.hasOwnProperty(\"id\"))\n                    writer.uint32(/* id 1, wireType 2 =*/10).string(message.id);\n                if (message.filename != null && message.hasOwnProperty(\"filename\"))\n                    writer.uint32(/* id 2, wireType 2 =*/18).string(message.filename);\n                if (message.collectionName != null && message.hasOwnProperty(\"collectionName\"))\n                    writer.uint32(/* id 3, wireType 2 =*/26).string(message.collectionName);\n                if (message.ticksPerQuarter != null && message.hasOwnProperty(\"ticksPerQuarter\"))\n                    writer.uint32(/* id 4, wireType 0 =*/32).int32(message.ticksPerQuarter);\n                if (message.timeSignatures != null && message.timeSignatures.length)\n                    for (var i = 0; i < message.timeSignatures.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.TimeSignature.encode(message.timeSignatures[i], writer.uint32(/* id 5, wireType 2 =*/42).fork()).ldelim();\n                if (message.keySignatures != null && message.keySignatures.length)\n                    for (var i = 0; i < message.keySignatures.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.KeySignature.encode(message.keySignatures[i], writer.uint32(/* id 6, wireType 2 =*/50).fork()).ldelim();\n                if (message.tempos != null && message.tempos.length)\n                    for (var i = 0; i < message.tempos.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.Tempo.encode(message.tempos[i], writer.uint32(/* id 7, wireType 2 =*/58).fork()).ldelim();\n                if (message.notes != null && message.notes.length)\n                    for (var i = 0; i < message.notes.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.Note.encode(message.notes[i], writer.uint32(/* id 8, wireType 2 =*/66).fork()).ldelim();\n                if (message.totalTime != null && message.hasOwnProperty(\"totalTime\"))\n                    writer.uint32(/* id 9, wireType 1 =*/73).double(message.totalTime);\n                if (message.pitchBends != null && message.pitchBends.length)\n                    for (var i = 0; i < message.pitchBends.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.PitchBend.encode(message.pitchBends[i], writer.uint32(/* id 10, wireType 2 =*/82).fork()).ldelim();\n                if (message.controlChanges != null && message.controlChanges.length)\n                    for (var i = 0; i < message.controlChanges.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.ControlChange.encode(message.controlChanges[i], writer.uint32(/* id 11, wireType 2 =*/90).fork()).ldelim();\n                if (message.partInfos != null && message.partInfos.length)\n                    for (var i = 0; i < message.partInfos.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.PartInfo.encode(message.partInfos[i], writer.uint32(/* id 12, wireType 2 =*/98).fork()).ldelim();\n                if (message.sourceInfo != null && message.hasOwnProperty(\"sourceInfo\"))\n                    $root.tensorflow.magenta.NoteSequence.SourceInfo.encode(message.sourceInfo, writer.uint32(/* id 13, wireType 2 =*/106).fork()).ldelim();\n                if (message.textAnnotations != null && message.textAnnotations.length)\n                    for (var i = 0; i < message.textAnnotations.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.TextAnnotation.encode(message.textAnnotations[i], writer.uint32(/* id 14, wireType 2 =*/114).fork()).ldelim();\n                if (message.quantizationInfo != null && message.hasOwnProperty(\"quantizationInfo\"))\n                    $root.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(message.quantizationInfo, writer.uint32(/* id 15, wireType 2 =*/122).fork()).ldelim();\n                if (message.totalQuantizedSteps != null && message.hasOwnProperty(\"totalQuantizedSteps\"))\n                    writer.uint32(/* id 16, wireType 0 =*/128).int64(message.totalQuantizedSteps);\n                if (message.subsequenceInfo != null && message.hasOwnProperty(\"subsequenceInfo\"))\n                    $root.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(message.subsequenceInfo, writer.uint32(/* id 17, wireType 2 =*/138).fork()).ldelim();\n                if (message.referenceNumber != null && message.hasOwnProperty(\"referenceNumber\"))\n                    writer.uint32(/* id 18, wireType 0 =*/144).int64(message.referenceNumber);\n                if (message.sequenceMetadata != null && message.hasOwnProperty(\"sequenceMetadata\"))\n                    $root.tensorflow.magenta.SequenceMetadata.encode(message.sequenceMetadata, writer.uint32(/* id 19, wireType 2 =*/154).fork()).ldelim();\n                if (message.sectionAnnotations != null && message.sectionAnnotations.length)\n                    for (var i = 0; i < message.sectionAnnotations.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(message.sectionAnnotations[i], writer.uint32(/* id 20, wireType 2 =*/162).fork()).ldelim();\n                if (message.sectionGroups != null && message.sectionGroups.length)\n                    for (var i = 0; i < message.sectionGroups.length; ++i)\n                        $root.tensorflow.magenta.NoteSequence.SectionGroup.encode(message.sectionGroups[i], writer.uint32(/* id 21, wireType 2 =*/170).fork()).ldelim();\n                return writer;\n            };\n\n            /**\n             * Encodes the specified NoteSequence message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.verify|verify} messages.\n             * @function encodeDelimited\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {tensorflow.magenta.INoteSequence} message NoteSequence message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            NoteSequence.encodeDelimited = function encodeDelimited(message, writer) {\n                return this.encode(message, writer).ldelim();\n            };\n\n            /**\n             * Decodes a NoteSequence message from the specified reader or buffer.\n             * @function decode\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @param {number} [length] Message length if known beforehand\n             * @returns {tensorflow.magenta.NoteSequence} NoteSequence\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            NoteSequence.decode = function decode(reader, length) {\n                if (!(reader instanceof $Reader))\n                    reader = $Reader.create(reader);\n                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence();\n                while (reader.pos < end) {\n                    var tag = reader.uint32();\n                    switch (tag >>> 3) {\n                    case 1:\n                        message.id = reader.string();\n                        break;\n                    case 2:\n                        message.filename = reader.string();\n                        break;\n                    case 18:\n                        message.referenceNumber = $util.Long?reader.int64().toNumber():reader.int64();\n                        break;\n                    case 3:\n                        message.collectionName = reader.string();\n                        break;\n                    case 4:\n                        message.ticksPerQuarter = reader.int32();\n                        break;\n                    case 5:\n                        if (!(message.timeSignatures && message.timeSignatures.length))\n                            message.timeSignatures = [];\n                        message.timeSignatures.push($root.tensorflow.magenta.NoteSequence.TimeSignature.decode(reader, reader.uint32()));\n                        break;\n                    case 6:\n                        if (!(message.keySignatures && message.keySignatures.length))\n                            message.keySignatures = [];\n                        message.keySignatures.push($root.tensorflow.magenta.NoteSequence.KeySignature.decode(reader, reader.uint32()));\n                        break;\n                    case 7:\n                        if (!(message.tempos && message.tempos.length))\n                            message.tempos = [];\n                        message.tempos.push($root.tensorflow.magenta.NoteSequence.Tempo.decode(reader, reader.uint32()));\n                        break;\n                    case 8:\n                        if (!(message.notes && message.notes.length))\n                            message.notes = [];\n                        message.notes.push($root.tensorflow.magenta.NoteSequence.Note.decode(reader, reader.uint32()));\n                        break;\n                    case 9:\n                        message.totalTime = reader.double();\n                        break;\n                    case 16:\n                        message.totalQuantizedSteps = $util.Long?reader.int64().toNumber():reader.int64();\n                        break;\n                    case 10:\n                        if (!(message.pitchBends && message.pitchBends.length))\n                            message.pitchBends = [];\n                        message.pitchBends.push($root.tensorflow.magenta.NoteSequence.PitchBend.decode(reader, reader.uint32()));\n                        break;\n                    case 11:\n                        if (!(message.controlChanges && message.controlChanges.length))\n                            message.controlChanges = [];\n                        message.controlChanges.push($root.tensorflow.magenta.NoteSequence.ControlChange.decode(reader, reader.uint32()));\n                        break;\n                    case 12:\n                        if (!(message.partInfos && message.partInfos.length))\n                            message.partInfos = [];\n                        message.partInfos.push($root.tensorflow.magenta.NoteSequence.PartInfo.decode(reader, reader.uint32()));\n                        break;\n                    case 13:\n                        message.sourceInfo = $root.tensorflow.magenta.NoteSequence.SourceInfo.decode(reader, reader.uint32());\n                        break;\n                    case 14:\n                        if (!(message.textAnnotations && message.textAnnotations.length))\n                            message.textAnnotations = [];\n                        message.textAnnotations.push($root.tensorflow.magenta.NoteSequence.TextAnnotation.decode(reader, reader.uint32()));\n                        break;\n                    case 20:\n                        if (!(message.sectionAnnotations && message.sectionAnnotations.length))\n                            message.sectionAnnotations = [];\n                        message.sectionAnnotations.push($root.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(reader, reader.uint32()));\n                        break;\n                    case 21:\n                        if (!(message.sectionGroups && message.sectionGroups.length))\n                            message.sectionGroups = [];\n                        message.sectionGroups.push($root.tensorflow.magenta.NoteSequence.SectionGroup.decode(reader, reader.uint32()));\n                        break;\n                    case 15:\n                        message.quantizationInfo = $root.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(reader, reader.uint32());\n                        break;\n                    case 17:\n                        message.subsequenceInfo = $root.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(reader, reader.uint32());\n                        break;\n                    case 19:\n                        message.sequenceMetadata = $root.tensorflow.magenta.SequenceMetadata.decode(reader, reader.uint32());\n                        break;\n                    default:\n                        reader.skipType(tag & 7);\n                        break;\n                    }\n                }\n                return message;\n            };\n\n            /**\n             * Decodes a NoteSequence message from the specified reader or buffer, length delimited.\n             * @function decodeDelimited\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @returns {tensorflow.magenta.NoteSequence} NoteSequence\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            NoteSequence.decodeDelimited = function decodeDelimited(reader) {\n                if (!(reader instanceof $Reader))\n                    reader = new $Reader(reader);\n                return this.decode(reader, reader.uint32());\n            };\n\n            /**\n             * Verifies a NoteSequence message.\n             * @function verify\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {Object.<string,*>} message Plain object to verify\n             * @returns {string|null} `null` if valid, otherwise the reason why it is not\n             */\n            NoteSequence.verify = function verify(message) {\n                if (typeof message !== \"object\" || message === null)\n                    return \"object expected\";\n                if (message.id != null && message.hasOwnProperty(\"id\"))\n                    if (!$util.isString(message.id))\n                        return \"id: string expected\";\n                if (message.filename != null && message.hasOwnProperty(\"filename\"))\n                    if (!$util.isString(message.filename))\n                        return \"filename: string expected\";\n                if (message.referenceNumber != null && message.hasOwnProperty(\"referenceNumber\"))\n                    if (!$util.isInteger(message.referenceNumber) && !(message.referenceNumber && $util.isInteger(message.referenceNumber.low) && $util.isInteger(message.referenceNumber.high)))\n                        return \"referenceNumber: integer|Long expected\";\n                if (message.collectionName != null && message.hasOwnProperty(\"collectionName\"))\n                    if (!$util.isString(message.collectionName))\n                        return \"collectionName: string expected\";\n                if (message.ticksPerQuarter != null && message.hasOwnProperty(\"ticksPerQuarter\"))\n                    if (!$util.isInteger(message.ticksPerQuarter))\n                        return \"ticksPerQuarter: integer expected\";\n                if (message.timeSignatures != null && message.hasOwnProperty(\"timeSignatures\")) {\n                    if (!Array.isArray(message.timeSignatures))\n                        return \"timeSignatures: array expected\";\n                    for (var i = 0; i < message.timeSignatures.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.TimeSignature.verify(message.timeSignatures[i]);\n                        if (error)\n                            return \"timeSignatures.\" + error;\n                    }\n                }\n                if (message.keySignatures != null && message.hasOwnProperty(\"keySignatures\")) {\n                    if (!Array.isArray(message.keySignatures))\n                        return \"keySignatures: array expected\";\n                    for (var i = 0; i < message.keySignatures.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.KeySignature.verify(message.keySignatures[i]);\n                        if (error)\n                            return \"keySignatures.\" + error;\n                    }\n                }\n                if (message.tempos != null && message.hasOwnProperty(\"tempos\")) {\n                    if (!Array.isArray(message.tempos))\n                        return \"tempos: array expected\";\n                    for (var i = 0; i < message.tempos.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.Tempo.verify(message.tempos[i]);\n                        if (error)\n                            return \"tempos.\" + error;\n                    }\n                }\n                if (message.notes != null && message.hasOwnProperty(\"notes\")) {\n                    if (!Array.isArray(message.notes))\n                        return \"notes: array expected\";\n                    for (var i = 0; i < message.notes.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.Note.verify(message.notes[i]);\n                        if (error)\n                            return \"notes.\" + error;\n                    }\n                }\n                if (message.totalTime != null && message.hasOwnProperty(\"totalTime\"))\n                    if (typeof message.totalTime !== \"number\")\n                        return \"totalTime: number expected\";\n                if (message.totalQuantizedSteps != null && message.hasOwnProperty(\"totalQuantizedSteps\"))\n                    if (!$util.isInteger(message.totalQuantizedSteps) && !(message.totalQuantizedSteps && $util.isInteger(message.totalQuantizedSteps.low) && $util.isInteger(message.totalQuantizedSteps.high)))\n                        return \"totalQuantizedSteps: integer|Long expected\";\n                if (message.pitchBends != null && message.hasOwnProperty(\"pitchBends\")) {\n                    if (!Array.isArray(message.pitchBends))\n                        return \"pitchBends: array expected\";\n                    for (var i = 0; i < message.pitchBends.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.PitchBend.verify(message.pitchBends[i]);\n                        if (error)\n                            return \"pitchBends.\" + error;\n                    }\n                }\n                if (message.controlChanges != null && message.hasOwnProperty(\"controlChanges\")) {\n                    if (!Array.isArray(message.controlChanges))\n                        return \"controlChanges: array expected\";\n                    for (var i = 0; i < message.controlChanges.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.ControlChange.verify(message.controlChanges[i]);\n                        if (error)\n                            return \"controlChanges.\" + error;\n                    }\n                }\n                if (message.partInfos != null && message.hasOwnProperty(\"partInfos\")) {\n                    if (!Array.isArray(message.partInfos))\n                        return \"partInfos: array expected\";\n                    for (var i = 0; i < message.partInfos.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.PartInfo.verify(message.partInfos[i]);\n                        if (error)\n                            return \"partInfos.\" + error;\n                    }\n                }\n                if (message.sourceInfo != null && message.hasOwnProperty(\"sourceInfo\")) {\n                    var error = $root.tensorflow.magenta.NoteSequence.SourceInfo.verify(message.sourceInfo);\n                    if (error)\n                        return \"sourceInfo.\" + error;\n                }\n                if (message.textAnnotations != null && message.hasOwnProperty(\"textAnnotations\")) {\n                    if (!Array.isArray(message.textAnnotations))\n                        return \"textAnnotations: array expected\";\n                    for (var i = 0; i < message.textAnnotations.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.TextAnnotation.verify(message.textAnnotations[i]);\n                        if (error)\n                            return \"textAnnotations.\" + error;\n                    }\n                }\n                if (message.sectionAnnotations != null && message.hasOwnProperty(\"sectionAnnotations\")) {\n                    if (!Array.isArray(message.sectionAnnotations))\n                        return \"sectionAnnotations: array expected\";\n                    for (var i = 0; i < message.sectionAnnotations.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(message.sectionAnnotations[i]);\n                        if (error)\n                            return \"sectionAnnotations.\" + error;\n                    }\n                }\n                if (message.sectionGroups != null && message.hasOwnProperty(\"sectionGroups\")) {\n                    if (!Array.isArray(message.sectionGroups))\n                        return \"sectionGroups: array expected\";\n                    for (var i = 0; i < message.sectionGroups.length; ++i) {\n                        var error = $root.tensorflow.magenta.NoteSequence.SectionGroup.verify(message.sectionGroups[i]);\n                        if (error)\n                            return \"sectionGroups.\" + error;\n                    }\n                }\n                if (message.quantizationInfo != null && message.hasOwnProperty(\"quantizationInfo\")) {\n                    var error = $root.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(message.quantizationInfo);\n                    if (error)\n                        return \"quantizationInfo.\" + error;\n                }\n                if (message.subsequenceInfo != null && message.hasOwnProperty(\"subsequenceInfo\")) {\n                    var error = $root.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(message.subsequenceInfo);\n                    if (error)\n                        return \"subsequenceInfo.\" + error;\n                }\n                if (message.sequenceMetadata != null && message.hasOwnProperty(\"sequenceMetadata\")) {\n                    var error = $root.tensorflow.magenta.SequenceMetadata.verify(message.sequenceMetadata);\n                    if (error)\n                        return \"sequenceMetadata.\" + error;\n                }\n                return null;\n            };\n\n            /**\n             * Creates a NoteSequence message from a plain object. Also converts values to their respective internal types.\n             * @function fromObject\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {Object.<string,*>} object Plain object\n             * @returns {tensorflow.magenta.NoteSequence} NoteSequence\n             */\n            NoteSequence.fromObject = function fromObject(object) {\n                if (object instanceof $root.tensorflow.magenta.NoteSequence)\n                    return object;\n                var message = new $root.tensorflow.magenta.NoteSequence();\n                if (object.id != null)\n                    message.id = String(object.id);\n                if (object.filename != null)\n                    message.filename = String(object.filename);\n                if (object.referenceNumber != null)\n                    if ($util.Long)\n                        (message.referenceNumber = $util.Long.fromValue(object.referenceNumber)).unsigned = false;\n                    else if (typeof object.referenceNumber === \"string\")\n                        message.referenceNumber = parseInt(object.referenceNumber, 10);\n                    else if (typeof object.referenceNumber === \"number\")\n                        message.referenceNumber = object.referenceNumber;\n                    else if (typeof object.referenceNumber === \"object\")\n                        message.referenceNumber = new $util.LongBits(object.referenceNumber.low >>> 0, object.referenceNumber.high >>> 0).toNumber();\n                if (object.collectionName != null)\n                    message.collectionName = String(object.collectionName);\n                if (object.ticksPerQuarter != null)\n                    message.ticksPerQuarter = object.ticksPerQuarter | 0;\n                if (object.timeSignatures) {\n                    if (!Array.isArray(object.timeSignatures))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.timeSignatures: array expected\");\n                    message.timeSignatures = [];\n                    for (var i = 0; i < object.timeSignatures.length; ++i) {\n                        if (typeof object.timeSignatures[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.timeSignatures: object expected\");\n                        message.timeSignatures[i] = $root.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(object.timeSignatures[i]);\n                    }\n                }\n                if (object.keySignatures) {\n                    if (!Array.isArray(object.keySignatures))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.keySignatures: array expected\");\n                    message.keySignatures = [];\n                    for (var i = 0; i < object.keySignatures.length; ++i) {\n                        if (typeof object.keySignatures[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.keySignatures: object expected\");\n                        message.keySignatures[i] = $root.tensorflow.magenta.NoteSequence.KeySignature.fromObject(object.keySignatures[i]);\n                    }\n                }\n                if (object.tempos) {\n                    if (!Array.isArray(object.tempos))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.tempos: array expected\");\n                    message.tempos = [];\n                    for (var i = 0; i < object.tempos.length; ++i) {\n                        if (typeof object.tempos[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.tempos: object expected\");\n                        message.tempos[i] = $root.tensorflow.magenta.NoteSequence.Tempo.fromObject(object.tempos[i]);\n                    }\n                }\n                if (object.notes) {\n                    if (!Array.isArray(object.notes))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.notes: array expected\");\n                    message.notes = [];\n                    for (var i = 0; i < object.notes.length; ++i) {\n                        if (typeof object.notes[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.notes: object expected\");\n                        message.notes[i] = $root.tensorflow.magenta.NoteSequence.Note.fromObject(object.notes[i]);\n                    }\n                }\n                if (object.totalTime != null)\n                    message.totalTime = Number(object.totalTime);\n                if (object.totalQuantizedSteps != null)\n                    if ($util.Long)\n                        (message.totalQuantizedSteps = $util.Long.fromValue(object.totalQuantizedSteps)).unsigned = false;\n                    else if (typeof object.totalQuantizedSteps === \"string\")\n                        message.totalQuantizedSteps = parseInt(object.totalQuantizedSteps, 10);\n                    else if (typeof object.totalQuantizedSteps === \"number\")\n                        message.totalQuantizedSteps = object.totalQuantizedSteps;\n                    else if (typeof object.totalQuantizedSteps === \"object\")\n                        message.totalQuantizedSteps = new $util.LongBits(object.totalQuantizedSteps.low >>> 0, object.totalQuantizedSteps.high >>> 0).toNumber();\n                if (object.pitchBends) {\n                    if (!Array.isArray(object.pitchBends))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.pitchBends: array expected\");\n                    message.pitchBends = [];\n                    for (var i = 0; i < object.pitchBends.length; ++i) {\n                        if (typeof object.pitchBends[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.pitchBends: object expected\");\n                        message.pitchBends[i] = $root.tensorflow.magenta.NoteSequence.PitchBend.fromObject(object.pitchBends[i]);\n                    }\n                }\n                if (object.controlChanges) {\n                    if (!Array.isArray(object.controlChanges))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.controlChanges: array expected\");\n                    message.controlChanges = [];\n                    for (var i = 0; i < object.controlChanges.length; ++i) {\n                        if (typeof object.controlChanges[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.controlChanges: object expected\");\n                        message.controlChanges[i] = $root.tensorflow.magenta.NoteSequence.ControlChange.fromObject(object.controlChanges[i]);\n                    }\n                }\n                if (object.partInfos) {\n                    if (!Array.isArray(object.partInfos))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.partInfos: array expected\");\n                    message.partInfos = [];\n                    for (var i = 0; i < object.partInfos.length; ++i) {\n                        if (typeof object.partInfos[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.partInfos: object expected\");\n                        message.partInfos[i] = $root.tensorflow.magenta.NoteSequence.PartInfo.fromObject(object.partInfos[i]);\n                    }\n                }\n                if (object.sourceInfo != null) {\n                    if (typeof object.sourceInfo !== \"object\")\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.sourceInfo: object expected\");\n                    message.sourceInfo = $root.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(object.sourceInfo);\n                }\n                if (object.textAnnotations) {\n                    if (!Array.isArray(object.textAnnotations))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.textAnnotations: array expected\");\n                    message.textAnnotations = [];\n                    for (var i = 0; i < object.textAnnotations.length; ++i) {\n                        if (typeof object.textAnnotations[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.textAnnotations: object expected\");\n                        message.textAnnotations[i] = $root.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(object.textAnnotations[i]);\n                    }\n                }\n                if (object.sectionAnnotations) {\n                    if (!Array.isArray(object.sectionAnnotations))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected\");\n                    message.sectionAnnotations = [];\n                    for (var i = 0; i < object.sectionAnnotations.length; ++i) {\n                        if (typeof object.sectionAnnotations[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected\");\n                        message.sectionAnnotations[i] = $root.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(object.sectionAnnotations[i]);\n                    }\n                }\n                if (object.sectionGroups) {\n                    if (!Array.isArray(object.sectionGroups))\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.sectionGroups: array expected\");\n                    message.sectionGroups = [];\n                    for (var i = 0; i < object.sectionGroups.length; ++i) {\n                        if (typeof object.sectionGroups[i] !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.sectionGroups: object expected\");\n                        message.sectionGroups[i] = $root.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(object.sectionGroups[i]);\n                    }\n                }\n                if (object.quantizationInfo != null) {\n                    if (typeof object.quantizationInfo !== \"object\")\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.quantizationInfo: object expected\");\n                    message.quantizationInfo = $root.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(object.quantizationInfo);\n                }\n                if (object.subsequenceInfo != null) {\n                    if (typeof object.subsequenceInfo !== \"object\")\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected\");\n                    message.subsequenceInfo = $root.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(object.subsequenceInfo);\n                }\n                if (object.sequenceMetadata != null) {\n                    if (typeof object.sequenceMetadata !== \"object\")\n                        throw TypeError(\".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected\");\n                    message.sequenceMetadata = $root.tensorflow.magenta.SequenceMetadata.fromObject(object.sequenceMetadata);\n                }\n                return message;\n            };\n\n            /**\n             * Creates a plain object from a NoteSequence message. Also converts values to other types if specified.\n             * @function toObject\n             * @memberof tensorflow.magenta.NoteSequence\n             * @static\n             * @param {tensorflow.magenta.NoteSequence} message NoteSequence\n             * @param {$protobuf.IConversionOptions} [options] Conversion options\n             * @returns {Object.<string,*>} Plain object\n             */\n            NoteSequence.toObject = function toObject(message, options) {\n                if (!options)\n                    options = {};\n                var object = {};\n                if (options.arrays || options.defaults) {\n                    object.timeSignatures = [];\n                    object.keySignatures = [];\n                    object.tempos = [];\n                    object.notes = [];\n                    object.pitchBends = [];\n                    object.controlChanges = [];\n                    object.partInfos = [];\n                    object.textAnnotations = [];\n                    object.sectionAnnotations = [];\n                    object.sectionGroups = [];\n                }\n                if (options.defaults) {\n                    object.id = \"\";\n                    object.filename = \"\";\n                    object.collectionName = \"\";\n                    object.ticksPerQuarter = 0;\n                    object.totalTime = 0;\n                    object.sourceInfo = null;\n                    object.quantizationInfo = null;\n                    if ($util.Long) {\n                        var long = new $util.Long(0, 0, false);\n                        object.totalQuantizedSteps = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                    } else\n                        object.totalQuantizedSteps = options.longs === String ? \"0\" : 0;\n                    object.subsequenceInfo = null;\n                    if ($util.Long) {\n                        var long = new $util.Long(0, 0, false);\n                        object.referenceNumber = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                    } else\n                        object.referenceNumber = options.longs === String ? \"0\" : 0;\n                    object.sequenceMetadata = null;\n                }\n                if (message.id != null && message.hasOwnProperty(\"id\"))\n                    object.id = message.id;\n                if (message.filename != null && message.hasOwnProperty(\"filename\"))\n                    object.filename = message.filename;\n                if (message.collectionName != null && message.hasOwnProperty(\"collectionName\"))\n                    object.collectionName = message.collectionName;\n                if (message.ticksPerQuarter != null && message.hasOwnProperty(\"ticksPerQuarter\"))\n                    object.ticksPerQuarter = message.ticksPerQuarter;\n                if (message.timeSignatures && message.timeSignatures.length) {\n                    object.timeSignatures = [];\n                    for (var j = 0; j < message.timeSignatures.length; ++j)\n                        object.timeSignatures[j] = $root.tensorflow.magenta.NoteSequence.TimeSignature.toObject(message.timeSignatures[j], options);\n                }\n                if (message.keySignatures && message.keySignatures.length) {\n                    object.keySignatures = [];\n                    for (var j = 0; j < message.keySignatures.length; ++j)\n                        object.keySignatures[j] = $root.tensorflow.magenta.NoteSequence.KeySignature.toObject(message.keySignatures[j], options);\n                }\n                if (message.tempos && message.tempos.length) {\n                    object.tempos = [];\n                    for (var j = 0; j < message.tempos.length; ++j)\n                        object.tempos[j] = $root.tensorflow.magenta.NoteSequence.Tempo.toObject(message.tempos[j], options);\n                }\n                if (message.notes && message.notes.length) {\n                    object.notes = [];\n                    for (var j = 0; j < message.notes.length; ++j)\n                        object.notes[j] = $root.tensorflow.magenta.NoteSequence.Note.toObject(message.notes[j], options);\n                }\n                if (message.totalTime != null && message.hasOwnProperty(\"totalTime\"))\n                    object.totalTime = options.json && !isFinite(message.totalTime) ? String(message.totalTime) : message.totalTime;\n                if (message.pitchBends && message.pitchBends.length) {\n                    object.pitchBends = [];\n                    for (var j = 0; j < message.pitchBends.length; ++j)\n                        object.pitchBends[j] = $root.tensorflow.magenta.NoteSequence.PitchBend.toObject(message.pitchBends[j], options);\n                }\n                if (message.controlChanges && message.controlChanges.length) {\n                    object.controlChanges = [];\n                    for (var j = 0; j < message.controlChanges.length; ++j)\n                        object.controlChanges[j] = $root.tensorflow.magenta.NoteSequence.ControlChange.toObject(message.controlChanges[j], options);\n                }\n                if (message.partInfos && message.partInfos.length) {\n                    object.partInfos = [];\n                    for (var j = 0; j < message.partInfos.length; ++j)\n                        object.partInfos[j] = $root.tensorflow.magenta.NoteSequence.PartInfo.toObject(message.partInfos[j], options);\n                }\n                if (message.sourceInfo != null && message.hasOwnProperty(\"sourceInfo\"))\n                    object.sourceInfo = $root.tensorflow.magenta.NoteSequence.SourceInfo.toObject(message.sourceInfo, options);\n                if (message.textAnnotations && message.textAnnotations.length) {\n                    object.textAnnotations = [];\n                    for (var j = 0; j < message.textAnnotations.length; ++j)\n                        object.textAnnotations[j] = $root.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(message.textAnnotations[j], options);\n                }\n                if (message.quantizationInfo != null && message.hasOwnProperty(\"quantizationInfo\"))\n                    object.quantizationInfo = $root.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(message.quantizationInfo, options);\n                if (message.totalQuantizedSteps != null && message.hasOwnProperty(\"totalQuantizedSteps\"))\n                    if (typeof message.totalQuantizedSteps === \"number\")\n                        object.totalQuantizedSteps = options.longs === String ? String(message.totalQuantizedSteps) : message.totalQuantizedSteps;\n                    else\n                        object.totalQuantizedSteps = options.longs === String ? $util.Long.prototype.toString.call(message.totalQuantizedSteps) : options.longs === Number ? new $util.LongBits(message.totalQuantizedSteps.low >>> 0, message.totalQuantizedSteps.high >>> 0).toNumber() : message.totalQuantizedSteps;\n                if (message.subsequenceInfo != null && message.hasOwnProperty(\"subsequenceInfo\"))\n                    object.subsequenceInfo = $root.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(message.subsequenceInfo, options);\n                if (message.referenceNumber != null && message.hasOwnProperty(\"referenceNumber\"))\n                    if (typeof message.referenceNumber === \"number\")\n                        object.referenceNumber = options.longs === String ? String(message.referenceNumber) : message.referenceNumber;\n                    else\n                        object.referenceNumber = options.longs === String ? $util.Long.prototype.toString.call(message.referenceNumber) : options.longs === Number ? new $util.LongBits(message.referenceNumber.low >>> 0, message.referenceNumber.high >>> 0).toNumber() : message.referenceNumber;\n                if (message.sequenceMetadata != null && message.hasOwnProperty(\"sequenceMetadata\"))\n                    object.sequenceMetadata = $root.tensorflow.magenta.SequenceMetadata.toObject(message.sequenceMetadata, options);\n                if (message.sectionAnnotations && message.sectionAnnotations.length) {\n                    object.sectionAnnotations = [];\n                    for (var j = 0; j < message.sectionAnnotations.length; ++j)\n                        object.sectionAnnotations[j] = $root.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(message.sectionAnnotations[j], options);\n                }\n                if (message.sectionGroups && message.sectionGroups.length) {\n                    object.sectionGroups = [];\n                    for (var j = 0; j < message.sectionGroups.length; ++j)\n                        object.sectionGroups[j] = $root.tensorflow.magenta.NoteSequence.SectionGroup.toObject(message.sectionGroups[j], options);\n                }\n                return object;\n            };\n\n            /**\n             * Converts this NoteSequence to JSON.\n             * @function toJSON\n             * @memberof tensorflow.magenta.NoteSequence\n             * @instance\n             * @returns {Object.<string,*>} JSON object\n             */\n            NoteSequence.prototype.toJSON = function toJSON() {\n                return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n            };\n\n            NoteSequence.Note = (function() {\n\n                /**\n                 * Properties of a Note.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface INote\n                 * @property {number|null} [pitch] Note pitch\n                 * @property {tensorflow.magenta.NoteSequence.PitchName|null} [pitchName] Note pitchName\n                 * @property {number|null} [velocity] Note velocity\n                 * @property {number|null} [startTime] Note startTime\n                 * @property {number|null} [quantizedStartStep] Note quantizedStartStep\n                 * @property {number|null} [endTime] Note endTime\n                 * @property {number|null} [quantizedEndStep] Note quantizedEndStep\n                 * @property {number|null} [numerator] Note numerator\n                 * @property {number|null} [denominator] Note denominator\n                 * @property {number|null} [instrument] Note instrument\n                 * @property {number|null} [program] Note program\n                 * @property {boolean|null} [isDrum] Note isDrum\n                 * @property {number|null} [part] Note part\n                 * @property {number|null} [voice] Note voice\n                 */\n\n                /**\n                 * Constructs a new Note.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a Note.\n                 * @implements INote\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.INote=} [properties] Properties to set\n                 */\n                function Note(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * Note pitch.\n                 * @member {number} pitch\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.pitch = 0;\n\n                /**\n                 * Note pitchName.\n                 * @member {tensorflow.magenta.NoteSequence.PitchName} pitchName\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.pitchName = 0;\n\n                /**\n                 * Note velocity.\n                 * @member {number} velocity\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.velocity = 0;\n\n                /**\n                 * Note startTime.\n                 * @member {number} startTime\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.startTime = 0;\n\n                /**\n                 * Note quantizedStartStep.\n                 * @member {number} quantizedStartStep\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.quantizedStartStep = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * Note endTime.\n                 * @member {number} endTime\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.endTime = 0;\n\n                /**\n                 * Note quantizedEndStep.\n                 * @member {number} quantizedEndStep\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.quantizedEndStep = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * Note numerator.\n                 * @member {number} numerator\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.numerator = 0;\n\n                /**\n                 * Note denominator.\n                 * @member {number} denominator\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.denominator = 0;\n\n                /**\n                 * Note instrument.\n                 * @member {number} instrument\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.instrument = 0;\n\n                /**\n                 * Note program.\n                 * @member {number} program\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.program = 0;\n\n                /**\n                 * Note isDrum.\n                 * @member {boolean} isDrum\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.isDrum = false;\n\n                /**\n                 * Note part.\n                 * @member {number} part\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.part = 0;\n\n                /**\n                 * Note voice.\n                 * @member {number} voice\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 */\n                Note.prototype.voice = 0;\n\n                /**\n                 * Creates a new Note instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.INote=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.Note} Note instance\n                 */\n                Note.create = function create(properties) {\n                    return new Note(properties);\n                };\n\n                /**\n                 * Encodes the specified Note message. Does not implicitly {@link tensorflow.magenta.NoteSequence.Note.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.INote} message Note message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Note.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.pitch != null && message.hasOwnProperty(\"pitch\"))\n                        writer.uint32(/* id 1, wireType 0 =*/8).int32(message.pitch);\n                    if (message.velocity != null && message.hasOwnProperty(\"velocity\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.velocity);\n                    if (message.startTime != null && message.hasOwnProperty(\"startTime\"))\n                        writer.uint32(/* id 3, wireType 1 =*/25).double(message.startTime);\n                    if (message.endTime != null && message.hasOwnProperty(\"endTime\"))\n                        writer.uint32(/* id 4, wireType 1 =*/33).double(message.endTime);\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        writer.uint32(/* id 5, wireType 0 =*/40).int32(message.numerator);\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        writer.uint32(/* id 6, wireType 0 =*/48).int32(message.denominator);\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        writer.uint32(/* id 7, wireType 0 =*/56).int32(message.instrument);\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        writer.uint32(/* id 8, wireType 0 =*/64).int32(message.program);\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        writer.uint32(/* id 9, wireType 0 =*/72).bool(message.isDrum);\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        writer.uint32(/* id 10, wireType 0 =*/80).int32(message.part);\n                    if (message.pitchName != null && message.hasOwnProperty(\"pitchName\"))\n                        writer.uint32(/* id 11, wireType 0 =*/88).int32(message.pitchName);\n                    if (message.voice != null && message.hasOwnProperty(\"voice\"))\n                        writer.uint32(/* id 12, wireType 0 =*/96).int32(message.voice);\n                    if (message.quantizedStartStep != null && message.hasOwnProperty(\"quantizedStartStep\"))\n                        writer.uint32(/* id 13, wireType 0 =*/104).int64(message.quantizedStartStep);\n                    if (message.quantizedEndStep != null && message.hasOwnProperty(\"quantizedEndStep\"))\n                        writer.uint32(/* id 14, wireType 0 =*/112).int64(message.quantizedEndStep);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified Note message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.Note.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.INote} message Note message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Note.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a Note message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.Note} Note\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Note.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.Note();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.pitch = reader.int32();\n                            break;\n                        case 11:\n                            message.pitchName = reader.int32();\n                            break;\n                        case 2:\n                            message.velocity = reader.int32();\n                            break;\n                        case 3:\n                            message.startTime = reader.double();\n                            break;\n                        case 13:\n                            message.quantizedStartStep = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        case 4:\n                            message.endTime = reader.double();\n                            break;\n                        case 14:\n                            message.quantizedEndStep = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        case 5:\n                            message.numerator = reader.int32();\n                            break;\n                        case 6:\n                            message.denominator = reader.int32();\n                            break;\n                        case 7:\n                            message.instrument = reader.int32();\n                            break;\n                        case 8:\n                            message.program = reader.int32();\n                            break;\n                        case 9:\n                            message.isDrum = reader.bool();\n                            break;\n                        case 10:\n                            message.part = reader.int32();\n                            break;\n                        case 12:\n                            message.voice = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a Note message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.Note} Note\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Note.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a Note message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                Note.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.pitch != null && message.hasOwnProperty(\"pitch\"))\n                        if (!$util.isInteger(message.pitch))\n                            return \"pitch: integer expected\";\n                    if (message.pitchName != null && message.hasOwnProperty(\"pitchName\"))\n                        switch (message.pitchName) {\n                        default:\n                            return \"pitchName: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                        case 3:\n                        case 4:\n                        case 5:\n                        case 6:\n                        case 7:\n                        case 8:\n                        case 9:\n                        case 10:\n                        case 11:\n                        case 12:\n                        case 13:\n                        case 14:\n                        case 15:\n                        case 16:\n                        case 17:\n                        case 18:\n                        case 19:\n                        case 20:\n                        case 21:\n                        case 22:\n                        case 23:\n                        case 24:\n                        case 25:\n                        case 26:\n                        case 27:\n                        case 28:\n                        case 29:\n                        case 30:\n                        case 31:\n                        case 32:\n                        case 33:\n                        case 34:\n                        case 35:\n                            break;\n                        }\n                    if (message.velocity != null && message.hasOwnProperty(\"velocity\"))\n                        if (!$util.isInteger(message.velocity))\n                            return \"velocity: integer expected\";\n                    if (message.startTime != null && message.hasOwnProperty(\"startTime\"))\n                        if (typeof message.startTime !== \"number\")\n                            return \"startTime: number expected\";\n                    if (message.quantizedStartStep != null && message.hasOwnProperty(\"quantizedStartStep\"))\n                        if (!$util.isInteger(message.quantizedStartStep) && !(message.quantizedStartStep && $util.isInteger(message.quantizedStartStep.low) && $util.isInteger(message.quantizedStartStep.high)))\n                            return \"quantizedStartStep: integer|Long expected\";\n                    if (message.endTime != null && message.hasOwnProperty(\"endTime\"))\n                        if (typeof message.endTime !== \"number\")\n                            return \"endTime: number expected\";\n                    if (message.quantizedEndStep != null && message.hasOwnProperty(\"quantizedEndStep\"))\n                        if (!$util.isInteger(message.quantizedEndStep) && !(message.quantizedEndStep && $util.isInteger(message.quantizedEndStep.low) && $util.isInteger(message.quantizedEndStep.high)))\n                            return \"quantizedEndStep: integer|Long expected\";\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        if (!$util.isInteger(message.numerator))\n                            return \"numerator: integer expected\";\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        if (!$util.isInteger(message.denominator))\n                            return \"denominator: integer expected\";\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        if (!$util.isInteger(message.instrument))\n                            return \"instrument: integer expected\";\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        if (!$util.isInteger(message.program))\n                            return \"program: integer expected\";\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        if (typeof message.isDrum !== \"boolean\")\n                            return \"isDrum: boolean expected\";\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        if (!$util.isInteger(message.part))\n                            return \"part: integer expected\";\n                    if (message.voice != null && message.hasOwnProperty(\"voice\"))\n                        if (!$util.isInteger(message.voice))\n                            return \"voice: integer expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a Note message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.Note} Note\n                 */\n                Note.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.Note)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.Note();\n                    if (object.pitch != null)\n                        message.pitch = object.pitch | 0;\n                    switch (object.pitchName) {\n                    case \"UNKNOWN_PITCH_NAME\":\n                    case 0:\n                        message.pitchName = 0;\n                        break;\n                    case \"F_FLAT_FLAT\":\n                    case 1:\n                        message.pitchName = 1;\n                        break;\n                    case \"C_FLAT_FLAT\":\n                    case 2:\n                        message.pitchName = 2;\n                        break;\n                    case \"G_FLAT_FLAT\":\n                    case 3:\n                        message.pitchName = 3;\n                        break;\n                    case \"D_FLAT_FLAT\":\n                    case 4:\n                        message.pitchName = 4;\n                        break;\n                    case \"A_FLAT_FLAT\":\n                    case 5:\n                        message.pitchName = 5;\n                        break;\n                    case \"E_FLAT_FLAT\":\n                    case 6:\n                        message.pitchName = 6;\n                        break;\n                    case \"B_FLAT_FLAT\":\n                    case 7:\n                        message.pitchName = 7;\n                        break;\n                    case \"F_FLAT\":\n                    case 8:\n                        message.pitchName = 8;\n                        break;\n                    case \"C_FLAT\":\n                    case 9:\n                        message.pitchName = 9;\n                        break;\n                    case \"G_FLAT\":\n                    case 10:\n                        message.pitchName = 10;\n                        break;\n                    case \"D_FLAT\":\n                    case 11:\n                        message.pitchName = 11;\n                        break;\n                    case \"A_FLAT\":\n                    case 12:\n                        message.pitchName = 12;\n                        break;\n                    case \"E_FLAT\":\n                    case 13:\n                        message.pitchName = 13;\n                        break;\n                    case \"B_FLAT\":\n                    case 14:\n                        message.pitchName = 14;\n                        break;\n                    case \"F\":\n                    case 15:\n                        message.pitchName = 15;\n                        break;\n                    case \"C\":\n                    case 16:\n                        message.pitchName = 16;\n                        break;\n                    case \"G\":\n                    case 17:\n                        message.pitchName = 17;\n                        break;\n                    case \"D\":\n                    case 18:\n                        message.pitchName = 18;\n                        break;\n                    case \"A\":\n                    case 19:\n                        message.pitchName = 19;\n                        break;\n                    case \"E\":\n                    case 20:\n                        message.pitchName = 20;\n                        break;\n                    case \"B\":\n                    case 21:\n                        message.pitchName = 21;\n                        break;\n                    case \"F_SHARP\":\n                    case 22:\n                        message.pitchName = 22;\n                        break;\n                    case \"C_SHARP\":\n                    case 23:\n                        message.pitchName = 23;\n                        break;\n                    case \"G_SHARP\":\n                    case 24:\n                        message.pitchName = 24;\n                        break;\n                    case \"D_SHARP\":\n                    case 25:\n                        message.pitchName = 25;\n                        break;\n                    case \"A_SHARP\":\n                    case 26:\n                        message.pitchName = 26;\n                        break;\n                    case \"E_SHARP\":\n                    case 27:\n                        message.pitchName = 27;\n                        break;\n                    case \"B_SHARP\":\n                    case 28:\n                        message.pitchName = 28;\n                        break;\n                    case \"F_SHARP_SHARP\":\n                    case 29:\n                        message.pitchName = 29;\n                        break;\n                    case \"C_SHARP_SHARP\":\n                    case 30:\n                        message.pitchName = 30;\n                        break;\n                    case \"G_SHARP_SHARP\":\n                    case 31:\n                        message.pitchName = 31;\n                        break;\n                    case \"D_SHARP_SHARP\":\n                    case 32:\n                        message.pitchName = 32;\n                        break;\n                    case \"A_SHARP_SHARP\":\n                    case 33:\n                        message.pitchName = 33;\n                        break;\n                    case \"E_SHARP_SHARP\":\n                    case 34:\n                        message.pitchName = 34;\n                        break;\n                    case \"B_SHARP_SHARP\":\n                    case 35:\n                        message.pitchName = 35;\n                        break;\n                    }\n                    if (object.velocity != null)\n                        message.velocity = object.velocity | 0;\n                    if (object.startTime != null)\n                        message.startTime = Number(object.startTime);\n                    if (object.quantizedStartStep != null)\n                        if ($util.Long)\n                            (message.quantizedStartStep = $util.Long.fromValue(object.quantizedStartStep)).unsigned = false;\n                        else if (typeof object.quantizedStartStep === \"string\")\n                            message.quantizedStartStep = parseInt(object.quantizedStartStep, 10);\n                        else if (typeof object.quantizedStartStep === \"number\")\n                            message.quantizedStartStep = object.quantizedStartStep;\n                        else if (typeof object.quantizedStartStep === \"object\")\n                            message.quantizedStartStep = new $util.LongBits(object.quantizedStartStep.low >>> 0, object.quantizedStartStep.high >>> 0).toNumber();\n                    if (object.endTime != null)\n                        message.endTime = Number(object.endTime);\n                    if (object.quantizedEndStep != null)\n                        if ($util.Long)\n                            (message.quantizedEndStep = $util.Long.fromValue(object.quantizedEndStep)).unsigned = false;\n                        else if (typeof object.quantizedEndStep === \"string\")\n                            message.quantizedEndStep = parseInt(object.quantizedEndStep, 10);\n                        else if (typeof object.quantizedEndStep === \"number\")\n                            message.quantizedEndStep = object.quantizedEndStep;\n                        else if (typeof object.quantizedEndStep === \"object\")\n                            message.quantizedEndStep = new $util.LongBits(object.quantizedEndStep.low >>> 0, object.quantizedEndStep.high >>> 0).toNumber();\n                    if (object.numerator != null)\n                        message.numerator = object.numerator | 0;\n                    if (object.denominator != null)\n                        message.denominator = object.denominator | 0;\n                    if (object.instrument != null)\n                        message.instrument = object.instrument | 0;\n                    if (object.program != null)\n                        message.program = object.program | 0;\n                    if (object.isDrum != null)\n                        message.isDrum = Boolean(object.isDrum);\n                    if (object.part != null)\n                        message.part = object.part | 0;\n                    if (object.voice != null)\n                        message.voice = object.voice | 0;\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a Note message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.Note} message Note\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                Note.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.pitch = 0;\n                        object.velocity = 0;\n                        object.startTime = 0;\n                        object.endTime = 0;\n                        object.numerator = 0;\n                        object.denominator = 0;\n                        object.instrument = 0;\n                        object.program = 0;\n                        object.isDrum = false;\n                        object.part = 0;\n                        object.pitchName = options.enums === String ? \"UNKNOWN_PITCH_NAME\" : 0;\n                        object.voice = 0;\n                        if ($util.Long) {\n                            var long = new $util.Long(0, 0, false);\n                            object.quantizedStartStep = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                        } else\n                            object.quantizedStartStep = options.longs === String ? \"0\" : 0;\n                        if ($util.Long) {\n                            var long = new $util.Long(0, 0, false);\n                            object.quantizedEndStep = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                        } else\n                            object.quantizedEndStep = options.longs === String ? \"0\" : 0;\n                    }\n                    if (message.pitch != null && message.hasOwnProperty(\"pitch\"))\n                        object.pitch = message.pitch;\n                    if (message.velocity != null && message.hasOwnProperty(\"velocity\"))\n                        object.velocity = message.velocity;\n                    if (message.startTime != null && message.hasOwnProperty(\"startTime\"))\n                        object.startTime = options.json && !isFinite(message.startTime) ? String(message.startTime) : message.startTime;\n                    if (message.endTime != null && message.hasOwnProperty(\"endTime\"))\n                        object.endTime = options.json && !isFinite(message.endTime) ? String(message.endTime) : message.endTime;\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        object.numerator = message.numerator;\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        object.denominator = message.denominator;\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        object.instrument = message.instrument;\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        object.program = message.program;\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        object.isDrum = message.isDrum;\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        object.part = message.part;\n                    if (message.pitchName != null && message.hasOwnProperty(\"pitchName\"))\n                        object.pitchName = options.enums === String ? $root.tensorflow.magenta.NoteSequence.PitchName[message.pitchName] : message.pitchName;\n                    if (message.voice != null && message.hasOwnProperty(\"voice\"))\n                        object.voice = message.voice;\n                    if (message.quantizedStartStep != null && message.hasOwnProperty(\"quantizedStartStep\"))\n                        if (typeof message.quantizedStartStep === \"number\")\n                            object.quantizedStartStep = options.longs === String ? String(message.quantizedStartStep) : message.quantizedStartStep;\n                        else\n                            object.quantizedStartStep = options.longs === String ? $util.Long.prototype.toString.call(message.quantizedStartStep) : options.longs === Number ? new $util.LongBits(message.quantizedStartStep.low >>> 0, message.quantizedStartStep.high >>> 0).toNumber() : message.quantizedStartStep;\n                    if (message.quantizedEndStep != null && message.hasOwnProperty(\"quantizedEndStep\"))\n                        if (typeof message.quantizedEndStep === \"number\")\n                            object.quantizedEndStep = options.longs === String ? String(message.quantizedEndStep) : message.quantizedEndStep;\n                        else\n                            object.quantizedEndStep = options.longs === String ? $util.Long.prototype.toString.call(message.quantizedEndStep) : options.longs === Number ? new $util.LongBits(message.quantizedEndStep.low >>> 0, message.quantizedEndStep.high >>> 0).toNumber() : message.quantizedEndStep;\n                    return object;\n                };\n\n                /**\n                 * Converts this Note to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.Note\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                Note.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return Note;\n            })();\n\n            /**\n             * PitchName enum.\n             * @name tensorflow.magenta.NoteSequence.PitchName\n             * @enum {string}\n             * @property {number} UNKNOWN_PITCH_NAME=0 UNKNOWN_PITCH_NAME value\n             * @property {number} F_FLAT_FLAT=1 F_FLAT_FLAT value\n             * @property {number} C_FLAT_FLAT=2 C_FLAT_FLAT value\n             * @property {number} G_FLAT_FLAT=3 G_FLAT_FLAT value\n             * @property {number} D_FLAT_FLAT=4 D_FLAT_FLAT value\n             * @property {number} A_FLAT_FLAT=5 A_FLAT_FLAT value\n             * @property {number} E_FLAT_FLAT=6 E_FLAT_FLAT value\n             * @property {number} B_FLAT_FLAT=7 B_FLAT_FLAT value\n             * @property {number} F_FLAT=8 F_FLAT value\n             * @property {number} C_FLAT=9 C_FLAT value\n             * @property {number} G_FLAT=10 G_FLAT value\n             * @property {number} D_FLAT=11 D_FLAT value\n             * @property {number} A_FLAT=12 A_FLAT value\n             * @property {number} E_FLAT=13 E_FLAT value\n             * @property {number} B_FLAT=14 B_FLAT value\n             * @property {number} F=15 F value\n             * @property {number} C=16 C value\n             * @property {number} G=17 G value\n             * @property {number} D=18 D value\n             * @property {number} A=19 A value\n             * @property {number} E=20 E value\n             * @property {number} B=21 B value\n             * @property {number} F_SHARP=22 F_SHARP value\n             * @property {number} C_SHARP=23 C_SHARP value\n             * @property {number} G_SHARP=24 G_SHARP value\n             * @property {number} D_SHARP=25 D_SHARP value\n             * @property {number} A_SHARP=26 A_SHARP value\n             * @property {number} E_SHARP=27 E_SHARP value\n             * @property {number} B_SHARP=28 B_SHARP value\n             * @property {number} F_SHARP_SHARP=29 F_SHARP_SHARP value\n             * @property {number} C_SHARP_SHARP=30 C_SHARP_SHARP value\n             * @property {number} G_SHARP_SHARP=31 G_SHARP_SHARP value\n             * @property {number} D_SHARP_SHARP=32 D_SHARP_SHARP value\n             * @property {number} A_SHARP_SHARP=33 A_SHARP_SHARP value\n             * @property {number} E_SHARP_SHARP=34 E_SHARP_SHARP value\n             * @property {number} B_SHARP_SHARP=35 B_SHARP_SHARP value\n             */\n            NoteSequence.PitchName = (function() {\n                var valuesById = {}, values = Object.create(valuesById);\n                values[valuesById[0] = \"UNKNOWN_PITCH_NAME\"] = 0;\n                values[valuesById[1] = \"F_FLAT_FLAT\"] = 1;\n                values[valuesById[2] = \"C_FLAT_FLAT\"] = 2;\n                values[valuesById[3] = \"G_FLAT_FLAT\"] = 3;\n                values[valuesById[4] = \"D_FLAT_FLAT\"] = 4;\n                values[valuesById[5] = \"A_FLAT_FLAT\"] = 5;\n                values[valuesById[6] = \"E_FLAT_FLAT\"] = 6;\n                values[valuesById[7] = \"B_FLAT_FLAT\"] = 7;\n                values[valuesById[8] = \"F_FLAT\"] = 8;\n                values[valuesById[9] = \"C_FLAT\"] = 9;\n                values[valuesById[10] = \"G_FLAT\"] = 10;\n                values[valuesById[11] = \"D_FLAT\"] = 11;\n                values[valuesById[12] = \"A_FLAT\"] = 12;\n                values[valuesById[13] = \"E_FLAT\"] = 13;\n                values[valuesById[14] = \"B_FLAT\"] = 14;\n                values[valuesById[15] = \"F\"] = 15;\n                values[valuesById[16] = \"C\"] = 16;\n                values[valuesById[17] = \"G\"] = 17;\n                values[valuesById[18] = \"D\"] = 18;\n                values[valuesById[19] = \"A\"] = 19;\n                values[valuesById[20] = \"E\"] = 20;\n                values[valuesById[21] = \"B\"] = 21;\n                values[valuesById[22] = \"F_SHARP\"] = 22;\n                values[valuesById[23] = \"C_SHARP\"] = 23;\n                values[valuesById[24] = \"G_SHARP\"] = 24;\n                values[valuesById[25] = \"D_SHARP\"] = 25;\n                values[valuesById[26] = \"A_SHARP\"] = 26;\n                values[valuesById[27] = \"E_SHARP\"] = 27;\n                values[valuesById[28] = \"B_SHARP\"] = 28;\n                values[valuesById[29] = \"F_SHARP_SHARP\"] = 29;\n                values[valuesById[30] = \"C_SHARP_SHARP\"] = 30;\n                values[valuesById[31] = \"G_SHARP_SHARP\"] = 31;\n                values[valuesById[32] = \"D_SHARP_SHARP\"] = 32;\n                values[valuesById[33] = \"A_SHARP_SHARP\"] = 33;\n                values[valuesById[34] = \"E_SHARP_SHARP\"] = 34;\n                values[valuesById[35] = \"B_SHARP_SHARP\"] = 35;\n                return values;\n            })();\n\n            NoteSequence.TimeSignature = (function() {\n\n                /**\n                 * Properties of a TimeSignature.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ITimeSignature\n                 * @property {number|null} [time] TimeSignature time\n                 * @property {number|null} [numerator] TimeSignature numerator\n                 * @property {number|null} [denominator] TimeSignature denominator\n                 */\n\n                /**\n                 * Constructs a new TimeSignature.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a TimeSignature.\n                 * @implements ITimeSignature\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ITimeSignature=} [properties] Properties to set\n                 */\n                function TimeSignature(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * TimeSignature time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @instance\n                 */\n                TimeSignature.prototype.time = 0;\n\n                /**\n                 * TimeSignature numerator.\n                 * @member {number} numerator\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @instance\n                 */\n                TimeSignature.prototype.numerator = 0;\n\n                /**\n                 * TimeSignature denominator.\n                 * @member {number} denominator\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @instance\n                 */\n                TimeSignature.prototype.denominator = 0;\n\n                /**\n                 * Creates a new TimeSignature instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITimeSignature=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.TimeSignature} TimeSignature instance\n                 */\n                TimeSignature.create = function create(properties) {\n                    return new TimeSignature(properties);\n                };\n\n                /**\n                 * Encodes the specified TimeSignature message. Does not implicitly {@link tensorflow.magenta.NoteSequence.TimeSignature.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITimeSignature} message TimeSignature message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                TimeSignature.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.numerator);\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.denominator);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified TimeSignature message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.TimeSignature.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITimeSignature} message TimeSignature message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                TimeSignature.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a TimeSignature message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.TimeSignature} TimeSignature\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                TimeSignature.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.TimeSignature();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 2:\n                            message.numerator = reader.int32();\n                            break;\n                        case 3:\n                            message.denominator = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a TimeSignature message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.TimeSignature} TimeSignature\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                TimeSignature.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a TimeSignature message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                TimeSignature.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        if (!$util.isInteger(message.numerator))\n                            return \"numerator: integer expected\";\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        if (!$util.isInteger(message.denominator))\n                            return \"denominator: integer expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a TimeSignature message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.TimeSignature} TimeSignature\n                 */\n                TimeSignature.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.TimeSignature)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.TimeSignature();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.numerator != null)\n                        message.numerator = object.numerator | 0;\n                    if (object.denominator != null)\n                        message.denominator = object.denominator | 0;\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a TimeSignature message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.TimeSignature} message TimeSignature\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                TimeSignature.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.numerator = 0;\n                        object.denominator = 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.numerator != null && message.hasOwnProperty(\"numerator\"))\n                        object.numerator = message.numerator;\n                    if (message.denominator != null && message.hasOwnProperty(\"denominator\"))\n                        object.denominator = message.denominator;\n                    return object;\n                };\n\n                /**\n                 * Converts this TimeSignature to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.TimeSignature\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                TimeSignature.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return TimeSignature;\n            })();\n\n            NoteSequence.KeySignature = (function() {\n\n                /**\n                 * Properties of a KeySignature.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface IKeySignature\n                 * @property {number|null} [time] KeySignature time\n                 * @property {tensorflow.magenta.NoteSequence.KeySignature.Key|null} [key] KeySignature key\n                 * @property {tensorflow.magenta.NoteSequence.KeySignature.Mode|null} [mode] KeySignature mode\n                 */\n\n                /**\n                 * Constructs a new KeySignature.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a KeySignature.\n                 * @implements IKeySignature\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.IKeySignature=} [properties] Properties to set\n                 */\n                function KeySignature(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * KeySignature time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @instance\n                 */\n                KeySignature.prototype.time = 0;\n\n                /**\n                 * KeySignature key.\n                 * @member {tensorflow.magenta.NoteSequence.KeySignature.Key} key\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @instance\n                 */\n                KeySignature.prototype.key = 0;\n\n                /**\n                 * KeySignature mode.\n                 * @member {tensorflow.magenta.NoteSequence.KeySignature.Mode} mode\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @instance\n                 */\n                KeySignature.prototype.mode = 0;\n\n                /**\n                 * Creates a new KeySignature instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IKeySignature=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.KeySignature} KeySignature instance\n                 */\n                KeySignature.create = function create(properties) {\n                    return new KeySignature(properties);\n                };\n\n                /**\n                 * Encodes the specified KeySignature message. Does not implicitly {@link tensorflow.magenta.NoteSequence.KeySignature.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IKeySignature} message KeySignature message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                KeySignature.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.key != null && message.hasOwnProperty(\"key\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.key);\n                    if (message.mode != null && message.hasOwnProperty(\"mode\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.mode);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified KeySignature message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.KeySignature.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IKeySignature} message KeySignature message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                KeySignature.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a KeySignature message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.KeySignature} KeySignature\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                KeySignature.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.KeySignature();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 2:\n                            message.key = reader.int32();\n                            break;\n                        case 3:\n                            message.mode = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a KeySignature message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.KeySignature} KeySignature\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                KeySignature.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a KeySignature message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                KeySignature.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.key != null && message.hasOwnProperty(\"key\"))\n                        switch (message.key) {\n                        default:\n                            return \"key: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 1:\n                        case 2:\n                        case 3:\n                        case 3:\n                        case 4:\n                        case 5:\n                        case 6:\n                        case 6:\n                        case 7:\n                        case 8:\n                        case 8:\n                        case 9:\n                        case 10:\n                        case 10:\n                        case 11:\n                            break;\n                        }\n                    if (message.mode != null && message.hasOwnProperty(\"mode\"))\n                        switch (message.mode) {\n                        default:\n                            return \"mode: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                        case 3:\n                        case 4:\n                        case 5:\n                        case 6:\n                        case 7:\n                            break;\n                        }\n                    return null;\n                };\n\n                /**\n                 * Creates a KeySignature message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.KeySignature} KeySignature\n                 */\n                KeySignature.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.KeySignature)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.KeySignature();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    switch (object.key) {\n                    case \"C\":\n                    case 0:\n                        message.key = 0;\n                        break;\n                    case \"C_SHARP\":\n                    case 1:\n                        message.key = 1;\n                        break;\n                    case \"D_FLAT\":\n                    case 1:\n                        message.key = 1;\n                        break;\n                    case \"D\":\n                    case 2:\n                        message.key = 2;\n                        break;\n                    case \"D_SHARP\":\n                    case 3:\n                        message.key = 3;\n                        break;\n                    case \"E_FLAT\":\n                    case 3:\n                        message.key = 3;\n                        break;\n                    case \"E\":\n                    case 4:\n                        message.key = 4;\n                        break;\n                    case \"F\":\n                    case 5:\n                        message.key = 5;\n                        break;\n                    case \"F_SHARP\":\n                    case 6:\n                        message.key = 6;\n                        break;\n                    case \"G_FLAT\":\n                    case 6:\n                        message.key = 6;\n                        break;\n                    case \"G\":\n                    case 7:\n                        message.key = 7;\n                        break;\n                    case \"G_SHARP\":\n                    case 8:\n                        message.key = 8;\n                        break;\n                    case \"A_FLAT\":\n                    case 8:\n                        message.key = 8;\n                        break;\n                    case \"A\":\n                    case 9:\n                        message.key = 9;\n                        break;\n                    case \"A_SHARP\":\n                    case 10:\n                        message.key = 10;\n                        break;\n                    case \"B_FLAT\":\n                    case 10:\n                        message.key = 10;\n                        break;\n                    case \"B\":\n                    case 11:\n                        message.key = 11;\n                        break;\n                    }\n                    switch (object.mode) {\n                    case \"MAJOR\":\n                    case 0:\n                        message.mode = 0;\n                        break;\n                    case \"MINOR\":\n                    case 1:\n                        message.mode = 1;\n                        break;\n                    case \"NOT_SPECIFIED\":\n                    case 2:\n                        message.mode = 2;\n                        break;\n                    case \"MIXOLYDIAN\":\n                    case 3:\n                        message.mode = 3;\n                        break;\n                    case \"DORIAN\":\n                    case 4:\n                        message.mode = 4;\n                        break;\n                    case \"PHRYGIAN\":\n                    case 5:\n                        message.mode = 5;\n                        break;\n                    case \"LYDIAN\":\n                    case 6:\n                        message.mode = 6;\n                        break;\n                    case \"LOCRIAN\":\n                    case 7:\n                        message.mode = 7;\n                        break;\n                    }\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a KeySignature message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.KeySignature} message KeySignature\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                KeySignature.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.key = options.enums === String ? \"C\" : 0;\n                        object.mode = options.enums === String ? \"MAJOR\" : 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.key != null && message.hasOwnProperty(\"key\"))\n                        object.key = options.enums === String ? $root.tensorflow.magenta.NoteSequence.KeySignature.Key[message.key] : message.key;\n                    if (message.mode != null && message.hasOwnProperty(\"mode\"))\n                        object.mode = options.enums === String ? $root.tensorflow.magenta.NoteSequence.KeySignature.Mode[message.mode] : message.mode;\n                    return object;\n                };\n\n                /**\n                 * Converts this KeySignature to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.KeySignature\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                KeySignature.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                /**\n                 * Key enum.\n                 * @name tensorflow.magenta.NoteSequence.KeySignature.Key\n                 * @enum {string}\n                 * @property {number} C=0 C value\n                 * @property {number} C_SHARP=1 C_SHARP value\n                 * @property {number} D_FLAT=1 D_FLAT value\n                 * @property {number} D=2 D value\n                 * @property {number} D_SHARP=3 D_SHARP value\n                 * @property {number} E_FLAT=3 E_FLAT value\n                 * @property {number} E=4 E value\n                 * @property {number} F=5 F value\n                 * @property {number} F_SHARP=6 F_SHARP value\n                 * @property {number} G_FLAT=6 G_FLAT value\n                 * @property {number} G=7 G value\n                 * @property {number} G_SHARP=8 G_SHARP value\n                 * @property {number} A_FLAT=8 A_FLAT value\n                 * @property {number} A=9 A value\n                 * @property {number} A_SHARP=10 A_SHARP value\n                 * @property {number} B_FLAT=10 B_FLAT value\n                 * @property {number} B=11 B value\n                 */\n                KeySignature.Key = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"C\"] = 0;\n                    values[valuesById[1] = \"C_SHARP\"] = 1;\n                    values[\"D_FLAT\"] = 1;\n                    values[valuesById[2] = \"D\"] = 2;\n                    values[valuesById[3] = \"D_SHARP\"] = 3;\n                    values[\"E_FLAT\"] = 3;\n                    values[valuesById[4] = \"E\"] = 4;\n                    values[valuesById[5] = \"F\"] = 5;\n                    values[valuesById[6] = \"F_SHARP\"] = 6;\n                    values[\"G_FLAT\"] = 6;\n                    values[valuesById[7] = \"G\"] = 7;\n                    values[valuesById[8] = \"G_SHARP\"] = 8;\n                    values[\"A_FLAT\"] = 8;\n                    values[valuesById[9] = \"A\"] = 9;\n                    values[valuesById[10] = \"A_SHARP\"] = 10;\n                    values[\"B_FLAT\"] = 10;\n                    values[valuesById[11] = \"B\"] = 11;\n                    return values;\n                })();\n\n                /**\n                 * Mode enum.\n                 * @name tensorflow.magenta.NoteSequence.KeySignature.Mode\n                 * @enum {string}\n                 * @property {number} MAJOR=0 MAJOR value\n                 * @property {number} MINOR=1 MINOR value\n                 * @property {number} NOT_SPECIFIED=2 NOT_SPECIFIED value\n                 * @property {number} MIXOLYDIAN=3 MIXOLYDIAN value\n                 * @property {number} DORIAN=4 DORIAN value\n                 * @property {number} PHRYGIAN=5 PHRYGIAN value\n                 * @property {number} LYDIAN=6 LYDIAN value\n                 * @property {number} LOCRIAN=7 LOCRIAN value\n                 */\n                KeySignature.Mode = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"MAJOR\"] = 0;\n                    values[valuesById[1] = \"MINOR\"] = 1;\n                    values[valuesById[2] = \"NOT_SPECIFIED\"] = 2;\n                    values[valuesById[3] = \"MIXOLYDIAN\"] = 3;\n                    values[valuesById[4] = \"DORIAN\"] = 4;\n                    values[valuesById[5] = \"PHRYGIAN\"] = 5;\n                    values[valuesById[6] = \"LYDIAN\"] = 6;\n                    values[valuesById[7] = \"LOCRIAN\"] = 7;\n                    return values;\n                })();\n\n                return KeySignature;\n            })();\n\n            NoteSequence.Tempo = (function() {\n\n                /**\n                 * Properties of a Tempo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ITempo\n                 * @property {number|null} [time] Tempo time\n                 * @property {number|null} [qpm] Tempo qpm\n                 */\n\n                /**\n                 * Constructs a new Tempo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a Tempo.\n                 * @implements ITempo\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ITempo=} [properties] Properties to set\n                 */\n                function Tempo(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * Tempo time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @instance\n                 */\n                Tempo.prototype.time = 0;\n\n                /**\n                 * Tempo qpm.\n                 * @member {number} qpm\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @instance\n                 */\n                Tempo.prototype.qpm = 0;\n\n                /**\n                 * Creates a new Tempo instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITempo=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.Tempo} Tempo instance\n                 */\n                Tempo.create = function create(properties) {\n                    return new Tempo(properties);\n                };\n\n                /**\n                 * Encodes the specified Tempo message. Does not implicitly {@link tensorflow.magenta.NoteSequence.Tempo.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITempo} message Tempo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Tempo.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.qpm != null && message.hasOwnProperty(\"qpm\"))\n                        writer.uint32(/* id 2, wireType 1 =*/17).double(message.qpm);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified Tempo message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.Tempo.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITempo} message Tempo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Tempo.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a Tempo message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.Tempo} Tempo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Tempo.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.Tempo();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 2:\n                            message.qpm = reader.double();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a Tempo message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.Tempo} Tempo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Tempo.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a Tempo message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                Tempo.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.qpm != null && message.hasOwnProperty(\"qpm\"))\n                        if (typeof message.qpm !== \"number\")\n                            return \"qpm: number expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a Tempo message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.Tempo} Tempo\n                 */\n                Tempo.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.Tempo)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.Tempo();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.qpm != null)\n                        message.qpm = Number(object.qpm);\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a Tempo message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.Tempo} message Tempo\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                Tempo.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.qpm = 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.qpm != null && message.hasOwnProperty(\"qpm\"))\n                        object.qpm = options.json && !isFinite(message.qpm) ? String(message.qpm) : message.qpm;\n                    return object;\n                };\n\n                /**\n                 * Converts this Tempo to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.Tempo\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                Tempo.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return Tempo;\n            })();\n\n            NoteSequence.PitchBend = (function() {\n\n                /**\n                 * Properties of a PitchBend.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface IPitchBend\n                 * @property {number|null} [time] PitchBend time\n                 * @property {number|null} [bend] PitchBend bend\n                 * @property {number|null} [instrument] PitchBend instrument\n                 * @property {number|null} [program] PitchBend program\n                 * @property {boolean|null} [isDrum] PitchBend isDrum\n                 */\n\n                /**\n                 * Constructs a new PitchBend.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a PitchBend.\n                 * @implements IPitchBend\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.IPitchBend=} [properties] Properties to set\n                 */\n                function PitchBend(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * PitchBend time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 */\n                PitchBend.prototype.time = 0;\n\n                /**\n                 * PitchBend bend.\n                 * @member {number} bend\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 */\n                PitchBend.prototype.bend = 0;\n\n                /**\n                 * PitchBend instrument.\n                 * @member {number} instrument\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 */\n                PitchBend.prototype.instrument = 0;\n\n                /**\n                 * PitchBend program.\n                 * @member {number} program\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 */\n                PitchBend.prototype.program = 0;\n\n                /**\n                 * PitchBend isDrum.\n                 * @member {boolean} isDrum\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 */\n                PitchBend.prototype.isDrum = false;\n\n                /**\n                 * Creates a new PitchBend instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPitchBend=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.PitchBend} PitchBend instance\n                 */\n                PitchBend.create = function create(properties) {\n                    return new PitchBend(properties);\n                };\n\n                /**\n                 * Encodes the specified PitchBend message. Does not implicitly {@link tensorflow.magenta.NoteSequence.PitchBend.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPitchBend} message PitchBend message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                PitchBend.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.bend != null && message.hasOwnProperty(\"bend\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.bend);\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.instrument);\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        writer.uint32(/* id 4, wireType 0 =*/32).int32(message.program);\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        writer.uint32(/* id 5, wireType 0 =*/40).bool(message.isDrum);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified PitchBend message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.PitchBend.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPitchBend} message PitchBend message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                PitchBend.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a PitchBend message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.PitchBend} PitchBend\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                PitchBend.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.PitchBend();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 2:\n                            message.bend = reader.int32();\n                            break;\n                        case 3:\n                            message.instrument = reader.int32();\n                            break;\n                        case 4:\n                            message.program = reader.int32();\n                            break;\n                        case 5:\n                            message.isDrum = reader.bool();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a PitchBend message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.PitchBend} PitchBend\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                PitchBend.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a PitchBend message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                PitchBend.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.bend != null && message.hasOwnProperty(\"bend\"))\n                        if (!$util.isInteger(message.bend))\n                            return \"bend: integer expected\";\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        if (!$util.isInteger(message.instrument))\n                            return \"instrument: integer expected\";\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        if (!$util.isInteger(message.program))\n                            return \"program: integer expected\";\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        if (typeof message.isDrum !== \"boolean\")\n                            return \"isDrum: boolean expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a PitchBend message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.PitchBend} PitchBend\n                 */\n                PitchBend.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.PitchBend)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.PitchBend();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.bend != null)\n                        message.bend = object.bend | 0;\n                    if (object.instrument != null)\n                        message.instrument = object.instrument | 0;\n                    if (object.program != null)\n                        message.program = object.program | 0;\n                    if (object.isDrum != null)\n                        message.isDrum = Boolean(object.isDrum);\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a PitchBend message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.PitchBend} message PitchBend\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                PitchBend.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.bend = 0;\n                        object.instrument = 0;\n                        object.program = 0;\n                        object.isDrum = false;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.bend != null && message.hasOwnProperty(\"bend\"))\n                        object.bend = message.bend;\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        object.instrument = message.instrument;\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        object.program = message.program;\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        object.isDrum = message.isDrum;\n                    return object;\n                };\n\n                /**\n                 * Converts this PitchBend to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.PitchBend\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                PitchBend.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return PitchBend;\n            })();\n\n            NoteSequence.ControlChange = (function() {\n\n                /**\n                 * Properties of a ControlChange.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface IControlChange\n                 * @property {number|null} [time] ControlChange time\n                 * @property {number|null} [quantizedStep] ControlChange quantizedStep\n                 * @property {number|null} [controlNumber] ControlChange controlNumber\n                 * @property {number|null} [controlValue] ControlChange controlValue\n                 * @property {number|null} [instrument] ControlChange instrument\n                 * @property {number|null} [program] ControlChange program\n                 * @property {boolean|null} [isDrum] ControlChange isDrum\n                 */\n\n                /**\n                 * Constructs a new ControlChange.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a ControlChange.\n                 * @implements IControlChange\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.IControlChange=} [properties] Properties to set\n                 */\n                function ControlChange(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * ControlChange time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.time = 0;\n\n                /**\n                 * ControlChange quantizedStep.\n                 * @member {number} quantizedStep\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.quantizedStep = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * ControlChange controlNumber.\n                 * @member {number} controlNumber\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.controlNumber = 0;\n\n                /**\n                 * ControlChange controlValue.\n                 * @member {number} controlValue\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.controlValue = 0;\n\n                /**\n                 * ControlChange instrument.\n                 * @member {number} instrument\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.instrument = 0;\n\n                /**\n                 * ControlChange program.\n                 * @member {number} program\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.program = 0;\n\n                /**\n                 * ControlChange isDrum.\n                 * @member {boolean} isDrum\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 */\n                ControlChange.prototype.isDrum = false;\n\n                /**\n                 * Creates a new ControlChange instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IControlChange=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.ControlChange} ControlChange instance\n                 */\n                ControlChange.create = function create(properties) {\n                    return new ControlChange(properties);\n                };\n\n                /**\n                 * Encodes the specified ControlChange message. Does not implicitly {@link tensorflow.magenta.NoteSequence.ControlChange.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IControlChange} message ControlChange message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                ControlChange.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.controlNumber != null && message.hasOwnProperty(\"controlNumber\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.controlNumber);\n                    if (message.controlValue != null && message.hasOwnProperty(\"controlValue\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.controlValue);\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        writer.uint32(/* id 4, wireType 0 =*/32).int32(message.instrument);\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        writer.uint32(/* id 5, wireType 0 =*/40).int32(message.program);\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        writer.uint32(/* id 6, wireType 0 =*/48).bool(message.isDrum);\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        writer.uint32(/* id 7, wireType 0 =*/56).int64(message.quantizedStep);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified ControlChange message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.ControlChange.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IControlChange} message ControlChange message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                ControlChange.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a ControlChange message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.ControlChange} ControlChange\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                ControlChange.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.ControlChange();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 7:\n                            message.quantizedStep = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        case 2:\n                            message.controlNumber = reader.int32();\n                            break;\n                        case 3:\n                            message.controlValue = reader.int32();\n                            break;\n                        case 4:\n                            message.instrument = reader.int32();\n                            break;\n                        case 5:\n                            message.program = reader.int32();\n                            break;\n                        case 6:\n                            message.isDrum = reader.bool();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a ControlChange message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.ControlChange} ControlChange\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                ControlChange.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a ControlChange message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                ControlChange.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        if (!$util.isInteger(message.quantizedStep) && !(message.quantizedStep && $util.isInteger(message.quantizedStep.low) && $util.isInteger(message.quantizedStep.high)))\n                            return \"quantizedStep: integer|Long expected\";\n                    if (message.controlNumber != null && message.hasOwnProperty(\"controlNumber\"))\n                        if (!$util.isInteger(message.controlNumber))\n                            return \"controlNumber: integer expected\";\n                    if (message.controlValue != null && message.hasOwnProperty(\"controlValue\"))\n                        if (!$util.isInteger(message.controlValue))\n                            return \"controlValue: integer expected\";\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        if (!$util.isInteger(message.instrument))\n                            return \"instrument: integer expected\";\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        if (!$util.isInteger(message.program))\n                            return \"program: integer expected\";\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        if (typeof message.isDrum !== \"boolean\")\n                            return \"isDrum: boolean expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a ControlChange message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.ControlChange} ControlChange\n                 */\n                ControlChange.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.ControlChange)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.ControlChange();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.quantizedStep != null)\n                        if ($util.Long)\n                            (message.quantizedStep = $util.Long.fromValue(object.quantizedStep)).unsigned = false;\n                        else if (typeof object.quantizedStep === \"string\")\n                            message.quantizedStep = parseInt(object.quantizedStep, 10);\n                        else if (typeof object.quantizedStep === \"number\")\n                            message.quantizedStep = object.quantizedStep;\n                        else if (typeof object.quantizedStep === \"object\")\n                            message.quantizedStep = new $util.LongBits(object.quantizedStep.low >>> 0, object.quantizedStep.high >>> 0).toNumber();\n                    if (object.controlNumber != null)\n                        message.controlNumber = object.controlNumber | 0;\n                    if (object.controlValue != null)\n                        message.controlValue = object.controlValue | 0;\n                    if (object.instrument != null)\n                        message.instrument = object.instrument | 0;\n                    if (object.program != null)\n                        message.program = object.program | 0;\n                    if (object.isDrum != null)\n                        message.isDrum = Boolean(object.isDrum);\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a ControlChange message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ControlChange} message ControlChange\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                ControlChange.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.controlNumber = 0;\n                        object.controlValue = 0;\n                        object.instrument = 0;\n                        object.program = 0;\n                        object.isDrum = false;\n                        if ($util.Long) {\n                            var long = new $util.Long(0, 0, false);\n                            object.quantizedStep = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                        } else\n                            object.quantizedStep = options.longs === String ? \"0\" : 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.controlNumber != null && message.hasOwnProperty(\"controlNumber\"))\n                        object.controlNumber = message.controlNumber;\n                    if (message.controlValue != null && message.hasOwnProperty(\"controlValue\"))\n                        object.controlValue = message.controlValue;\n                    if (message.instrument != null && message.hasOwnProperty(\"instrument\"))\n                        object.instrument = message.instrument;\n                    if (message.program != null && message.hasOwnProperty(\"program\"))\n                        object.program = message.program;\n                    if (message.isDrum != null && message.hasOwnProperty(\"isDrum\"))\n                        object.isDrum = message.isDrum;\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        if (typeof message.quantizedStep === \"number\")\n                            object.quantizedStep = options.longs === String ? String(message.quantizedStep) : message.quantizedStep;\n                        else\n                            object.quantizedStep = options.longs === String ? $util.Long.prototype.toString.call(message.quantizedStep) : options.longs === Number ? new $util.LongBits(message.quantizedStep.low >>> 0, message.quantizedStep.high >>> 0).toNumber() : message.quantizedStep;\n                    return object;\n                };\n\n                /**\n                 * Converts this ControlChange to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.ControlChange\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                ControlChange.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return ControlChange;\n            })();\n\n            NoteSequence.PartInfo = (function() {\n\n                /**\n                 * Properties of a PartInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface IPartInfo\n                 * @property {number|null} [part] PartInfo part\n                 * @property {string|null} [name] PartInfo name\n                 */\n\n                /**\n                 * Constructs a new PartInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a PartInfo.\n                 * @implements IPartInfo\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.IPartInfo=} [properties] Properties to set\n                 */\n                function PartInfo(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * PartInfo part.\n                 * @member {number} part\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @instance\n                 */\n                PartInfo.prototype.part = 0;\n\n                /**\n                 * PartInfo name.\n                 * @member {string} name\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @instance\n                 */\n                PartInfo.prototype.name = \"\";\n\n                /**\n                 * Creates a new PartInfo instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPartInfo=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.PartInfo} PartInfo instance\n                 */\n                PartInfo.create = function create(properties) {\n                    return new PartInfo(properties);\n                };\n\n                /**\n                 * Encodes the specified PartInfo message. Does not implicitly {@link tensorflow.magenta.NoteSequence.PartInfo.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPartInfo} message PartInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                PartInfo.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        writer.uint32(/* id 1, wireType 0 =*/8).int32(message.part);\n                    if (message.name != null && message.hasOwnProperty(\"name\"))\n                        writer.uint32(/* id 2, wireType 2 =*/18).string(message.name);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified PartInfo message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.PartInfo.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IPartInfo} message PartInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                PartInfo.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a PartInfo message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.PartInfo} PartInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                PartInfo.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.PartInfo();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.part = reader.int32();\n                            break;\n                        case 2:\n                            message.name = reader.string();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a PartInfo message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.PartInfo} PartInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                PartInfo.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a PartInfo message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                PartInfo.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        if (!$util.isInteger(message.part))\n                            return \"part: integer expected\";\n                    if (message.name != null && message.hasOwnProperty(\"name\"))\n                        if (!$util.isString(message.name))\n                            return \"name: string expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a PartInfo message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.PartInfo} PartInfo\n                 */\n                PartInfo.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.PartInfo)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.PartInfo();\n                    if (object.part != null)\n                        message.part = object.part | 0;\n                    if (object.name != null)\n                        message.name = String(object.name);\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a PartInfo message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.PartInfo} message PartInfo\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                PartInfo.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.part = 0;\n                        object.name = \"\";\n                    }\n                    if (message.part != null && message.hasOwnProperty(\"part\"))\n                        object.part = message.part;\n                    if (message.name != null && message.hasOwnProperty(\"name\"))\n                        object.name = message.name;\n                    return object;\n                };\n\n                /**\n                 * Converts this PartInfo to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.PartInfo\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                PartInfo.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return PartInfo;\n            })();\n\n            NoteSequence.SourceInfo = (function() {\n\n                /**\n                 * Properties of a SourceInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ISourceInfo\n                 * @property {tensorflow.magenta.NoteSequence.SourceInfo.SourceType|null} [sourceType] SourceInfo sourceType\n                 * @property {tensorflow.magenta.NoteSequence.SourceInfo.EncodingType|null} [encodingType] SourceInfo encodingType\n                 * @property {tensorflow.magenta.NoteSequence.SourceInfo.Parser|null} [parser] SourceInfo parser\n                 */\n\n                /**\n                 * Constructs a new SourceInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a SourceInfo.\n                 * @implements ISourceInfo\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ISourceInfo=} [properties] Properties to set\n                 */\n                function SourceInfo(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * SourceInfo sourceType.\n                 * @member {tensorflow.magenta.NoteSequence.SourceInfo.SourceType} sourceType\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @instance\n                 */\n                SourceInfo.prototype.sourceType = 0;\n\n                /**\n                 * SourceInfo encodingType.\n                 * @member {tensorflow.magenta.NoteSequence.SourceInfo.EncodingType} encodingType\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @instance\n                 */\n                SourceInfo.prototype.encodingType = 0;\n\n                /**\n                 * SourceInfo parser.\n                 * @member {tensorflow.magenta.NoteSequence.SourceInfo.Parser} parser\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @instance\n                 */\n                SourceInfo.prototype.parser = 0;\n\n                /**\n                 * Creates a new SourceInfo instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISourceInfo=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.SourceInfo} SourceInfo instance\n                 */\n                SourceInfo.create = function create(properties) {\n                    return new SourceInfo(properties);\n                };\n\n                /**\n                 * Encodes the specified SourceInfo message. Does not implicitly {@link tensorflow.magenta.NoteSequence.SourceInfo.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISourceInfo} message SourceInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SourceInfo.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.sourceType != null && message.hasOwnProperty(\"sourceType\"))\n                        writer.uint32(/* id 1, wireType 0 =*/8).int32(message.sourceType);\n                    if (message.encodingType != null && message.hasOwnProperty(\"encodingType\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.encodingType);\n                    if (message.parser != null && message.hasOwnProperty(\"parser\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.parser);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified SourceInfo message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.SourceInfo.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISourceInfo} message SourceInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SourceInfo.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a SourceInfo message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.SourceInfo} SourceInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SourceInfo.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.SourceInfo();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.sourceType = reader.int32();\n                            break;\n                        case 2:\n                            message.encodingType = reader.int32();\n                            break;\n                        case 3:\n                            message.parser = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a SourceInfo message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.SourceInfo} SourceInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SourceInfo.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a SourceInfo message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                SourceInfo.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.sourceType != null && message.hasOwnProperty(\"sourceType\"))\n                        switch (message.sourceType) {\n                        default:\n                            return \"sourceType: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                            break;\n                        }\n                    if (message.encodingType != null && message.hasOwnProperty(\"encodingType\"))\n                        switch (message.encodingType) {\n                        default:\n                            return \"encodingType: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                        case 3:\n                        case 4:\n                            break;\n                        }\n                    if (message.parser != null && message.hasOwnProperty(\"parser\"))\n                        switch (message.parser) {\n                        default:\n                            return \"parser: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                        case 3:\n                        case 4:\n                        case 5:\n                        case 6:\n                            break;\n                        }\n                    return null;\n                };\n\n                /**\n                 * Creates a SourceInfo message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.SourceInfo} SourceInfo\n                 */\n                SourceInfo.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.SourceInfo)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.SourceInfo();\n                    switch (object.sourceType) {\n                    case \"UNKNOWN_SOURCE_TYPE\":\n                    case 0:\n                        message.sourceType = 0;\n                        break;\n                    case \"SCORE_BASED\":\n                    case 1:\n                        message.sourceType = 1;\n                        break;\n                    case \"PERFORMANCE_BASED\":\n                    case 2:\n                        message.sourceType = 2;\n                        break;\n                    }\n                    switch (object.encodingType) {\n                    case \"UNKNOWN_ENCODING_TYPE\":\n                    case 0:\n                        message.encodingType = 0;\n                        break;\n                    case \"MUSIC_XML\":\n                    case 1:\n                        message.encodingType = 1;\n                        break;\n                    case \"ABC\":\n                    case 2:\n                        message.encodingType = 2;\n                        break;\n                    case \"MIDI\":\n                    case 3:\n                        message.encodingType = 3;\n                        break;\n                    case \"MUSICNET\":\n                    case 4:\n                        message.encodingType = 4;\n                        break;\n                    }\n                    switch (object.parser) {\n                    case \"UNKNOWN_PARSER\":\n                    case 0:\n                        message.parser = 0;\n                        break;\n                    case \"MUSIC21\":\n                    case 1:\n                        message.parser = 1;\n                        break;\n                    case \"PRETTY_MIDI\":\n                    case 2:\n                        message.parser = 2;\n                        break;\n                    case \"MAGENTA_MUSIC_XML\":\n                    case 3:\n                        message.parser = 3;\n                        break;\n                    case \"MAGENTA_MUSICNET\":\n                    case 4:\n                        message.parser = 4;\n                        break;\n                    case \"MAGENTA_ABC\":\n                    case 5:\n                        message.parser = 5;\n                        break;\n                    case \"TONEJS_MIDI_CONVERT\":\n                    case 6:\n                        message.parser = 6;\n                        break;\n                    }\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a SourceInfo message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.SourceInfo} message SourceInfo\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                SourceInfo.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.sourceType = options.enums === String ? \"UNKNOWN_SOURCE_TYPE\" : 0;\n                        object.encodingType = options.enums === String ? \"UNKNOWN_ENCODING_TYPE\" : 0;\n                        object.parser = options.enums === String ? \"UNKNOWN_PARSER\" : 0;\n                    }\n                    if (message.sourceType != null && message.hasOwnProperty(\"sourceType\"))\n                        object.sourceType = options.enums === String ? $root.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[message.sourceType] : message.sourceType;\n                    if (message.encodingType != null && message.hasOwnProperty(\"encodingType\"))\n                        object.encodingType = options.enums === String ? $root.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[message.encodingType] : message.encodingType;\n                    if (message.parser != null && message.hasOwnProperty(\"parser\"))\n                        object.parser = options.enums === String ? $root.tensorflow.magenta.NoteSequence.SourceInfo.Parser[message.parser] : message.parser;\n                    return object;\n                };\n\n                /**\n                 * Converts this SourceInfo to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.SourceInfo\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                SourceInfo.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                /**\n                 * SourceType enum.\n                 * @name tensorflow.magenta.NoteSequence.SourceInfo.SourceType\n                 * @enum {string}\n                 * @property {number} UNKNOWN_SOURCE_TYPE=0 UNKNOWN_SOURCE_TYPE value\n                 * @property {number} SCORE_BASED=1 SCORE_BASED value\n                 * @property {number} PERFORMANCE_BASED=2 PERFORMANCE_BASED value\n                 */\n                SourceInfo.SourceType = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"UNKNOWN_SOURCE_TYPE\"] = 0;\n                    values[valuesById[1] = \"SCORE_BASED\"] = 1;\n                    values[valuesById[2] = \"PERFORMANCE_BASED\"] = 2;\n                    return values;\n                })();\n\n                /**\n                 * EncodingType enum.\n                 * @name tensorflow.magenta.NoteSequence.SourceInfo.EncodingType\n                 * @enum {string}\n                 * @property {number} UNKNOWN_ENCODING_TYPE=0 UNKNOWN_ENCODING_TYPE value\n                 * @property {number} MUSIC_XML=1 MUSIC_XML value\n                 * @property {number} ABC=2 ABC value\n                 * @property {number} MIDI=3 MIDI value\n                 * @property {number} MUSICNET=4 MUSICNET value\n                 */\n                SourceInfo.EncodingType = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"UNKNOWN_ENCODING_TYPE\"] = 0;\n                    values[valuesById[1] = \"MUSIC_XML\"] = 1;\n                    values[valuesById[2] = \"ABC\"] = 2;\n                    values[valuesById[3] = \"MIDI\"] = 3;\n                    values[valuesById[4] = \"MUSICNET\"] = 4;\n                    return values;\n                })();\n\n                /**\n                 * Parser enum.\n                 * @name tensorflow.magenta.NoteSequence.SourceInfo.Parser\n                 * @enum {string}\n                 * @property {number} UNKNOWN_PARSER=0 UNKNOWN_PARSER value\n                 * @property {number} MUSIC21=1 MUSIC21 value\n                 * @property {number} PRETTY_MIDI=2 PRETTY_MIDI value\n                 * @property {number} MAGENTA_MUSIC_XML=3 MAGENTA_MUSIC_XML value\n                 * @property {number} MAGENTA_MUSICNET=4 MAGENTA_MUSICNET value\n                 * @property {number} MAGENTA_ABC=5 MAGENTA_ABC value\n                 * @property {number} TONEJS_MIDI_CONVERT=6 TONEJS_MIDI_CONVERT value\n                 */\n                SourceInfo.Parser = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"UNKNOWN_PARSER\"] = 0;\n                    values[valuesById[1] = \"MUSIC21\"] = 1;\n                    values[valuesById[2] = \"PRETTY_MIDI\"] = 2;\n                    values[valuesById[3] = \"MAGENTA_MUSIC_XML\"] = 3;\n                    values[valuesById[4] = \"MAGENTA_MUSICNET\"] = 4;\n                    values[valuesById[5] = \"MAGENTA_ABC\"] = 5;\n                    values[valuesById[6] = \"TONEJS_MIDI_CONVERT\"] = 6;\n                    return values;\n                })();\n\n                return SourceInfo;\n            })();\n\n            NoteSequence.TextAnnotation = (function() {\n\n                /**\n                 * Properties of a TextAnnotation.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ITextAnnotation\n                 * @property {number|null} [time] TextAnnotation time\n                 * @property {number|null} [quantizedStep] TextAnnotation quantizedStep\n                 * @property {string|null} [text] TextAnnotation text\n                 * @property {tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType|null} [annotationType] TextAnnotation annotationType\n                 */\n\n                /**\n                 * Constructs a new TextAnnotation.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a TextAnnotation.\n                 * @implements ITextAnnotation\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ITextAnnotation=} [properties] Properties to set\n                 */\n                function TextAnnotation(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * TextAnnotation time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @instance\n                 */\n                TextAnnotation.prototype.time = 0;\n\n                /**\n                 * TextAnnotation quantizedStep.\n                 * @member {number} quantizedStep\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @instance\n                 */\n                TextAnnotation.prototype.quantizedStep = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * TextAnnotation text.\n                 * @member {string} text\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @instance\n                 */\n                TextAnnotation.prototype.text = \"\";\n\n                /**\n                 * TextAnnotation annotationType.\n                 * @member {tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType} annotationType\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @instance\n                 */\n                TextAnnotation.prototype.annotationType = 0;\n\n                /**\n                 * Creates a new TextAnnotation instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITextAnnotation=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.TextAnnotation} TextAnnotation instance\n                 */\n                TextAnnotation.create = function create(properties) {\n                    return new TextAnnotation(properties);\n                };\n\n                /**\n                 * Encodes the specified TextAnnotation message. Does not implicitly {@link tensorflow.magenta.NoteSequence.TextAnnotation.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITextAnnotation} message TextAnnotation message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                TextAnnotation.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.text != null && message.hasOwnProperty(\"text\"))\n                        writer.uint32(/* id 2, wireType 2 =*/18).string(message.text);\n                    if (message.annotationType != null && message.hasOwnProperty(\"annotationType\"))\n                        writer.uint32(/* id 3, wireType 0 =*/24).int32(message.annotationType);\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        writer.uint32(/* id 4, wireType 0 =*/32).int64(message.quantizedStep);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified TextAnnotation message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.TextAnnotation.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ITextAnnotation} message TextAnnotation message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                TextAnnotation.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a TextAnnotation message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.TextAnnotation} TextAnnotation\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                TextAnnotation.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.TextAnnotation();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 4:\n                            message.quantizedStep = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        case 2:\n                            message.text = reader.string();\n                            break;\n                        case 3:\n                            message.annotationType = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a TextAnnotation message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.TextAnnotation} TextAnnotation\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                TextAnnotation.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a TextAnnotation message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                TextAnnotation.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        if (!$util.isInteger(message.quantizedStep) && !(message.quantizedStep && $util.isInteger(message.quantizedStep.low) && $util.isInteger(message.quantizedStep.high)))\n                            return \"quantizedStep: integer|Long expected\";\n                    if (message.text != null && message.hasOwnProperty(\"text\"))\n                        if (!$util.isString(message.text))\n                            return \"text: string expected\";\n                    if (message.annotationType != null && message.hasOwnProperty(\"annotationType\"))\n                        switch (message.annotationType) {\n                        default:\n                            return \"annotationType: enum value expected\";\n                        case 0:\n                        case 1:\n                        case 2:\n                            break;\n                        }\n                    return null;\n                };\n\n                /**\n                 * Creates a TextAnnotation message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.TextAnnotation} TextAnnotation\n                 */\n                TextAnnotation.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.TextAnnotation)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.TextAnnotation();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.quantizedStep != null)\n                        if ($util.Long)\n                            (message.quantizedStep = $util.Long.fromValue(object.quantizedStep)).unsigned = false;\n                        else if (typeof object.quantizedStep === \"string\")\n                            message.quantizedStep = parseInt(object.quantizedStep, 10);\n                        else if (typeof object.quantizedStep === \"number\")\n                            message.quantizedStep = object.quantizedStep;\n                        else if (typeof object.quantizedStep === \"object\")\n                            message.quantizedStep = new $util.LongBits(object.quantizedStep.low >>> 0, object.quantizedStep.high >>> 0).toNumber();\n                    if (object.text != null)\n                        message.text = String(object.text);\n                    switch (object.annotationType) {\n                    case \"UNKNOWN\":\n                    case 0:\n                        message.annotationType = 0;\n                        break;\n                    case \"CHORD_SYMBOL\":\n                    case 1:\n                        message.annotationType = 1;\n                        break;\n                    case \"BEAT\":\n                    case 2:\n                        message.annotationType = 2;\n                        break;\n                    }\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a TextAnnotation message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.TextAnnotation} message TextAnnotation\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                TextAnnotation.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        object.text = \"\";\n                        object.annotationType = options.enums === String ? \"UNKNOWN\" : 0;\n                        if ($util.Long) {\n                            var long = new $util.Long(0, 0, false);\n                            object.quantizedStep = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                        } else\n                            object.quantizedStep = options.longs === String ? \"0\" : 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.text != null && message.hasOwnProperty(\"text\"))\n                        object.text = message.text;\n                    if (message.annotationType != null && message.hasOwnProperty(\"annotationType\"))\n                        object.annotationType = options.enums === String ? $root.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[message.annotationType] : message.annotationType;\n                    if (message.quantizedStep != null && message.hasOwnProperty(\"quantizedStep\"))\n                        if (typeof message.quantizedStep === \"number\")\n                            object.quantizedStep = options.longs === String ? String(message.quantizedStep) : message.quantizedStep;\n                        else\n                            object.quantizedStep = options.longs === String ? $util.Long.prototype.toString.call(message.quantizedStep) : options.longs === Number ? new $util.LongBits(message.quantizedStep.low >>> 0, message.quantizedStep.high >>> 0).toNumber() : message.quantizedStep;\n                    return object;\n                };\n\n                /**\n                 * Converts this TextAnnotation to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.TextAnnotation\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                TextAnnotation.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                /**\n                 * TextAnnotationType enum.\n                 * @name tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType\n                 * @enum {string}\n                 * @property {number} UNKNOWN=0 UNKNOWN value\n                 * @property {number} CHORD_SYMBOL=1 CHORD_SYMBOL value\n                 * @property {number} BEAT=2 BEAT value\n                 */\n                TextAnnotation.TextAnnotationType = (function() {\n                    var valuesById = {}, values = Object.create(valuesById);\n                    values[valuesById[0] = \"UNKNOWN\"] = 0;\n                    values[valuesById[1] = \"CHORD_SYMBOL\"] = 1;\n                    values[valuesById[2] = \"BEAT\"] = 2;\n                    return values;\n                })();\n\n                return TextAnnotation;\n            })();\n\n            NoteSequence.QuantizationInfo = (function() {\n\n                /**\n                 * Properties of a QuantizationInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface IQuantizationInfo\n                 * @property {number|null} [stepsPerQuarter] QuantizationInfo stepsPerQuarter\n                 * @property {number|null} [stepsPerSecond] QuantizationInfo stepsPerSecond\n                 */\n\n                /**\n                 * Constructs a new QuantizationInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a QuantizationInfo.\n                 * @implements IQuantizationInfo\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.IQuantizationInfo=} [properties] Properties to set\n                 */\n                function QuantizationInfo(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * QuantizationInfo stepsPerQuarter.\n                 * @member {number} stepsPerQuarter\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @instance\n                 */\n                QuantizationInfo.prototype.stepsPerQuarter = 0;\n\n                /**\n                 * QuantizationInfo stepsPerSecond.\n                 * @member {number} stepsPerSecond\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @instance\n                 */\n                QuantizationInfo.prototype.stepsPerSecond = 0;\n\n                // OneOf field names bound to virtual getters and setters\n                var $oneOfFields;\n\n                /**\n                 * QuantizationInfo resolution.\n                 * @member {\"stepsPerQuarter\"|\"stepsPerSecond\"|undefined} resolution\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @instance\n                 */\n                Object.defineProperty(QuantizationInfo.prototype, \"resolution\", {\n                    get: $util.oneOfGetter($oneOfFields = [\"stepsPerQuarter\", \"stepsPerSecond\"]),\n                    set: $util.oneOfSetter($oneOfFields)\n                });\n\n                /**\n                 * Creates a new QuantizationInfo instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IQuantizationInfo=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.QuantizationInfo} QuantizationInfo instance\n                 */\n                QuantizationInfo.create = function create(properties) {\n                    return new QuantizationInfo(properties);\n                };\n\n                /**\n                 * Encodes the specified QuantizationInfo message. Does not implicitly {@link tensorflow.magenta.NoteSequence.QuantizationInfo.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IQuantizationInfo} message QuantizationInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                QuantizationInfo.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.stepsPerQuarter != null && message.hasOwnProperty(\"stepsPerQuarter\"))\n                        writer.uint32(/* id 1, wireType 0 =*/8).int32(message.stepsPerQuarter);\n                    if (message.stepsPerSecond != null && message.hasOwnProperty(\"stepsPerSecond\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.stepsPerSecond);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified QuantizationInfo message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.QuantizationInfo.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.IQuantizationInfo} message QuantizationInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                QuantizationInfo.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a QuantizationInfo message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.QuantizationInfo} QuantizationInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                QuantizationInfo.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.QuantizationInfo();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.stepsPerQuarter = reader.int32();\n                            break;\n                        case 2:\n                            message.stepsPerSecond = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a QuantizationInfo message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.QuantizationInfo} QuantizationInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                QuantizationInfo.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a QuantizationInfo message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                QuantizationInfo.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    var properties = {};\n                    if (message.stepsPerQuarter != null && message.hasOwnProperty(\"stepsPerQuarter\")) {\n                        properties.resolution = 1;\n                        if (!$util.isInteger(message.stepsPerQuarter))\n                            return \"stepsPerQuarter: integer expected\";\n                    }\n                    if (message.stepsPerSecond != null && message.hasOwnProperty(\"stepsPerSecond\")) {\n                        if (properties.resolution === 1)\n                            return \"resolution: multiple values\";\n                        properties.resolution = 1;\n                        if (!$util.isInteger(message.stepsPerSecond))\n                            return \"stepsPerSecond: integer expected\";\n                    }\n                    return null;\n                };\n\n                /**\n                 * Creates a QuantizationInfo message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.QuantizationInfo} QuantizationInfo\n                 */\n                QuantizationInfo.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.QuantizationInfo)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.QuantizationInfo();\n                    if (object.stepsPerQuarter != null)\n                        message.stepsPerQuarter = object.stepsPerQuarter | 0;\n                    if (object.stepsPerSecond != null)\n                        message.stepsPerSecond = object.stepsPerSecond | 0;\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a QuantizationInfo message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.QuantizationInfo} message QuantizationInfo\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                QuantizationInfo.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (message.stepsPerQuarter != null && message.hasOwnProperty(\"stepsPerQuarter\")) {\n                        object.stepsPerQuarter = message.stepsPerQuarter;\n                        if (options.oneofs)\n                            object.resolution = \"stepsPerQuarter\";\n                    }\n                    if (message.stepsPerSecond != null && message.hasOwnProperty(\"stepsPerSecond\")) {\n                        object.stepsPerSecond = message.stepsPerSecond;\n                        if (options.oneofs)\n                            object.resolution = \"stepsPerSecond\";\n                    }\n                    return object;\n                };\n\n                /**\n                 * Converts this QuantizationInfo to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.QuantizationInfo\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                QuantizationInfo.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return QuantizationInfo;\n            })();\n\n            NoteSequence.SubsequenceInfo = (function() {\n\n                /**\n                 * Properties of a SubsequenceInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ISubsequenceInfo\n                 * @property {number|null} [startTimeOffset] SubsequenceInfo startTimeOffset\n                 * @property {number|null} [endTimeOffset] SubsequenceInfo endTimeOffset\n                 */\n\n                /**\n                 * Constructs a new SubsequenceInfo.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a SubsequenceInfo.\n                 * @implements ISubsequenceInfo\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ISubsequenceInfo=} [properties] Properties to set\n                 */\n                function SubsequenceInfo(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * SubsequenceInfo startTimeOffset.\n                 * @member {number} startTimeOffset\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @instance\n                 */\n                SubsequenceInfo.prototype.startTimeOffset = 0;\n\n                /**\n                 * SubsequenceInfo endTimeOffset.\n                 * @member {number} endTimeOffset\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @instance\n                 */\n                SubsequenceInfo.prototype.endTimeOffset = 0;\n\n                /**\n                 * Creates a new SubsequenceInfo instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISubsequenceInfo=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.SubsequenceInfo} SubsequenceInfo instance\n                 */\n                SubsequenceInfo.create = function create(properties) {\n                    return new SubsequenceInfo(properties);\n                };\n\n                /**\n                 * Encodes the specified SubsequenceInfo message. Does not implicitly {@link tensorflow.magenta.NoteSequence.SubsequenceInfo.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISubsequenceInfo} message SubsequenceInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SubsequenceInfo.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.startTimeOffset != null && message.hasOwnProperty(\"startTimeOffset\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.startTimeOffset);\n                    if (message.endTimeOffset != null && message.hasOwnProperty(\"endTimeOffset\"))\n                        writer.uint32(/* id 2, wireType 1 =*/17).double(message.endTimeOffset);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified SubsequenceInfo message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.SubsequenceInfo.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISubsequenceInfo} message SubsequenceInfo message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SubsequenceInfo.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a SubsequenceInfo message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.SubsequenceInfo} SubsequenceInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SubsequenceInfo.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.SubsequenceInfo();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.startTimeOffset = reader.double();\n                            break;\n                        case 2:\n                            message.endTimeOffset = reader.double();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a SubsequenceInfo message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.SubsequenceInfo} SubsequenceInfo\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SubsequenceInfo.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a SubsequenceInfo message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                SubsequenceInfo.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.startTimeOffset != null && message.hasOwnProperty(\"startTimeOffset\"))\n                        if (typeof message.startTimeOffset !== \"number\")\n                            return \"startTimeOffset: number expected\";\n                    if (message.endTimeOffset != null && message.hasOwnProperty(\"endTimeOffset\"))\n                        if (typeof message.endTimeOffset !== \"number\")\n                            return \"endTimeOffset: number expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a SubsequenceInfo message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.SubsequenceInfo} SubsequenceInfo\n                 */\n                SubsequenceInfo.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.SubsequenceInfo)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.SubsequenceInfo();\n                    if (object.startTimeOffset != null)\n                        message.startTimeOffset = Number(object.startTimeOffset);\n                    if (object.endTimeOffset != null)\n                        message.endTimeOffset = Number(object.endTimeOffset);\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a SubsequenceInfo message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.SubsequenceInfo} message SubsequenceInfo\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                SubsequenceInfo.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.startTimeOffset = 0;\n                        object.endTimeOffset = 0;\n                    }\n                    if (message.startTimeOffset != null && message.hasOwnProperty(\"startTimeOffset\"))\n                        object.startTimeOffset = options.json && !isFinite(message.startTimeOffset) ? String(message.startTimeOffset) : message.startTimeOffset;\n                    if (message.endTimeOffset != null && message.hasOwnProperty(\"endTimeOffset\"))\n                        object.endTimeOffset = options.json && !isFinite(message.endTimeOffset) ? String(message.endTimeOffset) : message.endTimeOffset;\n                    return object;\n                };\n\n                /**\n                 * Converts this SubsequenceInfo to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.SubsequenceInfo\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                SubsequenceInfo.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return SubsequenceInfo;\n            })();\n\n            NoteSequence.SectionAnnotation = (function() {\n\n                /**\n                 * Properties of a SectionAnnotation.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ISectionAnnotation\n                 * @property {number|null} [time] SectionAnnotation time\n                 * @property {number|null} [sectionId] SectionAnnotation sectionId\n                 */\n\n                /**\n                 * Constructs a new SectionAnnotation.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a SectionAnnotation.\n                 * @implements ISectionAnnotation\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ISectionAnnotation=} [properties] Properties to set\n                 */\n                function SectionAnnotation(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * SectionAnnotation time.\n                 * @member {number} time\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @instance\n                 */\n                SectionAnnotation.prototype.time = 0;\n\n                /**\n                 * SectionAnnotation sectionId.\n                 * @member {number} sectionId\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @instance\n                 */\n                SectionAnnotation.prototype.sectionId = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * Creates a new SectionAnnotation instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionAnnotation=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.SectionAnnotation} SectionAnnotation instance\n                 */\n                SectionAnnotation.create = function create(properties) {\n                    return new SectionAnnotation(properties);\n                };\n\n                /**\n                 * Encodes the specified SectionAnnotation message. Does not implicitly {@link tensorflow.magenta.NoteSequence.SectionAnnotation.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionAnnotation} message SectionAnnotation message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SectionAnnotation.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        writer.uint32(/* id 1, wireType 1 =*/9).double(message.time);\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\"))\n                        writer.uint32(/* id 4, wireType 0 =*/32).int64(message.sectionId);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified SectionAnnotation message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.SectionAnnotation.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionAnnotation} message SectionAnnotation message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SectionAnnotation.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a SectionAnnotation message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.SectionAnnotation} SectionAnnotation\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SectionAnnotation.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.SectionAnnotation();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.time = reader.double();\n                            break;\n                        case 4:\n                            message.sectionId = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a SectionAnnotation message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.SectionAnnotation} SectionAnnotation\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SectionAnnotation.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a SectionAnnotation message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                SectionAnnotation.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        if (typeof message.time !== \"number\")\n                            return \"time: number expected\";\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\"))\n                        if (!$util.isInteger(message.sectionId) && !(message.sectionId && $util.isInteger(message.sectionId.low) && $util.isInteger(message.sectionId.high)))\n                            return \"sectionId: integer|Long expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a SectionAnnotation message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.SectionAnnotation} SectionAnnotation\n                 */\n                SectionAnnotation.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.SectionAnnotation)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.SectionAnnotation();\n                    if (object.time != null)\n                        message.time = Number(object.time);\n                    if (object.sectionId != null)\n                        if ($util.Long)\n                            (message.sectionId = $util.Long.fromValue(object.sectionId)).unsigned = false;\n                        else if (typeof object.sectionId === \"string\")\n                            message.sectionId = parseInt(object.sectionId, 10);\n                        else if (typeof object.sectionId === \"number\")\n                            message.sectionId = object.sectionId;\n                        else if (typeof object.sectionId === \"object\")\n                            message.sectionId = new $util.LongBits(object.sectionId.low >>> 0, object.sectionId.high >>> 0).toNumber();\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a SectionAnnotation message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.SectionAnnotation} message SectionAnnotation\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                SectionAnnotation.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.defaults) {\n                        object.time = 0;\n                        if ($util.Long) {\n                            var long = new $util.Long(0, 0, false);\n                            object.sectionId = options.longs === String ? long.toString() : options.longs === Number ? long.toNumber() : long;\n                        } else\n                            object.sectionId = options.longs === String ? \"0\" : 0;\n                    }\n                    if (message.time != null && message.hasOwnProperty(\"time\"))\n                        object.time = options.json && !isFinite(message.time) ? String(message.time) : message.time;\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\"))\n                        if (typeof message.sectionId === \"number\")\n                            object.sectionId = options.longs === String ? String(message.sectionId) : message.sectionId;\n                        else\n                            object.sectionId = options.longs === String ? $util.Long.prototype.toString.call(message.sectionId) : options.longs === Number ? new $util.LongBits(message.sectionId.low >>> 0, message.sectionId.high >>> 0).toNumber() : message.sectionId;\n                    return object;\n                };\n\n                /**\n                 * Converts this SectionAnnotation to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.SectionAnnotation\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                SectionAnnotation.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return SectionAnnotation;\n            })();\n\n            NoteSequence.Section = (function() {\n\n                /**\n                 * Properties of a Section.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ISection\n                 * @property {number|null} [sectionId] Section sectionId\n                 * @property {tensorflow.magenta.NoteSequence.ISectionGroup|null} [sectionGroup] Section sectionGroup\n                 */\n\n                /**\n                 * Constructs a new Section.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a Section.\n                 * @implements ISection\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ISection=} [properties] Properties to set\n                 */\n                function Section(properties) {\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * Section sectionId.\n                 * @member {number} sectionId\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @instance\n                 */\n                Section.prototype.sectionId = $util.Long ? $util.Long.fromBits(0,0,false) : 0;\n\n                /**\n                 * Section sectionGroup.\n                 * @member {tensorflow.magenta.NoteSequence.ISectionGroup|null|undefined} sectionGroup\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @instance\n                 */\n                Section.prototype.sectionGroup = null;\n\n                // OneOf field names bound to virtual getters and setters\n                var $oneOfFields;\n\n                /**\n                 * Section sectionType.\n                 * @member {\"sectionId\"|\"sectionGroup\"|undefined} sectionType\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @instance\n                 */\n                Object.defineProperty(Section.prototype, \"sectionType\", {\n                    get: $util.oneOfGetter($oneOfFields = [\"sectionId\", \"sectionGroup\"]),\n                    set: $util.oneOfSetter($oneOfFields)\n                });\n\n                /**\n                 * Creates a new Section instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISection=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.Section} Section instance\n                 */\n                Section.create = function create(properties) {\n                    return new Section(properties);\n                };\n\n                /**\n                 * Encodes the specified Section message. Does not implicitly {@link tensorflow.magenta.NoteSequence.Section.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISection} message Section message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Section.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\"))\n                        writer.uint32(/* id 1, wireType 0 =*/8).int64(message.sectionId);\n                    if (message.sectionGroup != null && message.hasOwnProperty(\"sectionGroup\"))\n                        $root.tensorflow.magenta.NoteSequence.SectionGroup.encode(message.sectionGroup, writer.uint32(/* id 2, wireType 2 =*/18).fork()).ldelim();\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified Section message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.Section.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISection} message Section message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                Section.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a Section message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.Section} Section\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Section.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.Section();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            message.sectionId = $util.Long?reader.int64().toNumber():reader.int64();\n                            break;\n                        case 2:\n                            message.sectionGroup = $root.tensorflow.magenta.NoteSequence.SectionGroup.decode(reader, reader.uint32());\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a Section message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.Section} Section\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                Section.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a Section message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                Section.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    var properties = {};\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\")) {\n                        properties.sectionType = 1;\n                        if (!$util.isInteger(message.sectionId) && !(message.sectionId && $util.isInteger(message.sectionId.low) && $util.isInteger(message.sectionId.high)))\n                            return \"sectionId: integer|Long expected\";\n                    }\n                    if (message.sectionGroup != null && message.hasOwnProperty(\"sectionGroup\")) {\n                        if (properties.sectionType === 1)\n                            return \"sectionType: multiple values\";\n                        properties.sectionType = 1;\n                        {\n                            var error = $root.tensorflow.magenta.NoteSequence.SectionGroup.verify(message.sectionGroup);\n                            if (error)\n                                return \"sectionGroup.\" + error;\n                        }\n                    }\n                    return null;\n                };\n\n                /**\n                 * Creates a Section message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.Section} Section\n                 */\n                Section.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.Section)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.Section();\n                    if (object.sectionId != null)\n                        if ($util.Long)\n                            (message.sectionId = $util.Long.fromValue(object.sectionId)).unsigned = false;\n                        else if (typeof object.sectionId === \"string\")\n                            message.sectionId = parseInt(object.sectionId, 10);\n                        else if (typeof object.sectionId === \"number\")\n                            message.sectionId = object.sectionId;\n                        else if (typeof object.sectionId === \"object\")\n                            message.sectionId = new $util.LongBits(object.sectionId.low >>> 0, object.sectionId.high >>> 0).toNumber();\n                    if (object.sectionGroup != null) {\n                        if (typeof object.sectionGroup !== \"object\")\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected\");\n                        message.sectionGroup = $root.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(object.sectionGroup);\n                    }\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a Section message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.Section} message Section\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                Section.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (message.sectionId != null && message.hasOwnProperty(\"sectionId\")) {\n                        if (typeof message.sectionId === \"number\")\n                            object.sectionId = options.longs === String ? String(message.sectionId) : message.sectionId;\n                        else\n                            object.sectionId = options.longs === String ? $util.Long.prototype.toString.call(message.sectionId) : options.longs === Number ? new $util.LongBits(message.sectionId.low >>> 0, message.sectionId.high >>> 0).toNumber() : message.sectionId;\n                        if (options.oneofs)\n                            object.sectionType = \"sectionId\";\n                    }\n                    if (message.sectionGroup != null && message.hasOwnProperty(\"sectionGroup\")) {\n                        object.sectionGroup = $root.tensorflow.magenta.NoteSequence.SectionGroup.toObject(message.sectionGroup, options);\n                        if (options.oneofs)\n                            object.sectionType = \"sectionGroup\";\n                    }\n                    return object;\n                };\n\n                /**\n                 * Converts this Section to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.Section\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                Section.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return Section;\n            })();\n\n            NoteSequence.SectionGroup = (function() {\n\n                /**\n                 * Properties of a SectionGroup.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @interface ISectionGroup\n                 * @property {Array.<tensorflow.magenta.NoteSequence.ISection>|null} [sections] SectionGroup sections\n                 * @property {number|null} [numTimes] SectionGroup numTimes\n                 */\n\n                /**\n                 * Constructs a new SectionGroup.\n                 * @memberof tensorflow.magenta.NoteSequence\n                 * @classdesc Represents a SectionGroup.\n                 * @implements ISectionGroup\n                 * @constructor\n                 * @param {tensorflow.magenta.NoteSequence.ISectionGroup=} [properties] Properties to set\n                 */\n                function SectionGroup(properties) {\n                    this.sections = [];\n                    if (properties)\n                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                            if (properties[keys[i]] != null)\n                                this[keys[i]] = properties[keys[i]];\n                }\n\n                /**\n                 * SectionGroup sections.\n                 * @member {Array.<tensorflow.magenta.NoteSequence.ISection>} sections\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @instance\n                 */\n                SectionGroup.prototype.sections = $util.emptyArray;\n\n                /**\n                 * SectionGroup numTimes.\n                 * @member {number} numTimes\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @instance\n                 */\n                SectionGroup.prototype.numTimes = 0;\n\n                /**\n                 * Creates a new SectionGroup instance using the specified properties.\n                 * @function create\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionGroup=} [properties] Properties to set\n                 * @returns {tensorflow.magenta.NoteSequence.SectionGroup} SectionGroup instance\n                 */\n                SectionGroup.create = function create(properties) {\n                    return new SectionGroup(properties);\n                };\n\n                /**\n                 * Encodes the specified SectionGroup message. Does not implicitly {@link tensorflow.magenta.NoteSequence.SectionGroup.verify|verify} messages.\n                 * @function encode\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionGroup} message SectionGroup message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SectionGroup.encode = function encode(message, writer) {\n                    if (!writer)\n                        writer = $Writer.create();\n                    if (message.sections != null && message.sections.length)\n                        for (var i = 0; i < message.sections.length; ++i)\n                            $root.tensorflow.magenta.NoteSequence.Section.encode(message.sections[i], writer.uint32(/* id 1, wireType 2 =*/10).fork()).ldelim();\n                    if (message.numTimes != null && message.hasOwnProperty(\"numTimes\"))\n                        writer.uint32(/* id 2, wireType 0 =*/16).int32(message.numTimes);\n                    return writer;\n                };\n\n                /**\n                 * Encodes the specified SectionGroup message, length delimited. Does not implicitly {@link tensorflow.magenta.NoteSequence.SectionGroup.verify|verify} messages.\n                 * @function encodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.ISectionGroup} message SectionGroup message or plain object to encode\n                 * @param {$protobuf.Writer} [writer] Writer to encode to\n                 * @returns {$protobuf.Writer} Writer\n                 */\n                SectionGroup.encodeDelimited = function encodeDelimited(message, writer) {\n                    return this.encode(message, writer).ldelim();\n                };\n\n                /**\n                 * Decodes a SectionGroup message from the specified reader or buffer.\n                 * @function decode\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @param {number} [length] Message length if known beforehand\n                 * @returns {tensorflow.magenta.NoteSequence.SectionGroup} SectionGroup\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SectionGroup.decode = function decode(reader, length) {\n                    if (!(reader instanceof $Reader))\n                        reader = $Reader.create(reader);\n                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.NoteSequence.SectionGroup();\n                    while (reader.pos < end) {\n                        var tag = reader.uint32();\n                        switch (tag >>> 3) {\n                        case 1:\n                            if (!(message.sections && message.sections.length))\n                                message.sections = [];\n                            message.sections.push($root.tensorflow.magenta.NoteSequence.Section.decode(reader, reader.uint32()));\n                            break;\n                        case 2:\n                            message.numTimes = reader.int32();\n                            break;\n                        default:\n                            reader.skipType(tag & 7);\n                            break;\n                        }\n                    }\n                    return message;\n                };\n\n                /**\n                 * Decodes a SectionGroup message from the specified reader or buffer, length delimited.\n                 * @function decodeDelimited\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n                 * @returns {tensorflow.magenta.NoteSequence.SectionGroup} SectionGroup\n                 * @throws {Error} If the payload is not a reader or valid buffer\n                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n                 */\n                SectionGroup.decodeDelimited = function decodeDelimited(reader) {\n                    if (!(reader instanceof $Reader))\n                        reader = new $Reader(reader);\n                    return this.decode(reader, reader.uint32());\n                };\n\n                /**\n                 * Verifies a SectionGroup message.\n                 * @function verify\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {Object.<string,*>} message Plain object to verify\n                 * @returns {string|null} `null` if valid, otherwise the reason why it is not\n                 */\n                SectionGroup.verify = function verify(message) {\n                    if (typeof message !== \"object\" || message === null)\n                        return \"object expected\";\n                    if (message.sections != null && message.hasOwnProperty(\"sections\")) {\n                        if (!Array.isArray(message.sections))\n                            return \"sections: array expected\";\n                        for (var i = 0; i < message.sections.length; ++i) {\n                            var error = $root.tensorflow.magenta.NoteSequence.Section.verify(message.sections[i]);\n                            if (error)\n                                return \"sections.\" + error;\n                        }\n                    }\n                    if (message.numTimes != null && message.hasOwnProperty(\"numTimes\"))\n                        if (!$util.isInteger(message.numTimes))\n                            return \"numTimes: integer expected\";\n                    return null;\n                };\n\n                /**\n                 * Creates a SectionGroup message from a plain object. Also converts values to their respective internal types.\n                 * @function fromObject\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {Object.<string,*>} object Plain object\n                 * @returns {tensorflow.magenta.NoteSequence.SectionGroup} SectionGroup\n                 */\n                SectionGroup.fromObject = function fromObject(object) {\n                    if (object instanceof $root.tensorflow.magenta.NoteSequence.SectionGroup)\n                        return object;\n                    var message = new $root.tensorflow.magenta.NoteSequence.SectionGroup();\n                    if (object.sections) {\n                        if (!Array.isArray(object.sections))\n                            throw TypeError(\".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected\");\n                        message.sections = [];\n                        for (var i = 0; i < object.sections.length; ++i) {\n                            if (typeof object.sections[i] !== \"object\")\n                                throw TypeError(\".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected\");\n                            message.sections[i] = $root.tensorflow.magenta.NoteSequence.Section.fromObject(object.sections[i]);\n                        }\n                    }\n                    if (object.numTimes != null)\n                        message.numTimes = object.numTimes | 0;\n                    return message;\n                };\n\n                /**\n                 * Creates a plain object from a SectionGroup message. Also converts values to other types if specified.\n                 * @function toObject\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @static\n                 * @param {tensorflow.magenta.NoteSequence.SectionGroup} message SectionGroup\n                 * @param {$protobuf.IConversionOptions} [options] Conversion options\n                 * @returns {Object.<string,*>} Plain object\n                 */\n                SectionGroup.toObject = function toObject(message, options) {\n                    if (!options)\n                        options = {};\n                    var object = {};\n                    if (options.arrays || options.defaults)\n                        object.sections = [];\n                    if (options.defaults)\n                        object.numTimes = 0;\n                    if (message.sections && message.sections.length) {\n                        object.sections = [];\n                        for (var j = 0; j < message.sections.length; ++j)\n                            object.sections[j] = $root.tensorflow.magenta.NoteSequence.Section.toObject(message.sections[j], options);\n                    }\n                    if (message.numTimes != null && message.hasOwnProperty(\"numTimes\"))\n                        object.numTimes = message.numTimes;\n                    return object;\n                };\n\n                /**\n                 * Converts this SectionGroup to JSON.\n                 * @function toJSON\n                 * @memberof tensorflow.magenta.NoteSequence.SectionGroup\n                 * @instance\n                 * @returns {Object.<string,*>} JSON object\n                 */\n                SectionGroup.prototype.toJSON = function toJSON() {\n                    return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n                };\n\n                return SectionGroup;\n            })();\n\n            return NoteSequence;\n        })();\n\n        magenta.SequenceMetadata = (function() {\n\n            /**\n             * Properties of a SequenceMetadata.\n             * @memberof tensorflow.magenta\n             * @interface ISequenceMetadata\n             * @property {string|null} [title] SequenceMetadata title\n             * @property {string|null} [artist] SequenceMetadata artist\n             * @property {Array.<string>|null} [genre] SequenceMetadata genre\n             * @property {Array.<string>|null} [composers] SequenceMetadata composers\n             */\n\n            /**\n             * Constructs a new SequenceMetadata.\n             * @memberof tensorflow.magenta\n             * @classdesc Represents a SequenceMetadata.\n             * @implements ISequenceMetadata\n             * @constructor\n             * @param {tensorflow.magenta.ISequenceMetadata=} [properties] Properties to set\n             */\n            function SequenceMetadata(properties) {\n                this.genre = [];\n                this.composers = [];\n                if (properties)\n                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                        if (properties[keys[i]] != null)\n                            this[keys[i]] = properties[keys[i]];\n            }\n\n            /**\n             * SequenceMetadata title.\n             * @member {string} title\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @instance\n             */\n            SequenceMetadata.prototype.title = \"\";\n\n            /**\n             * SequenceMetadata artist.\n             * @member {string} artist\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @instance\n             */\n            SequenceMetadata.prototype.artist = \"\";\n\n            /**\n             * SequenceMetadata genre.\n             * @member {Array.<string>} genre\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @instance\n             */\n            SequenceMetadata.prototype.genre = $util.emptyArray;\n\n            /**\n             * SequenceMetadata composers.\n             * @member {Array.<string>} composers\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @instance\n             */\n            SequenceMetadata.prototype.composers = $util.emptyArray;\n\n            /**\n             * Creates a new SequenceMetadata instance using the specified properties.\n             * @function create\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {tensorflow.magenta.ISequenceMetadata=} [properties] Properties to set\n             * @returns {tensorflow.magenta.SequenceMetadata} SequenceMetadata instance\n             */\n            SequenceMetadata.create = function create(properties) {\n                return new SequenceMetadata(properties);\n            };\n\n            /**\n             * Encodes the specified SequenceMetadata message. Does not implicitly {@link tensorflow.magenta.SequenceMetadata.verify|verify} messages.\n             * @function encode\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {tensorflow.magenta.ISequenceMetadata} message SequenceMetadata message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            SequenceMetadata.encode = function encode(message, writer) {\n                if (!writer)\n                    writer = $Writer.create();\n                if (message.title != null && message.hasOwnProperty(\"title\"))\n                    writer.uint32(/* id 1, wireType 2 =*/10).string(message.title);\n                if (message.artist != null && message.hasOwnProperty(\"artist\"))\n                    writer.uint32(/* id 2, wireType 2 =*/18).string(message.artist);\n                if (message.genre != null && message.genre.length)\n                    for (var i = 0; i < message.genre.length; ++i)\n                        writer.uint32(/* id 3, wireType 2 =*/26).string(message.genre[i]);\n                if (message.composers != null && message.composers.length)\n                    for (var i = 0; i < message.composers.length; ++i)\n                        writer.uint32(/* id 4, wireType 2 =*/34).string(message.composers[i]);\n                return writer;\n            };\n\n            /**\n             * Encodes the specified SequenceMetadata message, length delimited. Does not implicitly {@link tensorflow.magenta.SequenceMetadata.verify|verify} messages.\n             * @function encodeDelimited\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {tensorflow.magenta.ISequenceMetadata} message SequenceMetadata message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            SequenceMetadata.encodeDelimited = function encodeDelimited(message, writer) {\n                return this.encode(message, writer).ldelim();\n            };\n\n            /**\n             * Decodes a SequenceMetadata message from the specified reader or buffer.\n             * @function decode\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @param {number} [length] Message length if known beforehand\n             * @returns {tensorflow.magenta.SequenceMetadata} SequenceMetadata\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            SequenceMetadata.decode = function decode(reader, length) {\n                if (!(reader instanceof $Reader))\n                    reader = $Reader.create(reader);\n                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.SequenceMetadata();\n                while (reader.pos < end) {\n                    var tag = reader.uint32();\n                    switch (tag >>> 3) {\n                    case 1:\n                        message.title = reader.string();\n                        break;\n                    case 2:\n                        message.artist = reader.string();\n                        break;\n                    case 3:\n                        if (!(message.genre && message.genre.length))\n                            message.genre = [];\n                        message.genre.push(reader.string());\n                        break;\n                    case 4:\n                        if (!(message.composers && message.composers.length))\n                            message.composers = [];\n                        message.composers.push(reader.string());\n                        break;\n                    default:\n                        reader.skipType(tag & 7);\n                        break;\n                    }\n                }\n                return message;\n            };\n\n            /**\n             * Decodes a SequenceMetadata message from the specified reader or buffer, length delimited.\n             * @function decodeDelimited\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @returns {tensorflow.magenta.SequenceMetadata} SequenceMetadata\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            SequenceMetadata.decodeDelimited = function decodeDelimited(reader) {\n                if (!(reader instanceof $Reader))\n                    reader = new $Reader(reader);\n                return this.decode(reader, reader.uint32());\n            };\n\n            /**\n             * Verifies a SequenceMetadata message.\n             * @function verify\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {Object.<string,*>} message Plain object to verify\n             * @returns {string|null} `null` if valid, otherwise the reason why it is not\n             */\n            SequenceMetadata.verify = function verify(message) {\n                if (typeof message !== \"object\" || message === null)\n                    return \"object expected\";\n                if (message.title != null && message.hasOwnProperty(\"title\"))\n                    if (!$util.isString(message.title))\n                        return \"title: string expected\";\n                if (message.artist != null && message.hasOwnProperty(\"artist\"))\n                    if (!$util.isString(message.artist))\n                        return \"artist: string expected\";\n                if (message.genre != null && message.hasOwnProperty(\"genre\")) {\n                    if (!Array.isArray(message.genre))\n                        return \"genre: array expected\";\n                    for (var i = 0; i < message.genre.length; ++i)\n                        if (!$util.isString(message.genre[i]))\n                            return \"genre: string[] expected\";\n                }\n                if (message.composers != null && message.hasOwnProperty(\"composers\")) {\n                    if (!Array.isArray(message.composers))\n                        return \"composers: array expected\";\n                    for (var i = 0; i < message.composers.length; ++i)\n                        if (!$util.isString(message.composers[i]))\n                            return \"composers: string[] expected\";\n                }\n                return null;\n            };\n\n            /**\n             * Creates a SequenceMetadata message from a plain object. Also converts values to their respective internal types.\n             * @function fromObject\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {Object.<string,*>} object Plain object\n             * @returns {tensorflow.magenta.SequenceMetadata} SequenceMetadata\n             */\n            SequenceMetadata.fromObject = function fromObject(object) {\n                if (object instanceof $root.tensorflow.magenta.SequenceMetadata)\n                    return object;\n                var message = new $root.tensorflow.magenta.SequenceMetadata();\n                if (object.title != null)\n                    message.title = String(object.title);\n                if (object.artist != null)\n                    message.artist = String(object.artist);\n                if (object.genre) {\n                    if (!Array.isArray(object.genre))\n                        throw TypeError(\".tensorflow.magenta.SequenceMetadata.genre: array expected\");\n                    message.genre = [];\n                    for (var i = 0; i < object.genre.length; ++i)\n                        message.genre[i] = String(object.genre[i]);\n                }\n                if (object.composers) {\n                    if (!Array.isArray(object.composers))\n                        throw TypeError(\".tensorflow.magenta.SequenceMetadata.composers: array expected\");\n                    message.composers = [];\n                    for (var i = 0; i < object.composers.length; ++i)\n                        message.composers[i] = String(object.composers[i]);\n                }\n                return message;\n            };\n\n            /**\n             * Creates a plain object from a SequenceMetadata message. Also converts values to other types if specified.\n             * @function toObject\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @static\n             * @param {tensorflow.magenta.SequenceMetadata} message SequenceMetadata\n             * @param {$protobuf.IConversionOptions} [options] Conversion options\n             * @returns {Object.<string,*>} Plain object\n             */\n            SequenceMetadata.toObject = function toObject(message, options) {\n                if (!options)\n                    options = {};\n                var object = {};\n                if (options.arrays || options.defaults) {\n                    object.genre = [];\n                    object.composers = [];\n                }\n                if (options.defaults) {\n                    object.title = \"\";\n                    object.artist = \"\";\n                }\n                if (message.title != null && message.hasOwnProperty(\"title\"))\n                    object.title = message.title;\n                if (message.artist != null && message.hasOwnProperty(\"artist\"))\n                    object.artist = message.artist;\n                if (message.genre && message.genre.length) {\n                    object.genre = [];\n                    for (var j = 0; j < message.genre.length; ++j)\n                        object.genre[j] = message.genre[j];\n                }\n                if (message.composers && message.composers.length) {\n                    object.composers = [];\n                    for (var j = 0; j < message.composers.length; ++j)\n                        object.composers[j] = message.composers[j];\n                }\n                return object;\n            };\n\n            /**\n             * Converts this SequenceMetadata to JSON.\n             * @function toJSON\n             * @memberof tensorflow.magenta.SequenceMetadata\n             * @instance\n             * @returns {Object.<string,*>} JSON object\n             */\n            SequenceMetadata.prototype.toJSON = function toJSON() {\n                return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n            };\n\n            return SequenceMetadata;\n        })();\n\n        magenta.VelocityRange = (function() {\n\n            /**\n             * Properties of a VelocityRange.\n             * @memberof tensorflow.magenta\n             * @interface IVelocityRange\n             * @property {number|null} [min] VelocityRange min\n             * @property {number|null} [max] VelocityRange max\n             */\n\n            /**\n             * Constructs a new VelocityRange.\n             * @memberof tensorflow.magenta\n             * @classdesc Represents a VelocityRange.\n             * @implements IVelocityRange\n             * @constructor\n             * @param {tensorflow.magenta.IVelocityRange=} [properties] Properties to set\n             */\n            function VelocityRange(properties) {\n                if (properties)\n                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n                        if (properties[keys[i]] != null)\n                            this[keys[i]] = properties[keys[i]];\n            }\n\n            /**\n             * VelocityRange min.\n             * @member {number} min\n             * @memberof tensorflow.magenta.VelocityRange\n             * @instance\n             */\n            VelocityRange.prototype.min = 0;\n\n            /**\n             * VelocityRange max.\n             * @member {number} max\n             * @memberof tensorflow.magenta.VelocityRange\n             * @instance\n             */\n            VelocityRange.prototype.max = 0;\n\n            /**\n             * Creates a new VelocityRange instance using the specified properties.\n             * @function create\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {tensorflow.magenta.IVelocityRange=} [properties] Properties to set\n             * @returns {tensorflow.magenta.VelocityRange} VelocityRange instance\n             */\n            VelocityRange.create = function create(properties) {\n                return new VelocityRange(properties);\n            };\n\n            /**\n             * Encodes the specified VelocityRange message. Does not implicitly {@link tensorflow.magenta.VelocityRange.verify|verify} messages.\n             * @function encode\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {tensorflow.magenta.IVelocityRange} message VelocityRange message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            VelocityRange.encode = function encode(message, writer) {\n                if (!writer)\n                    writer = $Writer.create();\n                if (message.min != null && message.hasOwnProperty(\"min\"))\n                    writer.uint32(/* id 1, wireType 0 =*/8).int32(message.min);\n                if (message.max != null && message.hasOwnProperty(\"max\"))\n                    writer.uint32(/* id 2, wireType 0 =*/16).int32(message.max);\n                return writer;\n            };\n\n            /**\n             * Encodes the specified VelocityRange message, length delimited. Does not implicitly {@link tensorflow.magenta.VelocityRange.verify|verify} messages.\n             * @function encodeDelimited\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {tensorflow.magenta.IVelocityRange} message VelocityRange message or plain object to encode\n             * @param {$protobuf.Writer} [writer] Writer to encode to\n             * @returns {$protobuf.Writer} Writer\n             */\n            VelocityRange.encodeDelimited = function encodeDelimited(message, writer) {\n                return this.encode(message, writer).ldelim();\n            };\n\n            /**\n             * Decodes a VelocityRange message from the specified reader or buffer.\n             * @function decode\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @param {number} [length] Message length if known beforehand\n             * @returns {tensorflow.magenta.VelocityRange} VelocityRange\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            VelocityRange.decode = function decode(reader, length) {\n                if (!(reader instanceof $Reader))\n                    reader = $Reader.create(reader);\n                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.tensorflow.magenta.VelocityRange();\n                while (reader.pos < end) {\n                    var tag = reader.uint32();\n                    switch (tag >>> 3) {\n                    case 1:\n                        message.min = reader.int32();\n                        break;\n                    case 2:\n                        message.max = reader.int32();\n                        break;\n                    default:\n                        reader.skipType(tag & 7);\n                        break;\n                    }\n                }\n                return message;\n            };\n\n            /**\n             * Decodes a VelocityRange message from the specified reader or buffer, length delimited.\n             * @function decodeDelimited\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n             * @returns {tensorflow.magenta.VelocityRange} VelocityRange\n             * @throws {Error} If the payload is not a reader or valid buffer\n             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n             */\n            VelocityRange.decodeDelimited = function decodeDelimited(reader) {\n                if (!(reader instanceof $Reader))\n                    reader = new $Reader(reader);\n                return this.decode(reader, reader.uint32());\n            };\n\n            /**\n             * Verifies a VelocityRange message.\n             * @function verify\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {Object.<string,*>} message Plain object to verify\n             * @returns {string|null} `null` if valid, otherwise the reason why it is not\n             */\n            VelocityRange.verify = function verify(message) {\n                if (typeof message !== \"object\" || message === null)\n                    return \"object expected\";\n                if (message.min != null && message.hasOwnProperty(\"min\"))\n                    if (!$util.isInteger(message.min))\n                        return \"min: integer expected\";\n                if (message.max != null && message.hasOwnProperty(\"max\"))\n                    if (!$util.isInteger(message.max))\n                        return \"max: integer expected\";\n                return null;\n            };\n\n            /**\n             * Creates a VelocityRange message from a plain object. Also converts values to their respective internal types.\n             * @function fromObject\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {Object.<string,*>} object Plain object\n             * @returns {tensorflow.magenta.VelocityRange} VelocityRange\n             */\n            VelocityRange.fromObject = function fromObject(object) {\n                if (object instanceof $root.tensorflow.magenta.VelocityRange)\n                    return object;\n                var message = new $root.tensorflow.magenta.VelocityRange();\n                if (object.min != null)\n                    message.min = object.min | 0;\n                if (object.max != null)\n                    message.max = object.max | 0;\n                return message;\n            };\n\n            /**\n             * Creates a plain object from a VelocityRange message. Also converts values to other types if specified.\n             * @function toObject\n             * @memberof tensorflow.magenta.VelocityRange\n             * @static\n             * @param {tensorflow.magenta.VelocityRange} message VelocityRange\n             * @param {$protobuf.IConversionOptions} [options] Conversion options\n             * @returns {Object.<string,*>} Plain object\n             */\n            VelocityRange.toObject = function toObject(message, options) {\n                if (!options)\n                    options = {};\n                var object = {};\n                if (options.defaults) {\n                    object.min = 0;\n                    object.max = 0;\n                }\n                if (message.min != null && message.hasOwnProperty(\"min\"))\n                    object.min = message.min;\n                if (message.max != null && message.hasOwnProperty(\"max\"))\n                    object.max = message.max;\n                return object;\n            };\n\n            /**\n             * Converts this VelocityRange to JSON.\n             * @function toJSON\n             * @memberof tensorflow.magenta.VelocityRange\n             * @instance\n             * @returns {Object.<string,*>} JSON object\n             */\n            VelocityRange.prototype.toJSON = function toJSON() {\n                return this.constructor.toObject(this, $protobuf.util.toJSONOptions);\n            };\n\n            return VelocityRange;\n        })();\n\n        return magenta;\n    })();\n\n    return tensorflow;\n})();\n\nmodule.exports = $root;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQG1hZ2VudGErbXVzaWNAMS4yMy4xX0B0ZW5zb3JmbG93K3RmanMtY29yZUAyLjguNl9zZWVkcmFuZG9tQDIuNC40L25vZGVfbW9kdWxlcy9AbWFnZW50YS9tdXNpYy9lc20vcHJvdG9idWYvcHJvdG8uanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDYTs7QUFFYixnQkFBZ0IsbUJBQU8sQ0FBQywyR0FBb0I7O0FBRTVDO0FBQ0E7O0FBRUE7QUFDQSwwRUFBMEU7O0FBRTFFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsYUFBYTtBQUN2QywwQkFBMEIsYUFBYTtBQUN2QywwQkFBMEIsYUFBYTtBQUN2QywwQkFBMEIsYUFBYTtBQUN2QywwQkFBMEIsYUFBYTtBQUN2QywwQkFBMEIsNkRBQTZEO0FBQ3ZGLDBCQUEwQiw0REFBNEQ7QUFDdEYsMEJBQTBCLHFEQUFxRDtBQUMvRSwwQkFBMEIsb0RBQW9EO0FBQzlFLDBCQUEwQixhQUFhO0FBQ3ZDLDBCQUEwQixhQUFhO0FBQ3ZDLDBCQUEwQix5REFBeUQ7QUFDbkYsMEJBQTBCLDZEQUE2RDtBQUN2RiwwQkFBMEIsd0RBQXdEO0FBQ2xGLDBCQUEwQixrREFBa0Q7QUFDNUUsMEJBQTBCLDhEQUE4RDtBQUN4RiwwQkFBMEIsaUVBQWlFO0FBQzNGLDBCQUEwQiw0REFBNEQ7QUFDdEYsMEJBQTBCLHdEQUF3RDtBQUNsRiwwQkFBMEIsdURBQXVEO0FBQ2pGLDBCQUEwQiwyQ0FBMkM7QUFDckU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG1DQUFtQztBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRSxpQkFBaUI7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0NBQXNDO0FBQ2pFLDJCQUEyQiw4QkFBOEI7QUFDekQsNkJBQTZCLG1CQUFtQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLG1CQUFtQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDLDBCQUEwQixRQUFRO0FBQ2xDO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGFBQWE7QUFDM0MsOEJBQThCLGFBQWE7QUFDM0MsOEJBQThCLGFBQWE7QUFDM0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlEQUFpRDtBQUM1RTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsaUJBQWlCO0FBQ3pGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNEJBQTRCLFFBQVE7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDRCQUE0QixRQUFRO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw0QkFBNEIsUUFBUTtBQUNwQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlEQUFpRDtBQUM1RSw2QkFBNkIsK0NBQStDO0FBQzVFO0FBQ0E7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw4Q0FBOEM7QUFDekUsMkJBQTJCLDhCQUE4QjtBQUN6RCw2QkFBNkIsbUJBQW1CO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLG1CQUFtQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUIsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFBQVE7QUFDdEMsOEJBQThCLFFB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O0FBQ0EsdUJBQXVCLG1CQUFtQjtBQUMxQyx5QkFBeUIsa0NBQWtDO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrQ0FBa0M7QUFDekQsdUJBQXVCLDhCQUE4QjtBQUNyRCx5QkFBeUIsbUJBQW1CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLG1CQUFtQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSxLQUFLOztBQUVMO0FBQ0EsQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL21vbW9uZ2FoLmdpdGh1Yi5pby8uL25vZGVfbW9kdWxlcy8ucG5wbS9AbWFnZW50YSttdXNpY0AxLjIzLjFfQHRlbnNvcmZsb3crdGZqcy1jb3JlQDIuOC42X3NlZWRyYW5kb21AMi40LjQvbm9kZV9tb2R1bGVzL0BtYWdlbnRhL211c2ljL2VzbS9wcm90b2J1Zi9wcm90by5qcz8yZGM2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZXNsaW50LWRpc2FibGUgYmxvY2stc2NvcGVkLXZhciwgbm8tcmVkZWNsYXJlLCBuby1jb250cm9sLXJlZ2V4LCBuby1wcm90b3R5cGUtYnVpbHRpbnMqL1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciAkcHJvdG9idWYgPSByZXF1aXJlKFwicHJvdG9idWZqcy9taW5pbWFsXCIpO1xuXG4vLyBDb21tb24gYWxpYXNlc1xudmFyICRSZWFkZXIgPSAkcHJvdG9idWYuUmVhZGVyLCAkV3JpdGVyID0gJHByb3RvYnVmLldyaXRlciwgJHV0aWwgPSAkcHJvdG9idWYudXRpbDtcblxuLy8gRXhwb3J0ZWQgcm9vdCBuYW1lc3BhY2VcbnZhciAkcm9vdCA9ICRwcm90b2J1Zi5yb290c1tcImRlZmF1bHRcIl0gfHwgKCRwcm90b2J1Zi5yb290c1tcImRlZmF1bHRcIl0gPSB7fSk7XG5cbiRyb290LnRlbnNvcmZsb3cgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAvKipcbiAgICAgKiBOYW1lc3BhY2UgdGVuc29yZmxvdy5cbiAgICAgKiBAZXhwb3J0cyB0ZW5zb3JmbG93XG4gICAgICogQG5hbWVzcGFjZVxuICAgICAqL1xuICAgIHZhciB0ZW5zb3JmbG93ID0ge307XG5cbiAgICB0ZW5zb3JmbG93Lm1hZ2VudGEgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWVzcGFjZSBtYWdlbnRhLlxuICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvd1xuICAgICAgICAgKiBAbmFtZXNwYWNlXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgbWFnZW50YSA9IHt9O1xuXG4gICAgICAgIG1hZ2VudGEuTm90ZVNlcXVlbmNlID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFByb3BlcnRpZXMgb2YgYSBOb3RlU2VxdWVuY2UuXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhXG4gICAgICAgICAgICAgKiBAaW50ZXJmYWNlIElOb3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfG51bGx9IFtpZF0gTm90ZVNlcXVlbmNlIGlkXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ3xudWxsfSBbZmlsZW5hbWVdIE5vdGVTZXF1ZW5jZSBmaWxlbmFtZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3JlZmVyZW5jZU51bWJlcl0gTm90ZVNlcXVlbmNlIHJlZmVyZW5jZU51bWJlclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd8bnVsbH0gW2NvbGxlY3Rpb25OYW1lXSBOb3RlU2VxdWVuY2UgY29sbGVjdGlvbk5hbWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFt0aWNrc1BlclF1YXJ0ZXJdIE5vdGVTZXF1ZW5jZSB0aWNrc1BlclF1YXJ0ZXJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRpbWVTaWduYXR1cmU+fG51bGx9IFt0aW1lU2lnbmF0dXJlc10gTm90ZVNlcXVlbmNlIHRpbWVTaWduYXR1cmVzXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklLZXlTaWduYXR1cmU+fG51bGx9IFtrZXlTaWduYXR1cmVzXSBOb3RlU2VxdWVuY2Uga2V5U2lnbmF0dXJlc1xuICAgICAgICAgICAgICogQHByb3BlcnR5IHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JVGVtcG8+fG51bGx9IFt0ZW1wb3NdIE5vdGVTZXF1ZW5jZSB0ZW1wb3NcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSU5vdGU+fG51bGx9IFtub3Rlc10gTm90ZVNlcXVlbmNlIG5vdGVzXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbdG90YWxUaW1lXSBOb3RlU2VxdWVuY2UgdG90YWxUaW1lXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbdG90YWxRdWFudGl6ZWRTdGVwc10gTm90ZVNlcXVlbmNlIHRvdGFsUXVhbnRpemVkU3RlcHNcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVBpdGNoQmVuZD58bnVsbH0gW3BpdGNoQmVuZHNdIE5vdGVTZXF1ZW5jZSBwaXRjaEJlbmRzXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklDb250cm9sQ2hhbmdlPnxudWxsfSBbY29udHJvbENoYW5nZXNdIE5vdGVTZXF1ZW5jZSBjb250cm9sQ2hhbmdlc1xuICAgICAgICAgICAgICogQHByb3BlcnR5IHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGFydEluZm8+fG51bGx9IFtwYXJ0SW5mb3NdIE5vdGVTZXF1ZW5jZSBwYXJ0SW5mb3NcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU291cmNlSW5mb3xudWxsfSBbc291cmNlSW5mb10gTm90ZVNlcXVlbmNlIHNvdXJjZUluZm9cbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRleHRBbm5vdGF0aW9uPnxudWxsfSBbdGV4dEFubm90YXRpb25zXSBOb3RlU2VxdWVuY2UgdGV4dEFubm90YXRpb25zXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uQW5ub3RhdGlvbj58bnVsbH0gW3NlY3Rpb25Bbm5vdGF0aW9uc10gTm90ZVNlcXVlbmNlIHNlY3Rpb25Bbm5vdGF0aW9uc1xuICAgICAgICAgICAgICogQHByb3BlcnR5IHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkdyb3VwPnxudWxsfSBbc2VjdGlvbkdyb3Vwc10gTm90ZVNlcXVlbmNlIHNlY3Rpb25Hcm91cHNcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUXVhbnRpemF0aW9uSW5mb3xudWxsfSBbcXVhbnRpemF0aW9uSW5mb10gTm90ZVNlcXVlbmNlIHF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU3Vic2VxdWVuY2VJbmZvfG51bGx9IFtzdWJzZXF1ZW5jZUluZm9dIE5vdGVTZXF1ZW5jZSBzdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLklTZXF1ZW5jZU1ldGFkYXRhfG51bGx9IFtzZXF1ZW5jZU1ldGFkYXRhXSBOb3RlU2VxdWVuY2Ugc2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ29uc3RydWN0cyBhIG5ldyBOb3RlU2VxdWVuY2UuXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhXG4gICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBOb3RlU2VxdWVuY2UuXG4gICAgICAgICAgICAgKiBAaW1wbGVtZW50cyBJTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklOb3RlU2VxdWVuY2U9fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gTm90ZVNlcXVlbmNlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVTaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlTaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy50ZW1wb3MgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGVzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5waXRjaEJlbmRzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMucGFydEluZm9zID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0QW5ub3RhdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlY3Rpb25Bbm5vdGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbkdyb3VwcyA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2tleXNbaV1dICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIGlkLlxuICAgICAgICAgICAgICogQG1lbWJlciB7c3RyaW5nfSBpZFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLmlkID0gXCJcIjtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBOb3RlU2VxdWVuY2UgZmlsZW5hbWUuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtzdHJpbmd9IGZpbGVuYW1lXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUuZmlsZW5hbWUgPSBcIlwiO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSByZWZlcmVuY2VOdW1iZXIuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHJlZmVyZW5jZU51bWJlclxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnJlZmVyZW5jZU51bWJlciA9ICR1dGlsLkxvbmcgPyAkdXRpbC5Mb25nLmZyb21CaXRzKDAsMCxmYWxzZSkgOiAwO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSBjb2xsZWN0aW9uTmFtZS5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge3N0cmluZ30gY29sbGVjdGlvbk5hbWVcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLnByb3RvdHlwZS5jb2xsZWN0aW9uTmFtZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHRpY2tzUGVyUXVhcnRlci5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gdGlja3NQZXJRdWFydGVyXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUudGlja3NQZXJRdWFydGVyID0gMDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBOb3RlU2VxdWVuY2UgdGltZVNpZ25hdHVyZXMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JVGltZVNpZ25hdHVyZT59IHRpbWVTaWduYXR1cmVzXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUudGltZVNpZ25hdHVyZXMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSBrZXlTaWduYXR1cmVzLlxuICAgICAgICAgICAgICogQG1lbWJlciB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSUtleVNpZ25hdHVyZT59IGtleVNpZ25hdHVyZXNcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLnByb3RvdHlwZS5rZXlTaWduYXR1cmVzID0gJHV0aWwuZW1wdHlBcnJheTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBOb3RlU2VxdWVuY2UgdGVtcG9zLlxuICAgICAgICAgICAgICogQG1lbWJlciB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRlbXBvPn0gdGVtcG9zXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUudGVtcG9zID0gJHV0aWwuZW1wdHlBcnJheTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBOb3RlU2VxdWVuY2Ugbm90ZXMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JTm90ZT59IG5vdGVzXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUubm90ZXMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSB0b3RhbFRpbWUuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHRvdGFsVGltZVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnRvdGFsVGltZSA9IDA7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHRvdGFsUXVhbnRpemVkU3RlcHMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHRvdGFsUXVhbnRpemVkU3RlcHNcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLnByb3RvdHlwZS50b3RhbFF1YW50aXplZFN0ZXBzID0gJHV0aWwuTG9uZyA/ICR1dGlsLkxvbmcuZnJvbUJpdHMoMCwwLGZhbHNlKSA6IDA7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHBpdGNoQmVuZHMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGl0Y2hCZW5kPn0gcGl0Y2hCZW5kc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnBpdGNoQmVuZHMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSBjb250cm9sQ2hhbmdlcy5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklDb250cm9sQ2hhbmdlPn0gY29udHJvbENoYW5nZXNcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLnByb3RvdHlwZS5jb250cm9sQ2hhbmdlcyA9ICR1dGlsLmVtcHR5QXJyYXk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHBhcnRJbmZvcy5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklQYXJ0SW5mbz59IHBhcnRJbmZvc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnBhcnRJbmZvcyA9ICR1dGlsLmVtcHR5QXJyYXk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHNvdXJjZUluZm8uXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTb3VyY2VJbmZvfG51bGx8dW5kZWZpbmVkfSBzb3VyY2VJbmZvXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5wcm90b3R5cGUuc291cmNlSW5mbyA9IG51bGw7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHRleHRBbm5vdGF0aW9ucy5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUZXh0QW5ub3RhdGlvbj59IHRleHRBbm5vdGF0aW9uc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnRleHRBbm5vdGF0aW9ucyA9ICR1dGlsLmVtcHR5QXJyYXk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHNlY3Rpb25Bbm5vdGF0aW9ucy5cbiAgICAgICAgICAgICAqIEBtZW1iZXIge0FycmF5Ljx0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uQW5ub3RhdGlvbj59IHNlY3Rpb25Bbm5vdGF0aW9uc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnNlY3Rpb25Bbm5vdGF0aW9ucyA9ICR1dGlsLmVtcHR5QXJyYXk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHNlY3Rpb25Hcm91cHMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtBcnJheS48dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkdyb3VwPn0gc2VjdGlvbkdyb3Vwc1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnNlY3Rpb25Hcm91cHMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSBxdWFudGl6YXRpb25JbmZvLlxuICAgICAgICAgICAgICogQG1lbWJlciB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUXVhbnRpemF0aW9uSW5mb3xudWxsfHVuZGVmaW5lZH0gcXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnF1YW50aXphdGlvbkluZm8gPSBudWxsO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE5vdGVTZXF1ZW5jZSBzdWJzZXF1ZW5jZUluZm8uXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTdWJzZXF1ZW5jZUluZm98bnVsbHx1bmRlZmluZWR9IHN1YnNlcXVlbmNlSW5mb1xuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnN1YnNlcXVlbmNlSW5mbyA9IG51bGw7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm90ZVNlcXVlbmNlIHNlcXVlbmNlTWV0YWRhdGEuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuSVNlcXVlbmNlTWV0YWRhdGF8bnVsbHx1bmRlZmluZWR9IHNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLnByb3RvdHlwZS5zZXF1ZW5jZU1ldGFkYXRhID0gbnVsbDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IE5vdGVTZXF1ZW5jZSBpbnN0YW5jZSB1c2luZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuSU5vdGVTZXF1ZW5jZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2V9IE5vdGVTZXF1ZW5jZSBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5vdGVTZXF1ZW5jZShwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIE5vdGVTZXF1ZW5jZSBtZXNzYWdlLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklOb3RlU2VxdWVuY2V9IG1lc3NhZ2UgTm90ZVNlcXVlbmNlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlciA9ICRXcml0ZXIuY3JlYXRlKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaWQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaWRcIikpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMiA9Ki8xMCkuc3RyaW5nKG1lc3NhZ2UuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmZpbGVuYW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImZpbGVuYW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDIgPSovMTgpLnN0cmluZyhtZXNzYWdlLmZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb2xsZWN0aW9uTmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJjb2xsZWN0aW9uTmFtZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAzLCB3aXJlVHlwZSAyID0qLzI2KS5zdHJpbmcobWVzc2FnZS5jb2xsZWN0aW9uTmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGlja3NQZXJRdWFydGVyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpY2tzUGVyUXVhcnRlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA0LCB3aXJlVHlwZSAwID0qLzMyKS5pbnQzMihtZXNzYWdlLnRpY2tzUGVyUXVhcnRlcik7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZVNpZ25hdHVyZXMgIT0gbnVsbCAmJiBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlLmVuY29kZShtZXNzYWdlLnRpbWVTaWduYXR1cmVzW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDUsIHdpcmVUeXBlIDIgPSovNDIpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uua2V5U2lnbmF0dXJlcyAhPSBudWxsICYmIG1lc3NhZ2Uua2V5U2lnbmF0dXJlcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5rZXlTaWduYXR1cmVzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUuZW5jb2RlKG1lc3NhZ2Uua2V5U2lnbmF0dXJlc1tpXSwgd3JpdGVyLnVpbnQzMigvKiBpZCA2LCB3aXJlVHlwZSAyID0qLzUwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRlbXBvcyAhPSBudWxsICYmIG1lc3NhZ2UudGVtcG9zLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnRlbXBvcy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG8uZW5jb2RlKG1lc3NhZ2UudGVtcG9zW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDcsIHdpcmVUeXBlIDIgPSovNTgpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uubm90ZXMgIT0gbnVsbCAmJiBtZXNzYWdlLm5vdGVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLm5vdGVzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlLmVuY29kZShtZXNzYWdlLm5vdGVzW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDgsIHdpcmVUeXBlIDIgPSovNjYpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG90YWxUaW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRvdGFsVGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA5LCB3aXJlVHlwZSAxID0qLzczKS5kb3VibGUobWVzc2FnZS50b3RhbFRpbWUpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBpdGNoQmVuZHMgIT0gbnVsbCAmJiBtZXNzYWdlLnBpdGNoQmVuZHMubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2UucGl0Y2hCZW5kcy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kLmVuY29kZShtZXNzYWdlLnBpdGNoQmVuZHNbaV0sIHdyaXRlci51aW50MzIoLyogaWQgMTAsIHdpcmVUeXBlIDIgPSovODIpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY29udHJvbENoYW5nZXMgIT0gbnVsbCAmJiBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLmVuY29kZShtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDExLCB3aXJlVHlwZSAyID0qLzkwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBhcnRJbmZvcyAhPSBudWxsICYmIG1lc3NhZ2UucGFydEluZm9zLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnBhcnRJbmZvcy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm8uZW5jb2RlKG1lc3NhZ2UucGFydEluZm9zW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDEyLCB3aXJlVHlwZSAyID0qLzk4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNvdXJjZUluZm8gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic291cmNlSW5mb1wiKSlcbiAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLmVuY29kZShtZXNzYWdlLnNvdXJjZUluZm8sIHdyaXRlci51aW50MzIoLyogaWQgMTMsIHdpcmVUeXBlIDIgPSovMTA2KS5mb3JrKCkpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRleHRBbm5vdGF0aW9ucyAhPSBudWxsICYmIG1lc3NhZ2UudGV4dEFubm90YXRpb25zLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnRleHRBbm5vdGF0aW9ucy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24uZW5jb2RlKG1lc3NhZ2UudGV4dEFubm90YXRpb25zW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDE0LCB3aXJlVHlwZSAyID0qLzExNCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6YXRpb25JbmZvICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXphdGlvbkluZm9cIikpXG4gICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mby5lbmNvZGUobWVzc2FnZS5xdWFudGl6YXRpb25JbmZvLCB3cml0ZXIudWludDMyKC8qIGlkIDE1LCB3aXJlVHlwZSAyID0qLzEyMikuZm9yaygpKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3RhbFF1YW50aXplZFN0ZXBzICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRvdGFsUXVhbnRpemVkU3RlcHNcIikpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMTYsIHdpcmVUeXBlIDAgPSovMTI4KS5pbnQ2NChtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdWJzZXF1ZW5jZUluZm9cIikpXG4gICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvLmVuY29kZShtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbywgd3JpdGVyLnVpbnQzMigvKiBpZCAxNywgd2lyZVR5cGUgMiA9Ki8xMzgpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInJlZmVyZW5jZU51bWJlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxOCwgd2lyZVR5cGUgMCA9Ki8xNDQpLmludDY0KG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZXF1ZW5jZU1ldGFkYXRhICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInNlcXVlbmNlTWV0YWRhdGFcIikpXG4gICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhLmVuY29kZShtZXNzYWdlLnNlcXVlbmNlTWV0YWRhdGEsIHdyaXRlci51aW50MzIoLyogaWQgMTksIHdpcmVUeXBlIDIgPSovMTU0KS5mb3JrKCkpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlY3Rpb25Bbm5vdGF0aW9ucyAhPSBudWxsICYmIG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnNlY3Rpb25Bbm5vdGF0aW9ucy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb24uZW5jb2RlKG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDIwLCB3aXJlVHlwZSAyID0qLzE2MikuZm9yaygpKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uR3JvdXBzICE9IG51bGwgJiYgbWVzc2FnZS5zZWN0aW9uR3JvdXBzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnNlY3Rpb25Hcm91cHMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cC5lbmNvZGUobWVzc2FnZS5zZWN0aW9uR3JvdXBzW2ldLCB3cml0ZXIudWludDMyKC8qIGlkIDIxLCB3aXJlVHlwZSAyID0qLzE3MCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVyO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgTm90ZVNlcXVlbmNlIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuSU5vdGVTZXF1ZW5jZX0gbWVzc2FnZSBOb3RlU2VxdWVuY2UgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGUobWVzc2FnZSwgd3JpdGVyKS5sZGVsaW0oKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRGVjb2RlcyBhIE5vdGVTZXF1ZW5jZSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlfSBOb3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UoKTtcbiAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gcmVhZGVyLnVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZyA+Pj4gMykge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmlkID0gcmVhZGVyLnN0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZmlsZW5hbWUgPSByZWFkZXIuc3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyID0gJHV0aWwuTG9uZz9yZWFkZXIuaW50NjQoKS50b051bWJlcigpOnJlYWRlci5pbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29sbGVjdGlvbk5hbWUgPSByZWFkZXIuc3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aWNrc1BlclF1YXJ0ZXIgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLnRpbWVTaWduYXR1cmVzICYmIG1lc3NhZ2UudGltZVNpZ25hdHVyZXMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpbWVTaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG1lc3NhZ2Uua2V5U2lnbmF0dXJlcyAmJiBtZXNzYWdlLmtleVNpZ25hdHVyZXMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleVNpZ25hdHVyZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5U2lnbmF0dXJlcy5wdXNoKCRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG1lc3NhZ2UudGVtcG9zICYmIG1lc3NhZ2UudGVtcG9zLmxlbmd0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50ZW1wb3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGVtcG9zLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wby5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLm5vdGVzICYmIG1lc3NhZ2Uubm90ZXMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm5vdGVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm5vdGVzLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudG90YWxUaW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSAkdXRpbC5Mb25nP3JlYWRlci5pbnQ2NCgpLnRvTnVtYmVyKCk6cmVhZGVyLmludDY0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG1lc3NhZ2UucGl0Y2hCZW5kcyAmJiBtZXNzYWdlLnBpdGNoQmVuZHMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBpdGNoQmVuZHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hCZW5kcy5wdXNoKCRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzICYmIG1lc3NhZ2UuY29udHJvbENoYW5nZXMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLnBhcnRJbmZvcyAmJiBtZXNzYWdlLnBhcnRJbmZvcy5sZW5ndGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFydEluZm9zID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcnRJbmZvcy5wdXNoKCRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm8uZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc291cmNlSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLnRleHRBbm5vdGF0aW9ucyAmJiBtZXNzYWdlLnRleHRBbm5vdGF0aW9ucy5sZW5ndGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGV4dEFubm90YXRpb25zID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRleHRBbm5vdGF0aW9ucy5wdXNoKCRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24uZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zICYmIG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zLmxlbmd0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9uQW5ub3RhdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbi5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEobWVzc2FnZS5zZWN0aW9uR3JvdXBzICYmIG1lc3NhZ2Uuc2VjdGlvbkdyb3Vwcy5sZW5ndGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkdyb3VwcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9uR3JvdXBzLnB1c2goJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemF0aW9uSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mby5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VxdWVuY2VNZXRhZGF0YSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBEZWNvZGVzIGEgTm90ZVNlcXVlbmNlIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIsIGxlbmd0aCBkZWxpbWl0ZWQuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZX0gTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVmVyaWZpZXMgYSBOb3RlU2VxdWVuY2UgbWVzc2FnZS5cbiAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBtZXNzYWdlIFBsYWluIG9iamVjdCB0byB2ZXJpZnlcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLmlkKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImlkOiBzdHJpbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5maWxlbmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJmaWxlbmFtZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLmZpbGVuYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImZpbGVuYW1lOiBzdHJpbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5yZWZlcmVuY2VOdW1iZXIgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicmVmZXJlbmNlTnVtYmVyXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnJlZmVyZW5jZU51bWJlcikgJiYgIShtZXNzYWdlLnJlZmVyZW5jZU51bWJlciAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5yZWZlcmVuY2VOdW1iZXIubG93KSAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5yZWZlcmVuY2VOdW1iZXIuaGlnaCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicmVmZXJlbmNlTnVtYmVyOiBpbnRlZ2VyfExvbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb2xsZWN0aW9uTmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJjb2xsZWN0aW9uTmFtZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLmNvbGxlY3Rpb25OYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImNvbGxlY3Rpb25OYW1lOiBzdHJpbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aWNrc1BlclF1YXJ0ZXIgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGlja3NQZXJRdWFydGVyXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnRpY2tzUGVyUXVhcnRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0aWNrc1BlclF1YXJ0ZXI6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lU2lnbmF0dXJlcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lU2lnbmF0dXJlc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS50aW1lU2lnbmF0dXJlcykpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0aW1lU2lnbmF0dXJlczogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmUudmVyaWZ5KG1lc3NhZ2UudGltZVNpZ25hdHVyZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRpbWVTaWduYXR1cmVzLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uua2V5U2lnbmF0dXJlcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJrZXlTaWduYXR1cmVzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShtZXNzYWdlLmtleVNpZ25hdHVyZXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwia2V5U2lnbmF0dXJlczogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLmtleVNpZ25hdHVyZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlLnZlcmlmeShtZXNzYWdlLmtleVNpZ25hdHVyZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImtleVNpZ25hdHVyZXMuXCIgKyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50ZW1wb3MgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGVtcG9zXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShtZXNzYWdlLnRlbXBvcykpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0ZW1wb3M6IGFycmF5IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS50ZW1wb3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG8udmVyaWZ5KG1lc3NhZ2UudGVtcG9zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0ZW1wb3MuXCIgKyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5ub3RlcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJub3Rlc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS5ub3RlcykpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJub3RlczogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLm5vdGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGUudmVyaWZ5KG1lc3NhZ2Uubm90ZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm5vdGVzLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG90YWxUaW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRvdGFsVGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLnRvdGFsVGltZSAhPT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRvdGFsVGltZTogbnVtYmVyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0b3RhbFF1YW50aXplZFN0ZXBzXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMpICYmICEobWVzc2FnZS50b3RhbFF1YW50aXplZFN0ZXBzICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMubG93KSAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS50b3RhbFF1YW50aXplZFN0ZXBzLmhpZ2gpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRvdGFsUXVhbnRpemVkU3RlcHM6IGludGVnZXJ8TG9uZyBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBpdGNoQmVuZHMgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicGl0Y2hCZW5kc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS5waXRjaEJlbmRzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBpdGNoQmVuZHM6IGFycmF5IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5waXRjaEJlbmRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZC52ZXJpZnkobWVzc2FnZS5waXRjaEJlbmRzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJwaXRjaEJlbmRzLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY29udHJvbENoYW5nZXMgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbENoYW5nZXNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG1lc3NhZ2UuY29udHJvbENoYW5nZXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29udHJvbENoYW5nZXM6IGFycmF5IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5jb250cm9sQ2hhbmdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLnZlcmlmeShtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJjb250cm9sQ2hhbmdlcy5cIiArIGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBhcnRJbmZvcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwYXJ0SW5mb3NcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG1lc3NhZ2UucGFydEluZm9zKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBhcnRJbmZvczogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnBhcnRJbmZvcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mby52ZXJpZnkobWVzc2FnZS5wYXJ0SW5mb3NbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBhcnRJbmZvcy5cIiArIGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNvdXJjZUluZm8gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic291cmNlSW5mb1wiKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8udmVyaWZ5KG1lc3NhZ2Uuc291cmNlSW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInNvdXJjZUluZm8uXCIgKyBlcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGV4dEFubm90YXRpb25zICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRleHRBbm5vdGF0aW9uc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS50ZXh0QW5ub3RhdGlvbnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGV4dEFubm90YXRpb25zOiBhcnJheSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2UudGV4dEFubm90YXRpb25zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uLnZlcmlmeShtZXNzYWdlLnRleHRBbm5vdGF0aW9uc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGV4dEFubm90YXRpb25zLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInNlY3Rpb25Bbm5vdGF0aW9uc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS5zZWN0aW9uQW5ub3RhdGlvbnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VjdGlvbkFubm90YXRpb25zOiBhcnJheSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9uLnZlcmlmeShtZXNzYWdlLnNlY3Rpb25Bbm5vdGF0aW9uc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VjdGlvbkFubm90YXRpb25zLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc2VjdGlvbkdyb3VwcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uR3JvdXBzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShtZXNzYWdlLnNlY3Rpb25Hcm91cHMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VjdGlvbkdyb3VwczogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnNlY3Rpb25Hcm91cHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwLnZlcmlmeShtZXNzYWdlLnNlY3Rpb25Hcm91cHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInNlY3Rpb25Hcm91cHMuXCIgKyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6YXRpb25JbmZvICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXphdGlvbkluZm9cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5RdWFudGl6YXRpb25JbmZvLnZlcmlmeShtZXNzYWdlLnF1YW50aXphdGlvbkluZm8pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJxdWFudGl6YXRpb25JbmZvLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdWJzZXF1ZW5jZUluZm9cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm8udmVyaWZ5KG1lc3NhZ2Uuc3Vic2VxdWVuY2VJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic3Vic2VxdWVuY2VJbmZvLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlcXVlbmNlTWV0YWRhdGEgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VxdWVuY2VNZXRhZGF0YVwiKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YS52ZXJpZnkobWVzc2FnZS5zZXF1ZW5jZU1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VxdWVuY2VNZXRhZGF0YS5cIiArIGVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ3JlYXRlcyBhIE5vdGVTZXF1ZW5jZSBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZnJvbU9iamVjdFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG9iamVjdCBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlfSBOb3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UoKTtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LmlkICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaWQgPSBTdHJpbmcob2JqZWN0LmlkKTtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LmZpbGVuYW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZmlsZW5hbWUgPSBTdHJpbmcob2JqZWN0LmZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnJlZmVyZW5jZU51bWJlciAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgIChtZXNzYWdlLnJlZmVyZW5jZU51bWJlciA9ICR1dGlsLkxvbmcuZnJvbVZhbHVlKG9iamVjdC5yZWZlcmVuY2VOdW1iZXIpKS51bnNpZ25lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnJlZmVyZW5jZU51bWJlciA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyID0gcGFyc2VJbnQob2JqZWN0LnJlZmVyZW5jZU51bWJlciwgMTApO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnJlZmVyZW5jZU51bWJlciA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyID0gb2JqZWN0LnJlZmVyZW5jZU51bWJlcjtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5yZWZlcmVuY2VOdW1iZXIgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnJlZmVyZW5jZU51bWJlciA9IG5ldyAkdXRpbC5Mb25nQml0cyhvYmplY3QucmVmZXJlbmNlTnVtYmVyLmxvdyA+Pj4gMCwgb2JqZWN0LnJlZmVyZW5jZU51bWJlci5oaWdoID4+PiAwKS50b051bWJlcigpO1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QuY29sbGVjdGlvbk5hbWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb2xsZWN0aW9uTmFtZSA9IFN0cmluZyhvYmplY3QuY29sbGVjdGlvbk5hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QudGlja3NQZXJRdWFydGVyICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGlja3NQZXJRdWFydGVyID0gb2JqZWN0LnRpY2tzUGVyUXVhcnRlciB8IDA7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC50aW1lU2lnbmF0dXJlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnRpbWVTaWduYXR1cmVzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnRpbWVTaWduYXR1cmVzOiBhcnJheSBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lU2lnbmF0dXJlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC50aW1lU2lnbmF0dXJlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmplY3QudGltZVNpZ25hdHVyZXNbaV0gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UudGltZVNpZ25hdHVyZXM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGltZVNpZ25hdHVyZXNbaV0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmUuZnJvbU9iamVjdChvYmplY3QudGltZVNpZ25hdHVyZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3Qua2V5U2lnbmF0dXJlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LmtleVNpZ25hdHVyZXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2Uua2V5U2lnbmF0dXJlczogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5U2lnbmF0dXJlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5rZXlTaWduYXR1cmVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5rZXlTaWduYXR1cmVzW2ldICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLmtleVNpZ25hdHVyZXM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5U2lnbmF0dXJlc1tpXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlLmZyb21PYmplY3Qob2JqZWN0LmtleVNpZ25hdHVyZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QudGVtcG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvYmplY3QudGVtcG9zKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnRlbXBvczogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGVtcG9zID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqZWN0LnRlbXBvcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmplY3QudGVtcG9zW2ldICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnRlbXBvczogb2JqZWN0IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50ZW1wb3NbaV0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvLmZyb21PYmplY3Qob2JqZWN0LnRlbXBvc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5ub3Rlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0Lm5vdGVzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLm5vdGVzOiBhcnJheSBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5ub3RlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5ub3Rlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmplY3Qubm90ZXNbaV0gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2Uubm90ZXM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uubm90ZXNbaV0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGUuZnJvbU9iamVjdChvYmplY3Qubm90ZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QudG90YWxUaW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudG90YWxUaW1lID0gTnVtYmVyKG9iamVjdC50b3RhbFRpbWUpO1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcyAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgIChtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSAkdXRpbC5Mb25nLmZyb21WYWx1ZShvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcykpLnVuc2lnbmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcyA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IHBhcnNlSW50KG9iamVjdC50b3RhbFF1YW50aXplZFN0ZXBzLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcyA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcyA9IG9iamVjdC50b3RhbFF1YW50aXplZFN0ZXBzO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnRvdGFsUXVhbnRpemVkU3RlcHMgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMgPSBuZXcgJHV0aWwuTG9uZ0JpdHMob2JqZWN0LnRvdGFsUXVhbnRpemVkU3RlcHMubG93ID4+PiAwLCBvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcy5oaWdoID4+PiAwKS50b051bWJlcigpO1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QucGl0Y2hCZW5kcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnBpdGNoQmVuZHMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UucGl0Y2hCZW5kczogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hCZW5kcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5waXRjaEJlbmRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5waXRjaEJlbmRzW2ldICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnBpdGNoQmVuZHM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hCZW5kc1tpXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kLmZyb21PYmplY3Qob2JqZWN0LnBpdGNoQmVuZHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QuY29udHJvbENoYW5nZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9iamVjdC5jb250cm9sQ2hhbmdlcykpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5jb250cm9sQ2hhbmdlczogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29udHJvbENoYW5nZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmplY3QuY29udHJvbENoYW5nZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0LmNvbnRyb2xDaGFuZ2VzW2ldICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLmNvbnRyb2xDaGFuZ2VzOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzW2ldID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLmZyb21PYmplY3Qob2JqZWN0LmNvbnRyb2xDaGFuZ2VzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnBhcnRJbmZvcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnBhcnRJbmZvcykpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5wYXJ0SW5mb3M6IGFycmF5IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcnRJbmZvcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5wYXJ0SW5mb3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0LnBhcnRJbmZvc1tpXSAhPT0gXCJvYmplY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5wYXJ0SW5mb3M6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFydEluZm9zW2ldID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mby5mcm9tT2JqZWN0KG9iamVjdC5wYXJ0SW5mb3NbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3Quc291cmNlSW5mbyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0LnNvdXJjZUluZm8gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5zb3VyY2VJbmZvOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc291cmNlSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5mcm9tT2JqZWN0KG9iamVjdC5zb3VyY2VJbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC50ZXh0QW5ub3RhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9iamVjdC50ZXh0QW5ub3RhdGlvbnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UudGV4dEFubm90YXRpb25zOiBhcnJheSBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50ZXh0QW5ub3RhdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmplY3QudGV4dEFubm90YXRpb25zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC50ZXh0QW5ub3RhdGlvbnNbaV0gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UudGV4dEFubm90YXRpb25zOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRleHRBbm5vdGF0aW9uc1tpXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24uZnJvbU9iamVjdChvYmplY3QudGV4dEFubm90YXRpb25zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnNlY3Rpb25Bbm5vdGF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnNlY3Rpb25Bbm5vdGF0aW9ucykpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5zZWN0aW9uQW5ub3RhdGlvbnM6IGFycmF5IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnNlY3Rpb25Bbm5vdGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5zZWN0aW9uQW5ub3RhdGlvbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0LnNlY3Rpb25Bbm5vdGF0aW9uc1tpXSAhPT0gXCJvYmplY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5zZWN0aW9uQW5ub3RhdGlvbnM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zW2ldID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbi5mcm9tT2JqZWN0KG9iamVjdC5zZWN0aW9uQW5ub3RhdGlvbnNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3Quc2VjdGlvbkdyb3Vwcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnNlY3Rpb25Hcm91cHMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2Uuc2VjdGlvbkdyb3VwczogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkdyb3VwcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5zZWN0aW9uR3JvdXBzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5zZWN0aW9uR3JvdXBzW2ldICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLnNlY3Rpb25Hcm91cHM6IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkdyb3Vwc1tpXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwLmZyb21PYmplY3Qob2JqZWN0LnNlY3Rpb25Hcm91cHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QucXVhbnRpemF0aW9uSW5mbyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXphdGlvbkluZm8gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5xdWFudGl6YXRpb25JbmZvOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemF0aW9uSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mby5mcm9tT2JqZWN0KG9iamVjdC5xdWFudGl6YXRpb25JbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5zdWJzZXF1ZW5jZUluZm8gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5zdWJzZXF1ZW5jZUluZm8gIT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5zdWJzZXF1ZW5jZUluZm86IG9iamVjdCBleHBlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zdWJzZXF1ZW5jZUluZm8gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlN1YnNlcXVlbmNlSW5mby5mcm9tT2JqZWN0KG9iamVjdC5zdWJzZXF1ZW5jZUluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnNlcXVlbmNlTWV0YWRhdGEgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5zZXF1ZW5jZU1ldGFkYXRhICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2Uuc2VxdWVuY2VNZXRhZGF0YTogb2JqZWN0IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnNlcXVlbmNlTWV0YWRhdGEgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YS5mcm9tT2JqZWN0KG9iamVjdC5zZXF1ZW5jZU1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIE5vdGVTZXF1ZW5jZSBtZXNzYWdlLiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byBvdGhlciB0eXBlcyBpZiBzcGVjaWZpZWQuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2V9IG1lc3NhZ2UgTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXJyYXlzIHx8IG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWVTaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5rZXlTaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC50ZW1wb3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm5vdGVzID0gW107XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5waXRjaEJlbmRzID0gW107XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5jb250cm9sQ2hhbmdlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QucGFydEluZm9zID0gW107XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC50ZXh0QW5ub3RhdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25Bbm5vdGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VjdGlvbkdyb3VwcyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuaWQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuZmlsZW5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuY29sbGVjdGlvbk5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QudGlja3NQZXJRdWFydGVyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRvdGFsVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zb3VyY2VJbmZvID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXphdGlvbkluZm8gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvbmcgPSBuZXcgJHV0aWwuTG9uZygwLCAwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudG90YWxRdWFudGl6ZWRTdGVwcyA9IG9wdGlvbnMubG9uZ3MgPT09IFN0cmluZyA/IGxvbmcudG9TdHJpbmcoKSA6IG9wdGlvbnMubG9uZ3MgPT09IE51bWJlciA/IGxvbmcudG9OdW1iZXIoKSA6IGxvbmc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRvdGFsUXVhbnRpemVkU3RlcHMgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBcIjBcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zdWJzZXF1ZW5jZUluZm8gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvbmcgPSBuZXcgJHV0aWwuTG9uZygwLCAwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucmVmZXJlbmNlTnVtYmVyID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gbG9uZy50b1N0cmluZygpIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbG9uZy50b051bWJlcigpIDogbG9uZztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucmVmZXJlbmNlTnVtYmVyID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gXCIwXCIgOiAwO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VxdWVuY2VNZXRhZGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmlkICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImlkXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QuaWQgPSBtZXNzYWdlLmlkO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmZpbGVuYW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImZpbGVuYW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QuZmlsZW5hbWUgPSBtZXNzYWdlLmZpbGVuYW1lO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbGxlY3Rpb25OYW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImNvbGxlY3Rpb25OYW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QuY29sbGVjdGlvbk5hbWUgPSBtZXNzYWdlLmNvbGxlY3Rpb25OYW1lO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpY2tzUGVyUXVhcnRlciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aWNrc1BlclF1YXJ0ZXJcIikpXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC50aWNrc1BlclF1YXJ0ZXIgPSBtZXNzYWdlLnRpY2tzUGVyUXVhcnRlcjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lU2lnbmF0dXJlcyAmJiBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QudGltZVNpZ25hdHVyZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLnRpbWVTaWduYXR1cmVzLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWVTaWduYXR1cmVzW2pdID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlLnRvT2JqZWN0KG1lc3NhZ2UudGltZVNpZ25hdHVyZXNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5rZXlTaWduYXR1cmVzICYmIG1lc3NhZ2Uua2V5U2lnbmF0dXJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmtleVNpZ25hdHVyZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLmtleVNpZ25hdHVyZXMubGVuZ3RoOyArK2opXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Qua2V5U2lnbmF0dXJlc1tqXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlLnRvT2JqZWN0KG1lc3NhZ2Uua2V5U2lnbmF0dXJlc1tqXSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRlbXBvcyAmJiBtZXNzYWdlLnRlbXBvcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRlbXBvcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2UudGVtcG9zLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRlbXBvc1tqXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG8udG9PYmplY3QobWVzc2FnZS50ZW1wb3Nbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5ub3RlcyAmJiBtZXNzYWdlLm5vdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3Qubm90ZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLm5vdGVzLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm5vdGVzW2pdID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlLnRvT2JqZWN0KG1lc3NhZ2Uubm90ZXNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3RhbFRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidG90YWxUaW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QudG90YWxUaW1lID0gb3B0aW9ucy5qc29uICYmICFpc0Zpbml0ZShtZXNzYWdlLnRvdGFsVGltZSkgPyBTdHJpbmcobWVzc2FnZS50b3RhbFRpbWUpIDogbWVzc2FnZS50b3RhbFRpbWU7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGl0Y2hCZW5kcyAmJiBtZXNzYWdlLnBpdGNoQmVuZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5waXRjaEJlbmRzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWVzc2FnZS5waXRjaEJlbmRzLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnBpdGNoQmVuZHNbal0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZC50b09iamVjdChtZXNzYWdlLnBpdGNoQmVuZHNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb250cm9sQ2hhbmdlcyAmJiBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuY29udHJvbENoYW5nZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLmNvbnRyb2xDaGFuZ2VzLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmNvbnRyb2xDaGFuZ2VzW2pdID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLnRvT2JqZWN0KG1lc3NhZ2UuY29udHJvbENoYW5nZXNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wYXJ0SW5mb3MgJiYgbWVzc2FnZS5wYXJ0SW5mb3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5wYXJ0SW5mb3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLnBhcnRJbmZvcy5sZW5ndGg7ICsrailcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5wYXJ0SW5mb3Nbal0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvLnRvT2JqZWN0KG1lc3NhZ2UucGFydEluZm9zW2pdLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc291cmNlSW5mbyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzb3VyY2VJbmZvXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3Quc291cmNlSW5mbyA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby50b09iamVjdChtZXNzYWdlLnNvdXJjZUluZm8sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRleHRBbm5vdGF0aW9ucyAmJiBtZXNzYWdlLnRleHRBbm5vdGF0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRleHRBbm5vdGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2UudGV4dEFubm90YXRpb25zLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRleHRBbm5vdGF0aW9uc1tqXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24udG9PYmplY3QobWVzc2FnZS50ZXh0QW5ub3RhdGlvbnNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6YXRpb25JbmZvICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXphdGlvbkluZm9cIikpXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6YXRpb25JbmZvID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5RdWFudGl6YXRpb25JbmZvLnRvT2JqZWN0KG1lc3NhZ2UucXVhbnRpemF0aW9uSW5mbywgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0b3RhbFF1YW50aXplZFN0ZXBzXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcyA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50b3RhbFF1YW50aXplZFN0ZXBzID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gU3RyaW5nKG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcykgOiBtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHM7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50b3RhbFF1YW50aXplZFN0ZXBzID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gJHV0aWwuTG9uZy5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtZXNzYWdlLnRvdGFsUXVhbnRpemVkU3RlcHMpIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbmV3ICR1dGlsLkxvbmdCaXRzKG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcy5sb3cgPj4+IDAsIG1lc3NhZ2UudG90YWxRdWFudGl6ZWRTdGVwcy5oaWdoID4+PiAwKS50b051bWJlcigpIDogbWVzc2FnZS50b3RhbFF1YW50aXplZFN0ZXBzO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdWJzZXF1ZW5jZUluZm9cIikpXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zdWJzZXF1ZW5jZUluZm8gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlN1YnNlcXVlbmNlSW5mby50b09iamVjdChtZXNzYWdlLnN1YnNlcXVlbmNlSW5mbywgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInJlZmVyZW5jZU51bWJlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLnJlZmVyZW5jZU51bWJlciA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5yZWZlcmVuY2VOdW1iZXIgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBTdHJpbmcobWVzc2FnZS5yZWZlcmVuY2VOdW1iZXIpIDogbWVzc2FnZS5yZWZlcmVuY2VOdW1iZXI7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5yZWZlcmVuY2VOdW1iZXIgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyAkdXRpbC5Mb25nLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyKSA6IG9wdGlvbnMubG9uZ3MgPT09IE51bWJlciA/IG5ldyAkdXRpbC5Mb25nQml0cyhtZXNzYWdlLnJlZmVyZW5jZU51bWJlci5sb3cgPj4+IDAsIG1lc3NhZ2UucmVmZXJlbmNlTnVtYmVyLmhpZ2ggPj4+IDApLnRvTnVtYmVyKCkgOiBtZXNzYWdlLnJlZmVyZW5jZU51bWJlcjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZXF1ZW5jZU1ldGFkYXRhICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInNlcXVlbmNlTWV0YWRhdGFcIikpXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZXF1ZW5jZU1ldGFkYXRhID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGEudG9PYmplY3QobWVzc2FnZS5zZXF1ZW5jZU1ldGFkYXRhLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uQW5ub3RhdGlvbnMgJiYgbWVzc2FnZS5zZWN0aW9uQW5ub3RhdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uQW5ub3RhdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLnNlY3Rpb25Bbm5vdGF0aW9ucy5sZW5ndGg7ICsrailcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uQW5ub3RhdGlvbnNbal0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9uLnRvT2JqZWN0KG1lc3NhZ2Uuc2VjdGlvbkFubm90YXRpb25zW2pdLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc2VjdGlvbkdyb3VwcyAmJiBtZXNzYWdlLnNlY3Rpb25Hcm91cHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uR3JvdXBzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWVzc2FnZS5zZWN0aW9uR3JvdXBzLmxlbmd0aDsgKytqKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25Hcm91cHNbal0gPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cC50b09iamVjdChtZXNzYWdlLnNlY3Rpb25Hcm91cHNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIE5vdGVTZXF1ZW5jZSB0byBKU09OLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvSlNPTlxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5Ob3RlID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIE5vdGUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAaW50ZXJmYWNlIElOb3RlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3BpdGNoXSBOb3RlIHBpdGNoXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoTmFtZXxudWxsfSBbcGl0Y2hOYW1lXSBOb3RlIHBpdGNoTmFtZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFt2ZWxvY2l0eV0gTm90ZSB2ZWxvY2l0eVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtzdGFydFRpbWVdIE5vdGUgc3RhcnRUaW1lXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3F1YW50aXplZFN0YXJ0U3RlcF0gTm90ZSBxdWFudGl6ZWRTdGFydFN0ZXBcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbZW5kVGltZV0gTm90ZSBlbmRUaW1lXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3F1YW50aXplZEVuZFN0ZXBdIE5vdGUgcXVhbnRpemVkRW5kU3RlcFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtudW1lcmF0b3JdIE5vdGUgbnVtZXJhdG9yXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2Rlbm9taW5hdG9yXSBOb3RlIGRlbm9taW5hdG9yXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2luc3RydW1lbnRdIE5vdGUgaW5zdHJ1bWVudFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtwcm9ncmFtXSBOb3RlIHByb2dyYW1cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW58bnVsbH0gW2lzRHJ1bV0gTm90ZSBpc0RydW1cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbcGFydF0gTm90ZSBwYXJ0XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3ZvaWNlXSBOb3RlIHZvaWNlXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IE5vdGUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBOb3RlLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElOb3RlXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklOb3RlPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gTm90ZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBwaXRjaC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHBpdGNoXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLnBpdGNoID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIE5vdGUgcGl0Y2hOYW1lLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hOYW1lfSBwaXRjaE5hbWVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS5wcm90b3R5cGUucGl0Y2hOYW1lID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIE5vdGUgdmVsb2NpdHkuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSB2ZWxvY2l0eVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS52ZWxvY2l0eSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBOb3RlIHN0YXJ0VGltZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHN0YXJ0VGltZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS5zdGFydFRpbWUgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBxdWFudGl6ZWRTdGFydFN0ZXAuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBxdWFudGl6ZWRTdGFydFN0ZXBcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS5wcm90b3R5cGUucXVhbnRpemVkU3RhcnRTdGVwID0gJHV0aWwuTG9uZyA/ICR1dGlsLkxvbmcuZnJvbUJpdHMoMCwwLGZhbHNlKSA6IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBOb3RlIGVuZFRpbWUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBlbmRUaW1lXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLmVuZFRpbWUgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBxdWFudGl6ZWRFbmRTdGVwLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gcXVhbnRpemVkRW5kU3RlcFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS5xdWFudGl6ZWRFbmRTdGVwID0gJHV0aWwuTG9uZyA/ICR1dGlsLkxvbmcuZnJvbUJpdHMoMCwwLGZhbHNlKSA6IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBOb3RlIG51bWVyYXRvci5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IG51bWVyYXRvclxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS5udW1lcmF0b3IgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBkZW5vbWluYXRvci5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IGRlbm9taW5hdG9yXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLmRlbm9taW5hdG9yID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIE5vdGUgaW5zdHJ1bWVudC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IGluc3RydW1lbnRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS5wcm90b3R5cGUuaW5zdHJ1bWVudCA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBOb3RlIHByb2dyYW0uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBwcm9ncmFtXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLnByb2dyYW0gPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBpc0RydW0uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7Ym9vbGVhbn0gaXNEcnVtXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLmlzRHJ1bSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTm90ZSBwYXJ0LlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gcGFydFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS5wYXJ0ID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIE5vdGUgdm9pY2UuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSB2b2ljZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnByb3RvdHlwZS52b2ljZSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IE5vdGUgaW5zdGFuY2UgdXNpbmcgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JTm90ZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGV9IE5vdGUgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm90ZShwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIE5vdGUgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JTm90ZX0gbWVzc2FnZSBOb3RlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLmVuY29kZSA9IGZ1bmN0aW9uIGVuY29kZShtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSAkV3JpdGVyLmNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5waXRjaCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwaXRjaFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMCA9Ki84KS5pbnQzMihtZXNzYWdlLnBpdGNoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudmVsb2NpdHkgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidmVsb2NpdHlcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDAgPSovMTYpLmludDMyKG1lc3NhZ2UudmVsb2NpdHkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGFydFRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic3RhcnRUaW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAzLCB3aXJlVHlwZSAxID0qLzI1KS5kb3VibGUobWVzc2FnZS5zdGFydFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5lbmRUaW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImVuZFRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDQsIHdpcmVUeXBlIDEgPSovMzMpLmRvdWJsZShtZXNzYWdlLmVuZFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5udW1lcmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtZXJhdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA1LCB3aXJlVHlwZSAwID0qLzQwKS5pbnQzMihtZXNzYWdlLm51bWVyYXRvcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRlbm9taW5hdG9yICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImRlbm9taW5hdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA2LCB3aXJlVHlwZSAwID0qLzQ4KS5pbnQzMihtZXNzYWdlLmRlbm9taW5hdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaW5zdHJ1bWVudCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpbnN0cnVtZW50XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA3LCB3aXJlVHlwZSAwID0qLzU2KS5pbnQzMihtZXNzYWdlLmluc3RydW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wcm9ncmFtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInByb2dyYW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDgsIHdpcmVUeXBlIDAgPSovNjQpLmludDMyKG1lc3NhZ2UucHJvZ3JhbSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmlzRHJ1bSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpc0RydW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDksIHdpcmVUeXBlIDAgPSovNzIpLmJvb2wobWVzc2FnZS5pc0RydW0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wYXJ0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEwLCB3aXJlVHlwZSAwID0qLzgwKS5pbnQzMihtZXNzYWdlLnBhcnQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5waXRjaE5hbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicGl0Y2hOYW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxMSwgd2lyZVR5cGUgMCA9Ki84OCkuaW50MzIobWVzc2FnZS5waXRjaE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS52b2ljZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ2b2ljZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMTIsIHdpcmVUeXBlIDAgPSovOTYpLmludDMyKG1lc3NhZ2Uudm9pY2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXVhbnRpemVkU3RhcnRTdGVwXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxMywgd2lyZVR5cGUgMCA9Ki8xMDQpLmludDY0KG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJxdWFudGl6ZWRFbmRTdGVwXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxNCwgd2lyZVR5cGUgMCA9Ki8xMTIpLmludDY0KG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZXI7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBOb3RlIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZS52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSU5vdGV9IG1lc3NhZ2UgTm90ZSBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuY29kZShtZXNzYWdlLCB3cml0ZXIpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgTm90ZSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZX0gTm90ZVxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSByZWFkZXIudWludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZyA+Pj4gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2ggPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnZlbG9jaXR5ID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zdGFydFRpbWUgPSByZWFkZXIuZG91YmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwID0gJHV0aWwuTG9uZz9yZWFkZXIuaW50NjQoKS50b051bWJlcigpOnJlYWRlci5pbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZW5kVGltZSA9IHJlYWRlci5kb3VibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRFbmRTdGVwID0gJHV0aWwuTG9uZz9yZWFkZXIuaW50NjQoKS50b051bWJlcigpOnJlYWRlci5pbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubnVtZXJhdG9yID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kZW5vbWluYXRvciA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW5zdHJ1bWVudCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucHJvZ3JhbSA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNEcnVtID0gcmVhZGVyLmJvb2woKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJ0ID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uudm9pY2UgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnNraXBUeXBlKHRhZyAmIDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgTm90ZSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGV9IE5vdGVcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUuZGVjb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkKHJlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFZlcmlmaWVzIGEgTm90ZSBtZXNzYWdlLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgTm90ZS52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwib2JqZWN0XCIgfHwgbWVzc2FnZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5waXRjaCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwaXRjaFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UucGl0Y2gpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBpdGNoOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBpdGNoTmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwaXRjaE5hbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UucGl0Y2hOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBpdGNoTmFtZTogZW51bSB2YWx1ZSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjM6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjY6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyODpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjk6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDMzOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnZlbG9jaXR5ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInZlbG9jaXR5XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS52ZWxvY2l0eSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidmVsb2NpdHk6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RhcnRUaW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInN0YXJ0VGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5zdGFydFRpbWUgIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic3RhcnRUaW1lOiBudW1iZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXplZFN0YXJ0U3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwKSAmJiAhKG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcC5sb3cpICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcC5oaWdoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicXVhbnRpemVkU3RhcnRTdGVwOiBpbnRlZ2VyfExvbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZW5kVGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJlbmRUaW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLmVuZFRpbWUgIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZW5kVGltZTogbnVtYmVyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXVhbnRpemVkRW5kU3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcCkgJiYgIShtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgJiYgJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcC5sb3cpICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAuaGlnaCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInF1YW50aXplZEVuZFN0ZXA6IGludGVnZXJ8TG9uZyBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5udW1lcmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtZXJhdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5udW1lcmF0b3IpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm51bWVyYXRvcjogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kZW5vbWluYXRvciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJkZW5vbWluYXRvclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UuZGVub21pbmF0b3IpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImRlbm9taW5hdG9yOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmluc3RydW1lbnQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaW5zdHJ1bWVudFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UuaW5zdHJ1bWVudCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaW5zdHJ1bWVudDogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wcm9ncmFtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInByb2dyYW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnByb2dyYW0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInByb2dyYW06IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaXNEcnVtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImlzRHJ1bVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5pc0RydW0gIT09IFwiYm9vbGVhblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImlzRHJ1bTogYm9vbGVhbiBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wYXJ0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnBhcnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInBhcnQ6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uudm9pY2UgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidm9pY2VcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnZvaWNlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ2b2ljZTogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIE5vdGUgbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBmcm9tT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBvYmplY3QgUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZX0gTm90ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLk5vdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5waXRjaCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaCA9IG9iamVjdC5waXRjaCB8IDA7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAob2JqZWN0LnBpdGNoTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVU5LTk9XTl9QSVRDSF9OQU1FXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hOYW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRl9GTEFUX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDX0ZMQVRfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBpdGNoTmFtZSA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkdfRkxBVF9GTEFUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hOYW1lID0gMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRF9GTEFUX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBX0ZMQVRfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBpdGNoTmFtZSA9IDU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkVfRkxBVF9GTEFUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hOYW1lID0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQl9GTEFUX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSA3O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJGX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSA4O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSA5O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJHX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hOYW1lID0gMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDExOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQV9GTEFUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBpdGNoTmFtZSA9IDEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGl0Y2hOYW1lID0gMTM7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ1wiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiR1wiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxNztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxODtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAxOTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQlwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRl9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDIyOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ19TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDIzOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiR19TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQV9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI2OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRV9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyNztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQl9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI4OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyODtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRl9TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI5OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAyOTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ19TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiR19TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRF9TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDMyOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQV9TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDMzOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRV9TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQl9TSEFSUF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5waXRjaE5hbWUgPSAzNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QudmVsb2NpdHkgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudmVsb2NpdHkgPSBvYmplY3QudmVsb2NpdHkgfCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnN0YXJ0VGltZSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zdGFydFRpbWUgPSBOdW1iZXIob2JqZWN0LnN0YXJ0VGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAgPSAkdXRpbC5Mb25nLmZyb21WYWx1ZShvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwKSkudW5zaWduZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwID0gcGFyc2VJbnQob2JqZWN0LnF1YW50aXplZFN0YXJ0U3RlcCwgMTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5xdWFudGl6ZWRTdGFydFN0ZXAgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAgPSBvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5xdWFudGl6ZWRTdGFydFN0ZXAgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAgPSBuZXcgJHV0aWwuTG9uZ0JpdHMob2JqZWN0LnF1YW50aXplZFN0YXJ0U3RlcC5sb3cgPj4+IDAsIG9iamVjdC5xdWFudGl6ZWRTdGFydFN0ZXAuaGlnaCA+Pj4gMCkudG9OdW1iZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5lbmRUaW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuZFRpbWUgPSBOdW1iZXIob2JqZWN0LmVuZFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnF1YW50aXplZEVuZFN0ZXAgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdXRpbC5Mb25nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgPSAkdXRpbC5Mb25nLmZyb21WYWx1ZShvYmplY3QucXVhbnRpemVkRW5kU3RlcCkpLnVuc2lnbmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXplZEVuZFN0ZXAgPT09IFwic3RyaW5nXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRFbmRTdGVwID0gcGFyc2VJbnQob2JqZWN0LnF1YW50aXplZEVuZFN0ZXAsIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3QucXVhbnRpemVkRW5kU3RlcCA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgPSBvYmplY3QucXVhbnRpemVkRW5kU3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3QucXVhbnRpemVkRW5kU3RlcCA9PT0gXCJvYmplY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgPSBuZXcgJHV0aWwuTG9uZ0JpdHMob2JqZWN0LnF1YW50aXplZEVuZFN0ZXAubG93ID4+PiAwLCBvYmplY3QucXVhbnRpemVkRW5kU3RlcC5oaWdoID4+PiAwKS50b051bWJlcigpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lm51bWVyYXRvciAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5udW1lcmF0b3IgPSBvYmplY3QubnVtZXJhdG9yIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5kZW5vbWluYXRvciAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kZW5vbWluYXRvciA9IG9iamVjdC5kZW5vbWluYXRvciB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QuaW5zdHJ1bWVudCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5pbnN0cnVtZW50ID0gb2JqZWN0Lmluc3RydW1lbnQgfCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnByb2dyYW0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucHJvZ3JhbSA9IG9iamVjdC5wcm9ncmFtIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5pc0RydW0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNEcnVtID0gQm9vbGVhbihvYmplY3QuaXNEcnVtKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5wYXJ0ICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcnQgPSBvYmplY3QucGFydCB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3Qudm9pY2UgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uudm9pY2UgPSBvYmplY3Qudm9pY2UgfCAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIHBsYWluIG9iamVjdCBmcm9tIGEgTm90ZSBtZXNzYWdlLiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byBvdGhlciB0eXBlcyBpZiBzcGVjaWZpZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuTm90ZX0gbWVzc2FnZSBOb3RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuSUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBOb3RlLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5waXRjaCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudmVsb2NpdHkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnN0YXJ0VGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZW5kVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubnVtZXJhdG9yID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5kZW5vbWluYXRvciA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaW5zdHJ1bWVudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucHJvZ3JhbSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaXNEcnVtID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucGl0Y2hOYW1lID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gXCJVTktOT1dOX1BJVENIX05BTUVcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Qudm9pY2UgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR1dGlsLkxvbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9uZyA9IG5ldyAkdXRpbC5Mb25nKDAsIDAsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gbG9uZy50b1N0cmluZygpIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbG9uZy50b051bWJlcigpIDogbG9uZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRTdGFydFN0ZXAgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBcIjBcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb25nID0gbmV3ICR1dGlsLkxvbmcoMCwgMCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRFbmRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gbG9uZy50b1N0cmluZygpIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbG9uZy50b051bWJlcigpIDogbG9uZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRFbmRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gXCIwXCIgOiAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBpdGNoICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBpdGNoXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnBpdGNoID0gbWVzc2FnZS5waXRjaDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudmVsb2NpdHkgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidmVsb2NpdHlcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudmVsb2NpdHkgPSBtZXNzYWdlLnZlbG9jaXR5O1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGFydFRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic3RhcnRUaW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnN0YXJ0VGltZSA9IG9wdGlvbnMuanNvbiAmJiAhaXNGaW5pdGUobWVzc2FnZS5zdGFydFRpbWUpID8gU3RyaW5nKG1lc3NhZ2Uuc3RhcnRUaW1lKSA6IG1lc3NhZ2Uuc3RhcnRUaW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5lbmRUaW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImVuZFRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZW5kVGltZSA9IG9wdGlvbnMuanNvbiAmJiAhaXNGaW5pdGUobWVzc2FnZS5lbmRUaW1lKSA/IFN0cmluZyhtZXNzYWdlLmVuZFRpbWUpIDogbWVzc2FnZS5lbmRUaW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5udW1lcmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtZXJhdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm51bWVyYXRvciA9IG1lc3NhZ2UubnVtZXJhdG9yO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kZW5vbWluYXRvciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJkZW5vbWluYXRvclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5kZW5vbWluYXRvciA9IG1lc3NhZ2UuZGVub21pbmF0b3I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmluc3RydW1lbnQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaW5zdHJ1bWVudFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5pbnN0cnVtZW50ID0gbWVzc2FnZS5pbnN0cnVtZW50O1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wcm9ncmFtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInByb2dyYW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucHJvZ3JhbSA9IG1lc3NhZ2UucHJvZ3JhbTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaXNEcnVtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImlzRHJ1bVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5pc0RydW0gPSBtZXNzYWdlLmlzRHJ1bTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGFydCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwYXJ0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnBhcnQgPSBtZXNzYWdlLnBhcnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBpdGNoTmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwaXRjaE5hbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucGl0Y2hOYW1lID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaE5hbWVbbWVzc2FnZS5waXRjaE5hbWVdIDogbWVzc2FnZS5waXRjaE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnZvaWNlICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInZvaWNlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnZvaWNlID0gbWVzc2FnZS52b2ljZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucXVhbnRpemVkU3RhcnRTdGVwICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXplZFN0YXJ0U3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXplZFN0YXJ0U3RlcCA9IG9wdGlvbnMubG9uZ3MgPT09IFN0cmluZyA/IFN0cmluZyhtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcCkgOiBtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucXVhbnRpemVkU3RhcnRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gJHV0aWwuTG9uZy5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBuZXcgJHV0aWwuTG9uZ0JpdHMobWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXAubG93ID4+PiAwLCBtZXNzYWdlLnF1YW50aXplZFN0YXJ0U3RlcC5oaWdoID4+PiAwKS50b051bWJlcigpIDogbWVzc2FnZS5xdWFudGl6ZWRTdGFydFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXVhbnRpemVkRW5kU3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5xdWFudGl6ZWRFbmRTdGVwID09PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRFbmRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gU3RyaW5nKG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcCkgOiBtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXplZEVuZFN0ZXAgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyAkdXRpbC5Mb25nLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1lc3NhZ2UucXVhbnRpemVkRW5kU3RlcCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBuZXcgJHV0aWwuTG9uZ0JpdHMobWVzc2FnZS5xdWFudGl6ZWRFbmRTdGVwLmxvdyA+Pj4gMCwgbWVzc2FnZS5xdWFudGl6ZWRFbmRTdGVwLmhpZ2ggPj4+IDApLnRvTnVtYmVyKCkgOiBtZXNzYWdlLnF1YW50aXplZEVuZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnZlcnRzIHRoaXMgTm90ZSB0byBKU09OLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b0pTT05cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Ob3RlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIE5vdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywgJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBOb3RlO1xuICAgICAgICAgICAgfSkoKTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBQaXRjaE5hbWUgZW51bS5cbiAgICAgICAgICAgICAqIEBuYW1lIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hOYW1lXG4gICAgICAgICAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFVOS05PV05fUElUQ0hfTkFNRT0wIFVOS05PV05fUElUQ0hfTkFNRSB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEZfRkxBVF9GTEFUPTEgRl9GTEFUX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBDX0ZMQVRfRkxBVD0yIENfRkxBVF9GTEFUIHZhbHVlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gR19GTEFUX0ZMQVQ9MyBHX0ZMQVRfRkxBVCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERfRkxBVF9GTEFUPTQgRF9GTEFUX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBBX0ZMQVRfRkxBVD01IEFfRkxBVF9GTEFUIHZhbHVlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRV9GTEFUX0ZMQVQ9NiBFX0ZMQVRfRkxBVCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEJfRkxBVF9GTEFUPTcgQl9GTEFUX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBGX0ZMQVQ9OCBGX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBDX0ZMQVQ9OSBDX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBHX0ZMQVQ9MTAgR19GTEFUIHZhbHVlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRF9GTEFUPTExIERfRkxBVCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEFfRkxBVD0xMiBBX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBFX0ZMQVQ9MTMgRV9GTEFUIHZhbHVlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gQl9GTEFUPTE0IEJfRkxBVCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEY9MTUgRiB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEM9MTYgQyB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEc9MTcgRyB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEQ9MTggRCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEE9MTkgQSB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEU9MjAgRSB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEI9MjEgQiB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEZfU0hBUlA9MjIgRl9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IENfU0hBUlA9MjMgQ19TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEdfU0hBUlA9MjQgR19TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERfU0hBUlA9MjUgRF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEFfU0hBUlA9MjYgQV9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEVfU0hBUlA9MjcgRV9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEJfU0hBUlA9MjggQl9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEZfU0hBUlBfU0hBUlA9MjkgRl9TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IENfU0hBUlBfU0hBUlA9MzAgQ19TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEdfU0hBUlBfU0hBUlA9MzEgR19TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERfU0hBUlBfU0hBUlA9MzIgRF9TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEFfU0hBUlBfU0hBUlA9MzMgQV9TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEVfU0hBUlBfU0hBUlA9MzQgRV9TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEJfU0hBUlBfU0hBUlA9MzUgQl9TSEFSUF9TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UuUGl0Y2hOYW1lID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZXNCeUlkID0ge30sIHZhbHVlcyA9IE9iamVjdC5jcmVhdGUodmFsdWVzQnlJZCk7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMF0gPSBcIlVOS05PV05fUElUQ0hfTkFNRVwiXSA9IDA7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMV0gPSBcIkZfRkxBVF9GTEFUXCJdID0gMTtcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsyXSA9IFwiQ19GTEFUX0ZMQVRcIl0gPSAyO1xuICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzNdID0gXCJHX0ZMQVRfRkxBVFwiXSA9IDM7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbNF0gPSBcIkRfRkxBVF9GTEFUXCJdID0gNDtcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs1XSA9IFwiQV9GTEFUX0ZMQVRcIl0gPSA1O1xuICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzZdID0gXCJFX0ZMQVRfRkxBVFwiXSA9IDY7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbN10gPSBcIkJfRkxBVF9GTEFUXCJdID0gNztcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs4XSA9IFwiRl9GTEFUXCJdID0gODtcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs5XSA9IFwiQ19GTEFUXCJdID0gOTtcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxMF0gPSBcIkdfRkxBVFwiXSA9IDEwO1xuICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzExXSA9IFwiRF9GTEFUXCJdID0gMTE7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMTJdID0gXCJBX0ZMQVRcIl0gPSAxMjtcbiAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxM10gPSBcIkVfRkxBVFwiXSA9IDEzO1xuICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzE0XSA9IFwiQl9GTEFUXCJdID0gMTQ7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMTVdID0gXCJGXCJdID0gMTU7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMTZdID0gXCJDXCJdID0gMTY7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMTddID0gXCJHXCJdID0gMTc7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMThdID0gXCJEXCJdID0gMTg7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMTldID0gXCJBXCJdID0gMTk7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjBdID0gXCJFXCJdID0gMjA7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjFdID0gXCJCXCJdID0gMjE7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjJdID0gXCJGX1NIQVJQXCJdID0gMjI7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjNdID0gXCJDX1NIQVJQXCJdID0gMjM7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjRdID0gXCJHX1NIQVJQXCJdID0gMjQ7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjVdID0gXCJEX1NIQVJQXCJdID0gMjU7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjZdID0gXCJBX1NIQVJQXCJdID0gMjY7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjddID0gXCJFX1NIQVJQXCJdID0gMjc7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjhdID0gXCJCX1NIQVJQXCJdID0gMjg7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMjldID0gXCJGX1NIQVJQX1NIQVJQXCJdID0gMjk7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzBdID0gXCJDX1NIQVJQX1NIQVJQXCJdID0gMzA7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzFdID0gXCJHX1NIQVJQX1NIQVJQXCJdID0gMzE7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzJdID0gXCJEX1NIQVJQX1NIQVJQXCJdID0gMzI7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzNdID0gXCJBX1NIQVJQX1NIQVJQXCJdID0gMzM7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzRdID0gXCJFX1NIQVJQX1NIQVJQXCJdID0gMzQ7XG4gICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMzVdID0gXCJCX1NIQVJQX1NIQVJQXCJdID0gMzU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIFRpbWVTaWduYXR1cmUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAaW50ZXJmYWNlIElUaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIFRpbWVTaWduYXR1cmUgdGltZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtudW1lcmF0b3JdIFRpbWVTaWduYXR1cmUgbnVtZXJhdG9yXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2Rlbm9taW5hdG9yXSBUaW1lU2lnbmF0dXJlIGRlbm9taW5hdG9yXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IFRpbWVTaWduYXR1cmUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBUaW1lU2lnbmF0dXJlLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElUaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUaW1lU2lnbmF0dXJlPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gVGltZVNpZ25hdHVyZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVGltZVNpZ25hdHVyZSB0aW1lLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gdGltZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUaW1lU2lnbmF0dXJlLnByb3RvdHlwZS50aW1lID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFRpbWVTaWduYXR1cmUgbnVtZXJhdG9yLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gbnVtZXJhdG9yXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRpbWVTaWduYXR1cmUucHJvdG90eXBlLm51bWVyYXRvciA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBUaW1lU2lnbmF0dXJlIGRlbm9taW5hdG9yLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gZGVub21pbmF0b3JcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS5wcm90b3R5cGUuZGVub21pbmF0b3IgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBUaW1lU2lnbmF0dXJlIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRpbWVTaWduYXR1cmU9fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlfSBUaW1lU2lnbmF0dXJlIGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVTaWduYXR1cmUocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBUaW1lU2lnbmF0dXJlIG1lc3NhZ2UuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZS52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRpbWVTaWduYXR1cmV9IG1lc3NhZ2UgVGltZVNpZ25hdHVyZSBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxLCB3aXJlVHlwZSAxID0qLzkpLmRvdWJsZShtZXNzYWdlLnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5udW1lcmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtZXJhdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAwID0qLzE2KS5pbnQzMihtZXNzYWdlLm51bWVyYXRvcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRlbm9taW5hdG9yICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImRlbm9taW5hdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAzLCB3aXJlVHlwZSAwID0qLzI0KS5pbnQzMihtZXNzYWdlLmRlbm9taW5hdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFRpbWVTaWduYXR1cmUgbWVzc2FnZSwgbGVuZ3RoIGRlbGltaXRlZC4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JVGltZVNpZ25hdHVyZX0gbWVzc2FnZSBUaW1lU2lnbmF0dXJlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUaW1lU2lnbmF0dXJlLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBUaW1lU2lnbmF0dXJlIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlfSBUaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUaW1lU2lnbmF0dXJlLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9ICRSZWFkZXIuY3JlYXRlKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubnVtZXJhdG9yID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kZW5vbWluYXRvciA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBUaW1lU2lnbmF0dXJlIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIsIGxlbmd0aCBkZWxpbWl0ZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZX0gVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVmVyaWZpZXMgYSBUaW1lU2lnbmF0dXJlIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gbWVzc2FnZSBQbGFpbiBvYmplY3QgdG8gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBgbnVsbGAgaWYgdmFsaWQsIG90aGVyd2lzZSB0aGUgcmVhc29uIHdoeSBpdCBpcyBub3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUaW1lU2lnbmF0dXJlLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS50aW1lICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRpbWU6IG51bWJlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5udW1lcmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtZXJhdG9yXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5udW1lcmF0b3IpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm51bWVyYXRvcjogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kZW5vbWluYXRvciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJkZW5vbWluYXRvclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UuZGVub21pbmF0b3IpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImRlbm9taW5hdG9yOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgVGltZVNpZ25hdHVyZSBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG9iamVjdCBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UaW1lU2lnbmF0dXJlfSBUaW1lU2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gZnJvbU9iamVjdChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnRpbWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGltZSA9IE51bWJlcihvYmplY3QudGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QubnVtZXJhdG9yICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm51bWVyYXRvciA9IG9iamVjdC5udW1lcmF0b3IgfCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LmRlbm9taW5hdG9yICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmRlbm9taW5hdG9yID0gb2JqZWN0LmRlbm9taW5hdG9yIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFRpbWVTaWduYXR1cmUgbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRpbWVTaWduYXR1cmV9IG1lc3NhZ2UgVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGltZVNpZ25hdHVyZS50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRlZmF1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubnVtZXJhdG9yID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5kZW5vbWluYXRvciA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWUgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2UudGltZSkgPyBTdHJpbmcobWVzc2FnZS50aW1lKSA6IG1lc3NhZ2UudGltZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubnVtZXJhdG9yICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcIm51bWVyYXRvclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5udW1lcmF0b3IgPSBtZXNzYWdlLm51bWVyYXRvcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZGVub21pbmF0b3IgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiZGVub21pbmF0b3JcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZGVub21pbmF0b3IgPSBtZXNzYWdlLmRlbm9taW5hdG9yO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFRpbWVTaWduYXR1cmUgdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGltZVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUaW1lU2lnbmF0dXJlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gVGltZVNpZ25hdHVyZTtcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQcm9wZXJ0aWVzIG9mIGEgS2V5U2lnbmF0dXJlLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIEtleVNpZ25hdHVyZSB0aW1lXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZS5LZXl8bnVsbH0gW2tleV0gS2V5U2lnbmF0dXJlIGtleVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUuTW9kZXxudWxsfSBbbW9kZV0gS2V5U2lnbmF0dXJlIG1vZGVcbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgS2V5U2lnbmF0dXJlLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgS2V5U2lnbmF0dXJlLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElLZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSUtleVNpZ25hdHVyZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEtleVNpZ25hdHVyZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogS2V5U2lnbmF0dXJlIHRpbWUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSB0aW1lXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLnByb3RvdHlwZS50aW1lID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEtleVNpZ25hdHVyZSBrZXkuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUuS2V5fSBrZXlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBLZXlTaWduYXR1cmUucHJvdG90eXBlLmtleSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBLZXlTaWduYXR1cmUgbW9kZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZS5Nb2RlfSBtb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLnByb3RvdHlwZS5tb2RlID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgS2V5U2lnbmF0dXJlIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JS2V5U2lnbmF0dXJlPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlfSBLZXlTaWduYXR1cmUgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBLZXlTaWduYXR1cmUuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBLZXlTaWduYXR1cmUocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBLZXlTaWduYXR1cmUgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSUtleVNpZ25hdHVyZX0gbWVzc2FnZSBLZXlTaWduYXR1cmUgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIEtleVNpZ25hdHVyZS5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxLCB3aXJlVHlwZSAxID0qLzkpLmRvdWJsZShtZXNzYWdlLnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5rZXkgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwia2V5XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAwID0qLzE2KS5pbnQzMihtZXNzYWdlLmtleSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm1vZGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibW9kZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMywgd2lyZVR5cGUgMCA9Ki8yNCkuaW50MzIobWVzc2FnZS5tb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIEtleVNpZ25hdHVyZSBtZXNzYWdlLCBsZW5ndGggZGVsaW1pdGVkLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZS52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JS2V5U2lnbmF0dXJlfSBtZXNzYWdlIEtleVNpZ25hdHVyZSBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBLZXlTaWduYXR1cmUgbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlci5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlfSBLZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIEtleVNpZ25hdHVyZS5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tb2RlID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIEtleVNpZ25hdHVyZSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlfSBLZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIEtleVNpZ25hdHVyZS5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVmVyaWZpZXMgYSBLZXlTaWduYXR1cmUgbWVzc2FnZS5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS50aW1lICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRpbWU6IG51bWJlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5rZXkgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwia2V5XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLmtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJrZXk6IGVudW0gdmFsdWUgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubW9kZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJtb2RlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLm1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwibW9kZTogZW51bSB2YWx1ZSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIEtleVNpZ25hdHVyZSBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZX0gS2V5U2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnRpbWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGltZSA9IE51bWJlcihvYmplY3QudGltZSk7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAob2JqZWN0LmtleSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ1wiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNfU0hBUlBcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJEX0ZMQVRcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRF9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDM7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkVfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDM7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkVcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRl9TSEFSUFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDY7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkdfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDY7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkdcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSA3O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJHX1NIQVJQXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQV9GTEFUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmtleSA9IDk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkFfU0hBUlBcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uua2V5ID0gMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJfRkxBVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQlwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDExOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5rZXkgPSAxMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAob2JqZWN0Lm1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1BSk9SXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubW9kZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1JTk9SXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubW9kZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk5PVF9TUEVDSUZJRURcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tb2RlID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTUlYT0xZRElBTlwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm1vZGUgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJET1JJQU5cIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tb2RlID0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUEhSWUdJQU5cIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tb2RlID0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTFlESUFOXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubW9kZSA9IDY7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkxPQ1JJQU5cIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tb2RlID0gNztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBLZXlTaWduYXR1cmUgbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuS2V5U2lnbmF0dXJlfSBtZXNzYWdlIEtleVNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50aW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5rZXkgPSBvcHRpb25zLmVudW1zID09PSBTdHJpbmcgPyBcIkNcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZSA9IG9wdGlvbnMuZW51bXMgPT09IFN0cmluZyA/IFwiTUFKT1JcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWUgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2UudGltZSkgPyBTdHJpbmcobWVzc2FnZS50aW1lKSA6IG1lc3NhZ2UudGltZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uua2V5ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImtleVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5rZXkgPSBvcHRpb25zLmVudW1zID09PSBTdHJpbmcgPyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZS5LZXlbbWVzc2FnZS5rZXldIDogbWVzc2FnZS5rZXk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm1vZGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibW9kZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5tb2RlID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUuTW9kZVttZXNzYWdlLm1vZGVdIDogbWVzc2FnZS5tb2RlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIEtleVNpZ25hdHVyZSB0byBKU09OLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b0pTT05cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IEpTT04gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBLZXkgZW51bS5cbiAgICAgICAgICAgICAgICAgKiBAbmFtZSB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLktleVNpZ25hdHVyZS5LZXlcbiAgICAgICAgICAgICAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBDPTAgQyB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBDX1NIQVJQPTEgQ19TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBEX0ZMQVQ9MSBEX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRD0yIEQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRF9TSEFSUD0zIERfU0hBUlAgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRV9GTEFUPTMgRV9GTEFUIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEU9NCBFIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEY9NSBGIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEZfU0hBUlA9NiBGX1NIQVJQIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEdfRkxBVD02IEdfRkxBVCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBHPTcgRyB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBHX1NIQVJQPTggR19TSEFSUCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBBX0ZMQVQ9OCBBX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gQT05IEEgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gQV9TSEFSUD0xMCBBX1NIQVJQIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IEJfRkxBVD0xMCBCX0ZMQVQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gQj0xMSBCIHZhbHVlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgS2V5U2lnbmF0dXJlLktleSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlc0J5SWQgPSB7fSwgdmFsdWVzID0gT2JqZWN0LmNyZWF0ZSh2YWx1ZXNCeUlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMF0gPSBcIkNcIl0gPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxXSA9IFwiQ19TSEFSUFwiXSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1tcIkRfRkxBVFwiXSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzJdID0gXCJEXCJdID0gMjtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbM10gPSBcIkRfU0hBUlBcIl0gPSAzO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbXCJFX0ZMQVRcIl0gPSAzO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs0XSA9IFwiRVwiXSA9IDQ7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzVdID0gXCJGXCJdID0gNTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbNl0gPSBcIkZfU0hBUlBcIl0gPSA2O1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbXCJHX0ZMQVRcIl0gPSA2O1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs3XSA9IFwiR1wiXSA9IDc7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzhdID0gXCJHX1NIQVJQXCJdID0gODtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW1wiQV9GTEFUXCJdID0gODtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbOV0gPSBcIkFcIl0gPSA5O1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxMF0gPSBcIkFfU0hBUlBcIl0gPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW1wiQl9GTEFUXCJdID0gMTA7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzExXSA9IFwiQlwiXSA9IDExO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBNb2RlIGVudW0uXG4gICAgICAgICAgICAgICAgICogQG5hbWUgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5LZXlTaWduYXR1cmUuTW9kZVxuICAgICAgICAgICAgICAgICAqIEBlbnVtIHtzdHJpbmd9XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE1BSk9SPTAgTUFKT1IgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTUlOT1I9MSBNSU5PUiB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBOT1RfU1BFQ0lGSUVEPTIgTk9UX1NQRUNJRklFRCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBNSVhPTFlESUFOPTMgTUlYT0xZRElBTiB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET1JJQU49NCBET1JJQU4gdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUEhSWUdJQU49NSBQSFJZR0lBTiB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBMWURJQU49NiBMWURJQU4gdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTE9DUklBTj03IExPQ1JJQU4gdmFsdWVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBLZXlTaWduYXR1cmUuTW9kZSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlc0J5SWQgPSB7fSwgdmFsdWVzID0gT2JqZWN0LmNyZWF0ZSh2YWx1ZXNCeUlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMF0gPSBcIk1BSk9SXCJdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMV0gPSBcIk1JTk9SXCJdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMl0gPSBcIk5PVF9TUEVDSUZJRURcIl0gPSAyO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFszXSA9IFwiTUlYT0xZRElBTlwiXSA9IDM7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzRdID0gXCJET1JJQU5cIl0gPSA0O1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs1XSA9IFwiUEhSWUdJQU5cIl0gPSA1O1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs2XSA9IFwiTFlESUFOXCJdID0gNjtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbN10gPSBcIkxPQ1JJQU5cIl0gPSA3O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gS2V5U2lnbmF0dXJlO1xuICAgICAgICAgICAgfSkoKTtcblxuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLlRlbXBvID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIFRlbXBvLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbdGltZV0gVGVtcG8gdGltZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtxcG1dIFRlbXBvIHFwbVxuICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29uc3RydWN0cyBhIG5ldyBUZW1wby5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBjbGFzc2Rlc2MgUmVwcmVzZW50cyBhIFRlbXBvLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElUZW1wb1xuICAgICAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JVGVtcG89fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBUZW1wbyhwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVGVtcG8gdGltZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHRpbWVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wb1xuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRlbXBvLnByb3RvdHlwZS50aW1lID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFRlbXBvIHFwbS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHFwbVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGVtcG8ucHJvdG90eXBlLnFwbSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IFRlbXBvIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUZW1wbz19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvfSBUZW1wbyBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRlbXBvLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGVtcG8ocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBUZW1wbyBtZXNzYWdlLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRlbXBvfSBtZXNzYWdlIFRlbXBvIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZW1wby5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxLCB3aXJlVHlwZSAxID0qLzkpLmRvdWJsZShtZXNzYWdlLnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xcG0gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXBtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAxID0qLzE3KS5kb3VibGUobWVzc2FnZS5xcG0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgVGVtcG8gbWVzc2FnZSwgbGVuZ3RoIGRlbGltaXRlZC4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wby52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUZW1wb30gbWVzc2FnZSBUZW1wbyBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGVtcG8uZW5jb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGUobWVzc2FnZSwgd3JpdGVyKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFRlbXBvIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG99IFRlbXBvXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZW1wby5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIucG9zIDwgZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gcmVhZGVyLnVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpbWUgPSByZWFkZXIuZG91YmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xcG0gPSByZWFkZXIuZG91YmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFRlbXBvIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIsIGxlbmd0aCBkZWxpbWl0ZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvfSBUZW1wb1xuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGVtcG8uZGVjb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkKHJlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFZlcmlmaWVzIGEgVGVtcG8gbWVzc2FnZS5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gbWVzc2FnZSBQbGFpbiBvYmplY3QgdG8gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBgbnVsbGAgaWYgdmFsaWQsIG90aGVyd2lzZSB0aGUgcmVhc29uIHdoeSBpdCBpcyBub3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZW1wby52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwib2JqZWN0XCIgfHwgbWVzc2FnZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UudGltZSAhPT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0aW1lOiBudW1iZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucXBtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInFwbVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5xcG0gIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicXBtOiBudW1iZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBUZW1wbyBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBvYmplY3QgUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG99IFRlbXBvXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGVtcG8uZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRlbXBvKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wbygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnRpbWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGltZSA9IE51bWJlcihvYmplY3QudGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QucXBtICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnFwbSA9IE51bWJlcihvYmplY3QucXBtKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFRlbXBvIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZW1wb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG99IG1lc3NhZ2UgVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRlbXBvLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50aW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xcG0gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50aW1lID0gb3B0aW9ucy5qc29uICYmICFpc0Zpbml0ZShtZXNzYWdlLnRpbWUpID8gU3RyaW5nKG1lc3NhZ2UudGltZSkgOiBtZXNzYWdlLnRpbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnFwbSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJxcG1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucXBtID0gb3B0aW9ucy5qc29uICYmICFpc0Zpbml0ZShtZXNzYWdlLnFwbSkgPyBTdHJpbmcobWVzc2FnZS5xcG0pIDogbWVzc2FnZS5xcG07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnZlcnRzIHRoaXMgVGVtcG8gdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGVtcG9cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IEpTT04gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGVtcG8ucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywgJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBUZW1wbztcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5QaXRjaEJlbmQgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQcm9wZXJ0aWVzIG9mIGEgUGl0Y2hCZW5kLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIFBpdGNoQmVuZCB0aW1lXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2JlbmRdIFBpdGNoQmVuZCBiZW5kXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2luc3RydW1lbnRdIFBpdGNoQmVuZCBpbnN0cnVtZW50XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3Byb2dyYW1dIFBpdGNoQmVuZCBwcm9ncmFtXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtib29sZWFufG51bGx9IFtpc0RydW1dIFBpdGNoQmVuZCBpc0RydW1cbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgUGl0Y2hCZW5kLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgUGl0Y2hCZW5kLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElQaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVBpdGNoQmVuZD19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFBpdGNoQmVuZChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUGl0Y2hCZW5kIHRpbWUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSB0aW1lXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGl0Y2hCZW5kLnByb3RvdHlwZS50aW1lID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFBpdGNoQmVuZCBiZW5kLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gYmVuZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZFxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC5wcm90b3R5cGUuYmVuZCA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQaXRjaEJlbmQgaW5zdHJ1bWVudC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IGluc3RydW1lbnRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBQaXRjaEJlbmQucHJvdG90eXBlLmluc3RydW1lbnQgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUGl0Y2hCZW5kIHByb2dyYW0uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBwcm9ncmFtXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGl0Y2hCZW5kLnByb3RvdHlwZS5wcm9ncmFtID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFBpdGNoQmVuZCBpc0RydW0uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7Ym9vbGVhbn0gaXNEcnVtXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGl0Y2hCZW5kLnByb3RvdHlwZS5pc0RydW0gPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgUGl0Y2hCZW5kIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGl0Y2hCZW5kPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kfSBQaXRjaEJlbmQgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBQaXRjaEJlbmQuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQaXRjaEJlbmQocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBQaXRjaEJlbmQgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmQudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZFxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVBpdGNoQmVuZH0gbWVzc2FnZSBQaXRjaEJlbmQgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxLCB3aXJlVHlwZSAxID0qLzkpLmRvdWJsZShtZXNzYWdlLnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5iZW5kICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImJlbmRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDAgPSovMTYpLmludDMyKG1lc3NhZ2UuYmVuZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmluc3RydW1lbnQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaW5zdHJ1bWVudFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMywgd2lyZVR5cGUgMCA9Ki8yNCkuaW50MzIobWVzc2FnZS5pbnN0cnVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucHJvZ3JhbSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwcm9ncmFtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA0LCB3aXJlVHlwZSAwID0qLzMyKS5pbnQzMihtZXNzYWdlLnByb2dyYW0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pc0RydW0gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaXNEcnVtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCA1LCB3aXJlVHlwZSAwID0qLzQwKS5ib29sKG1lc3NhZ2UuaXNEcnVtKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFBpdGNoQmVuZCBtZXNzYWdlLCBsZW5ndGggZGVsaW1pdGVkLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZC52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGl0Y2hCZW5kfSBtZXNzYWdlIFBpdGNoQmVuZCBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGl0Y2hCZW5kLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBQaXRjaEJlbmQgbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlci5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kfSBQaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZCgpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYmVuZCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW5zdHJ1bWVudCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucHJvZ3JhbSA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNEcnVtID0gcmVhZGVyLmJvb2woKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnNraXBUeXBlKHRhZyAmIDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgUGl0Y2hCZW5kIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIsIGxlbmd0aCBkZWxpbWl0ZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZFxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmR9IFBpdGNoQmVuZFxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGl0Y2hCZW5kLmRlY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZChyZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgJFJlYWRlcihyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBWZXJpZmllcyBhIFBpdGNoQmVuZCBtZXNzYWdlLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gbWVzc2FnZSBQbGFpbiBvYmplY3QgdG8gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBgbnVsbGAgaWYgdmFsaWQsIG90aGVyd2lzZSB0aGUgcmVhc29uIHdoeSBpdCBpcyBub3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBQaXRjaEJlbmQudmVyaWZ5ID0gZnVuY3Rpb24gdmVyaWZ5KG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIm9iamVjdFwiIHx8IG1lc3NhZ2UgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLnRpbWUgIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGltZTogbnVtYmVyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmJlbmQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiYmVuZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UuYmVuZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYmVuZDogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pbnN0cnVtZW50ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImluc3RydW1lbnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLmluc3RydW1lbnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImluc3RydW1lbnQ6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucHJvZ3JhbSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwcm9ncmFtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5wcm9ncmFtKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJwcm9ncmFtOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmlzRHJ1bSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpc0RydW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UuaXNEcnVtICE9PSBcImJvb2xlYW5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJpc0RydW06IGJvb2xlYW4gZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBQaXRjaEJlbmQgbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBmcm9tT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG9iamVjdCBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmR9IFBpdGNoQmVuZFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gZnJvbU9iamVjdChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC50aW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpbWUgPSBOdW1iZXIob2JqZWN0LnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LmJlbmQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYmVuZCA9IG9iamVjdC5iZW5kIHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5pbnN0cnVtZW50ICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmluc3RydW1lbnQgPSBvYmplY3QuaW5zdHJ1bWVudCB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QucHJvZ3JhbSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wcm9ncmFtID0gb2JqZWN0LnByb2dyYW0gfCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LmlzRHJ1bSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5pc0RydW0gPSBCb29sZWFuKG9iamVjdC5pc0RydW0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIHBsYWluIG9iamVjdCBmcm9tIGEgUGl0Y2hCZW5kIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBpdGNoQmVuZH0gbWVzc2FnZSBQaXRjaEJlbmRcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRlZmF1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuYmVuZCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaW5zdHJ1bWVudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucHJvZ3JhbSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaXNEcnVtID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWUgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2UudGltZSkgPyBTdHJpbmcobWVzc2FnZS50aW1lKSA6IG1lc3NhZ2UudGltZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuYmVuZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJiZW5kXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmJlbmQgPSBtZXNzYWdlLmJlbmQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmluc3RydW1lbnQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiaW5zdHJ1bWVudFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5pbnN0cnVtZW50ID0gbWVzc2FnZS5pbnN0cnVtZW50O1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wcm9ncmFtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInByb2dyYW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucHJvZ3JhbSA9IG1lc3NhZ2UucHJvZ3JhbTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaXNEcnVtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImlzRHJ1bVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5pc0RydW0gPSBtZXNzYWdlLmlzRHJ1bTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBQaXRjaEJlbmQgdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGl0Y2hCZW5kXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBpdGNoQmVuZC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBpdGNoQmVuZDtcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIENvbnRyb2xDaGFuZ2UuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAaW50ZXJmYWNlIElDb250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIENvbnRyb2xDaGFuZ2UgdGltZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtxdWFudGl6ZWRTdGVwXSBDb250cm9sQ2hhbmdlIHF1YW50aXplZFN0ZXBcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbY29udHJvbE51bWJlcl0gQ29udHJvbENoYW5nZSBjb250cm9sTnVtYmVyXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW2NvbnRyb2xWYWx1ZV0gQ29udHJvbENoYW5nZSBjb250cm9sVmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbaW5zdHJ1bWVudF0gQ29udHJvbENoYW5nZSBpbnN0cnVtZW50XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3Byb2dyYW1dIENvbnRyb2xDaGFuZ2UgcHJvZ3JhbVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbnxudWxsfSBbaXNEcnVtXSBDb250cm9sQ2hhbmdlIGlzRHJ1bVxuICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29uc3RydWN0cyBhIG5ldyBDb250cm9sQ2hhbmdlLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgQ29udHJvbENoYW5nZS5cbiAgICAgICAgICAgICAgICAgKiBAaW1wbGVtZW50cyBJQ29udHJvbENoYW5nZVxuICAgICAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JQ29udHJvbENoYW5nZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbnRyb2xDaGFuZ2UocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcylcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleXMgPSBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKSwgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2tleXNbaV1dICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5c1tpXV0gPSBwcm9wZXJ0aWVzW2tleXNbaV1dO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnRyb2xDaGFuZ2UgdGltZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHRpbWVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgQ29udHJvbENoYW5nZS5wcm90b3R5cGUudGltZSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb250cm9sQ2hhbmdlIHF1YW50aXplZFN0ZXAuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBxdWFudGl6ZWRTdGVwXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuQ29udHJvbENoYW5nZVxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIENvbnRyb2xDaGFuZ2UucHJvdG90eXBlLnF1YW50aXplZFN0ZXAgPSAkdXRpbC5Mb25nID8gJHV0aWwuTG9uZy5mcm9tQml0cygwLDAsZmFsc2UpIDogMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnRyb2xDaGFuZ2UgY29udHJvbE51bWJlci5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IGNvbnRyb2xOdW1iZXJcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgQ29udHJvbENoYW5nZS5wcm90b3R5cGUuY29udHJvbE51bWJlciA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb250cm9sQ2hhbmdlIGNvbnRyb2xWYWx1ZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IGNvbnRyb2xWYWx1ZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLnByb3RvdHlwZS5jb250cm9sVmFsdWUgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udHJvbENoYW5nZSBpbnN0cnVtZW50LlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gaW5zdHJ1bWVudFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLnByb3RvdHlwZS5pbnN0cnVtZW50ID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnRyb2xDaGFuZ2UgcHJvZ3JhbS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHByb2dyYW1cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgQ29udHJvbENoYW5nZS5wcm90b3R5cGUucHJvZ3JhbSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb250cm9sQ2hhbmdlIGlzRHJ1bS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtib29sZWFufSBpc0RydW1cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgQ29udHJvbENoYW5nZS5wcm90b3R5cGUuaXNEcnVtID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IENvbnRyb2xDaGFuZ2UgaW5zdGFuY2UgdXNpbmcgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JQ29udHJvbENoYW5nZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2V9IENvbnRyb2xDaGFuZ2UgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29udHJvbENoYW5nZShwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIENvbnRyb2xDaGFuZ2UgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JQ29udHJvbENoYW5nZX0gbWVzc2FnZSBDb250cm9sQ2hhbmdlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLmVuY29kZSA9IGZ1bmN0aW9uIGVuY29kZShtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSAkV3JpdGVyLmNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEsIHdpcmVUeXBlIDEgPSovOSkuZG91YmxlKG1lc3NhZ2UudGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbnRyb2xOdW1iZXIgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbE51bWJlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMiwgd2lyZVR5cGUgMCA9Ki8xNikuaW50MzIobWVzc2FnZS5jb250cm9sTnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY29udHJvbFZhbHVlICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImNvbnRyb2xWYWx1ZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMywgd2lyZVR5cGUgMCA9Ki8yNCkuaW50MzIobWVzc2FnZS5jb250cm9sVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pbnN0cnVtZW50ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImluc3RydW1lbnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDQsIHdpcmVUeXBlIDAgPSovMzIpLmludDMyKG1lc3NhZ2UuaW5zdHJ1bWVudCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnByb2dyYW0gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicHJvZ3JhbVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgNSwgd2lyZVR5cGUgMCA9Ki80MCkuaW50MzIobWVzc2FnZS5wcm9ncmFtKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaXNEcnVtICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImlzRHJ1bVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgNiwgd2lyZVR5cGUgMCA9Ki80OCkuYm9vbChtZXNzYWdlLmlzRHJ1bSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnF1YW50aXplZFN0ZXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXVhbnRpemVkU3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgNywgd2lyZVR5cGUgMCA9Ki81NikuaW50NjQobWVzc2FnZS5xdWFudGl6ZWRTdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIENvbnRyb2xDaGFuZ2UgbWVzc2FnZSwgbGVuZ3RoIGRlbGltaXRlZC4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JQ29udHJvbENoYW5nZX0gbWVzc2FnZSBDb250cm9sQ2hhbmdlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBDb250cm9sQ2hhbmdlIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlfSBDb250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9ICRSZWFkZXIuY3JlYXRlKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuQ29udHJvbENoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemVkU3RlcCA9ICR1dGlsLkxvbmc/cmVhZGVyLmludDY0KCkudG9OdW1iZXIoKTpyZWFkZXIuaW50NjQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xOdW1iZXIgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xWYWx1ZSA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW5zdHJ1bWVudCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucHJvZ3JhbSA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNEcnVtID0gcmVhZGVyLmJvb2woKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnNraXBUeXBlKHRhZyAmIDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgQ29udHJvbENoYW5nZSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2V9IENvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIENvbnRyb2xDaGFuZ2UuZGVjb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkKHJlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFZlcmlmaWVzIGEgQ29udHJvbENoYW5nZSBtZXNzYWdlLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgQ29udHJvbENoYW5nZS52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwib2JqZWN0XCIgfHwgbWVzc2FnZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UudGltZSAhPT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0aW1lOiBudW1iZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucXVhbnRpemVkU3RlcCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJxdWFudGl6ZWRTdGVwXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5xdWFudGl6ZWRTdGVwKSAmJiAhKG1lc3NhZ2UucXVhbnRpemVkU3RlcCAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5xdWFudGl6ZWRTdGVwLmxvdykgJiYgJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UucXVhbnRpemVkU3RlcC5oaWdoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicXVhbnRpemVkU3RlcDogaW50ZWdlcnxMb25nIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbnRyb2xOdW1iZXIgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbE51bWJlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2UuY29udHJvbE51bWJlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29udHJvbE51bWJlcjogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb250cm9sVmFsdWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbFZhbHVlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5jb250cm9sVmFsdWUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImNvbnRyb2xWYWx1ZTogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pbnN0cnVtZW50ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImluc3RydW1lbnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLmluc3RydW1lbnQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImluc3RydW1lbnQ6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucHJvZ3JhbSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwcm9ncmFtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5wcm9ncmFtKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJwcm9ncmFtOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmlzRHJ1bSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpc0RydW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UuaXNEcnVtICE9PSBcImJvb2xlYW5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJpc0RydW06IGJvb2xlYW4gZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBDb250cm9sQ2hhbmdlIG1lc3NhZ2UgZnJvbSBhIHBsYWluIG9iamVjdC4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gdGhlaXIgcmVzcGVjdGl2ZSBpbnRlcm5hbCB0eXBlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZnJvbU9iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLkNvbnRyb2xDaGFuZ2V9IENvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBDb250cm9sQ2hhbmdlLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QudGltZSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gTnVtYmVyKG9iamVjdC50aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5xdWFudGl6ZWRTdGVwICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gJHV0aWwuTG9uZy5mcm9tVmFsdWUob2JqZWN0LnF1YW50aXplZFN0ZXApKS51bnNpZ25lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5xdWFudGl6ZWRTdGVwID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemVkU3RlcCA9IHBhcnNlSW50KG9iamVjdC5xdWFudGl6ZWRTdGVwLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXplZFN0ZXAgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gb2JqZWN0LnF1YW50aXplZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXplZFN0ZXAgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gbmV3ICR1dGlsLkxvbmdCaXRzKG9iamVjdC5xdWFudGl6ZWRTdGVwLmxvdyA+Pj4gMCwgb2JqZWN0LnF1YW50aXplZFN0ZXAuaGlnaCA+Pj4gMCkudG9OdW1iZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5jb250cm9sTnVtYmVyICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xOdW1iZXIgPSBvYmplY3QuY29udHJvbE51bWJlciB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QuY29udHJvbFZhbHVlICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRyb2xWYWx1ZSA9IG9iamVjdC5jb250cm9sVmFsdWUgfCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lmluc3RydW1lbnQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW5zdHJ1bWVudCA9IG9iamVjdC5pbnN0cnVtZW50IHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5wcm9ncmFtICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnByb2dyYW0gPSBvYmplY3QucHJvZ3JhbSB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QuaXNEcnVtICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmlzRHJ1bSA9IEJvb2xlYW4ob2JqZWN0LmlzRHJ1bSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBDb250cm9sQ2hhbmdlIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlfSBtZXNzYWdlIENvbnRyb2xDaGFuZ2VcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIENvbnRyb2xDaGFuZ2UudG9PYmplY3QgPSBmdW5jdGlvbiB0b09iamVjdChtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmNvbnRyb2xOdW1iZXIgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmNvbnRyb2xWYWx1ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaW5zdHJ1bWVudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucHJvZ3JhbSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaXNEcnVtID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb25nID0gbmV3ICR1dGlsLkxvbmcoMCwgMCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gbG9uZy50b1N0cmluZygpIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbG9uZy50b051bWJlcigpIDogbG9uZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gXCIwXCIgOiAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50aW1lID0gb3B0aW9ucy5qc29uICYmICFpc0Zpbml0ZShtZXNzYWdlLnRpbWUpID8gU3RyaW5nKG1lc3NhZ2UudGltZSkgOiBtZXNzYWdlLnRpbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbnRyb2xOdW1iZXIgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbE51bWJlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5jb250cm9sTnVtYmVyID0gbWVzc2FnZS5jb250cm9sTnVtYmVyO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb250cm9sVmFsdWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiY29udHJvbFZhbHVlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmNvbnRyb2xWYWx1ZSA9IG1lc3NhZ2UuY29udHJvbFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5pbnN0cnVtZW50ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImluc3RydW1lbnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaW5zdHJ1bWVudCA9IG1lc3NhZ2UuaW5zdHJ1bWVudDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucHJvZ3JhbSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwcm9ncmFtXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnByb2dyYW0gPSBtZXNzYWdlLnByb2dyYW07XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmlzRHJ1bSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJpc0RydW1cIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaXNEcnVtID0gbWVzc2FnZS5pc0RydW07XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnF1YW50aXplZFN0ZXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicXVhbnRpemVkU3RlcFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5xdWFudGl6ZWRTdGVwID09PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gU3RyaW5nKG1lc3NhZ2UucXVhbnRpemVkU3RlcCkgOiBtZXNzYWdlLnF1YW50aXplZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXplZFN0ZXAgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyAkdXRpbC5Mb25nLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1lc3NhZ2UucXVhbnRpemVkU3RlcCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBuZXcgJHV0aWwuTG9uZ0JpdHMobWVzc2FnZS5xdWFudGl6ZWRTdGVwLmxvdyA+Pj4gMCwgbWVzc2FnZS5xdWFudGl6ZWRTdGVwLmhpZ2ggPj4+IDApLnRvTnVtYmVyKCkgOiBtZXNzYWdlLnF1YW50aXplZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnZlcnRzIHRoaXMgQ29udHJvbENoYW5nZSB0byBKU09OLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b0pTT05cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Db250cm9sQ2hhbmdlXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIENvbnRyb2xDaGFuZ2UucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywgJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBDb250cm9sQ2hhbmdlO1xuICAgICAgICAgICAgfSkoKTtcblxuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLlBhcnRJbmZvID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIFBhcnRJbmZvLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJUGFydEluZm9cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbcGFydF0gUGFydEluZm8gcGFydFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfG51bGx9IFtuYW1lXSBQYXJ0SW5mbyBuYW1lXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IFBhcnRJbmZvLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgUGFydEluZm8uXG4gICAgICAgICAgICAgICAgICogQGltcGxlbWVudHMgSVBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklQYXJ0SW5mbz19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFBhcnRJbmZvKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleXNbaV1dID0gcHJvcGVydGllc1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQYXJ0SW5mbyBwYXJ0LlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gcGFydFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8ucHJvdG90eXBlLnBhcnQgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUGFydEluZm8gbmFtZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtzdHJpbmd9IG5hbWVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBhcnRJbmZvLnByb3RvdHlwZS5uYW1lID0gXCJcIjtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgUGFydEluZm8gaW5zdGFuY2UgdXNpbmcgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVBhcnRJbmZvPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm99IFBhcnRJbmZvIGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8uY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXJ0SW5mbyhwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFBhcnRJbmZvIG1lc3NhZ2UuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm8udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGFydEluZm99IG1lc3NhZ2UgUGFydEluZm8gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBhcnRJbmZvLmVuY29kZSA9IGZ1bmN0aW9uIGVuY29kZShtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSAkV3JpdGVyLmNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wYXJ0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEsIHdpcmVUeXBlIDAgPSovOCkuaW50MzIobWVzc2FnZS5wYXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubmFtZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJuYW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAyID0qLzE4KS5zdHJpbmcobWVzc2FnZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFBhcnRJbmZvIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm8udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JUGFydEluZm99IG1lc3NhZ2UgUGFydEluZm8gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBhcnRJbmZvLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBQYXJ0SW5mbyBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aF0gTWVzc2FnZSBsZW5ndGggaWYga25vd24gYmVmb3JlaGFuZFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvfSBQYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8uZGVjb2RlID0gZnVuY3Rpb24gZGVjb2RlKHJlYWRlciwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gJFJlYWRlci5jcmVhdGUocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZCA9IGxlbmd0aCA9PT0gdW5kZWZpbmVkID8gcmVhZGVyLmxlbiA6IHJlYWRlci5wb3MgKyBsZW5ndGgsIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mbygpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJ0ID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5uYW1lID0gcmVhZGVyLnN0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBQYXJ0SW5mbyBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb30gUGFydEluZm9cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFBhcnRJbmZvLmRlY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZChyZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgJFJlYWRlcihyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBWZXJpZmllcyBhIFBhcnRJbmZvIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8udmVyaWZ5ID0gZnVuY3Rpb24gdmVyaWZ5KG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIm9iamVjdFwiIHx8IG1lc3NhZ2UgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGFydCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJwYXJ0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5wYXJ0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJwYXJ0OiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm5hbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibmFtZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNTdHJpbmcobWVzc2FnZS5uYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJuYW1lOiBzdHJpbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBQYXJ0SW5mbyBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBvYmplY3QgUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUGFydEluZm99IFBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8uZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mbygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnBhcnQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFydCA9IG9iamVjdC5wYXJ0IHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5uYW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm5hbWUgPSBTdHJpbmcob2JqZWN0Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIHBsYWluIG9iamVjdCBmcm9tIGEgUGFydEluZm8gbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlBhcnRJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb30gbWVzc2FnZSBQYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUGFydEluZm8udG9PYmplY3QgPSBmdW5jdGlvbiB0b09iamVjdChtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnBhcnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnBhcnQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwicGFydFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5wYXJ0ID0gbWVzc2FnZS5wYXJ0O1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5uYW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcIm5hbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubmFtZSA9IG1lc3NhZ2UubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBQYXJ0SW5mbyB0byBKU09OLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b0pTT05cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5QYXJ0SW5mb1xuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBQYXJ0SW5mby5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBhcnRJbmZvO1xuICAgICAgICAgICAgfSkoKTtcblxuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8gPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQcm9wZXJ0aWVzIG9mIGEgU291cmNlSW5mby5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBpbnRlcmZhY2UgSVNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5Tb3VyY2VUeXBlfG51bGx9IFtzb3VyY2VUeXBlXSBTb3VyY2VJbmZvIHNvdXJjZVR5cGVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5FbmNvZGluZ1R5cGV8bnVsbH0gW2VuY29kaW5nVHlwZV0gU291cmNlSW5mbyBlbmNvZGluZ1R5cGVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5QYXJzZXJ8bnVsbH0gW3BhcnNlcl0gU291cmNlSW5mbyBwYXJzZXJcbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgU291cmNlSW5mby5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBjbGFzc2Rlc2MgUmVwcmVzZW50cyBhIFNvdXJjZUluZm8uXG4gICAgICAgICAgICAgICAgICogQGltcGxlbWVudHMgSVNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNvdXJjZUluZm89fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBTb3VyY2VJbmZvKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleXNbaV1dID0gcHJvcGVydGllc1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTb3VyY2VJbmZvIHNvdXJjZVR5cGUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLlNvdXJjZVR5cGV9IHNvdXJjZVR5cGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU291cmNlSW5mby5wcm90b3R5cGUuc291cmNlVHlwZSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTb3VyY2VJbmZvIGVuY29kaW5nVHlwZS5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8uRW5jb2RpbmdUeXBlfSBlbmNvZGluZ1R5cGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU291cmNlSW5mby5wcm90b3R5cGUuZW5jb2RpbmdUeXBlID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFNvdXJjZUluZm8gcGFyc2VyLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5QYXJzZXJ9IHBhcnNlclxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTb3VyY2VJbmZvLnByb3RvdHlwZS5wYXJzZXIgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBTb3VyY2VJbmZvIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNvdXJjZUluZm89fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvfSBTb3VyY2VJbmZvIGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU291cmNlSW5mby5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNvdXJjZUluZm8ocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBTb3VyY2VJbmZvIG1lc3NhZ2UuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNvdXJjZUluZm99IG1lc3NhZ2UgU291cmNlSW5mbyBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU291cmNlSW5mby5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc291cmNlVHlwZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzb3VyY2VUeXBlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAxLCB3aXJlVHlwZSAwID0qLzgpLmludDMyKG1lc3NhZ2Uuc291cmNlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmVuY29kaW5nVHlwZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJlbmNvZGluZ1R5cGVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDAgPSovMTYpLmludDMyKG1lc3NhZ2UuZW5jb2RpbmdUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGFyc2VyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnNlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMywgd2lyZVR5cGUgMCA9Ki8yNCkuaW50MzIobWVzc2FnZS5wYXJzZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgU291cmNlSW5mbyBtZXNzYWdlLCBsZW5ndGggZGVsaW1pdGVkLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTb3VyY2VJbmZvfSBtZXNzYWdlIFNvdXJjZUluZm8gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNvdXJjZUluZm8uZW5jb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGUobWVzc2FnZSwgd3JpdGVyKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFNvdXJjZUluZm8gbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlci5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aF0gTWVzc2FnZSBsZW5ndGggaWYga25vd24gYmVmb3JlaGFuZFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm99IFNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNvdXJjZUluZm8uZGVjb2RlID0gZnVuY3Rpb24gZGVjb2RlKHJlYWRlciwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gJFJlYWRlci5jcmVhdGUocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZCA9IGxlbmd0aCA9PT0gdW5kZWZpbmVkID8gcmVhZGVyLmxlbiA6IHJlYWRlci5wb3MgKyBsZW5ndGgsIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIucG9zIDwgZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gcmVhZGVyLnVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnNvdXJjZVR5cGUgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuY29kaW5nVHlwZSA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyc2VyID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFNvdXJjZUluZm8gbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlciwgbGVuZ3RoIGRlbGltaXRlZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvfSBTb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTb3VyY2VJbmZvLmRlY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZChyZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgJFJlYWRlcihyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBWZXJpZmllcyBhIFNvdXJjZUluZm8gbWVzc2FnZS5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBtZXNzYWdlIFBsYWluIG9iamVjdCB0byB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IGBudWxsYCBpZiB2YWxpZCwgb3RoZXJ3aXNlIHRoZSByZWFzb24gd2h5IGl0IGlzIG5vdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNvdXJjZUluZm8udmVyaWZ5ID0gZnVuY3Rpb24gdmVyaWZ5KG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIm9iamVjdFwiIHx8IG1lc3NhZ2UgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc291cmNlVHlwZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzb3VyY2VUeXBlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLnNvdXJjZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic291cmNlVHlwZTogZW51bSB2YWx1ZSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5lbmNvZGluZ1R5cGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiZW5jb2RpbmdUeXBlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLmVuY29kaW5nVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJlbmNvZGluZ1R5cGU6IGVudW0gdmFsdWUgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGFyc2VyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnNlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZS5wYXJzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicGFyc2VyOiBlbnVtIHZhbHVlIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgU291cmNlSW5mbyBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG9iamVjdCBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvfSBTb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU291cmNlSW5mby5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gZnJvbU9iamVjdChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mbylcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mbygpO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG9iamVjdC5zb3VyY2VUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJVTktOT1dOX1NPVVJDRV9UWVBFXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc291cmNlVHlwZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNDT1JFX0JBU0VEXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc291cmNlVHlwZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlBFUkZPUk1BTkNFX0JBU0VEXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc291cmNlVHlwZSA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG9iamVjdC5lbmNvZGluZ1R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlVOS05PV05fRU5DT0RJTkdfVFlQRVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuY29kaW5nVHlwZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1VU0lDX1hNTFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuY29kaW5nVHlwZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkFCQ1wiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuY29kaW5nVHlwZSA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1JRElcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lbmNvZGluZ1R5cGUgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNVVNJQ05FVFwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuY29kaW5nVHlwZSA9IDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG9iamVjdC5wYXJzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlVOS05PV05fUEFSU0VSXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyc2VyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTVVTSUMyMVwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcnNlciA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlBSRVRUWV9NSURJXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyc2VyID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTUFHRU5UQV9NVVNJQ19YTUxcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJzZXIgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNQUdFTlRBX01VU0lDTkVUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyc2VyID0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTUFHRU5UQV9BQkNcIjpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJzZXIgPSA1O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUT05FSlNfTUlESV9DT05WRVJUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyc2VyID0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBTb3VyY2VJbmZvIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvfSBtZXNzYWdlIFNvdXJjZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNvdXJjZUluZm8udG9PYmplY3QgPSBmdW5jdGlvbiB0b09iamVjdChtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNvdXJjZVR5cGUgPSBvcHRpb25zLmVudW1zID09PSBTdHJpbmcgPyBcIlVOS05PV05fU09VUkNFX1RZUEVcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZW5jb2RpbmdUeXBlID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gXCJVTktOT1dOX0VOQ09ESU5HX1RZUEVcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucGFyc2VyID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gXCJVTktOT1dOX1BBUlNFUlwiIDogMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zb3VyY2VUeXBlICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInNvdXJjZVR5cGVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Quc291cmNlVHlwZSA9IG9wdGlvbnMuZW51bXMgPT09IFN0cmluZyA/ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mby5Tb3VyY2VUeXBlW21lc3NhZ2Uuc291cmNlVHlwZV0gOiBtZXNzYWdlLnNvdXJjZVR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmVuY29kaW5nVHlwZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJlbmNvZGluZ1R5cGVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZW5jb2RpbmdUeXBlID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLkVuY29kaW5nVHlwZVttZXNzYWdlLmVuY29kaW5nVHlwZV0gOiBtZXNzYWdlLmVuY29kaW5nVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGFyc2VyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInBhcnNlclwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5wYXJzZXIgPSBvcHRpb25zLmVudW1zID09PSBTdHJpbmcgPyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8uUGFyc2VyW21lc3NhZ2UucGFyc2VyXSA6IG1lc3NhZ2UucGFyc2VyO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFNvdXJjZUluZm8gdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU291cmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTb3VyY2VJbmZvLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTb3VyY2VUeXBlIGVudW0uXG4gICAgICAgICAgICAgICAgICogQG5hbWUgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLlNvdXJjZVR5cGVcbiAgICAgICAgICAgICAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBVTktOT1dOX1NPVVJDRV9UWVBFPTAgVU5LTk9XTl9TT1VSQ0VfVFlQRSB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBTQ09SRV9CQVNFRD0xIFNDT1JFX0JBU0VEIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFBFUkZPUk1BTkNFX0JBU0VEPTIgUEVSRk9STUFOQ0VfQkFTRUQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTb3VyY2VJbmZvLlNvdXJjZVR5cGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZXNCeUlkID0ge30sIHZhbHVlcyA9IE9iamVjdC5jcmVhdGUodmFsdWVzQnlJZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzBdID0gXCJVTktOT1dOX1NPVVJDRV9UWVBFXCJdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMV0gPSBcIlNDT1JFX0JBU0VEXCJdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMl0gPSBcIlBFUkZPUk1BTkNFX0JBU0VEXCJdID0gMjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICAgICAgICB9KSgpO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RpbmdUeXBlIGVudW0uXG4gICAgICAgICAgICAgICAgICogQG5hbWUgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5Tb3VyY2VJbmZvLkVuY29kaW5nVHlwZVxuICAgICAgICAgICAgICAgICAqIEBlbnVtIHtzdHJpbmd9XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFVOS05PV05fRU5DT0RJTkdfVFlQRT0wIFVOS05PV05fRU5DT0RJTkdfVFlQRSB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBNVVNJQ19YTUw9MSBNVVNJQ19YTUwgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gQUJDPTIgQUJDIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE1JREk9MyBNSURJIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE1VU0lDTkVUPTQgTVVTSUNORVQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTb3VyY2VJbmZvLkVuY29kaW5nVHlwZSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlc0J5SWQgPSB7fSwgdmFsdWVzID0gT2JqZWN0LmNyZWF0ZSh2YWx1ZXNCeUlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMF0gPSBcIlVOS05PV05fRU5DT0RJTkdfVFlQRVwiXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzFdID0gXCJNVVNJQ19YTUxcIl0gPSAxO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsyXSA9IFwiQUJDXCJdID0gMjtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbM10gPSBcIk1JRElcIl0gPSAzO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFs0XSA9IFwiTVVTSUNORVRcIl0gPSA0O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQYXJzZXIgZW51bS5cbiAgICAgICAgICAgICAgICAgKiBAbmFtZSB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNvdXJjZUluZm8uUGFyc2VyXG4gICAgICAgICAgICAgICAgICogQGVudW0ge3N0cmluZ31cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gVU5LTk9XTl9QQVJTRVI9MCBVTktOT1dOX1BBUlNFUiB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBNVVNJQzIxPTEgTVVTSUMyMSB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQUkVUVFlfTUlEST0yIFBSRVRUWV9NSURJIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE1BR0VOVEFfTVVTSUNfWE1MPTMgTUFHRU5UQV9NVVNJQ19YTUwgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTUFHRU5UQV9NVVNJQ05FVD00IE1BR0VOVEFfTVVTSUNORVQgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTUFHRU5UQV9BQkM9NSBNQUdFTlRBX0FCQyB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBUT05FSlNfTUlESV9DT05WRVJUPTYgVE9ORUpTX01JRElfQ09OVkVSVCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNvdXJjZUluZm8uUGFyc2VyID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVzQnlJZCA9IHt9LCB2YWx1ZXMgPSBPYmplY3QuY3JlYXRlKHZhbHVlc0J5SWQpO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFswXSA9IFwiVU5LTk9XTl9QQVJTRVJcIl0gPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxXSA9IFwiTVVTSUMyMVwiXSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzJdID0gXCJQUkVUVFlfTUlESVwiXSA9IDI7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzNdID0gXCJNQUdFTlRBX01VU0lDX1hNTFwiXSA9IDM7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1t2YWx1ZXNCeUlkWzRdID0gXCJNQUdFTlRBX01VU0lDTkVUXCJdID0gNDtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbNV0gPSBcIk1BR0VOVEFfQUJDXCJdID0gNTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbNl0gPSBcIlRPTkVKU19NSURJX0NPTlZFUlRcIl0gPSA2O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gU291cmNlSW5mbztcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbiA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFByb3BlcnRpZXMgb2YgYSBUZXh0QW5ub3RhdGlvbi5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBpbnRlcmZhY2UgSVRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIFRleHRBbm5vdGF0aW9uIHRpbWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbcXVhbnRpemVkU3RlcF0gVGV4dEFubm90YXRpb24gcXVhbnRpemVkU3RlcFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfG51bGx9IFt0ZXh0XSBUZXh0QW5ub3RhdGlvbiB0ZXh0XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uLlRleHRBbm5vdGF0aW9uVHlwZXxudWxsfSBbYW5ub3RhdGlvblR5cGVdIFRleHRBbm5vdGF0aW9uIGFubm90YXRpb25UeXBlXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IFRleHRBbm5vdGF0aW9uLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgVGV4dEFubm90YXRpb24uXG4gICAgICAgICAgICAgICAgICogQGltcGxlbWVudHMgSVRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUZXh0QW5ub3RhdGlvbj19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFRleHRBbm5vdGF0aW9uKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleXNbaV1dID0gcHJvcGVydGllc1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBUZXh0QW5ub3RhdGlvbiB0aW1lLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gdGltZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGV4dEFubm90YXRpb24ucHJvdG90eXBlLnRpbWUgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVGV4dEFubm90YXRpb24gcXVhbnRpemVkU3RlcC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IHF1YW50aXplZFN0ZXBcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLnByb3RvdHlwZS5xdWFudGl6ZWRTdGVwID0gJHV0aWwuTG9uZyA/ICR1dGlsLkxvbmcuZnJvbUJpdHMoMCwwLGZhbHNlKSA6IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBUZXh0QW5ub3RhdGlvbiB0ZXh0LlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge3N0cmluZ30gdGV4dFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGV4dEFubm90YXRpb24ucHJvdG90eXBlLnRleHQgPSBcIlwiO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVGV4dEFubm90YXRpb24gYW5ub3RhdGlvblR5cGUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbi5UZXh0QW5ub3RhdGlvblR5cGV9IGFubm90YXRpb25UeXBlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZXh0QW5ub3RhdGlvbi5wcm90b3R5cGUuYW5ub3RhdGlvblR5cGUgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBUZXh0QW5ub3RhdGlvbiBpbnN0YW5jZSB1c2luZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JVGV4dEFubm90YXRpb249fSBbcHJvcGVydGllc10gUHJvcGVydGllcyB0byBzZXRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbn0gVGV4dEFubm90YXRpb24gaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZXh0QW5ub3RhdGlvbi5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRleHRBbm5vdGF0aW9uKHByb3BlcnRpZXMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgVGV4dEFubm90YXRpb24gbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbi52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklUZXh0QW5ub3RhdGlvbn0gbWVzc2FnZSBUZXh0QW5ub3RhdGlvbiBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgVGV4dEFubm90YXRpb24uZW5jb2RlID0gZnVuY3Rpb24gZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdyaXRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlciA9ICRXcml0ZXIuY3JlYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMSA9Ki85KS5kb3VibGUobWVzc2FnZS50aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGV4dCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0ZXh0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAyID0qLzE4KS5zdHJpbmcobWVzc2FnZS50ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuYW5ub3RhdGlvblR5cGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiYW5ub3RhdGlvblR5cGVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDMsIHdpcmVUeXBlIDAgPSovMjQpLmludDMyKG1lc3NhZ2UuYW5ub3RhdGlvblR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6ZWRTdGVwICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXplZFN0ZXBcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDQsIHdpcmVUeXBlIDAgPSovMzIpLmludDY0KG1lc3NhZ2UucXVhbnRpemVkU3RlcCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZXI7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBUZXh0QW5ub3RhdGlvbiBtZXNzYWdlLCBsZW5ndGggZGVsaW1pdGVkLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVRleHRBbm5vdGF0aW9ufSBtZXNzYWdlIFRleHRBbm5vdGF0aW9uIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZXh0QW5ub3RhdGlvbi5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuY29kZShtZXNzYWdlLCB3cml0ZXIpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgVGV4dEFubm90YXRpb24gbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlci5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbn0gVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9ICRSZWFkZXIuY3JlYXRlKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSByZWFkZXIudWludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZyA+Pj4gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudGltZSA9IHJlYWRlci5kb3VibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnF1YW50aXplZFN0ZXAgPSAkdXRpbC5Mb25nP3JlYWRlci5pbnQ2NCgpLnRvTnVtYmVyKCk6cmVhZGVyLmludDY0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50ZXh0ID0gcmVhZGVyLnN0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5ub3RhdGlvblR5cGUgPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnNraXBUeXBlKHRhZyAmIDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgVGV4dEFubm90YXRpb24gbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlciwgbGVuZ3RoIGRlbGltaXRlZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb259IFRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZXh0QW5ub3RhdGlvbi5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVmVyaWZpZXMgYSBUZXh0QW5ub3RhdGlvbiBtZXNzYWdlLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBtZXNzYWdlIFBsYWluIG9iamVjdCB0byB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IGBudWxsYCBpZiB2YWxpZCwgb3RoZXJ3aXNlIHRoZSByZWFzb24gd2h5IGl0IGlzIG5vdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGltZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS50aW1lICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRpbWU6IG51bWJlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6ZWRTdGVwICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXplZFN0ZXBcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnF1YW50aXplZFN0ZXApICYmICEobWVzc2FnZS5xdWFudGl6ZWRTdGVwICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnF1YW50aXplZFN0ZXAubG93KSAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5xdWFudGl6ZWRTdGVwLmhpZ2gpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJxdWFudGl6ZWRTdGVwOiBpbnRlZ2VyfExvbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGV4dCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0ZXh0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLnRleHQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRleHQ6IHN0cmluZyBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5hbm5vdGF0aW9uVHlwZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJhbm5vdGF0aW9uVHlwZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZS5hbm5vdGF0aW9uVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJhbm5vdGF0aW9uVHlwZTogZW51bSB2YWx1ZSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIFRleHRBbm5vdGF0aW9uIG1lc3NhZ2UgZnJvbSBhIHBsYWluIG9iamVjdC4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gdGhlaXIgcmVzcGVjdGl2ZSBpbnRlcm5hbCB0eXBlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZnJvbU9iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG9iamVjdCBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbn0gVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBUZXh0QW5ub3RhdGlvbi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gZnJvbU9iamVjdChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb24pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QudGltZSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gTnVtYmVyKG9iamVjdC50aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5xdWFudGl6ZWRTdGVwICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gJHV0aWwuTG9uZy5mcm9tVmFsdWUob2JqZWN0LnF1YW50aXplZFN0ZXApKS51bnNpZ25lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5xdWFudGl6ZWRTdGVwID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucXVhbnRpemVkU3RlcCA9IHBhcnNlSW50KG9iamVjdC5xdWFudGl6ZWRTdGVwLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXplZFN0ZXAgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gb2JqZWN0LnF1YW50aXplZFN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnF1YW50aXplZFN0ZXAgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5xdWFudGl6ZWRTdGVwID0gbmV3ICR1dGlsLkxvbmdCaXRzKG9iamVjdC5xdWFudGl6ZWRTdGVwLmxvdyA+Pj4gMCwgb2JqZWN0LnF1YW50aXplZFN0ZXAuaGlnaCA+Pj4gMCkudG9OdW1iZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC50ZXh0ICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRleHQgPSBTdHJpbmcob2JqZWN0LnRleHQpO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG9iamVjdC5hbm5vdGF0aW9uVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVU5LTk9XTlwiOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFubm90YXRpb25UeXBlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ0hPUkRfU1lNQk9MXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5ub3RhdGlvblR5cGUgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCRUFUXCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5ub3RhdGlvblR5cGUgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFRleHRBbm5vdGF0aW9uIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuVGV4dEFubm90YXRpb259IG1lc3NhZ2UgVGV4dEFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5JQ29udmVyc2lvbk9wdGlvbnN9IFtvcHRpb25zXSBDb252ZXJzaW9uIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50aW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC50ZXh0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5hbm5vdGF0aW9uVHlwZSA9IG9wdGlvbnMuZW51bXMgPT09IFN0cmluZyA/IFwiVU5LTk9XTlwiIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdXRpbC5Mb25nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvbmcgPSBuZXcgJHV0aWwuTG9uZygwLCAwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXplZFN0ZXAgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBsb25nLnRvU3RyaW5nKCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBsb25nLnRvTnVtYmVyKCkgOiBsb25nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnF1YW50aXplZFN0ZXAgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBcIjBcIiA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRpbWUgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2UudGltZSkgPyBTdHJpbmcobWVzc2FnZS50aW1lKSA6IG1lc3NhZ2UudGltZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGV4dCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0ZXh0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnRleHQgPSBtZXNzYWdlLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmFubm90YXRpb25UeXBlICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImFubm90YXRpb25UeXBlXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmFubm90YXRpb25UeXBlID0gb3B0aW9ucy5lbnVtcyA9PT0gU3RyaW5nID8gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5UZXh0QW5ub3RhdGlvbi5UZXh0QW5ub3RhdGlvblR5cGVbbWVzc2FnZS5hbm5vdGF0aW9uVHlwZV0gOiBtZXNzYWdlLmFubm90YXRpb25UeXBlO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5xdWFudGl6ZWRTdGVwICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInF1YW50aXplZFN0ZXBcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UucXVhbnRpemVkU3RlcCA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucXVhbnRpemVkU3RlcCA9IG9wdGlvbnMubG9uZ3MgPT09IFN0cmluZyA/IFN0cmluZyhtZXNzYWdlLnF1YW50aXplZFN0ZXApIDogbWVzc2FnZS5xdWFudGl6ZWRTdGVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5xdWFudGl6ZWRTdGVwID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gJHV0aWwuTG9uZy5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtZXNzYWdlLnF1YW50aXplZFN0ZXApIDogb3B0aW9ucy5sb25ncyA9PT0gTnVtYmVyID8gbmV3ICR1dGlsLkxvbmdCaXRzKG1lc3NhZ2UucXVhbnRpemVkU3RlcC5sb3cgPj4+IDAsIG1lc3NhZ2UucXVhbnRpemVkU3RlcC5oaWdoID4+PiAwKS50b051bWJlcigpIDogbWVzc2FnZS5xdWFudGl6ZWRTdGVwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFRleHRBbm5vdGF0aW9uIHRvIEpTT04uXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvSlNPTlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBUZXh0QW5ub3RhdGlvblR5cGUgZW51bS5cbiAgICAgICAgICAgICAgICAgKiBAbmFtZSB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlRleHRBbm5vdGF0aW9uLlRleHRBbm5vdGF0aW9uVHlwZVxuICAgICAgICAgICAgICAgICAqIEBlbnVtIHtzdHJpbmd9XG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFVOS05PV049MCBVTktOT1dOIHZhbHVlXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IENIT1JEX1NZTUJPTD0xIENIT1JEX1NZTUJPTCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBCRUFUPTIgQkVBVCB2YWx1ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFRleHRBbm5vdGF0aW9uLlRleHRBbm5vdGF0aW9uVHlwZSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlc0J5SWQgPSB7fSwgdmFsdWVzID0gT2JqZWN0LmNyZWF0ZSh2YWx1ZXNCeUlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMF0gPSBcIlVOS05PV05cIl0gPSAwO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbdmFsdWVzQnlJZFsxXSA9IFwiQ0hPUkRfU1lNQk9MXCJdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW3ZhbHVlc0J5SWRbMl0gPSBcIkJFQVRcIl0gPSAyO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dEFubm90YXRpb247XG4gICAgICAgICAgICB9KSgpO1xuXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mbyA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFByb3BlcnRpZXMgb2YgYSBRdWFudGl6YXRpb25JbmZvLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtzdGVwc1BlclF1YXJ0ZXJdIFF1YW50aXphdGlvbkluZm8gc3RlcHNQZXJRdWFydGVyXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3N0ZXBzUGVyU2Vjb25kXSBRdWFudGl6YXRpb25JbmZvIHN0ZXBzUGVyU2Vjb25kXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IFF1YW50aXphdGlvbkluZm8uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBRdWFudGl6YXRpb25JbmZvLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElRdWFudGl6YXRpb25JbmZvXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklRdWFudGl6YXRpb25JbmZvPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gUXVhbnRpemF0aW9uSW5mbyhwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUXVhbnRpemF0aW9uSW5mbyBzdGVwc1BlclF1YXJ0ZXIuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBzdGVwc1BlclF1YXJ0ZXJcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5RdWFudGl6YXRpb25JbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUXVhbnRpemF0aW9uSW5mby5wcm90b3R5cGUuc3RlcHNQZXJRdWFydGVyID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFF1YW50aXphdGlvbkluZm8gc3RlcHNQZXJTZWNvbmQuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBzdGVwc1BlclNlY29uZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBRdWFudGl6YXRpb25JbmZvLnByb3RvdHlwZS5zdGVwc1BlclNlY29uZCA9IDA7XG5cbiAgICAgICAgICAgICAgICAvLyBPbmVPZiBmaWVsZCBuYW1lcyBib3VuZCB0byB2aXJ0dWFsIGdldHRlcnMgYW5kIHNldHRlcnNcbiAgICAgICAgICAgICAgICB2YXIgJG9uZU9mRmllbGRzO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUXVhbnRpemF0aW9uSW5mbyByZXNvbHV0aW9uLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge1wic3RlcHNQZXJRdWFydGVyXCJ8XCJzdGVwc1BlclNlY29uZFwifHVuZGVmaW5lZH0gcmVzb2x1dGlvblxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUXVhbnRpemF0aW9uSW5mby5wcm90b3R5cGUsIFwicmVzb2x1dGlvblwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGdldDogJHV0aWwub25lT2ZHZXR0ZXIoJG9uZU9mRmllbGRzID0gW1wic3RlcHNQZXJRdWFydGVyXCIsIFwic3RlcHNQZXJTZWNvbmRcIl0pLFxuICAgICAgICAgICAgICAgICAgICBzZXQ6ICR1dGlsLm9uZU9mU2V0dGVyKCRvbmVPZkZpZWxkcylcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgUXVhbnRpemF0aW9uSW5mbyBpbnN0YW5jZSB1c2luZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklRdWFudGl6YXRpb25JbmZvPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb30gUXVhbnRpemF0aW9uSW5mbyBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFF1YW50aXphdGlvbkluZm8uY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWFudGl6YXRpb25JbmZvKHByb3BlcnRpZXMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgUXVhbnRpemF0aW9uSW5mbyBtZXNzYWdlLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm8udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklRdWFudGl6YXRpb25JbmZvfSBtZXNzYWdlIFF1YW50aXphdGlvbkluZm8gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFF1YW50aXphdGlvbkluZm8uZW5jb2RlID0gZnVuY3Rpb24gZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdyaXRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlciA9ICRXcml0ZXIuY3JlYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN0ZXBzUGVyUXVhcnRlciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdGVwc1BlclF1YXJ0ZXJcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEsIHdpcmVUeXBlIDAgPSovOCkuaW50MzIobWVzc2FnZS5zdGVwc1BlclF1YXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGVwc1BlclNlY29uZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdGVwc1BlclNlY29uZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMiwgd2lyZVR5cGUgMCA9Ki8xNikuaW50MzIobWVzc2FnZS5zdGVwc1BlclNlY29uZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZXI7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBRdWFudGl6YXRpb25JbmZvIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mby52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVF1YW50aXphdGlvbkluZm99IG1lc3NhZ2UgUXVhbnRpemF0aW9uSW5mbyBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUXVhbnRpemF0aW9uSW5mby5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuY29kZShtZXNzYWdlLCB3cml0ZXIpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgUXVhbnRpemF0aW9uSW5mbyBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5RdWFudGl6YXRpb25JbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb30gUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUXVhbnRpemF0aW9uSW5mby5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSByZWFkZXIudWludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZyA+Pj4gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc3RlcHNQZXJRdWFydGVyID0gcmVhZGVyLmludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zdGVwc1BlclNlY29uZCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBRdWFudGl6YXRpb25JbmZvIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIsIGxlbmd0aCBkZWxpbWl0ZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb30gUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgUXVhbnRpemF0aW9uSW5mby5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVmVyaWZpZXMgYSBRdWFudGl6YXRpb25JbmZvIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gbWVzc2FnZSBQbGFpbiBvYmplY3QgdG8gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBgbnVsbGAgaWYgdmFsaWQsIG90aGVyd2lzZSB0aGUgcmVhc29uIHdoeSBpdCBpcyBub3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBRdWFudGl6YXRpb25JbmZvLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN0ZXBzUGVyUXVhcnRlciAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdGVwc1BlclF1YXJ0ZXJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucmVzb2x1dGlvbiA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnN0ZXBzUGVyUXVhcnRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic3RlcHNQZXJRdWFydGVyOiBpbnRlZ2VyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RlcHNQZXJTZWNvbmQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic3RlcHNQZXJTZWNvbmRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLnJlc29sdXRpb24gPT09IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwicmVzb2x1dGlvbjogbXVsdGlwbGUgdmFsdWVzXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnJlc29sdXRpb24gPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5zdGVwc1BlclNlY29uZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic3RlcHNQZXJTZWNvbmQ6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIFF1YW50aXphdGlvbkluZm8gbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBmcm9tT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBvYmplY3QgUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb30gUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFF1YW50aXphdGlvbkluZm8uZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm8pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlF1YW50aXphdGlvbkluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5zdGVwc1BlclF1YXJ0ZXIgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc3RlcHNQZXJRdWFydGVyID0gb2JqZWN0LnN0ZXBzUGVyUXVhcnRlciB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3Quc3RlcHNQZXJTZWNvbmQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc3RlcHNQZXJTZWNvbmQgPSBvYmplY3Quc3RlcHNQZXJTZWNvbmQgfCAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIHBsYWluIG9iamVjdCBmcm9tIGEgUXVhbnRpemF0aW9uSW5mbyBtZXNzYWdlLiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byBvdGhlciB0eXBlcyBpZiBzcGVjaWZpZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb30gbWVzc2FnZSBRdWFudGl6YXRpb25JbmZvXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuSUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBRdWFudGl6YXRpb25JbmZvLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RlcHNQZXJRdWFydGVyICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInN0ZXBzUGVyUXVhcnRlclwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnN0ZXBzUGVyUXVhcnRlciA9IG1lc3NhZ2Uuc3RlcHNQZXJRdWFydGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMub25lb2ZzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5yZXNvbHV0aW9uID0gXCJzdGVwc1BlclF1YXJ0ZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGVwc1BlclNlY29uZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdGVwc1BlclNlY29uZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnN0ZXBzUGVyU2Vjb25kID0gbWVzc2FnZS5zdGVwc1BlclNlY29uZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm9uZW9mcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QucmVzb2x1dGlvbiA9IFwic3RlcHNQZXJTZWNvbmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFF1YW50aXphdGlvbkluZm8gdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuUXVhbnRpemF0aW9uSW5mb1xuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBRdWFudGl6YXRpb25JbmZvLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gUXVhbnRpemF0aW9uSW5mbztcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm8gPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQcm9wZXJ0aWVzIG9mIGEgU3Vic2VxdWVuY2VJbmZvLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGludGVyZmFjZSBJU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3N0YXJ0VGltZU9mZnNldF0gU3Vic2VxdWVuY2VJbmZvIHN0YXJ0VGltZU9mZnNldFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfG51bGx9IFtlbmRUaW1lT2Zmc2V0XSBTdWJzZXF1ZW5jZUluZm8gZW5kVGltZU9mZnNldFxuICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29uc3RydWN0cyBhIG5ldyBTdWJzZXF1ZW5jZUluZm8uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBTdWJzZXF1ZW5jZUluZm8uXG4gICAgICAgICAgICAgICAgICogQGltcGxlbWVudHMgSVN1YnNlcXVlbmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU3Vic2VxdWVuY2VJbmZvPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gU3Vic2VxdWVuY2VJbmZvKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleXNbaV1dID0gcHJvcGVydGllc1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTdWJzZXF1ZW5jZUluZm8gc3RhcnRUaW1lT2Zmc2V0LlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gc3RhcnRUaW1lT2Zmc2V0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU3Vic2VxdWVuY2VJbmZvLnByb3RvdHlwZS5zdGFydFRpbWVPZmZzZXQgPSAwO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogU3Vic2VxdWVuY2VJbmZvIGVuZFRpbWVPZmZzZXQuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBlbmRUaW1lT2Zmc2V0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU3Vic2VxdWVuY2VJbmZvLnByb3RvdHlwZS5lbmRUaW1lT2Zmc2V0ID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgU3Vic2VxdWVuY2VJbmZvIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU3Vic2VxdWVuY2VJbmZvPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvfSBTdWJzZXF1ZW5jZUluZm8gaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTdWJzZXF1ZW5jZUluZm8uY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdWJzZXF1ZW5jZUluZm8ocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBTdWJzZXF1ZW5jZUluZm8gbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm8udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlN1YnNlcXVlbmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVN1YnNlcXVlbmNlSW5mb30gbWVzc2FnZSBTdWJzZXF1ZW5jZUluZm8gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFN1YnNlcXVlbmNlSW5mby5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RhcnRUaW1lT2Zmc2V0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInN0YXJ0VGltZU9mZnNldFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMSA9Ki85KS5kb3VibGUobWVzc2FnZS5zdGFydFRpbWVPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5lbmRUaW1lT2Zmc2V0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImVuZFRpbWVPZmZzZXRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDEgPSovMTcpLmRvdWJsZShtZXNzYWdlLmVuZFRpbWVPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgU3Vic2VxdWVuY2VJbmZvIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTdWJzZXF1ZW5jZUluZm99IG1lc3NhZ2UgU3Vic2VxdWVuY2VJbmZvIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTdWJzZXF1ZW5jZUluZm8uZW5jb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGUobWVzc2FnZSwgd3JpdGVyKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFN1YnNlcXVlbmNlSW5mbyBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm99IFN1YnNlcXVlbmNlSW5mb1xuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU3Vic2VxdWVuY2VJbmZvLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9ICRSZWFkZXIuY3JlYXRlKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIucG9zIDwgZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gcmVhZGVyLnVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnN0YXJ0VGltZU9mZnNldCA9IHJlYWRlci5kb3VibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVuZFRpbWVPZmZzZXQgPSByZWFkZXIuZG91YmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFN1YnNlcXVlbmNlSW5mbyBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvfSBTdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFN1YnNlcXVlbmNlSW5mby5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVmVyaWZpZXMgYSBTdWJzZXF1ZW5jZUluZm8gbWVzc2FnZS5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdmVyaWZ5XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU3Vic2VxdWVuY2VJbmZvLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0IGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN0YXJ0VGltZU9mZnNldCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzdGFydFRpbWVPZmZzZXRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2Uuc3RhcnRUaW1lT2Zmc2V0ICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInN0YXJ0VGltZU9mZnNldDogbnVtYmVyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmVuZFRpbWVPZmZzZXQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwiZW5kVGltZU9mZnNldFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5lbmRUaW1lT2Zmc2V0ICE9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImVuZFRpbWVPZmZzZXQ6IG51bWJlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIFN1YnNlcXVlbmNlSW5mbyBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm9cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlN1YnNlcXVlbmNlSW5mb30gU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU3Vic2VxdWVuY2VJbmZvLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm8pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlN1YnNlcXVlbmNlSW5mbygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnN0YXJ0VGltZU9mZnNldCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zdGFydFRpbWVPZmZzZXQgPSBOdW1iZXIob2JqZWN0LnN0YXJ0VGltZU9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3QuZW5kVGltZU9mZnNldCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lbmRUaW1lT2Zmc2V0ID0gTnVtYmVyKG9iamVjdC5lbmRUaW1lT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFN1YnNlcXVlbmNlSW5mbyBtZXNzYWdlLiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byBvdGhlciB0eXBlcyBpZiBzcGVjaWZpZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TdWJzZXF1ZW5jZUluZm99IG1lc3NhZ2UgU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuSUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTdWJzZXF1ZW5jZUluZm8udG9PYmplY3QgPSBmdW5jdGlvbiB0b09iamVjdChtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnN0YXJ0VGltZU9mZnNldCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZW5kVGltZU9mZnNldCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RhcnRUaW1lT2Zmc2V0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInN0YXJ0VGltZU9mZnNldFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5zdGFydFRpbWVPZmZzZXQgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2Uuc3RhcnRUaW1lT2Zmc2V0KSA/IFN0cmluZyhtZXNzYWdlLnN0YXJ0VGltZU9mZnNldCkgOiBtZXNzYWdlLnN0YXJ0VGltZU9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZW5kVGltZU9mZnNldCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJlbmRUaW1lT2Zmc2V0XCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmVuZFRpbWVPZmZzZXQgPSBvcHRpb25zLmpzb24gJiYgIWlzRmluaXRlKG1lc3NhZ2UuZW5kVGltZU9mZnNldCkgPyBTdHJpbmcobWVzc2FnZS5lbmRUaW1lT2Zmc2V0KSA6IG1lc3NhZ2UuZW5kVGltZU9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBTdWJzZXF1ZW5jZUluZm8gdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU3Vic2VxdWVuY2VJbmZvXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFN1YnNlcXVlbmNlSW5mby5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFN1YnNlcXVlbmNlSW5mbztcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIE5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbiA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFByb3BlcnRpZXMgb2YgYSBTZWN0aW9uQW5ub3RhdGlvbi5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBpbnRlcmZhY2UgSVNlY3Rpb25Bbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW3RpbWVdIFNlY3Rpb25Bbm5vdGF0aW9uIHRpbWVcbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbc2VjdGlvbklkXSBTZWN0aW9uQW5ub3RhdGlvbiBzZWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgU2VjdGlvbkFubm90YXRpb24uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBTZWN0aW9uQW5ub3RhdGlvbi5cbiAgICAgICAgICAgICAgICAgKiBAaW1wbGVtZW50cyBJU2VjdGlvbkFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb25Bbm5vdGF0aW9uPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gU2VjdGlvbkFubm90YXRpb24ocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcylcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleXMgPSBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKSwgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2tleXNbaV1dICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5c1tpXV0gPSBwcm9wZXJ0aWVzW2tleXNbaV1dO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFNlY3Rpb25Bbm5vdGF0aW9uIHRpbWUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSB0aW1lXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uQW5ub3RhdGlvbi5wcm90b3R5cGUudGltZSA9IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTZWN0aW9uQW5ub3RhdGlvbiBzZWN0aW9uSWQuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBzZWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Bbm5vdGF0aW9uLnByb3RvdHlwZS5zZWN0aW9uSWQgPSAkdXRpbC5Mb25nID8gJHV0aWwuTG9uZy5mcm9tQml0cygwLDAsZmFsc2UpIDogMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgU2VjdGlvbkFubm90YXRpb24gaW5zdGFuY2UgdXNpbmcgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBjcmVhdGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb25Bbm5vdGF0aW9uPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb259IFNlY3Rpb25Bbm5vdGF0aW9uIGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkFubm90YXRpb24uY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWN0aW9uQW5ub3RhdGlvbihwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFNlY3Rpb25Bbm5vdGF0aW9uIG1lc3NhZ2UuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb24udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkFubm90YXRpb259IG1lc3NhZ2UgU2VjdGlvbkFubm90YXRpb24gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Bbm5vdGF0aW9uLmVuY29kZSA9IGZ1bmN0aW9uIGVuY29kZShtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSAkV3JpdGVyLmNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEsIHdpcmVUeXBlIDEgPSovOSkuZG91YmxlKG1lc3NhZ2UudGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlY3Rpb25JZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uSWRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDQsIHdpcmVUeXBlIDAgPSovMzIpLmludDY0KG1lc3NhZ2Uuc2VjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFNlY3Rpb25Bbm5vdGF0aW9uIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb24udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkFubm90YXRpb259IG1lc3NhZ2UgU2VjdGlvbkFubm90YXRpb24gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Bbm5vdGF0aW9uLmVuY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGVuY29kZURlbGltaXRlZChtZXNzYWdlLCB3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBTZWN0aW9uQW5ub3RhdGlvbiBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aF0gTWVzc2FnZSBsZW5ndGggaWYga25vd24gYmVmb3JlaGFuZFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9ufSBTZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkFubm90YXRpb24uZGVjb2RlID0gZnVuY3Rpb24gZGVjb2RlKHJlYWRlciwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gJFJlYWRlci5jcmVhdGUocmVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZCA9IGxlbmd0aCA9PT0gdW5kZWZpbmVkID8gcmVhZGVyLmxlbiA6IHJlYWRlci5wb3MgKyBsZW5ndGgsIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVhZGVyLnBvcyA8IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnID4+PiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aW1lID0gcmVhZGVyLmRvdWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbklkID0gJHV0aWwuTG9uZz9yZWFkZXIuaW50NjQoKS50b051bWJlcigpOnJlYWRlci5pbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBTZWN0aW9uQW5ub3RhdGlvbiBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbn0gU2VjdGlvbkFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Bbm5vdGF0aW9uLmRlY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZChyZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSBuZXcgJFJlYWRlcihyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBWZXJpZmllcyBhIFNlY3Rpb25Bbm5vdGF0aW9uIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkFubm90YXRpb24udmVyaWZ5ID0gZnVuY3Rpb24gdmVyaWZ5KG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIm9iamVjdFwiIHx8IG1lc3NhZ2UgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGltZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJ0aW1lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLnRpbWUgIT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGltZTogbnVtYmVyIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlY3Rpb25JZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uSWRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnNlY3Rpb25JZCkgJiYgIShtZXNzYWdlLnNlY3Rpb25JZCAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5zZWN0aW9uSWQubG93KSAmJiAkdXRpbC5pc0ludGVnZXIobWVzc2FnZS5zZWN0aW9uSWQuaGlnaCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInNlY3Rpb25JZDogaW50ZWdlcnxMb25nIGV4cGVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgU2VjdGlvbkFubm90YXRpb24gbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBmcm9tT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9ufSBTZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Bbm5vdGF0aW9uLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC50aW1lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpbWUgPSBOdW1iZXIob2JqZWN0LnRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnNlY3Rpb25JZCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR1dGlsLkxvbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1lc3NhZ2Uuc2VjdGlvbklkID0gJHV0aWwuTG9uZy5mcm9tVmFsdWUob2JqZWN0LnNlY3Rpb25JZCkpLnVuc2lnbmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb2JqZWN0LnNlY3Rpb25JZCA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnNlY3Rpb25JZCA9IHBhcnNlSW50KG9iamVjdC5zZWN0aW9uSWQsIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3Quc2VjdGlvbklkID09PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbklkID0gb2JqZWN0LnNlY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3Quc2VjdGlvbklkID09PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbklkID0gbmV3ICR1dGlsLkxvbmdCaXRzKG9iamVjdC5zZWN0aW9uSWQubG93ID4+PiAwLCBvYmplY3Quc2VjdGlvbklkLmhpZ2ggPj4+IDApLnRvTnVtYmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBTZWN0aW9uQW5ub3RhdGlvbiBtZXNzYWdlLiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byBvdGhlciB0eXBlcyBpZiBzcGVjaWZpZWQuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvT2JqZWN0XG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkFubm90YXRpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Bbm5vdGF0aW9ufSBtZXNzYWdlIFNlY3Rpb25Bbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuSUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uQW5ub3RhdGlvbi50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRlZmF1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb25nID0gbmV3ICR1dGlsLkxvbmcoMCwgMCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uSWQgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyBsb25nLnRvU3RyaW5nKCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBsb25nLnRvTnVtYmVyKCkgOiBsb25nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25JZCA9IG9wdGlvbnMubG9uZ3MgPT09IFN0cmluZyA/IFwiMFwiIDogMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50aW1lICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpbWVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QudGltZSA9IG9wdGlvbnMuanNvbiAmJiAhaXNGaW5pdGUobWVzc2FnZS50aW1lKSA/IFN0cmluZyhtZXNzYWdlLnRpbWUpIDogbWVzc2FnZS50aW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uSWQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VjdGlvbklkXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLnNlY3Rpb25JZCA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VjdGlvbklkID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gU3RyaW5nKG1lc3NhZ2Uuc2VjdGlvbklkKSA6IG1lc3NhZ2Uuc2VjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uSWQgPSBvcHRpb25zLmxvbmdzID09PSBTdHJpbmcgPyAkdXRpbC5Mb25nLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1lc3NhZ2Uuc2VjdGlvbklkKSA6IG9wdGlvbnMubG9uZ3MgPT09IE51bWJlciA/IG5ldyAkdXRpbC5Mb25nQml0cyhtZXNzYWdlLnNlY3Rpb25JZC5sb3cgPj4+IDAsIG1lc3NhZ2Uuc2VjdGlvbklkLmhpZ2ggPj4+IDApLnRvTnVtYmVyKCkgOiBtZXNzYWdlLnNlY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBTZWN0aW9uQW5ub3RhdGlvbiB0byBKU09OLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b0pTT05cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uQW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uQW5ub3RhdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlY3Rpb25Bbm5vdGF0aW9uO1xuICAgICAgICAgICAgfSkoKTtcblxuICAgICAgICAgICAgTm90ZVNlcXVlbmNlLlNlY3Rpb24gPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBQcm9wZXJ0aWVzIG9mIGEgU2VjdGlvbi5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBpbnRlcmZhY2UgSVNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbc2VjdGlvbklkXSBTZWN0aW9uIHNlY3Rpb25JZFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkdyb3VwfG51bGx9IFtzZWN0aW9uR3JvdXBdIFNlY3Rpb24gc2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IFNlY3Rpb24uXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2VcbiAgICAgICAgICAgICAgICAgKiBAY2xhc3NkZXNjIFJlcHJlc2VudHMgYSBTZWN0aW9uLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElTZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gU2VjdGlvbihwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNba2V5c1tpXV0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXlzW2ldXSA9IHByb3BlcnRpZXNba2V5c1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogU2VjdGlvbiBzZWN0aW9uSWQuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBzZWN0aW9uSWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi5wcm90b3R5cGUuc2VjdGlvbklkID0gJHV0aWwuTG9uZyA/ICR1dGlsLkxvbmcuZnJvbUJpdHMoMCwwLGZhbHNlKSA6IDA7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTZWN0aW9uIHNlY3Rpb25Hcm91cC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uR3JvdXB8bnVsbHx1bmRlZmluZWR9IHNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uLnByb3RvdHlwZS5zZWN0aW9uR3JvdXAgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy8gT25lT2YgZmllbGQgbmFtZXMgYm91bmQgdG8gdmlydHVhbCBnZXR0ZXJzIGFuZCBzZXR0ZXJzXG4gICAgICAgICAgICAgICAgdmFyICRvbmVPZkZpZWxkcztcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFNlY3Rpb24gc2VjdGlvblR5cGUuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7XCJzZWN0aW9uSWRcInxcInNlY3Rpb25Hcm91cFwifHVuZGVmaW5lZH0gc2VjdGlvblR5cGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlY3Rpb24ucHJvdG90eXBlLCBcInNlY3Rpb25UeXBlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0OiAkdXRpbC5vbmVPZkdldHRlcigkb25lT2ZGaWVsZHMgPSBbXCJzZWN0aW9uSWRcIiwgXCJzZWN0aW9uR3JvdXBcIl0pLFxuICAgICAgICAgICAgICAgICAgICBzZXQ6ICR1dGlsLm9uZU9mU2V0dGVyKCRvbmVPZkZpZWxkcylcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgU2VjdGlvbiBpbnN0YW5jZSB1c2luZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGNyZWF0ZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbn0gU2VjdGlvbiBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb24uY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWN0aW9uKHByb3BlcnRpZXMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgU2VjdGlvbiBtZXNzYWdlLiBEb2VzIG5vdCBpbXBsaWNpdGx5IHtAbGluayB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb24udmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9ufSBtZXNzYWdlIFNlY3Rpb24gbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb24uZW5jb2RlID0gZnVuY3Rpb24gZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdyaXRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlciA9ICRXcml0ZXIuY3JlYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlY3Rpb25JZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uSWRcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDEsIHdpcmVUeXBlIDAgPSovOCkuaW50NjQobWVzc2FnZS5zZWN0aW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uR3JvdXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VjdGlvbkdyb3VwXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAuZW5jb2RlKG1lc3NhZ2Uuc2VjdGlvbkdyb3VwLCB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDIgPSovMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZXI7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBTZWN0aW9uIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbi52ZXJpZnl8dmVyaWZ5fSBtZXNzYWdlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvblxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb259IG1lc3NhZ2UgU2VjdGlvbiBtZXNzYWdlIG9yIHBsYWluIG9iamVjdCB0byBlbmNvZGVcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuY29kZShtZXNzYWdlLCB3cml0ZXIpLmxkZWxpbSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgU2VjdGlvbiBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoXSBNZXNzYWdlIGxlbmd0aCBpZiBrbm93biBiZWZvcmVoYW5kXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbn0gU2VjdGlvblxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUocmVhZGVyLCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gbGVuZ3RoID09PSB1bmRlZmluZWQgPyByZWFkZXIubGVuIDogcmVhZGVyLnBvcyArIGxlbmd0aCwgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWcgPSByZWFkZXIudWludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZyA+Pj4gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbklkID0gJHV0aWwuTG9uZz9yZWFkZXIuaW50NjQoKS50b051bWJlcigpOnJlYWRlci5pbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbkdyb3VwID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnNraXBUeXBlKHRhZyAmIDcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBEZWNvZGVzIGEgU2VjdGlvbiBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb259IFNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBheWxvYWQgaXMgbm90IGEgcmVhZGVyIG9yIHZhbGlkIGJ1ZmZlclxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb24uZGVjb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkKHJlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFZlcmlmaWVzIGEgU2VjdGlvbiBtZXNzYWdlLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gYG51bGxgIGlmIHZhbGlkLCBvdGhlcndpc2UgdGhlIHJlYXNvbiB3aHkgaXQgaXMgbm90XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwib2JqZWN0XCIgfHwgbWVzc2FnZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uSWQgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VjdGlvbklkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnNlY3Rpb25UeXBlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNJbnRlZ2VyKG1lc3NhZ2Uuc2VjdGlvbklkKSAmJiAhKG1lc3NhZ2Uuc2VjdGlvbklkICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnNlY3Rpb25JZC5sb3cpICYmICR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLnNlY3Rpb25JZC5oaWdoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VjdGlvbklkOiBpbnRlZ2VyfExvbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uR3JvdXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VjdGlvbkdyb3VwXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcy5zZWN0aW9uVHlwZSA9PT0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJzZWN0aW9uVHlwZTogbXVsdGlwbGUgdmFsdWVzXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnNlY3Rpb25UeXBlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cC52ZXJpZnkobWVzc2FnZS5zZWN0aW9uR3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwic2VjdGlvbkdyb3VwLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBTZWN0aW9uIG1lc3NhZ2UgZnJvbSBhIHBsYWluIG9iamVjdC4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gdGhlaXIgcmVzcGVjdGl2ZSBpbnRlcm5hbCB0eXBlcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZnJvbU9iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb259IFNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3Quc2VjdGlvbklkICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHV0aWwuTG9uZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5zZWN0aW9uSWQgPSAkdXRpbC5Mb25nLmZyb21WYWx1ZShvYmplY3Quc2VjdGlvbklkKSkudW5zaWduZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmplY3Quc2VjdGlvbklkID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbklkID0gcGFyc2VJbnQob2JqZWN0LnNlY3Rpb25JZCwgMTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5zZWN0aW9uSWQgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9uSWQgPSBvYmplY3Quc2VjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdC5zZWN0aW9uSWQgPT09IFwib2JqZWN0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9uSWQgPSBuZXcgJHV0aWwuTG9uZ0JpdHMob2JqZWN0LnNlY3Rpb25JZC5sb3cgPj4+IDAsIG9iamVjdC5zZWN0aW9uSWQuaGlnaCA+Pj4gMCkudG9OdW1iZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5zZWN0aW9uR3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmplY3Quc2VjdGlvbkdyb3VwICE9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb24uc2VjdGlvbkdyb3VwOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnNlY3Rpb25Hcm91cCA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwLmZyb21PYmplY3Qob2JqZWN0LnNlY3Rpb25Hcm91cCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFNlY3Rpb24gbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb259IG1lc3NhZ2UgU2VjdGlvblxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnNlY3Rpb25JZCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uSWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZS5zZWN0aW9uSWQgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25JZCA9IG9wdGlvbnMubG9uZ3MgPT09IFN0cmluZyA/IFN0cmluZyhtZXNzYWdlLnNlY3Rpb25JZCkgOiBtZXNzYWdlLnNlY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VjdGlvbklkID0gb3B0aW9ucy5sb25ncyA9PT0gU3RyaW5nID8gJHV0aWwuTG9uZy5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChtZXNzYWdlLnNlY3Rpb25JZCkgOiBvcHRpb25zLmxvbmdzID09PSBOdW1iZXIgPyBuZXcgJHV0aWwuTG9uZ0JpdHMobWVzc2FnZS5zZWN0aW9uSWQubG93ID4+PiAwLCBtZXNzYWdlLnNlY3Rpb25JZC5oaWdoID4+PiAwKS50b051bWJlcigpIDogbWVzc2FnZS5zZWN0aW9uSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5vbmVvZnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25UeXBlID0gXCJzZWN0aW9uSWRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9uR3JvdXAgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwic2VjdGlvbkdyb3VwXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VjdGlvbkdyb3VwID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAudG9PYmplY3QobWVzc2FnZS5zZWN0aW9uR3JvdXAsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMub25lb2ZzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5zZWN0aW9uVHlwZSA9IFwic2VjdGlvbkdyb3VwXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBTZWN0aW9uIHRvIEpTT04uXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvSlNPTlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25cbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IEpTT04gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlY3Rpb247XG4gICAgICAgICAgICB9KSgpO1xuXG4gICAgICAgICAgICBOb3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIFNlY3Rpb25Hcm91cC5cbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAqIEBpbnRlcmZhY2UgSVNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb24+fG51bGx9IFtzZWN0aW9uc10gU2VjdGlvbkdyb3VwIHNlY3Rpb25zXG4gICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW251bVRpbWVzXSBTZWN0aW9uR3JvdXAgbnVtVGltZXNcbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgU2VjdGlvbkdyb3VwLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlXG4gICAgICAgICAgICAgICAgICogQGNsYXNzZGVzYyBSZXByZXNlbnRzIGEgU2VjdGlvbkdyb3VwLlxuICAgICAgICAgICAgICAgICAqIEBpbXBsZW1lbnRzIElTZWN0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb25Hcm91cD19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFNlY3Rpb25Hcm91cChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyksIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2tleXNbaV1dID0gcHJvcGVydGllc1trZXlzW2ldXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBTZWN0aW9uR3JvdXAgc2VjdGlvbnMuXG4gICAgICAgICAgICAgICAgICogQG1lbWJlciB7QXJyYXkuPHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb24+fSBzZWN0aW9uc1xuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Hcm91cC5wcm90b3R5cGUuc2VjdGlvbnMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogU2VjdGlvbkdyb3VwIG51bVRpbWVzLlxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXIge251bWJlcn0gbnVtVGltZXNcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uR3JvdXAucHJvdG90eXBlLm51bVRpbWVzID0gMDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgU2VjdGlvbkdyb3VwIGluc3RhbmNlIHVzaW5nIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5JU2VjdGlvbkdyb3VwPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwfSBTZWN0aW9uR3JvdXAgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uR3JvdXAuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWN0aW9uR3JvdXAocHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBTZWN0aW9uR3JvdXAgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuSVNlY3Rpb25Hcm91cH0gbWVzc2FnZSBTZWN0aW9uR3JvdXAgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMgeyRwcm90b2J1Zi5Xcml0ZXJ9IFdyaXRlclxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Hcm91cC5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyID0gJFdyaXRlci5jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc2VjdGlvbnMgIT0gbnVsbCAmJiBtZXNzYWdlLnNlY3Rpb25zLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5zZWN0aW9ucy5sZW5ndGg7ICsraSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb24uZW5jb2RlKG1lc3NhZ2Uuc2VjdGlvbnNbaV0sIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMiA9Ki8xMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubnVtVGltZXMgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtVGltZXNcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDIsIHdpcmVUeXBlIDAgPSovMTYpLmludDMyKG1lc3NhZ2UubnVtVGltZXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgU2VjdGlvbkdyb3VwIG1lc3NhZ2UsIGxlbmd0aCBkZWxpbWl0ZWQuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLklTZWN0aW9uR3JvdXB9IG1lc3NhZ2UgU2VjdGlvbkdyb3VwIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLldyaXRlcn0gW3dyaXRlcl0gV3JpdGVyIHRvIGVuY29kZSB0b1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uR3JvdXAuZW5jb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGUobWVzc2FnZSwgd3JpdGVyKS5sZGVsaW0oKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRGVjb2RlcyBhIFNlY3Rpb25Hcm91cCBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXB9IFNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7JHByb3RvYnVmLnV0aWwuUHJvdG9jb2xFcnJvcn0gSWYgcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkdyb3VwLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9ICRSZWFkZXIuY3JlYXRlKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZWFkZXIucG9zIDwgZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gcmVhZGVyLnVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLnNlY3Rpb25zICYmIG1lc3NhZ2Uuc2VjdGlvbnMubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2VjdGlvbnMucHVzaCgkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb24uZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5udW1UaW1lcyA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIERlY29kZXMgYSBTZWN0aW9uR3JvdXAgbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlciwgbGVuZ3RoIGRlbGltaXRlZC5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cH0gU2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBTZWN0aW9uR3JvdXAuZGVjb2RlRGVsaW1pdGVkID0gZnVuY3Rpb24gZGVjb2RlRGVsaW1pdGVkKHJlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZShyZWFkZXIsIHJlYWRlci51aW50MzIoKSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFZlcmlmaWVzIGEgU2VjdGlvbkdyb3VwIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIHZlcmlmeVxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBtZXNzYWdlIFBsYWluIG9iamVjdCB0byB2ZXJpZnlcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IGBudWxsYCBpZiB2YWxpZCwgb3RoZXJ3aXNlIHRoZSByZWFzb24gd2h5IGl0IGlzIG5vdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Hcm91cC52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgIT09IFwib2JqZWN0XCIgfHwgbWVzc2FnZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9ucyAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJzZWN0aW9uc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG1lc3NhZ2Uuc2VjdGlvbnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInNlY3Rpb25zOiBhcnJheSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLnNlY3Rpb25zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uLnZlcmlmeShtZXNzYWdlLnNlY3Rpb25zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInNlY3Rpb25zLlwiICsgZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubnVtVGltZXMgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibnVtVGltZXNcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLm51bVRpbWVzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJudW1UaW1lczogaW50ZWdlciBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIFNlY3Rpb25Hcm91cCBtZXNzYWdlIGZyb20gYSBwbGFpbiBvYmplY3QuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIHRoZWlyIHJlc3BlY3RpdmUgaW50ZXJuYWwgdHlwZXMuXG4gICAgICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cH0gU2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkdyb3VwLmZyb21PYmplY3QgPSBmdW5jdGlvbiBmcm9tT2JqZWN0KG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXApXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyAkcm9vdC50ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0LnNlY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LnNlY3Rpb25zKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCIudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uR3JvdXAuc2VjdGlvbnM6IGFycmF5IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmplY3Quc2VjdGlvbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iamVjdC5zZWN0aW9uc1tpXSAhPT0gXCJvYmplY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiLnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwLnNlY3Rpb25zOiBvYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5zZWN0aW9uc1tpXSA9ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbi5mcm9tT2JqZWN0KG9iamVjdC5zZWN0aW9uc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdC5udW1UaW1lcyAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5udW1UaW1lcyA9IG9iamVjdC5udW1UaW1lcyB8IDA7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBTZWN0aW9uR3JvdXAgbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuTm90ZVNlcXVlbmNlLlNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwfSBtZXNzYWdlIFNlY3Rpb25Hcm91cFxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gUGxhaW4gb2JqZWN0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgU2VjdGlvbkdyb3VwLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXJyYXlzIHx8IG9wdGlvbnMuZGVmYXVsdHMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3Quc2VjdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubnVtVGltZXMgPSAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zZWN0aW9ucyAmJiBtZXNzYWdlLnNlY3Rpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25zID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2Uuc2VjdGlvbnMubGVuZ3RoOyArK2opXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LnNlY3Rpb25zW2pdID0gJHJvb3QudGVuc29yZmxvdy5tYWdlbnRhLk5vdGVTZXF1ZW5jZS5TZWN0aW9uLnRvT2JqZWN0KG1lc3NhZ2Uuc2VjdGlvbnNbal0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm51bVRpbWVzICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcIm51bVRpbWVzXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm51bVRpbWVzID0gbWVzc2FnZS5udW1UaW1lcztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBTZWN0aW9uR3JvdXAgdG8gSlNPTi5cbiAgICAgICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5Ob3RlU2VxdWVuY2UuU2VjdGlvbkdyb3VwXG4gICAgICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIFNlY3Rpb25Hcm91cC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCAkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNlY3Rpb25Hcm91cDtcbiAgICAgICAgICAgIH0pKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBOb3RlU2VxdWVuY2U7XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgbWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFByb3BlcnRpZXMgb2YgYSBTZXF1ZW5jZU1ldGFkYXRhLlxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YVxuICAgICAgICAgICAgICogQGludGVyZmFjZSBJU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd8bnVsbH0gW3RpdGxlXSBTZXF1ZW5jZU1ldGFkYXRhIHRpdGxlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ3xudWxsfSBbYXJ0aXN0XSBTZXF1ZW5jZU1ldGFkYXRhIGFydGlzdFxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtBcnJheS48c3RyaW5nPnxudWxsfSBbZ2VucmVdIFNlcXVlbmNlTWV0YWRhdGEgZ2VucmVcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXJyYXkuPHN0cmluZz58bnVsbH0gW2NvbXBvc2Vyc10gU2VxdWVuY2VNZXRhZGF0YSBjb21wb3NlcnNcbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgU2VxdWVuY2VNZXRhZGF0YS5cbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGFcbiAgICAgICAgICAgICAqIEBjbGFzc2Rlc2MgUmVwcmVzZW50cyBhIFNlcXVlbmNlTWV0YWRhdGEuXG4gICAgICAgICAgICAgKiBAaW1wbGVtZW50cyBJU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5JU2VxdWVuY2VNZXRhZGF0YT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiBTZXF1ZW5jZU1ldGFkYXRhKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdlbnJlID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wb3NlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcylcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5c1tpXV0gPSBwcm9wZXJ0aWVzW2tleXNbaV1dO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFNlcXVlbmNlTWV0YWRhdGEgdGl0bGUuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtzdHJpbmd9IHRpdGxlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnByb3RvdHlwZS50aXRsZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogU2VxdWVuY2VNZXRhZGF0YSBhcnRpc3QuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtzdHJpbmd9IGFydGlzdFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgU2VxdWVuY2VNZXRhZGF0YS5wcm90b3R5cGUuYXJ0aXN0ID0gXCJcIjtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBTZXF1ZW5jZU1ldGFkYXRhIGdlbnJlLlxuICAgICAgICAgICAgICogQG1lbWJlciB7QXJyYXkuPHN0cmluZz59IGdlbnJlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnByb3RvdHlwZS5nZW5yZSA9ICR1dGlsLmVtcHR5QXJyYXk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogU2VxdWVuY2VNZXRhZGF0YSBjb21wb3NlcnMuXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtBcnJheS48c3RyaW5nPn0gY29tcG9zZXJzXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnByb3RvdHlwZS5jb21wb3NlcnMgPSAkdXRpbC5lbXB0eUFycmF5O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgU2VxdWVuY2VNZXRhZGF0YSBpbnN0YW5jZSB1c2luZyB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gY3JlYXRlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklTZXF1ZW5jZU1ldGFkYXRhPX0gW3Byb3BlcnRpZXNdIFByb3BlcnRpZXMgdG8gc2V0XG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGF9IFNlcXVlbmNlTWV0YWRhdGEgaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgU2VxdWVuY2VNZXRhZGF0YS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUocHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VxdWVuY2VNZXRhZGF0YShwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZS4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGEudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklTZXF1ZW5jZU1ldGFkYXRhfSBtZXNzYWdlIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgU2VxdWVuY2VNZXRhZGF0YS5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF3cml0ZXIpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlciA9ICRXcml0ZXIuY3JlYXRlKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGl0bGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGl0bGVcIikpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMiA9Ki8xMCkuc3RyaW5nKG1lc3NhZ2UudGl0bGUpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmFydGlzdCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJhcnRpc3RcIikpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMiwgd2lyZVR5cGUgMiA9Ki8xOCkuc3RyaW5nKG1lc3NhZ2UuYXJ0aXN0KTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5nZW5yZSAhPSBudWxsICYmIG1lc3NhZ2UuZ2VucmUubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2UuZ2VucmUubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDMsIHdpcmVUeXBlIDIgPSovMjYpLnN0cmluZyhtZXNzYWdlLmdlbnJlW2ldKTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb21wb3NlcnMgIT0gbnVsbCAmJiBtZXNzYWdlLmNvbXBvc2Vycy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5jb21wb3NlcnMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIudWludDMyKC8qIGlkIDQsIHdpcmVUeXBlIDIgPSovMzQpLnN0cmluZyhtZXNzYWdlLmNvbXBvc2Vyc1tpXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZSwgbGVuZ3RoIGRlbGltaXRlZC4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGEudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklTZXF1ZW5jZU1ldGFkYXRhfSBtZXNzYWdlIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgU2VxdWVuY2VNZXRhZGF0YS5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIERlY29kZXMgYSBTZXF1ZW5jZU1ldGFkYXRhIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YX0gU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhKCk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS50aXRsZSA9IHJlYWRlci5zdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFydGlzdCA9IHJlYWRlci5zdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLmdlbnJlICYmIG1lc3NhZ2UuZ2VucmUubGVuZ3RoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmdlbnJlID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmdlbnJlLnB1c2gocmVhZGVyLnN0cmluZygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtZXNzYWdlLmNvbXBvc2VycyAmJiBtZXNzYWdlLmNvbXBvc2Vycy5sZW5ndGgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29tcG9zZXJzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbXBvc2Vycy5wdXNoKHJlYWRlci5zdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5za2lwVHlwZSh0YWcgJiA3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBEZWNvZGVzIGEgU2VxdWVuY2VNZXRhZGF0YSBtZXNzYWdlIGZyb20gdGhlIHNwZWNpZmllZCByZWFkZXIgb3IgYnVmZmVyLCBsZW5ndGggZGVsaW1pdGVkLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5SZWFkZXJ8VWludDhBcnJheX0gcmVhZGVyIFJlYWRlciBvciBidWZmZXIgdG8gZGVjb2RlIGZyb21cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YX0gU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLmRlY29kZURlbGltaXRlZCA9IGZ1bmN0aW9uIGRlY29kZURlbGltaXRlZChyZWFkZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShyZWFkZXIgaW5zdGFuY2VvZiAkUmVhZGVyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyID0gbmV3ICRSZWFkZXIocmVhZGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGUocmVhZGVyLCByZWFkZXIudWludDMyKCkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBWZXJpZmllcyBhIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZS5cbiAgICAgICAgICAgICAqIEBmdW5jdGlvbiB2ZXJpZnlcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gbWVzc2FnZSBQbGFpbiBvYmplY3QgdG8gdmVyaWZ5XG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IGBudWxsYCBpZiB2YWxpZCwgb3RoZXJ3aXNlIHRoZSByZWFzb24gd2h5IGl0IGlzIG5vdFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnZlcmlmeSA9IGZ1bmN0aW9uIHZlcmlmeShtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIm9iamVjdFwiIHx8IG1lc3NhZ2UgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIm9iamVjdCBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpdGxlICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcInRpdGxlXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzU3RyaW5nKG1lc3NhZ2UudGl0bGUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGl0bGU6IHN0cmluZyBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmFydGlzdCAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJhcnRpc3RcIikpXG4gICAgICAgICAgICAgICAgICAgIGlmICghJHV0aWwuaXNTdHJpbmcobWVzc2FnZS5hcnRpc3QpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYXJ0aXN0OiBzdHJpbmcgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5nZW5yZSAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJnZW5yZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS5nZW5yZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJnZW5yZTogYXJyYXkgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlLmdlbnJlLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLmdlbnJlW2ldKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJnZW5yZTogc3RyaW5nW10gZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY29tcG9zZXJzICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImNvbXBvc2Vyc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZS5jb21wb3NlcnMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29tcG9zZXJzOiBhcnJheSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2UuY29tcG9zZXJzLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdXRpbC5pc1N0cmluZyhtZXNzYWdlLmNvbXBvc2Vyc1tpXSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29tcG9zZXJzOiBzdHJpbmdbXSBleHBlY3RlZFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ3JlYXRlcyBhIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhfSBTZXF1ZW5jZU1ldGFkYXRhXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFNlcXVlbmNlTWV0YWRhdGEuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5TZXF1ZW5jZU1ldGFkYXRhKCk7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC50aXRsZSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnRpdGxlID0gU3RyaW5nKG9iamVjdC50aXRsZSk7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5hcnRpc3QgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5hcnRpc3QgPSBTdHJpbmcob2JqZWN0LmFydGlzdCk7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5nZW5yZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqZWN0LmdlbnJlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YS5nZW5yZTogYXJyYXkgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZ2VucmUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmplY3QuZ2VucmUubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmdlbnJlW2ldID0gU3RyaW5nKG9iamVjdC5nZW5yZVtpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QuY29tcG9zZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvYmplY3QuY29tcG9zZXJzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihcIi50ZW5zb3JmbG93Lm1hZ2VudGEuU2VxdWVuY2VNZXRhZGF0YS5jb21wb3NlcnM6IGFycmF5IGV4cGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbXBvc2VycyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdC5jb21wb3NlcnMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbXBvc2Vyc1tpXSA9IFN0cmluZyhvYmplY3QuY29tcG9zZXJzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENyZWF0ZXMgYSBwbGFpbiBvYmplY3QgZnJvbSBhIFNlcXVlbmNlTWV0YWRhdGEgbWVzc2FnZS4gQWxzbyBjb252ZXJ0cyB2YWx1ZXMgdG8gb3RoZXIgdHlwZXMgaWYgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvT2JqZWN0XG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGF9IG1lc3NhZ2UgU2VxdWVuY2VNZXRhZGF0YVxuICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuSUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnRvT2JqZWN0ID0gZnVuY3Rpb24gdG9PYmplY3QobWVzc2FnZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hcnJheXMgfHwgb3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuZ2VucmUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmNvbXBvc2VycyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kZWZhdWx0cykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QudGl0bGUgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBvYmplY3QuYXJ0aXN0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGl0bGUgIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwidGl0bGVcIikpXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC50aXRsZSA9IG1lc3NhZ2UudGl0bGU7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuYXJ0aXN0ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcImFydGlzdFwiKSlcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmFydGlzdCA9IG1lc3NhZ2UuYXJ0aXN0O1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmdlbnJlICYmIG1lc3NhZ2UuZ2VucmUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5nZW5yZSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2UuZ2VucmUubGVuZ3RoOyArK2opXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuZ2VucmVbal0gPSBtZXNzYWdlLmdlbnJlW2pdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5jb21wb3NlcnMgJiYgbWVzc2FnZS5jb21wb3NlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5jb21wb3NlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZXNzYWdlLmNvbXBvc2Vycy5sZW5ndGg7ICsrailcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5jb21wb3NlcnNbal0gPSBtZXNzYWdlLmNvbXBvc2Vyc1tqXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ29udmVydHMgdGhpcyBTZXF1ZW5jZU1ldGFkYXRhIHRvIEpTT04uXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gdG9KU09OXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlNlcXVlbmNlTWV0YWRhdGFcbiAgICAgICAgICAgICAqIEBpbnN0YW5jZVxuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBKU09OIG9iamVjdFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBTZXF1ZW5jZU1ldGFkYXRhLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywgJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gU2VxdWVuY2VNZXRhZGF0YTtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICBtYWdlbnRhLlZlbG9jaXR5UmFuZ2UgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUHJvcGVydGllcyBvZiBhIFZlbG9jaXR5UmFuZ2UuXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhXG4gICAgICAgICAgICAgKiBAaW50ZXJmYWNlIElWZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBbbWluXSBWZWxvY2l0eVJhbmdlIG1pblxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ8bnVsbH0gW21heF0gVmVsb2NpdHlSYW5nZSBtYXhcbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENvbnN0cnVjdHMgYSBuZXcgVmVsb2NpdHlSYW5nZS5cbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGFcbiAgICAgICAgICAgICAqIEBjbGFzc2Rlc2MgUmVwcmVzZW50cyBhIFZlbG9jaXR5UmFuZ2UuXG4gICAgICAgICAgICAgKiBAaW1wbGVtZW50cyBJVmVsb2NpdHlSYW5nZVxuICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5JVmVsb2NpdHlSYW5nZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiBWZWxvY2l0eVJhbmdlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcylcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5cyA9IE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1trZXlzW2ldXSAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNba2V5c1tpXV0gPSBwcm9wZXJ0aWVzW2tleXNbaV1dO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFZlbG9jaXR5UmFuZ2UgbWluLlxuICAgICAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfSBtaW5cbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuVmVsb2NpdHlSYW5nZVxuICAgICAgICAgICAgICogQGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZlbG9jaXR5UmFuZ2UucHJvdG90eXBlLm1pbiA9IDA7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVmVsb2NpdHlSYW5nZSBtYXguXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IG1heFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS5wcm90b3R5cGUubWF4ID0gMDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IFZlbG9jaXR5UmFuZ2UgaW5zdGFuY2UgdXNpbmcgdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGNyZWF0ZVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5JVmVsb2NpdHlSYW5nZT19IFtwcm9wZXJ0aWVzXSBQcm9wZXJ0aWVzIHRvIHNldFxuICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlfSBWZWxvY2l0eVJhbmdlIGluc3RhbmNlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZlbG9jaXR5UmFuZ2UuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZlbG9jaXR5UmFuZ2UocHJvcGVydGllcyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBWZWxvY2l0eVJhbmdlIG1lc3NhZ2UuIERvZXMgbm90IGltcGxpY2l0bHkge0BsaW5rIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlLnZlcmlmeXx2ZXJpZnl9IG1lc3NhZ2VzLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGVuY29kZVxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5JVmVsb2NpdHlSYW5nZX0gbWVzc2FnZSBWZWxvY2l0eVJhbmdlIG1lc3NhZ2Ugb3IgcGxhaW4gb2JqZWN0IHRvIGVuY29kZVxuICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuV3JpdGVyfSBbd3JpdGVyXSBXcml0ZXIgdG8gZW5jb2RlIHRvXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7JHByb3RvYnVmLldyaXRlcn0gV3JpdGVyXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZlbG9jaXR5UmFuZ2UuZW5jb2RlID0gZnVuY3Rpb24gZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikge1xuICAgICAgICAgICAgICAgIGlmICghd3JpdGVyKVxuICAgICAgICAgICAgICAgICAgICB3cml0ZXIgPSAkV3JpdGVyLmNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm1pbiAhPSBudWxsICYmIG1lc3NhZ2UuaGFzT3duUHJvcGVydHkoXCJtaW5cIikpXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51aW50MzIoLyogaWQgMSwgd2lyZVR5cGUgMCA9Ki84KS5pbnQzMihtZXNzYWdlLm1pbik7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubWF4ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcIm1heFwiKSlcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnVpbnQzMigvKiBpZCAyLCB3aXJlVHlwZSAwID0qLzE2KS5pbnQzMihtZXNzYWdlLm1heCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlcjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIFZlbG9jaXR5UmFuZ2UgbWVzc2FnZSwgbGVuZ3RoIGRlbGltaXRlZC4gRG9lcyBub3QgaW1wbGljaXRseSB7QGxpbmsgdGVuc29yZmxvdy5tYWdlbnRhLlZlbG9jaXR5UmFuZ2UudmVyaWZ5fHZlcmlmeX0gbWVzc2FnZXMuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZW5jb2RlRGVsaW1pdGVkXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlZlbG9jaXR5UmFuZ2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7dGVuc29yZmxvdy5tYWdlbnRhLklWZWxvY2l0eVJhbmdlfSBtZXNzYWdlIFZlbG9jaXR5UmFuZ2UgbWVzc2FnZSBvciBwbGFpbiBvYmplY3QgdG8gZW5jb2RlXG4gICAgICAgICAgICAgKiBAcGFyYW0geyRwcm90b2J1Zi5Xcml0ZXJ9IFt3cml0ZXJdIFdyaXRlciB0byBlbmNvZGUgdG9cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHskcHJvdG9idWYuV3JpdGVyfSBXcml0ZXJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS5lbmNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBlbmNvZGVEZWxpbWl0ZWQobWVzc2FnZSwgd3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlKG1lc3NhZ2UsIHdyaXRlcikubGRlbGltKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIERlY29kZXMgYSBWZWxvY2l0eVJhbmdlIG1lc3NhZ2UgZnJvbSB0aGUgc3BlY2lmaWVkIHJlYWRlciBvciBidWZmZXIuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gZGVjb2RlXG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlZlbG9jaXR5UmFuZ2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLlJlYWRlcnxVaW50OEFycmF5fSByZWFkZXIgUmVhZGVyIG9yIGJ1ZmZlciB0byBkZWNvZGUgZnJvbVxuICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGhdIE1lc3NhZ2UgbGVuZ3RoIGlmIGtub3duIGJlZm9yZWhhbmRcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHt0ZW5zb3JmbG93Lm1hZ2VudGEuVmVsb2NpdHlSYW5nZX0gVmVsb2NpdHlSYW5nZVxuICAgICAgICAgICAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBwYXlsb2FkIGlzIG5vdCBhIHJlYWRlciBvciB2YWxpZCBidWZmZXJcbiAgICAgICAgICAgICAqIEB0aHJvd3MgeyRwcm90b2J1Zi51dGlsLlByb3RvY29sRXJyb3J9IElmIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBWZWxvY2l0eVJhbmdlLmRlY29kZSA9IGZ1bmN0aW9uIGRlY29kZShyZWFkZXIsIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghKHJlYWRlciBpbnN0YW5jZW9mICRSZWFkZXIpKVxuICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSAkUmVhZGVyLmNyZWF0ZShyZWFkZXIpO1xuICAgICAgICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggPT09IHVuZGVmaW5lZCA/IHJlYWRlci5sZW4gOiByZWFkZXIucG9zICsgbGVuZ3RoLCBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHJlYWRlci5wb3MgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IHJlYWRlci51aW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcgPj4+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5taW4gPSByZWFkZXIuaW50MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm1heCA9IHJlYWRlci5pbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIuc2tpcFR5cGUodGFnICYgNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRGVjb2RlcyBhIFZlbG9jaXR5UmFuZ2UgbWVzc2FnZSBmcm9tIHRoZSBzcGVjaWZpZWQgcmVhZGVyIG9yIGJ1ZmZlciwgbGVuZ3RoIGRlbGltaXRlZC5cbiAgICAgICAgICAgICAqIEBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWRcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuVmVsb2NpdHlSYW5nZVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHskcHJvdG9idWYuUmVhZGVyfFVpbnQ4QXJyYXl9IHJlYWRlciBSZWFkZXIgb3IgYnVmZmVyIHRvIGRlY29kZSBmcm9tXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7dGVuc29yZmxvdy5tYWdlbnRhLlZlbG9jaXR5UmFuZ2V9IFZlbG9jaXR5UmFuZ2VcbiAgICAgICAgICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgcGF5bG9hZCBpcyBub3QgYSByZWFkZXIgb3IgdmFsaWQgYnVmZmVyXG4gICAgICAgICAgICAgKiBAdGhyb3dzIHskcHJvdG9idWYudXRpbC5Qcm90b2NvbEVycm9yfSBJZiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS5kZWNvZGVEZWxpbWl0ZWQgPSBmdW5jdGlvbiBkZWNvZGVEZWxpbWl0ZWQocmVhZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEocmVhZGVyIGluc3RhbmNlb2YgJFJlYWRlcikpXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IG5ldyAkUmVhZGVyKHJlYWRlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlKHJlYWRlciwgcmVhZGVyLnVpbnQzMigpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVmVyaWZpZXMgYSBWZWxvY2l0eVJhbmdlIG1lc3NhZ2UuXG4gICAgICAgICAgICAgKiBAZnVuY3Rpb24gdmVyaWZ5XG4gICAgICAgICAgICAgKiBAbWVtYmVyb2YgdGVuc29yZmxvdy5tYWdlbnRhLlZlbG9jaXR5UmFuZ2VcbiAgICAgICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IG1lc3NhZ2UgUGxhaW4gb2JqZWN0IHRvIHZlcmlmeVxuICAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBgbnVsbGAgaWYgdmFsaWQsIG90aGVyd2lzZSB0aGUgcmVhc29uIHdoeSBpdCBpcyBub3RcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS52ZXJpZnkgPSBmdW5jdGlvbiB2ZXJpZnkobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gXCJvYmplY3RcIiB8fCBtZXNzYWdlID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3QgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5taW4gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibWluXCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLm1pbikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJtaW46IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5tYXggIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibWF4XCIpKVxuICAgICAgICAgICAgICAgICAgICBpZiAoISR1dGlsLmlzSW50ZWdlcihtZXNzYWdlLm1heCkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJtYXg6IGludGVnZXIgZXhwZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ3JlYXRlcyBhIFZlbG9jaXR5UmFuZ2UgbWVzc2FnZSBmcm9tIGEgcGxhaW4gb2JqZWN0LiBBbHNvIGNvbnZlcnRzIHZhbHVlcyB0byB0aGVpciByZXNwZWN0aXZlIGludGVybmFsIHR5cGVzLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZyb21PYmplY3RcbiAgICAgICAgICAgICAqIEBtZW1iZXJvZiB0ZW5zb3JmbG93Lm1hZ2VudGEuVmVsb2NpdHlSYW5nZVxuICAgICAgICAgICAgICogQHN0YXRpY1xuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3QuPHN0cmluZywqPn0gb2JqZWN0IFBsYWluIG9iamVjdFxuICAgICAgICAgICAgICogQHJldHVybnMge3RlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlfSBWZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFZlbG9jaXR5UmFuZ2UuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3ICRyb290LnRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgaWYgKG9iamVjdC5taW4gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5taW4gPSBvYmplY3QubWluIHwgMDtcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lm1heCAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm1heCA9IG9iamVjdC5tYXggfCAwO1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDcmVhdGVzIGEgcGxhaW4gb2JqZWN0IGZyb20gYSBWZWxvY2l0eVJhbmdlIG1lc3NhZ2UuIEFsc28gY29udmVydHMgdmFsdWVzIHRvIG90aGVyIHR5cGVzIGlmIHNwZWNpZmllZC5cbiAgICAgICAgICAgICAqIEBmdW5jdGlvbiB0b09iamVjdFxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3RlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlfSBtZXNzYWdlIFZlbG9jaXR5UmFuZ2VcbiAgICAgICAgICAgICAqIEBwYXJhbSB7JHByb3RvYnVmLklDb252ZXJzaW9uT3B0aW9uc30gW29wdGlvbnNdIENvbnZlcnNpb24gb3B0aW9uc1xuICAgICAgICAgICAgICogQHJldHVybnMge09iamVjdC48c3RyaW5nLCo+fSBQbGFpbiBvYmplY3RcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS50b09iamVjdCA9IGZ1bmN0aW9uIHRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm1pbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdC5tYXggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5taW4gIT0gbnVsbCAmJiBtZXNzYWdlLmhhc093blByb3BlcnR5KFwibWluXCIpKVxuICAgICAgICAgICAgICAgICAgICBvYmplY3QubWluID0gbWVzc2FnZS5taW47XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubWF4ICE9IG51bGwgJiYgbWVzc2FnZS5oYXNPd25Qcm9wZXJ0eShcIm1heFwiKSlcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm1heCA9IG1lc3NhZ2UubWF4O1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENvbnZlcnRzIHRoaXMgVmVsb2NpdHlSYW5nZSB0byBKU09OLlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIHRvSlNPTlxuICAgICAgICAgICAgICogQG1lbWJlcm9mIHRlbnNvcmZsb3cubWFnZW50YS5WZWxvY2l0eVJhbmdlXG4gICAgICAgICAgICAgKiBAaW5zdGFuY2VcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3QuPHN0cmluZywqPn0gSlNPTiBvYmplY3RcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgVmVsb2NpdHlSYW5nZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsICRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIFZlbG9jaXR5UmFuZ2U7XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgcmV0dXJuIG1hZ2VudGE7XG4gICAgfSkoKTtcblxuICAgIHJldHVybiB0ZW5zb3JmbG93O1xufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSAkcm9vdDtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@magenta+music@1.23.1_@tensorflow+tfjs-core@2.8.6_seedrandom@2.4.4/node_modules/@magenta/music/esm/protobuf/proto.js\n");

/***/ })

};
;